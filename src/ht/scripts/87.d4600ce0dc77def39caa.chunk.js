(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{1154:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"task-panel-wrap c-sub-lay"},[e("div",{staticClass:"c-sub-menu"},[e("ul",t._l(t.taskCodes,(function(a,s){return e("li",{key:s,class:{active:t.params.type==t.taskType[s]},on:{click:function(a){return t.typeClick(s)}}},[e("a",{attrs:{href:"javascript:void(null)"}},[t._v(t._s(a))])])})),0)]),t._v(" "),e("div",{staticClass:"c-sub-main c-scrollbar"},[e("div",{staticClass:"c-left-border-blue"},[e("div",{staticClass:"c-search-main"},[e("div",{staticClass:"c-form-item"},[e("label",[t._v("关键字：")]),e("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"任务标题"},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&t._k(a.keyCode,"enter",13,a.key,"Enter")?null:t.search(a)}},model:{value:t.params.queryName,callback:function(a){t.$set(t.params,"queryName",a)},expression:"params.queryName"}})],1),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("所属组织：")]),e("dropdown-tree",{staticStyle:{width:"200px"},attrs:{url:t.treeApi.getOrgTreeData,multiple:!0},model:{value:t.org,callback:function(a){t.org=a},expression:"org"}})],1),t._v(" "),e("div",{staticClass:"c-adv-search-btn"},[e("a",{attrs:{href:"javascript:;"},on:{click:function(a){t.advSearch=!t.advSearch}}},[e("Icon",{directives:[{name:"show",rawName:"v-show",value:!t.advSearch,expression:"!advSearch"}],attrs:{type:"ios-arrow-down"}}),e("Icon",{directives:[{name:"show",rawName:"v-show",value:t.advSearch,expression:"advSearch"}],attrs:{type:"ios-arrow-up"}}),t._v("高级搜索")],1),t._v(" "),e("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),e("Button",{staticClass:"c-btn-reset",attrs:{type:"primary",shape:"circle"},on:{click:t.paramsClean}},[t._v("重置")])],1)]),t._v(" "),e("collapse-transition",[e("div",{directives:[{name:"show",rawName:"v-show",value:t.advSearch,expression:"advSearch"}],staticClass:"c-adv-search"},[e("div",{staticClass:"c-adv-search-row"},[e("div",{staticClass:"c-form-item c-form-item-tab"},[e("label",[t._v("时间：")]),t._v(" "),e("mg-tab",{attrs:{groups:t.timeMap},on:{"on-click":t.selectClick},model:{value:t.timeActive,callback:function(a){t.timeActive=a},expression:"timeActive"}})],1)]),t._v(" "),e("div",{staticClass:"c-adv-search-row"},[e("div",{staticClass:"c-form-item c-form-item-tab"},[e("label",[t._v("任务状态：")]),t._v(" "),e("mg-tab",{attrs:{groups:t.taskStatusGroups},on:{"on-click":t.selectClick},model:{value:t.status,callback:function(a){t.status=a},expression:"status"}})],1)])])])],1),t._v(" "),e("div",{staticClass:"task-panel-list c-top-border-gray"},[t.loading?e("Spin",{attrs:{size:"large",fix:""}}):t._e(),t._v(" "),e("div",[t._l(t.listData,(function(a,s){return e("div",{key:s,staticClass:"c-right-list"},[e("Row",{staticClass:"list-title",attrs:{type:"flex",align:"middle"}},[e("Col",[t._v(t._s(a.title))])],1),t._v(" "),t._l(a.list,(function(a,s){return e("Row",{key:s,staticClass:"list-item",attrs:{type:"flex",align:"middle"}},[e("Col",{staticStyle:{"white-space":"nowrap",overflow:"hidden"},attrs:{span:"13"}},[e("a",{attrs:{href:"javascript:void(null)"},on:{click:function(e){return t.detailClick(a)}}},[t._v(t._s(a.name))])]),t._v(" "),e("Col",{attrs:{span:"5"}},[e("span",{staticStyle:{"margin-left":"15px"}},[t._v(t._s(a.no))])]),t._v(" "),e("Col",{attrs:{span:"2"}},[e("span",[t._v(t._s(a.statusName))])]),t._v(" "),e("Col",{staticClass:"item-time",attrs:{span:"4"}},[t._v(t._s(t.formatDateTime(a)))])],1)}))],2)})),t._v(" "),e("Row",{directives:[{name:"show",rawName:"v-show",value:!t.listData.length,expression:"!listData.length"}],staticClass:"c-nodata-tip"},[e("col"),t._v("暂无数据")]),t._v(" "),e("Page",{staticClass:"table-page",attrs:{total:t.total,"page-size":t.params.pageSize,current:t.params.currentPage,"show-total":"","show-elevator":""},on:{"on-change":t.pageChange}})],2)],1)])])};s._withStripped=!0;var i=e(23),n=e(519),r=e(145),o=e(524),l=e(107),c=e(608),p=e(11);function u(t){var a=t.type,e=void 0===a?"d":a,s=t.data,i=void 0===s?[]:s,n=t.key,r=void 0===n?"showTime":n,o=function(t){return(t?new Date(t):new Date).getDate()},l=function(t){return Math.ceil((t?new Date(t):new Date).getDate()/7)},c=function(t){return(t?new Date(t):new Date).getMonth()+1},p=0,u=[];return i.forEach((function(t,a,s){var i,n=a==s.length-1?a:a+1,d=t[r],m=[];(function(t,a){var s={d:o,w:l,m:c};return s[e](t)===s[e](a)})(d,s[n][r])&&a!=s.length-1||(m=s.slice(p,a+1),p=a+1,u.push({title:(i=d,new Date(i).getFullYear()+"年"+{d:c(i)+"月"+o(i)+"日",w:c(i)+"月第"+l(i)+"周",m:c(i)+"月"}[e]),list:m}))})),u}var d={components:{CollapseTransition:n.a,dropdownTree:r.a,mgTab:o.a},data:function(){return{treeApi:l.a,org:{id:"",title:"请选择"},params:{queryName:"",type:this.$route.params.type,status:1,orgIds:"",currentPage:1,pageSize:10},advSearch:!1,timeActive:[0],status:[1],listData:[],columns:[],loading:!1,total:0,taskStatusGroups:[]}},computed:Object(i.b)({taskStatusMap:function(t){return t.map.taskPanel.taskStatusMap},jobStatusMap:function(t){return t.map.taskPanel.jobStatusMap},timeMap:function(t){return t.map.taskPanel.timeMap},taskStatus:function(t){return t.map.taskPanel.taskStatus},taskType:function(t){return t.map.taskPanel.taskTypeMap.filter((function(a,e){var s=t.map.taskPanel.role[e];return-1!==sessionStorage.getItem("__MENUS_ROLE__").indexOf(s)}))},taskCodes:function(t){return t.map.taskPanel.taskCodes.filter((function(a,e){var s=t.map.taskPanel.role[e];return-1!==sessionStorage.getItem("__MENUS_ROLE__").indexOf(s)}))},taskTypeDetailMap:function(t){return t.map.taskPanel.taskTypeDetailMap}}),watch:{"$route.params.type":function(t){"fault"!=t&&"repair"!=t||(this.taskStatusGroups=this.jobStatusMap),"patrol"!=t&&"maintain"!=t||(this.taskStatusGroups=this.taskStatusMap),this.params.type=t,this.search()}},filters:{formatDateTime:p.a.transDateFromServer,formatDate:function(t){return p.a.transDateFromServer(t,"yyyy-MM-DD")}},methods:{formatDateTime:function(t){return"patrol"==this.params.type?p.a.transDateFromServer(t.showTime,"yyyy-MM-dd")+p.a.transDateFromServer(t.startTime," hh:mm"):"maintain"==this.params.type?p.a.transDateFromServer(t.showTime,"yyyy-MM-dd"):p.a.transDateFromServer(t.showTime,"yyyy-MM-dd hh:mm")},search:function(t){var a=this;this.loading=!0,this.params.currentPage="number"==typeof t?t:1,this.$http.get(c.a.getTasks,Object.assign({},this.params,{orgIds:this.org.id,type:this.taskStatus[this.params.type],status:this.status.join()})).then((function(t){if(t&&t.items){a.listData=u({type:{0:"d",1:"w",2:"m"}[a.timeActive.join()],data:t.items,key:"showTime"}),a.total=t.total}a.loading=!1})).catch((function(){a.listData=[],a.total=0,a.loading=!1}))},selectClick:function(t,a){this.search()},typeClick:function(t){this.paramsClean(),this.$router.replace({name:"task-panel",params:{type:this.taskType[t]}})},paramsClean:function(){this.org.id="",this.org.title="请选择",this.params.queryName="",this.params.pageSize=10,this.params.currentPage=1,this.params.status=[1],this.timeActive=[0],this.status=[1]},pageChange:function(t){this.params.currentPage=t,this.search(t)},detailClick:function(t){var a=this.taskTypeDetailMap[t.type];"patrol-task-detail"==a&&"Outside"==t.patrolType?this.$router.push({name:a,params:{id:t.id},query:{type:"map"}}):this.$router.push({name:a,params:{id:t.id}})}},created:function(){this.params.type||(this.params.type=this.taskType[0]);var t=this.params.type;"fault"!=t&&"repair"!=t||(this.taskStatusGroups=this.jobStatusMap),"patrol"!=t&&"maintain"!=t||(this.taskStatusGroups=this.taskStatusMap)},mounted:function(){this.search()}},m=(e(794),e(1)),h=Object(m.a)(d,s,[],!1,null,null,null);h.options.__file="src/views/task-panel/list.vue";a.default=h.exports},516:function(t,a,e){var s=e(526);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,e(17).default)("5a7c571a",s,!1,{})},519:function(t,a,e){"use strict";function s(t,a){if(!t||!a)return!1;if(-1!==a.indexOf(" "))throw new Error("className should not contain space.");return t.classList?t.classList.contains(a):(" "+t.className+" ").indexOf(" "+a+" ")>-1}function i(t,a){if(t){for(var e=t.className,i=(a||"").split(" "),n=0,r=i.length;n<r;n++){var o=i[n];o&&(t.classList?t.classList.add(o):s(t,o)||(e+=" "+o))}t.classList||(t.className=e)}}function n(t,a){if(t&&a){for(var e=a.split(" "),i=" "+t.className+" ",n=0,r=e.length;n<r;n++){var o=e[n];o&&(t.classList?t.classList.remove(o):s(t,o)&&(i=i.replace(" "+o+" "," ")))}t.classList||(t.className=trim(i))}}var r={beforeEnter:function(t){i(t,"collapse-transition"),t.dataset||(t.dataset={}),t.dataset.oldPaddingTop=t.style.paddingTop,t.dataset.oldPaddingBottom=t.style.paddingBottom,t.style.height="0",t.style.paddingTop=0,t.style.paddingBottom=0},enter:function(t){t.dataset.oldOverflow=t.style.overflow,0!==t.scrollHeight?(t.style.height=t.scrollHeight+"px",t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom):(t.style.height="",t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom),t.style.overflow="hidden"},afterEnter:function(t){n(t,"collapse-transition"),t.style.height="",t.style.overflow=t.dataset.oldOverflow},beforeLeave:function(t){t.dataset||(t.dataset={}),t.dataset.oldPaddingTop=t.style.paddingTop,t.dataset.oldPaddingBottom=t.style.paddingBottom,t.dataset.oldOverflow=t.style.overflow,t.style.height=t.scrollHeight+"px",t.style.overflow="hidden"},leave:function(t){0!==t.scrollHeight&&(i(t,"collapse-transition"),t.style.height=0,t.style.paddingTop=0,t.style.paddingBottom=0)},afterLeave:function(t){n(t,"collapse-transition"),t.style.height="",t.style.overflow=t.dataset.oldOverflow,t.style.paddingTop=t.dataset.oldPaddingTop,t.style.paddingBottom=t.dataset.oldPaddingBottom}};a.a={name:"CollapseTransition",functional:!0,render:function(t,a){var e=a.children;return t("transition",{on:r},e)}}},524:function(t,a,e){"use strict";var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"cmp-tab",class:{"cmp-tab-underline":t.underline}},t._l(t.items,(function(a){return e("a",{key:a.value,class:{active:t.activeIds.indexOf(a.value)>-1},attrs:{href:"javascript:;"},on:{click:function(e){return t.selectTab(a)}}},[t._v(t._s(a.label))])})),0)};function i(t){return function(t){if(Array.isArray(t)){for(var a=0,e=new Array(t.length);a<t.length;a++)e[a]=t[a];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}s._withStripped=!0;var n=null,r={name:"mgTab",props:{groups:Array,value:Array,multiple:{type:Boolean,default:!1},entire:{type:Boolean,default:!1},underline:Boolean},data:function(){return{activeIds:this.value,items:i(this.groups)}},watch:{groups:function(t){this.entire?this.items=[{label:"全部",value:n}].concat(i(t)):this.items=t},value:function(t){this.activeIds=t}},mounted:function(){this.entire&&this.items.unshift({label:"全部",value:n})},methods:{isSelected:function(t){return this.activeIds.indexOf(t)>-1},removeFromSelected:function(t){var a=this;this.activeIds.forEach((function(e,s){e==t&&a.activeIds.splice(s,1)}))},selectTab:function(t){this.entire&&t.value===n?this.activeIds=[n]:this.multiple?this.isSelected(t.value)?this.removeFromSelected(t.value):(this.activeIds.push(t.value),this.entire&&this.removeFromSelected(n)):(this.activeIds=[],this.activeIds.push(t.value)),this.$emit("input",this.activeIds),this.$emit("on-click",this.activeIds)},setValue:function(t){this.activeIds=t,this.$emit("input",this.activeIds)}}},o=(e(525),e(1)),l=Object(o.a)(r,s,[],!1,null,null,null);l.options.__file="src/components/mg-tab.vue";a.a=l.exports},525:function(t,a,e){"use strict";var s=e(516);e.n(s).a},526:function(t,a,e){(a=e(10)(!1)).push([t.i,"\n.cmp-tab {\r\n\tdisplay: inline-block;\n}\n.cmp-tab a {\r\n\tmargin-right: 20px;\t\r\n\tcolor: #576374;\n}\n.cmp-tab .active{\r\n\tcolor: #4B7EFE;\n}\n.cmp-tab-underline a {\r\n\tpadding: 2px 1px;\r\n\ttext-align: center;\n}\n.cmp-tab-underline .active  {\r\n\tborder-bottom: 2px solid #4B7EFE;\n}\r\n",""]),t.exports=a},608:function(t,a,e){"use strict";a.a={getTasks:"/portal/api/tasks",getConcern:"/portal/api/concerns"}},610:function(t,a,e){var s=e(795);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,e(17).default)("3eabeb35",s,!1,{})},794:function(t,a,e){"use strict";var s=e(610);e.n(s).a},795:function(t,a,e){(a=e(10)(!1)).push([t.i,".task-panel-wrap .task-panel-list {\n  position: relative;\n}\n.task-panel-wrap .task-panel-list .list-title {\n  height: 40px;\n  line-height: 40px;\n  padding-left: 20px;\n  background: #f4f4f4;\n}\n.task-panel-wrap .task-panel-list .list-item {\n  height: 60px;\n  padding-left: 20px;\n  line-height: 60px;\n  border-top: none;\n  border-bottom: 1px solid #eee;\n}\n.task-panel-wrap .task-panel-list .list-item:hover {\n  background-color: #fff;\n}\n.task-panel-wrap .task-panel-list .item-time {\n  padding-right: 20px;\n  text-align: right;\n}\n.task-panel-wrap .c-form-item-tab > span {\n  display: inline-block;\n  margin: 0 10px;\n  line-height: 20px;\n  font-size: 14px;\n  cursor: pointer;\n}\n",""]),t.exports=a}}]);