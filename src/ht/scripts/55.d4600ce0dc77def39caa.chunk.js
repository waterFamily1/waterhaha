(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{1149:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-tree"},[a("div",{staticClass:"c-tree-left",attrs:{id:"J_TREE_LEFT"}},[a("div",{staticStyle:{padding:"2px"}},[a("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"输入报表名称以检索",clearable:"",filterable:"",remote:"","remote-method":e.onSearch,loading:e.searchLoading},on:{"on-change":e.onSearchItemClick}},e._l(e.searchItems,(function(t){return a("Option",{key:t.id,attrs:{value:JSON.stringify(t)}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("div",{staticClass:"padding-l-10",staticStyle:{"border-top":"1px solid #e6e6e6",position:"relative"}},[e.treeLoading?a("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),a("Tree",{attrs:{data:e.treeData,render:e.renderContent}})],1)]),e._v(" "),a("div",{staticClass:"c-main-border c-tree-right"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"F"==e.activeType,expression:"activeType == 'F'"}]},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("报表目录")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveFolder}},[e._v("保存")])],1)]),e._v(" "),a("div",{staticStyle:{margin:"20px"}},[a("Form",{ref:"folderform",attrs:{model:e.floderForm,rules:e.floderFormRules,"label-width":120}},[a("FormItem",{attrs:{prop:"folderName",label:"目录名称"}},[a("Input",{staticStyle:{width:"200px"},attrs:{maxlength:20,placeholder:"目录名称"},model:{value:e.floderForm.folderName,callback:function(t){e.$set(e.floderForm,"folderName",t)},expression:"floderForm.folderName"}})],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"T"==e.activeType,expression:"activeType == 'T'"}]},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("报表模板")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveTempl}},[e._v("保存")]),e._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:1==e.saveType,expression:"saveType == 1"}],attrs:{type:"primary"},on:{click:e.linkToReort}},[e._v("预览")])],1)]),e._v(" "),a("div",{staticClass:"c-form-row-2col",staticStyle:{"margin-top":"10px"}},[a("Form",{ref:"form",attrs:{model:e.tmpData,rules:e.formRules,"label-width":120}},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"rname",label:"报表模板名称："}},[a("Input",{staticStyle:{width:"160px"},model:{value:e.tmpData.rname,callback:function(t){e.$set(e.tmpData,"rname",t)},expression:"tmpData.rname"}})],1)],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{label:"报表类型："}},[a("Select",{staticStyle:{width:"160px"},model:{value:e.tmpData.temptype,callback:function(t){e.$set(e.tmpData,"temptype",t)},expression:"tmpData.temptype"}},[a("Option",{attrs:{value:"D"}},[e._v("日报")]),e._v(" "),a("Option",{attrs:{value:"M"}},[e._v("月报")])],1)],1)],1)])],1),e._v(" "),a("h3",{staticClass:"c-gray-bg-h",staticStyle:{margin:"0 10px","text-indent":"10px"}},[e._v("报表数据源")]),e._v(" "),a("div",{staticStyle:{margin:"10px 0 0 10px","border-bottom":"1px solid #EFEFEF","padding-bottom":"10px"}},[a("Button",{staticClass:"c-btn-add",attrs:{type:"primary"},on:{click:e.addItem}},[e._v("新增")])],1),e._v(" "),a("Table",{attrs:{columns:e.columns,data:e.groupsData,stripe:"",size:"small"}})],1)]),e._v(" "),a("Modal",{attrs:{width:"600",title:"选择测点"},model:{value:e.modalShown,callback:function(t){e.modalShown=t},expression:"modalShown"}},[a("mg-mpoint-table",{ref:"modalTable",attrs:{query:{datasource:"INPUT,CALC"}},on:{"on-submit":e.onModalSelect,"on-cancel":e.onModalSelectCancel}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};i._withStripped=!0;a(23);var n=a(11),r=a(580),o=a(39);function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function l(e,t){return(t||"template_")+e}var c={data:function(){var e=this;return{treeLoading:!1,searchLoading:!1,searchItems:[],treeData:[],activeTreeId:"",activeType:"",saveType:0,saveLoading:!1,floderForm:{folderName:""},floderFormRules:{folderName:{required:!0,message:"请输入目录名称",trigger:"blur"}},tmpData:{rname:"",temptype:"D"},formRules:{rname:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"名称不能超过20个字符",trigger:"change"}]},columns:[{title:"分组名称",key:"groupname",width:180,render:function(t,a){return t("Input",{style:{width:"150px"},props:{size:"small",value:e.groupsData[a.index].groupname},on:{input:function(t){e.groupsData[a.index]=Object.assign({},e.groupsData[a.index],{groupname:t})}}})}},{title:"分组序号",key:"groupno",width:110,render:function(t,a){return t("Input",{style:{width:"80px"},props:{size:"small",value:e.groupsData[a.index].groupno},on:{input:function(t){e.groupsData[a.index]=Object.assign({},e.groupsData[a.index],{groupno:t})}}})}},{title:"测点",key:"mpointname",render:function(t,a){return t("div",[t("span",{class:"report-setting-mp-name",attrs:{title:a.row.mpointname}},a.row.mpointname),t("span",{class:a.row.mpoints.length>0?"report-setting-mp-sum":"report-setting-mp-sum-warning"},a.row.mpoints.length),t("a",{class:"c-btn-text",on:{click:function(){var t=e.groupsData[a.index];e.modalShown=!0,e.activeGroupData={row:t,index:a.index},e.selected=t.mpoints||[]}}},"[选择]")])}},{title:"操作",key:"",width:60,render:function(t,a){return t("div",[n.a.tableBtnStyle(t,(function(){e.groupsData.splice(a.index,1)}),"删除")])}}],groupsData:[],modalShown:!1,modalColumns:[{type:"selection",width:50},{title:"测点编号",key:"mpointId"},{title:"区域位置",key:"siteName"},{title:"测点名称",key:"mpointName"}],modalUrl:o.a.point,selected:[],activeGroupData:{}}},methods:{onSearch:function(e){var t=this;e&&(this.searchLoading=!0,this.$http.get(r.a.tree,{query:e}).then((function(e){t.searchLoading=!1,t.searchItems=e.filter((function(e){return 11==e.type}))||[]})).catch((function(){t.searchLoading=!1})))},onSearchItemClick:function(e){var t=JSON.parse(e);n.a.setTrueTreeExpand(this.treeData,t.id),this.activeTreeId=t.id,this.activeType="T",this.saveType=1,this.getTemplData(t.id)},getTreeData:function(){var e=this;this.treeLoading=!0,this.$http.get(r.a.normalTree).then((function(t){e.treeData=n.a.transDataToTree(t.map((function(e){return e.expand=!0,e}))),e.treeLoading=!1}))},renderContent:function(e,t){var a=this,i=(t.root,t.node,t.data),r=e("a",{attrs:{href:"javascript:;"},on:{click:function(){a.addFolder(i)}}},["新增目录"]),o=e("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-edit":!0},on:{click:function(){a.addTemplate(i)}}},["新增模板"]),s=n.a.treeBtnDelStyle(e,(function(){a.delClick(i)})),l=[];return"1"==i.type?l=[r]:"2"==i.type||"3"==i.type||"4"==i.type?l=[r,o]:"10"==i.type?l=[o,s]:"11"!=i.type&&"12"!=i.type||(l=[s]),e("div",{class:{"c-tree-row":!0}},[e("span",{class:{"ivu-tree-title":10==i.type||11==i.type||12==i.type,"ivu-tree-title-selected":i.id==this.activeTreeId,"report-tree-icon-normal":11==i.type,"report-tree-icon-folder":10==i.type},on:{click:function(){10!=i.type&&11!=i.type&&12!=i.type||a.infoClick(i)}}},[i.title]),e("div",{class:{"c-tree-btns":!0}},l)])},delClick:function(e){var t,a=this;10==e.type?t=r.a.folder:11==e.type&&(t=r.a.template),t&&this.$http.del(t,{ids:e.id}).then((function(e){e.count&&(a.$Notice.success({title:"删除成功"}),a.getTreeData(),a.activeType="")}))},infoClick:function(e){this.activeTreeId=e.id,this.saveType=1,10==e.type?(this.activeType="F",this.floderForm.folderName=e.title):11==e.type&&(this.activeType="T",this.getTemplData(e.id))},addFolder:function(e){this.activeType="F",this.activeTreeId=e.id,this.floderForm.folderName="",this.saveType=0},saveFolder:function(){var e,t=this,a="put",i="id",n={};0==this.saveType&&(a="post",i="siteid"),s(e={},i,this.activeTreeId),s(e,"fname",this.floderForm.folderName),n=e,this.$refs.folderform.validate((function(e){e&&(t.saveLoading=!0,t.$http[a](r.a.folder,n).then((function(e){t.saveLoading=!1,t.$Notice.success({title:"数据保存成功"}),0==t.saveType&&(t.saveType=1,t.activeTreeId=l(e.id,"folder_")),t.getTreeData()})))}))},addTemplate:function(e){this.activeTreeId=e.id,this.activeType="T",this.tmpData={rname:"",temptype:"D",siteid:e.siteId},10==e.type?this.tmpData.folderid=e.id:this.tmpData.siteid=e.id,this.groupsData=[],this.saveType=0},addItem:function(){var e=this.groupsData.length+1;this.groupsData.push({groupname:"未命名分组"+e,groupno:e,mpointname:"",mpoints:[],tempid:this.tmpData.id})},getTemplData:function(e){var t=this;this.$http.get(r.a.template+"/"+function(e){return e.replace(/(template_)/gi,"")}(e)).then((function(e){t.tmpData=e,t.groupsData=function(e){var t={},a=[];for(var i in e.map((function(e){var a=e.groupname;t[a]?t[a].push(e):t[a]=[e]})),t){var n=t[i],r=[];n.forEach((function(e){r.push(e.mpointname)})),a.push({groupname:n[0].groupname,groupno:n[0].groupno,tempid:n[0].tempid,mpointname:r.join(),mpoints:n})}return a}(e.mpoints||[])}))},saveTempl:function(){var e=this,t=this.groupsData,a=[];if(t.length){for(var i=!0,n=0,o=t.length;n<o;n++){var s=t[n].mpoints,c=t[n].groupname,p=t[n].groupno;if(!s.length){this.$Notice.warning({title:"分组下测点不能为空"}),i=!1;break}s.forEach((function(e){e.groupname=c,e.groupno=p,a.push(e)}))}i&&this.$refs.form.validate((function(t){if(t){var i=1==e.saveType?"put":"post";e.saveLoading=!0,e.tmpData.mpoints=a,e.$http[i](r.a.template,e.tmpData).then((function(t){e.saveLoading=!1,e.$Notice.success({title:"保存成功"}),0==e.saveType&&(e.saveType=1,e.activeTreeId=l(t.id),e.getTemplData(t.id)),e.getTreeData()}))}}))}else this.$Notice.warning({title:"请新增分组和测点"})},getMpointsData:function(){this.$refs.modalTable.getData({datasource:"INPUT,CALC"})},onModalSelectCancel:function(e,t){this.modalShown=!1},onModalSelect:function(e){var t=this;if(e.length){var a=[],i=[];e.forEach((function(e){a.push(function(e,t){return e.groupname?e:{groupname:t.groupname,groupno:t.groupno,id:e.id,mpointid:e.id,mpointname:e.mpointName,tempid:t.tempid}}(e,t.activeGroupData.row))})),a.forEach((function(e){i.push(e.mpointname)}));var n=Object.assign({},this.groupsData[this.activeGroupData.index],{mpointname:i.join(),mpoints:a});this.groupsData.splice(this.activeGroupData.index,1,n),this.modalShown=!1}else this.$Notice.info({title:"请选择测点"})},linkToReort:function(){this.$router.push({name:"report-normal-detail",params:{id:this.activeTreeId}})}},components:{mgMpointTable:a(555).a},mounted:function(){n.a.setTreeLeftHeight(),this.getTreeData(),this.getMpointsData()}},p=(a(991),a(1)),d=Object(p.a)(c,i,[],!1,null,null,null);d.options.__file="src/views/report/setting.vue";t.default=d.exports},512:function(e,t,a){e.exports=a.p+"images/a954021ab2bbe81e01475e318c91e48d.png"},518:function(e,t,a){var i=a(530);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("4411afe8",i,!1,{})},520:function(e,t,a){"use strict";var i=a(22),n={modalMpoints:"/loong/api/mpoints/dialog",alarmChart:"/loong/api/mpoints/alarm-condition",downloadTemplate:i.a+"/loong/api/mpoints/excel-template-download",exportTemplate:i.a+"/loong/api/mpoints/export",importExcel:i.a+"/loong/api/mpoints/import",saveExcelData:"/loong/api/mpoints/import-save",cancelExcelData:"/loong/api/mpoints/import-cancel",getCategroyData:"/loong/api/mpoints-datacategory",getMpointsList:"/loong/api/mpoints",deleteMpoints:"/loong/api/mpoints",deleteAllMpoints:"/loong/api/mpoints/all",batchSave:"/loong/api/mpoints/batch",autoMpoints:"/loong/api/mpoints-auto",datainputMpoints:"/loong/api/mpoints-datainput",taskMpoints:"/loong/api/mpoints-task",getCalcMpointDetail:"/loong/api/mpoints-calc",getCycle:"/loong/api/mpoints-calc-cycle",getAnalysisMpointDetail:"/loong/api/mpoints-analysis",getMpointNumByType:"/loong/api/mpoints/batch/all",getMpointDataImportList:"/loong/api/mpoint-data-imports",deleteMpointDataImport:"/loong/api/mpoint-data-imports",stopMpointDataImport:"/loong/api/mpoint-data-imports",pointDataImportTempleDownload:i.a+"/loong/api/mpoint-data-imports/templeDownload",pointDataImportFileUpload:i.a+"/loong/api/mpoint-data-imports/fileUpload"};t.a=n},529:function(e,t,a){"use strict";var i=a(518);a.n(i).a},530:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.cmp-dropdown-tree {\r\n    display: inline-block;\r\n    position: relative;\r\n    vertical-align: middle;\r\n    line-height: normal;\n}\n.ivu-form-item-error .cmp-dropdown-tree-label {\r\n    border: 1px solid #ed3f14;\n}\n.ivu-form-item-error .cmp-dropdown-tree-arrow {\r\n    border-left: 1px solid #ed3f14;\n}\n.cmp-dropdown-tree-label {\r\n    height: 28px;\r\n    width: 100%;\r\n    border: 1px solid #eaeaea;\r\n    display: flex;\r\n    border-radius: 3px;\r\n    cursor: pointer;\n}\n.cmp-dropdown-tree-text {\r\n    line-height: 28px;\r\n    text-indent: 5px;\r\n    flex: 1;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\n}\n.cmp-dropdown-tree-arrow {\r\n    margin-top: -1px;\r\n    width: 28px;\r\n    height: 28px;\r\n    border-left: 1px solid #eaeaea;\r\n    text-align: center;\r\n    line-height: 28px;\n}\n.cmp-dropdown-tree .ivu-input-group-append {\r\n    width: 25px;\r\n    height: 28px;\r\n    overflow: hidden;\r\n    padding: 0;\n}\n.cmp-dropdown-tree .ivu-btn {\r\n    padding: 5px 10px;\n}\n.cmp-dropdown-tree-tree {\r\n    z-index: 901;\r\n    position: absolute;\r\n    top: 37px;\r\n    left: 0;\r\n    min-width: 300px;\r\n    max-height: 400px;\r\n    overflow: auto;\r\n    padding: 5px 10px;\r\n    background-color: #fff;\r\n    box-shadow: 1px 1px 5px #999;\r\n    border-radius: 3px;\n}\r\n",""]),e.exports=t},531:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.hideTree,expression:"hideTree"}],staticClass:"cmp-dropdown-tree",style:{width:e.width+"px"}},[a("div",{staticClass:"cmp-dropdown-tree-label",on:{click:e.labelClick}},[a("div",{staticClass:"cmp-dropdown-tree-text"},[e._v(e._s(e.value.title))]),e._v(" "),a("div",{staticClass:"cmp-dropdown-tree-arrow"},[a("Icon",{directives:[{name:"show",rawName:"v-show",value:1!=e.isShowTree,expression:"isShowTree != true"}],attrs:{type:"ios-arrow-down"}}),e._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:1==e.isShowTree,expression:"isShowTree == true"}],attrs:{type:"ios-arrow-up"}})],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"cmp-dropdown-tree-tree"},[a("Tree",{attrs:{data:e.datas,"show-checkbox":e.showCheckbox,multiple:e.multiple},on:{"on-select-change":e.selectTree}})],1)])};i._withStripped=!0;var n=a(11),r=a(146),o=a(147);function s(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e){!function e(t){t.forEach((function(t,a){t.childrenIds=function e(t,a){a=a||[];return t.forEach((function(t){t.children.length&&e(t.children,a),a.push(Math.abs(t.id))})),a}(t.children),t.children.length&&e(t.children)}))}(e)}var c={name:"myProcessTreeAuthority",mixins:[r.a],props:{field:String,value:Object,data:Array,url:String,query:Object,showCheckbox:Boolean,multiple:Boolean,width:{type:[Number,String],default:300},type:String},watch:{"value.id":function(e){e?this.flatDatas.length&&(n.a.setTrueTreeExpand(this.datas,e),n.a.setTrueTreeSelected(this.datas,e)):(!function e(t){for(var a,i=t.length,n=0;n<i;n++)1==(a=t[n]).selected&&(a.selected=!1),a.children.length&&e(a.children)}(this.datas),this.$emit("input",{id:"",title:"请选择"}))},data:function(e){this.datas=e}},data:function(){return{datas:this.data,flatDatas:[],isShowTree:!1}},methods:{selectTree:function(e){var t=this,a=[],i=[],n=[],r=this.field||"id",o=[];e.forEach((function(e){a.push(Math.abs(e[r])),i.push(e.key),n.push(e.title),o=o.concat(Math.abs(e[r]),e.childrenIds)})),o=s(new Set(o)),this.$emit("input",{id:a.join(),key:i.join(),title:n.join(),childrenIds:o}),this.$emit("on-change",{id:a.join(),key:i.join(),title:n.join(),childrenIds:o}),this.multiple||(this.isShowTree=!1),setTimeout((function(){t.dispatch("FormItem","on-form-change",{id:a.join(),key:i.join(),title:n.join(),childrenIds:o})}),100)},hideTree:function(){this.isShowTree=!1},labelClick:function(){this.isShowTree=!this.isShowTree}},directives:{clickoutside:o.a},mounted:function(){var e=this;this.url&&this.$http.get(this.url,this.query).then((function(t){t&&t.length&&(t.forEach((function(e){!1===e.authorized&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),"EQUTYPE"==e.type&&t.forEach((function(e){var a=t.filter((function(t){return t.parentId==e.id}));("org"==e.type||a.length>0)&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),"PROCESS"==e.type&&t.forEach((function(e){1==e.type&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),e.flatDatas=t,e.value.id&&(n.a.setTreeExpand(e.flatDatas,e.value.id),n.a.setFlatTreeSelected(e.flatDatas,e.value.id)),e.datas=n.a.transDataToTree(e.flatDatas),l(e.datas))}))}},p=(a(529),a(1)),d=Object(p.a)(c,i,[],!1,null,null,null);d.options.__file="src/components/my-process-tree-authority.vue";t.a=d.exports},536:function(e,t,a){var i=a(551);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("f8fc3b20",i,!1,{})},550:function(e,t,a){"use strict";var i=a(536);a.n(i).a},551:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.mg-mp-table-header {\r\n\tdisplay: flex;\r\n\theight: 40px;\n}\n.mg-mp-table-search {\r\n\twidth: 250px;\n}\n.mg-mp-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-mp-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-mp-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),e.exports=t},555:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mg-mp-table"},[a("div",[a("div",[a("div",{staticClass:"c-form-item"},[a("label",{staticStyle:{width:"auto"}},[e._v("关键字：")]),e._v(" "),a("Input",{staticStyle:{width:"160px"},attrs:{placeholder:e.searchPlaceholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}})],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("label",{staticStyle:{width:"auto"}},[e._v("区域位置：")]),e._v(" "),a("my-process-tree-authority",{ref:"processTree",staticStyle:{width:"160px"},attrs:{url:e.treeApi.getProcessTreeData},on:{"on-change":e.processSelect},model:{value:e.relProcess,callback:function(t){e.relProcess=t},expression:"relProcess"}})],1),e._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("Button",{staticClass:"c-btn-modal-search",attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{staticClass:"c-btn-modal-reset",attrs:{type:"primary"},on:{click:e.searchParamsClean}},[e._v("重置")])],1)]),e._v(" "),a("div",{staticClass:"mg-mp-table-tip"},[e._v("已选择"),a("strong",[e._v(e._s(e.selectedTemp.length))]),e._v("个 "),a("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanup}},[e._v("[清空]")])])]),e._v(" "),a("div",{attrs:{id:e.TID}},[a("Table",{ref:e.tableRef,attrs:{columns:e.inColumns,data:e.listData,loading:e.loading,stripe:"",size:"small"},on:{"on-select":e.onSelect,"on-select-cancel":e.onSelectCancel,"on-select-all":e.onSelectAll}})],1),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":"",size:"small"},on:{"on-change":e.pageChange}}),e._v(" "),a("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[a("Button",{attrs:{type:"default",shape:"circle"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.submit}},[e._v("确定")])],1)],1)};i._withStripped=!0;var n=a(11),r=a(107),o=a(520),s={name:"mgMpointTable",components:{myProcessTreeAuthority:a(531).a},props:{columns:Array,disabledRow:Boolean,selected:Array,max:Number,manual:Boolean,field:String,query:Object},watch:{selected:function(e){var t=JSON.stringify(e);this.selectedTemp=JSON.parse(t),this.selectedTruth=JSON.parse(t),this.checkSelection()}},data:function(){return{searchPlaceholder:"输入测点名称以检索",relProcess:{id:"",title:"请选择"},treeApi:r.a,url:o.a.modalMpoints,inColumns:[{type:"selection",width:50},{title:"测点编号",width:120,key:"mpointId"},{title:"区域位置",key:"siteName"},{title:"测点名称",key:"mpointName"}],TID:"",searchParams:{queryName:"",siteId:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{searchParamsClean:function(){this.searchParams=Object.assign({},{queryName:"",siteId:"",currentPage:1,pageSize:10},this.query||{}),this.relProcess={id:"",title:"请选择"}},processSelect:function(e){this.searchParams.siteId=e.id},cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(){var e=this;this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(t){var a=t.items?t.items:[];e.disabledRow&&a.forEach((function(e){e.disabled&&(e._disabled=!0)})),e.field&&a.forEach((function(t){t.id||(t.id=t[e.field])})),e.listData=a,e.total=t.total,e.loading=!1,e.checkSelection()}))},pageChange:function(e){this.searchParams.currentPage=e,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(e,t){var a=this.selectedTemp;this.max&&a.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(t.id)):this.selectedTemp.push(t)},onSelectCancel:function(e,t){var a=this;this.selectedTemp.forEach((function(e,i){e.id==t.id&&a.selectedTemp.splice(i,1)}))},onSelectAll:function(e){0==e.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(e)},addTableToTemp:function(e){var t=this.selectedTemp;e.forEach((function(e){var a=!1;t.forEach((function(t,i){t.id==e.id&&(a=!0)})),a||t.push(e)}))},removeTableFromTemp:function(e){for(var t=this.selectedTemp,a=t.length;a--;){var i=!1;e.forEach((function(e){e.id==t[a].id&&(i=!0)})),i&&t.splice(a,1)}},cancelChecked:function(e){var t=this;this.checkSelection();var a=this.selectedTemp,i=[];a.forEach((function(a){a.id==e&&t.$set(a,"_checked",!1),i.push(a)})),this.selectedTemp=i},checkSelection:function(){var e=this;this.$nextTick((function(){var t=e.listData,a=e.selectedTemp,i=e.$refs[e.tableRef];t.forEach((function(e,t){var n=i.$refs.tbody.objData[t];n._isChecked=!1,a.forEach((function(t){t.id==e.id&&(n._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=n.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=n.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.query&&(this.searchParams=Object.assign({},{queryName:"",siteId:"",currentPage:1,pageSize:10},this.query)),this.getData()},created:function(){var e=n.a.gusid(6);this.TID="J_TABLE_"+e,this.tableRef="mg-select-table-"+e,this.columns&&(this.inColumns=this.columns),n.a.initTableColumnTitle(this.inColumns)}},l=(a(550),a(1)),c=Object(l.a)(s,i,[],!1,null,null,null);c.options.__file="src/components/mg-mpoint-table.vue";t.a=c.exports},580:function(e,t,a){"use strict";var i=a(22),n={tree:"/loong/api/reports/tree",normalTree:"/loong/api/normal-reports/tree",smartTree:"/loong/api/smart-reports/tree",briefTree:"/loong/api/datainput-reports/tree",folder:"/loong/api/folders",template:"/loong/api/report-templates",data:"/loong/api/reports/data",getReportUrl:"/loong/api/report/server-url",exportReport:i.a+"/loong/api/reports/export",exportBrief:i.a+"/loong/api/datainput-reports/export",getSessionId:"/loong/api/smart-reports/server-session-id",redirect:i.a+"/loong/api/smart-reports/server-url?reportUrl="};t.a=n},720:function(e,t,a){var i=a(992);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("366d58f9",i,!1,{})},991:function(e,t,a){"use strict";var i=a(720);a.n(i).a},992:function(e,t,a){var i=a(10),n=a(511);(t=i(!1)).i(n),t.push([e.i,"\r\n",""]),e.exports=t}}]);