(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{1214:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"plan-map c-main-border"},[n("div",{staticClass:"c-left-border-blue"},[n("h3",[t._v("巡检计划线路（"+t._s(t.plan.name)+"）")]),t._v(" "),n("div",{staticClass:"c-btns-right"},["edit"==t.pageStatus?n("Button",{attrs:{type:"primary",shape:"circle",loading:t.loading},on:{click:t.handleSubmit}},[t._v("保存")]):t._e(),t._v(" "),"edit"==t.pageStatus?n("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:t.handleCancle}},[t._v("取消")]):t._e(),t._v(" "),"info"==t.pageStatus&&"New"==t.plan.status?n("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.linkToEdit}},[t._v("编辑")]):t._e(),t._v(" "),"info"==t.pageStatus?n("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:t.handleCancle}},[t._v("返回")]):t._e()],1)]),t._v(" "),n("div",{staticClass:"c-top-border-gray patrol-map"},["edit"==t.pageStatus?n("div",{staticClass:"patrol-map-setting",style:{height:t.H+"px"}},[n("div",{staticClass:"patrol-map-line-btns"},[n("a",{class:{active:"line"==t.focus.type,disabled:t.existingLines},attrs:{href:"javascript:;"},on:{click:t.drawLine}},[n("Icon",{attrs:{type:"edit",size:"16"}}),t._v(" 绘制路线")],1),n("a",{attrs:{href:"javascript:;"},on:{click:t.clearPolyline}},[n("Icon",{attrs:{type:"refresh",size:"16"}}),t._v(" 清除路线")],1)]),t._v(" "),n("h3",[t._v("巡检点")]),t._v(" "),t._l(t.plan.pointsList,(function(e){return[e.longitude&&e.latitude?n("div",{staticClass:"patrol-map-point-set"},[n("a",{staticStyle:{"text-decoration":"underline"},attrs:{href:"javascript:;",title:e.description},on:{click:function(n){return t.localePoint(e)}}},[n("Icon",{attrs:{type:"ios-location",size:"16",color:"#48cef4"}}),t._v(t._s(e.patrolPoint))],1)]):n("div",{staticClass:"patrol-map-point-set patrol-point-unset"},[n("span",{attrs:{title:e.description}},[t._v(t._s(e.patrolPoint)+" ")]),t._v(" "),n("a",{staticClass:"patrol-map-locale",class:{active:"point"==t.focus.type&&t.focus.data.id==e.id},attrs:{href:"javascript:;"},on:{click:function(n){return t.hitPoint("point",e)}}},[n("Icon",{attrs:{type:"pinpoint",size:"16"}}),t._v("标注")],1)])]}))],2):t._e(),t._v(" "),n("div",{staticClass:"patrol-map-lay",staticStyle:{position:"relative"}},[n("div",{style:{height:t.H+"px"},attrs:{id:"patrol-plan-map"}}),t._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:t.mapLoading,expression:"mapLoading"}],staticStyle:{position:"absolute",left:"20px",top:"10px",color:"#999"}},[t._v("正在加载地图...")]),t._v(" "),n("div",{staticClass:"bdmap-search"},[n("Icon",{attrs:{type:"ios-search",size:"20",color:"#CCCCCC"}}),t._v(" "),n("input",{staticClass:"bdmap-search-key",attrs:{type:"text",id:"patrol-plan-bdmap-search-key"}})],1),t._v(" "),n("div",{staticClass:"bdmap-location"},[n("a",{attrs:{href:"javascript:;",title:"定位您的位置"},on:{click:t.myLocation}},[n("Icon",{attrs:{type:"android-locate",size:"20",color:"#388bff"}})],1)])])])])};a._withStripped=!0;n(11);var i,o,r=n(558),s=n(539);var l={data:function(){return{mapLoading:!0,pageStatus:"info",H:"380",plan:{pointsList:[]},focus:{type:"",data:""},existingLines:!1,loading:!1}},mounted:function(){var t=this;r.a.create((function(){i=new BMap.Map("patrol-plan-map",{enableMapClick:!1}),r.a.setStyle(i),n(958),i.enableScrollWheelZoom(),t.getData(),r.a.addSearch(i,"patrol-plan-bdmap-search-key"),i.addEventListener("click",t.onMapClick),t.initDrawingManager()}));var e=document.querySelector(".lay").offsetHeight-75;this.H=e,"patrol-plan-map-edit"==this.$route.name?this.pageStatus="edit":"patrol-plan-map"==this.$route.name&&(this.pageStatus="info")},watch:{$route:function(t,e){i.clearOverlays(),"patrol-plan-map-edit"===t.name?this.pageStatus="edit":"patrol-plan-map"===t.name&&(this.pageStatus="info"),this.getData()}},methods:{updatePoint:function(t,e){this.plan.pointsList.forEach((function(n){n.id==t&&(n.longitude=e.lng,n.latitude=e.lat)}))},getData:function(){var t=this,e=this;this.$http.get(s.a.planPath,{planId:this.$route.params.id}).then((function(n){if(t.plan=n,n.pathList&&n.pathList.length&&(t.existingLines=!0,o.initPolyline(r.a.getBDPoints(n.pathList))),n.pointsList&&n.pointsList.length&&!function(t){var e=!0;return t.forEach((function(t){t.longitude&&t.latitude&&(e=!1)})),e}(n.pointsList)){var a=!0;"edit"==t.pageStatus&&(a=function(t){e.updatePoint(t.target.getTitle(),t.point)}),r.a.hitPoint(i,n.pointsList,a);var s=r.a.getBDPoints(n.pointsList);i.setViewport(s),i.panBy(1,1)}else r.a.placePoint(i,(function(){t.mapLoading=!1}));t.mapLoading=!1}))},localePoint:function(t){i.centerAndZoom(new BMap.Point(t.longitude,t.latitude),18)},hitPoint:function(t,e){this.focus.type=t,this.focus.data=e,i.setDefaultCursor("crosshair")},drawLine:function(){this.existingLines||(this.focus.type="line",this.focus.data="",o.open(),o.setDrawingMode("polyline"))},onMapClick:function(t){var e=this;"point"==this.focus.type&&(this.focus.data.longitude=t.point.lng,this.focus.data.latitude=t.point.lat,r.a.hitPoint(i,[this.focus.data],(function(t){e.updatePoint(t.target.getTitle(),t.point)})),this.focus.type="",this.focus.data="",i.setDefaultCursor("auto"))},initDrawingManager:function(){var t=this;(o=new BMapLib.DrawingManager(i,{isOpen:!1,enableCalculate:!0})).addEventListener("polylinecomplete",(function(e){var n,a;t.plan.pathList=(n=e.getPath(),a=[],n.forEach((function(t){a.push({longitude:t.lng,latitude:t.lat})})),a),o.close(),t.focus.type="",t.focus.data="",t.existingLines=!0}))},clearPolyline:function(){o.cleanPolylinePath(),this.plan.pathList=[],this.existingLines=!1},linkToEdit:function(){this.$router.push({name:"patrol-plan-map-edit",params:{id:this.$route.params.id}})},handleSubmit:function(){var t=this;this.plan.pathList&&this.plan.pathList.length?(this.loading=!0,this.$http.put(s.a.planPath,this.plan).then((function(e){t.$Notice.success({title:"数据保存成功"}),t.loading=!1,t.$router.push({name:"patrol-plan-detail",params:{id:t.$route.params.id}})}))):this.$Notice.info({title:"请绘制线路",content:"点击【绘制线路】按钮开始，双击结束绘制"})},handleCancle:function(){this.$router.push({name:"patrol-plan-detail",params:{id:this.$route.params.id}})},myLocation:function(){r.a.placePoint(i)}}},p=(n(959),n(1)),c=Object(p.a)(l,a,[],!1,null,null,null);c.options.__file="src/views/patrol/plan/map.vue";e.default=c.exports},539:function(t,e,n){"use strict";var a=n(22),i={getTasks:"/patrol/api/tasks",getTaskDetail:"/patrol/api/tasks",delTasks:"/patrol/api/tasks",modifyTask:"/patrol/api/tasks",stop:"/patrol/api/tasks",updatePatrolTaskPoint:"/patrol/api/task-point-step",plan:"/patrol/api/plans",getPlan:"/patrol/api/plans",updatePlan:"/patrol/api/plans",deletePlan:"/patrol/api/plans",planPath:"/patrol/api/plan-path",releasePlan:"/patrol/api/plans/release",interruptPlan:"/patrol/api/plans/interrupt",statistics:"/patrol/api/tasks/statistics",export:a.a+"/patrol/api/tasks/statistics-export",point:"/patrol/api/points",getQrcode:a.a+"/patrol/api/points/qrcode-export",trace:"/patrol/api/tasks/map-track"};e.a=i},558:function(t,e,n){"use strict";var a=n(7),i=n(11);function o(t,e){return{lng:(t.lng+e.lng)/2,lat:(t.lat+e.lat)/2}}var r=n(559),s=n(560),l=n(561),p=n(562),c=n(563),d=n(564),u=n(565),h=n(566),g=(new a.default,[{featureType:"all",elementType:"all",stylers:{lightness:10,saturation:-100}}]);e.a={create:function(t){if("undefined"==typeof BMap){var e=document.createElement("script");e.src="https://api.map.baidu.com/api?v=2.0&ak=0lPULNZ5PmrFVg76kFuRjezF&callback=MG__MAP__CALLBACK",document.body.appendChild(e),window.MG__MAP__CALLBACK=function(){t&&t()}}else t&&t()},addTiles:function(t){if(t){var e=new BMap.TileLayer({isTransparentPng:!0});e.getTilesUrl=function(t,e){return"/images/tiles/"+e+"/"+t.x+"/"+t.y+".png"},t.addTileLayer(e)}},placePoint:function(t,e){t&&(new BMap.Geolocation).getCurrentPosition((function(n){var a={lng:121.480576,lat:31.235906};this.getStatus()==BMAP_STATUS_SUCCESS&&(a.lng=n.point.lng,a.lat=n.point.lat),t.centerAndZoom(new BMap.Point(a.lng,a.lat),15),e&&e(a)}),{enableHighAccuracy:!0})},setStyle:function(t){t&&t.setMapStyle({styleJson:g})},setZoom:function(t,e,n){var a=t.getViewport(e.map((function(t){return{lng:t.longitude,lat:t.latitude}}))),i=a.zoom,o=a.center;t.centerAndZoom(o,n||i)},drawPatrolTask:function(t,e){var n,a=e.patrolPointDetailDTOs||[],i=e.patrolTaskPlanPaths||[];if(t&&a.length&&i.length&&(this.setZoom(t,a),a.forEach((function(e){var a=new BMap.Point(e.longitude,e.latitude);switch(e.status){case"正常":n=new BMap.Icon(s,new BMap.Size(16,21));break;case"异常":n=new BMap.Icon(p,new BMap.Size(16,21));break;case"未检":n=new BMap.Icon(l,new BMap.Size(16,21),{anchor:new BMap.Size(8,21)});break;default:n=new BMap.Icon(r,new BMap.Size(16,21))}var i=new BMap.Marker(a,{icon:n});t.addOverlay(i);var o=new BMap.Label(e.patrolPoint,{position:a,offset:new BMap.Size(10,-15)});o.setStyle({borderColor:"#0093ff",color:"#0093ff"}),t.addOverlay(o);var c="",d="";e.uninspectedStep&&e.uninspectedStep.length?e.uninspectedStep.forEach((function(t){d+="<li>"+t+"</li>"})):d="<li>无</li>","异常"==e.status&&(c="<div ><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>漏检结果</div><ul style='padding-top:2px;clear:both;color:gray;'>"+d+"</ul></div>");var u=new BMap.InfoWindow("<div style='overflow:auto;'><div style='font-size:large;font-weight:bold;'>"+e.patrolPoint+"</div><div><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>报缺数</div>"+e.faultCount+"</div>"+c+"</div>",{width:0,height:0,title:"",enableMessage:!1});i.addEventListener("click",(function(){t.openInfoWindow(u,a)}))})),!(i.length<2)))for(var o=[],c=0,d=i.length;c<=d;c++){var u,h,g;c!=d&&(u=i[c],h=new BMap.Point(u.longitude,u.latitude)),o.length<2?o.push(h):(g=new BMap.Polyline(o,{strokeColor:"valid"==u.validate?"#3a6bdb":"#9b9b9b",strokeWeight:4}),t.addOverlay(g),c!=d&&(o=[o[1],h]))}},drawPatrol:function(t,e,n){var a,r=e.patrolTaskPointTrackDTOs||[],c=e.patrolTaskPlanPaths||[];if(t&&r.length&&c.length&&(this.setZoom(t,r),r.forEach((function(e){var n=new BMap.Point(e.longitude,e.latitude);switch(e.status){case"正常":a=new BMap.Icon(s,new BMap.Size(16,21));break;case"异常":a=new BMap.Icon(p,new BMap.Size(16,21));break;case"未检":a=new BMap.Icon(l,new BMap.Size(16,21),{anchor:new BMap.Size(8,21)})}var i=new BMap.Marker(n,{icon:a});t.addOverlay(i);var o=new BMap.Label(e.patrolPointName,{position:n,offset:new BMap.Size(10,-15)});o.setStyle({borderColor:"#0093ff",color:"#0093ff"}),t.addOverlay(o);var r="",c="";e.uninspectedStep&&e.uninspectedStep.length?e.uninspectedStep.forEach((function(t){c+="<li>"+t+"</li>"})):c="<li>无</li>","异常"==e.status&&(r="<div ><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>漏检结果</div><ul style='padding-top:2px;clear:both;color:gray;'>"+c+"</ul></div>");var d=new BMap.InfoWindow("<div style='overflow:auto;'><div style='font-size:large;font-weight:bold;'>"+e.patrolPointName+"</div><div><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>报缺数</div>"+e.faultCount+"</div>"+r+"</div>",{width:0,height:0,title:"",enableMessage:!1});i.addEventListener("click",(function(){t.openInfoWindow(d,n)}))})),!(c.length<2)))for(var d=new BMap.InfoWindow("<h5>"+e.name+"</h5><div>"+e.executeStatus+"</div><div>时间："+i.a.transDateFromServer(e.startTime,"hh:mm")+" - "+i.a.transDateFromServer(e.endTime,"hh:mm")+"</div><div>发现缺陷："+e.faultCount+"</div><div>巡检点："+e.inspectedCount+"/"+e.patrolPointCount+"</div><div>计划距离："+e.planPathLength+"米</div><div>有效距离："+e.validPathLength+"米</div>",{width:270,height:140,title:"",enableMessage:!1}),u=[],h=0,g=c.length;h<=g;h++){var f,v,y;h!=g&&(f=c[h],v=new BMap.Point(f.longitude,f.latitude)),u.length<2?u.push(v):((y=new BMap.Polyline(u,{strokeColor:"valid"==f.validate?"#3a6bdb":"#9b9b9b",strokeWeight:4})).addEventListener("mouseover",(function(){this.setStrokeStyle("dashed")})),y.addEventListener("mouseout",(function(){this.setStrokeStyle("solid")})),y.addEventListener("click",(function(e){var n=e.target.getPath()[0],a=e.target.getPath()[1];t.openInfoWindow(d,new BMap.Point(o(n,a).lng,o(n,a).lat))})),t.addOverlay(y),h!=g&&(u=[u[1],v]))}},addSearch:function(t,e,n){new BMap.Autocomplete({input:e||"bdmap-search-key",location:t}).addEventListener("onconfirm",(function(e){var a=e.item.value,i=a.province+a.city+a.district+a.street+a.business,o=new BMap.LocalSearch(t,{onSearchComplete:function(){var e=o.getResults().getPoi(0).point;t.centerAndZoom(e,18),n&&n(e)}});o.search(i)}))},getBDPoints:function(t){if(!t)return[];var e=[];return t.forEach((function(t){t.longitude&&t.latitude&&e.push(new BMap.Point(t.longitude,t.latitude))})),e},hitPoint:function(t,e,n){"[object Array]"!==Object.prototype.toString.call(e)&&(e=[e]),e.forEach((function(e){if(e.longitude&&e.latitude){var a=new BMap.Point(e.longitude,e.latitude),i=new BMap.Marker(a,{icon:new BMap.Icon(r,new BMap.Size(16,21))});n&&"boolean"==typeof n?i.disableDragging():"function"==typeof n&&(i.enableDragging(),i.addEventListener("dragend",(function(t){n(t)})));var o=new BMap.Label(e.patrolPoint,{offset:new BMap.Size(20,-10)});o.setStyle({borderColor:"#0093ff",color:"#0093ff"}),i.setLabel(o),i.setTitle(e.id),t.addOverlay(i)}}))},renderLine:function(t,e,n){var a=new BMap.Polyline(e,Object.assign({enableEditing:!1,enableClicking:!0,strokeWeight:"5",strokeOpacity:.65},n||{}));return t.addOverlay(a),a},hitProcess:function(t,e,n,a){var i=[],o=[];return e.forEach((function(e,a){if(e.longitude&&e.latitude){var r=e.handleStatus?c:d,s=new BMap.Point(e.longitude,e.latitude),l=new BMap.Marker(s,{icon:new BMap.Icon(r,new BMap.Size(36,30))}),p=(12*e.name.length+20)/2,u=new BMap.Label(e.name,{offset:new BMap.Size(18-p,-26)});u.setStyle({backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",color:"#4A4A4A",borderRadius:"2px",boxShadow:"2px 2px 4px 0px rgba(0,0,0,0.13)",padding:"3px 10px",cursor:"pointer"}),l.setLabel(u),l.setZIndex(2e3+a),t.addOverlay(l),o.push(l),u.addEventListener("click",(function(){n&&n(this,s,e)})),l.addEventListener("click",(function(){n&&n(this,s,e)})),i.push(s)}})),a&&a(o),i},hitStaff:function(t,e,n,a){var i=[],o=[];return e.forEach((function(e,a){if(e.longitude&&e.latitude){var r=1==e.haveTask?u:h,s=new BMap.Point(e.longitude,e.latitude),l=new BMap.Marker(s,{icon:new BMap.Icon(r,new BMap.Size(23,32))}),p=(12*e.userName.length+20)/2,c=new BMap.Label(e.userName,{offset:new BMap.Size(12-p,-26)});c.setStyle({backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",color:"#4A4A4A",borderRadius:"2px",boxShadow:"2px 2px 4px 0px rgba(0,0,0,0.13)",padding:"3px 10px"}),l.setLabel(c),l.setZIndex(1e3+a),t.addOverlay(l),o.push(l),l.addEventListener("click",(function(){n&&n(this,s,e)})),i.push(s)}})),a&&a(o),i}}},559:function(t,e,n){t.exports=n.p+"images/f2b760922921a7f0fd4d402145d6dbd5.png"},560:function(t,e,n){t.exports=n.p+"images/5a97737f8744e4f0a37e9eadcaae7469.png"},561:function(t,e,n){t.exports=n.p+"images/e91e0c308e4bdfa03605696ce3358b1b.png"},562:function(t,e,n){t.exports=n.p+"images/bd4523e3b67968731b5d77d0a89dcb9f.png"},563:function(t,e,n){t.exports=n.p+"images/6cc09be5e8a6202e732126b57d5d92da.png"},564:function(t,e,n){t.exports=n.p+"images/96e02f4efb20c9a13722cc8ae3fd59d8.png"},565:function(t,e,n){t.exports=n.p+"images/5980ed2516736ab58921267e07915b43.png"},566:function(t,e,n){t.exports=n.p+"images/1316c96a11c16e1faf98fa712e4b33c8.png"},711:function(t,e,n){var a=n(960);"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);(0,n(17).default)("5aae81b1",a,!1,{})},958:function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var a=window.BMapLib=a||{},i="marker",o="polyline",r="circle",s="rectangle",l="polygon";!function(){var t=t||{guid:"$BAIDU$"};window[t.guid]={},t.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},t.lang=t.lang||{},t.lang.guid=function(){return"TANGRAM__"+(window[t.guid]._counter++).toString(36)},window[t.guid]._counter=window[t.guid]._counter||1,window[t.guid]._instances=window[t.guid]._instances||{},t.lang.Class=function(e){this.guid=e||t.lang.guid(),window[t.guid]._instances[this.guid]=this},window[t.guid]._instances=window[t.guid]._instances||{},t.lang.isString=function(t){return"[object String]"==Object.prototype.toString.call(t)},t.lang.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.lang.Class.prototype.toString=function(){return"[object "+(this._className||"Object")+"]"},t.lang.Class.prototype.dispose=function(){for(var e in delete window[t.guid]._instances[this.guid],this)t.lang.isFunction(this[e])||delete this[e];this.disposed=!0},t.lang.Event=function(t,e){this.type=t,this.returnValue=!0,this.target=e||null,this.currentTarget=null},t.lang.Class.prototype.addEventListener=function(e,a,i){if(t.lang.isFunction(a)){!this.__listeners&&(this.__listeners={});var o,r=this.__listeners;if("string"==typeof i&&i){if(/[^\w\-]/.test(i))throw"nonstandard key:"+i;a.hashCode=i,o=i}0!=e.indexOf("on")&&(e="on"+e),"object"!=n(r[e])&&(r[e]={}),o=o||t.lang.guid(),a.hashCode=o,r[e][o]=a}},t.lang.Class.prototype.removeEventListener=function(e,n){if(t.lang.isFunction(n))n=n.hashCode;else if(!t.lang.isString(n))return;!this.__listeners&&(this.__listeners={}),0!=e.indexOf("on")&&(e="on"+e);var a=this.__listeners;a[e]&&a[e][n]&&delete a[e][n]},t.lang.Class.prototype.dispatchEvent=function(e,a){for(var i in t.lang.isString(e)&&(e=new t.lang.Event(e)),!this.__listeners&&(this.__listeners={}),a=a||{})e[i]=a[i];var o=this.__listeners,r=e.type;if(e.target=e.target||this,e.currentTarget=this,0!=r.indexOf("on")&&(r="on"+r),t.lang.isFunction(this[r])&&this[r].apply(this,arguments),"object"==n(o[r]))for(i in o[r])o[r][i].apply(this,arguments);return e.returnValue},t.lang.inherits=function(t,e,n){var a,i,o=t.prototype,r=new Function;for(a in r.prototype=e.prototype,i=t.prototype=new r,o)i[a]=o[a];t.prototype.constructor=t,t.superClass=e.prototype,"string"==typeof n&&(i._className=n)},t.dom=t.dom||{},t._g=t.dom._g=function(e){return t.lang.isString(e)?document.getElementById(e):e},t.g=t.dom.g=function(t){return"string"==typeof t||t instanceof String?document.getElementById(t):t&&t.nodeName&&(1==t.nodeType||9==t.nodeType)?t:null},t.insertHTML=t.dom.insertHTML=function(e,n,a){var i,o;return(e=t.dom.g(e)).insertAdjacentHTML?e.insertAdjacentHTML(n,a):(i=e.ownerDocument.createRange(),"AFTERBEGIN"==(n=n.toUpperCase())||"BEFOREEND"==n?(i.selectNodeContents(e),i.collapse("AFTERBEGIN"==n)):(i[(o="BEFOREBEGIN"==n)?"setStartBefore":"setEndAfter"](e),i.collapse(o)),i.insertNode(i.createContextualFragment(a))),e},t.ac=t.dom.addClass=function(e,n){e=t.dom.g(e);for(var a=n.split(/\s+/),i=e.className,o=" "+i+" ",r=0,s=a.length;r<s;r++)o.indexOf(" "+a[r]+" ")<0&&(i+=(i?" ":"")+a[r]);return e.className=i,e},t.event=t.event||{},t.event._listeners=t.event._listeners||[],t.on=t.event.on=function(e,n,a){n=n.replace(/^on/i,""),e=t._g(e);var i,o=function(t){a.call(e,t)},r=t.event._listeners,s=t.event._eventFilter,l=n;return n=n.toLowerCase(),s&&s[n]&&(l=(i=s[n](e,n,o)).type,o=i.listener),e.addEventListener?e.addEventListener(l,o,!1):e.attachEvent&&e.attachEvent("on"+l,o),r[r.length]=[e,n,a,o,l],e},t.un=t.event.un=function(e,n,a){e=t._g(e),n=n.replace(/^on/i,"").toLowerCase();for(var i,o,r,s=t.event._listeners,l=s.length,p=!a;l--;)(i=s[l])[1]!==n||i[0]!==e||!p&&i[2]!==a||(o=i[4],r=i[3],e.removeEventListener?e.removeEventListener(o,r,!1):e.detachEvent&&e.detachEvent("on"+o,r),s.splice(l,1));return e},t.getEvent=t.event.getEvent=function(t){return window.event||t},t.getTarget=t.event.getTarget=function(e){return(e=t.getEvent(e)).target||e.srcElement},t.preventDefault=t.event.preventDefault=function(e){(e=t.getEvent(e)).preventDefault?e.preventDefault():e.returnValue=!1},t.stopBubble=t.event.stopBubble=function(e){(e=t.getEvent(e)).stopPropagation?e.stopPropagation():e.cancelBubble=!0};var e=a.DrawingManager=function(t,e){t&&(d.push(this),e=e||{},this._initialize(t,e))};function p(){this._enableEdgeMove=!1}function c(t,e){this.drawingManager=t,e=this.drawingToolOptions=e||{},this.defaultAnchor=BMAP_ANCHOR_TOP_LEFT,this.defaultOffset=new BMap.Size(10,10),this.defaultDrawingModes=[i,r,o,l,s],e.drawingModes?this.drawingModes=e.drawingModes:this.drawingModes=this.defaultDrawingModes,e.anchor&&this.setAnchor(e.anchor),e.offset&&this.setOffset(e.offset)}t.lang.inherits(e,t.lang.Class,"DrawingManager"),e.prototype.open=function(){if(1==this._isOpen)return!0;u(this),this._open()},e.prototype.close=function(){if(0==this._isOpen)return!0;this._close()},e.prototype.setDrawingMode=function(t){this._drawingType!=t&&(u(this),this._setDrawingMode(t))},e.prototype.getDrawingMode=function(){return this._drawingType},e.prototype.enableCalculate=function(){this._enableCalculate=!0,this._addGeoUtilsLibrary()},e.prototype.disableCalculate=function(){this._enableCalculate=!1},e.prototype._initialize=function(t,e){if(this._map=t,this._opts=e,this._drawingType=e.drawingMode||i,e.enableDrawingTool){var n=new c(this,e.drawingToolOptions);this._drawingTool=n,t.addControl(n)}!0===e.enableCalculate?this.enableCalculate():this.disableCalculate(),this._isOpen=!(!0!==e.isOpen),this._isOpen&&this._open(),this.markerOptions=e.markerOptions||{},this.circleOptions=e.circleOptions||{},this.polylineOptions=e.polylineOptions||{},this.polygonOptions=e.polygonOptions||{},this.rectangleOptions=e.rectangleOptions||{},this._polyline_cache=[],this._polyline_label_cache=[]},e.prototype._open=function(){this._isOpen=!0,this._mask||(this._mask=new p),this._map.addOverlay(this._mask),this._setDrawingMode(this._drawingType)},e.prototype._setDrawingMode=function(t){if(this._drawingType=t,this._isOpen)switch(this._mask.__listeners={},t){case i:this._bindMarker();break;case r:this._bindCircle();break;case o:case l:this._bindPolylineOrPolygon();break;case s:this._bindRectangle()}this._drawingTool&&this._isOpen&&this._drawingTool.setStyleByDrawingMode(t)},e.prototype._close=function(){this._isOpen=!1,this._mask&&this._map.removeOverlay(this._mask),this._drawingTool&&this._drawingTool.setStyleByDrawingMode("hander")},e.prototype._bindMarker=function(){var t=this,e=this._map;this._mask.addEventListener("click",(function(n){var a=new BMap.Marker(n.point,t.markerOptions);e.addOverlay(a),t._dispatchOverlayComplete(a)}))},e.prototype._bindCircle=function(){var e=this,n=this._map,a=this._mask,i=null,o=null,r=function(t){i.setRadius(e._map.getDistance(o,t.point))},s=function n(s){var l=e._calculate(i,s.point);e._dispatchOverlayComplete(i,l),o=null,a.disableEdgeMove(),a.removeEventListener("mousemove",r),t.un(document,"mouseup",n)};a.addEventListener("mousedown",(function(l){t.preventDefault(l),t.stopBubble(l),null==o&&function(l){o=l.point,i=new BMap.Circle(o,0,e.circleOptions),n.addOverlay(i),a.enableEdgeMove(),a.addEventListener("mousemove",r),t.on(document,"mouseup",s)}(l)}))},e.prototype._bindPolylineOrPolygon=function(){var e=this,n=this._map,a=this._mask,i=[],r=null;overlay=null,isBinded=!1;var s=function(t){overlay.setPositionAt(r.length-1,t.point)},p=function n(o){t.stopBubble(o),isBinded=!1,a.disableEdgeMove(),a.removeEventListener("mousemove",s),a.removeEventListener("dblclick",n),overlay.setPath(i);var l=e._calculate(overlay,i.pop());e._dispatchOverlayComplete(overlay,l),i.length=0,r.length=0};a.addEventListener("click",(function(t){i.push(t.point),r=i.concat(i[i.length-1]),1==i.length?(e._drawingType==o?overlay=new BMap.Polyline(r,e.polylineOptions):e._drawingType==l&&(overlay=new BMap.Polygon(r,e.polygonOptions)),n.addOverlay(overlay),e._polyline_cache.push(overlay)):overlay.setPath(r),isBinded||(isBinded=!0,a.enableEdgeMove(),a.addEventListener("mousemove",s),a.addEventListener("dblclick",p))})),a.addEventListener("dblclick",(function(e){t.stopBubble(e)}))},e.prototype._bindRectangle=function(){var e=this,n=this._map,a=this._mask,i=null,o=null,r=function(t){i.setPath(e._getRectanglePoint(o,t.point))},s=function n(s){var l=e._calculate(i,i.getPath()[2]);e._dispatchOverlayComplete(i,l),o=null,a.disableEdgeMove(),a.removeEventListener("mousemove",r),t.un(document,"mouseup",n)};a.addEventListener("mousedown",(function(l){t.stopBubble(l),t.preventDefault(l);var p=o=l.point;i=new BMap.Polygon(e._getRectanglePoint(o,p),e.rectangleOptions),n.addOverlay(i),a.enableEdgeMove(),a.addEventListener("mousemove",r),t.on(document,"mouseup",s)}))},e.prototype._calculate=function(t,e){var n={data:0,label:null};if(this._enableCalculate&&a.GeoUtils){switch(t.toString()){case"[object Polyline]":n.data=a.GeoUtils.getPolylineDistance(t);break;case"[object Polygon]":n.data=a.GeoUtils.getPolygonArea(t);break;case"[object Circle]":var i=t.getRadius();n.data=Math.PI*i*i}!n.data||n.data<0?n.data=0:n.data=n.data.toFixed(0),n.label=this._addLabel(e,"路线共计"+n.data+"米","polyline")}return n},e.prototype._addGeoUtilsLibrary=function(){if(!a.GeoUtils){var t=document.createElement("script");t.setAttribute("type","text/javascript"),t.setAttribute("src","http://api.map.baidu.com/library/GeoUtils/1.2/src/GeoUtils_min.js"),document.body.appendChild(t)}},e.prototype._addLabel=function(t,e,n){var a=new BMap.Label(e,{position:t,offset:new BMap.Size(10,10)});return a.setStyle({borderColor:"#7d9ce3",color:"#7d9ce3",padding:"0 5px"}),this._map.addOverlay(a),"polyline"===n&&this._polyline_label_cache.push(a),a},e.prototype._getRectanglePoint=function(t,e){return[new BMap.Point(t.lng,t.lat),new BMap.Point(e.lng,t.lat),new BMap.Point(e.lng,e.lat),new BMap.Point(t.lng,e.lat)]},e.prototype._dispatchOverlayComplete=function(t,e){var n={overlay:t,drawingMode:this._drawingType,calculate:e.data||null,label:e.label||null};this.dispatchEvent(this._drawingType+"complete",t),this.dispatchEvent("overlaycomplete",n)},e.prototype.cleanPolylinePath=function(){for(var t=this._map,e=this._polyline_cache,n=this._polyline_label_cache,a=0,i=e.length;a<i;a++)t.removeOverlay(e[a]),t.removeOverlay(n[a]);this._polyline_cache=[],this._polyline_label_cache=[]},e.prototype.initPolyline=function(t){var e=this._map,n=new BMap.Polyline(t,this.polylineOptions);e.addOverlay(n);this._calculate(n,t.pop());this._polyline_cache=[n]},p.prototype=new BMap.Overlay,p.prototype.dispatchEvent=t.lang.Class.prototype.dispatchEvent,p.prototype.addEventListener=t.lang.Class.prototype.addEventListener,p.prototype.removeEventListener=t.lang.Class.prototype.removeEventListener,p.prototype.initialize=function(t){var e=this;this._map=t;var n=this.container=document.createElement("div"),a=this._map.getSize();return n.style.cssText="position:absolute;background:url(about:blank);cursor:crosshair;width:"+a.width+"px;height:"+a.height+"px",this._map.addEventListener("resize",(function(t){e._adjustSize(t.size)})),this._map.getPanes().floatPane.appendChild(n),this._bind(),n},p.prototype.draw=function(){var t=this._map,e=t.pixelToPoint(new BMap.Pixel(0,0)),n=t.pointToOverlayPixel(e);this.container.style.left=n.x+"px",this.container.style.top=n.y+"px"},p.prototype.enableEdgeMove=function(){this._enableEdgeMove=!0},p.prototype.disableEdgeMove=function(){clearInterval(this._edgeMoveTimer),this._enableEdgeMove=!1},p.prototype._bind=function(){for(var e=this,n=(this._map,this.container),a=null,i=null,o=function(t){return{x:t.clientX,y:t.clientY}},r=function(n){var r=n.type;n=t.getEvent(n),point=e.getDrawPoint(n);var s=function(t){n.point=point,e.dispatchEvent(n)};"mousedown"==r&&(a=o(n));var l=o(n);"click"==r?Math.abs(l.x-a.x)<5&&Math.abs(l.y-a.y)<5&&(i&&Math.abs(l.x-i.x)<5&&Math.abs(l.y-i.y)<5?i=null:(s(),i=o(n))):s()},s=["click","mousedown","mousemove","mouseup","dblclick"],l=s.length;l--;)t.on(n,s[l],r);t.on(n,"mousemove",(function(t){e._enableEdgeMove&&e.mousemoveAction(t)}))},p.prototype.mousemoveAction=function(t){var e=this._map,n=this,a=e.pointToPixel(this.getDrawPoint(t)),i=function(t){var e=t.clientX,n=t.clientY;return t.changedTouches&&(e=t.changedTouches[0].clientX,n=t.changedTouches[0].clientY),new BMap.Pixel(e,n)}(t),o=i.x-a.x,r=i.y-a.y;a=new BMap.Pixel(i.x-o,i.y-r),this._draggingMovePixel=a;e.pixelToPoint(a);this._panByX=this._panByY=0,a.x<=20||a.x>=e.width-20||a.y<=50||a.y>=e.height-10?(a.x<=20?this._panByX=8:a.x>=e.width-20&&(this._panByX=-8),a.y<=50?this._panByY=8:a.y>=e.height-10&&(this._panByY=-8),this._edgeMoveTimer||(this._edgeMoveTimer=setInterval((function(){e.panBy(n._panByX,n._panByY,{noAnimation:!0})}),30))):this._edgeMoveTimer&&(clearInterval(this._edgeMoveTimer),this._edgeMoveTimer=null)},p.prototype._adjustSize=function(t){this.container.style.width=t.width+"px",this.container.style.height=t.height+"px"},p.prototype.getDrawPoint=function(e){var n=this._map,a=t.getTarget(e),i=e.offsetX||e.layerX||0,o=e.offsetY||e.layerY||0;for(1!=a.nodeType&&(a=a.parentNode);a&&a!=n.getContainer();)0==a.clientWidth&&0==a.clientHeight&&a.offsetParent&&"TD"==a.offsetParent.nodeName||(i+=a.offsetLeft||0,o+=a.offsetTop||0),a=a.offsetParent;var r=new BMap.Pixel(i,o);return n.pixelToPoint(r)},c.prototype=new BMap.Control,c.prototype.initialize=function(t){var e=this.container=document.createElement("div");e.className="BMapLib_Drawing";var n=this.panel=document.createElement("div");return n.className="BMapLib_Drawing_panel",this.drawingToolOptions&&this.drawingToolOptions.scale&&this._setScale(this.drawingToolOptions.scale),e.appendChild(n),n.innerHTML=this._generalHtml(),this._bind(n),t.getContainer().appendChild(e),e},c.prototype._generalHtml=function(t){var e={hander:"拖动地图"};e[i]="画点",e[r]="画圆",e[o]="画折线",e[l]="画多边形",e[s]="画矩形";var n=function(t,n){return'<a class="'+t+'" drawingType="'+n+'" href="javascript:void(0)" title="'+e[n]+'" onfocus="this.blur()"></a>'},a=[];a.push(n("BMapLib_box BMapLib_hander","hander"));for(var p=0,c=this.drawingModes.length;p<c;p++){var d="BMapLib_box BMapLib_"+this.drawingModes[p];p==c-1&&(d+=" BMapLib_last"),a.push(n(d,this.drawingModes[p]))}return a.join("")},c.prototype._setScale=function(t){var e=-parseInt((390-390*t)/2,10),n=-parseInt((50-50*t)/2,10);this.container.style.cssText=["-moz-transform: scale("+t+");","-o-transform: scale("+t+");","-webkit-transform: scale("+t+");","transform: scale("+t+");","margin-left:"+e+"px;","margin-top:"+n+"px;","*margin-left:0px;","*margin-top:0px;","margin-left:0px\\0;","margin-top:0px\\0;","filter: progid:DXImageTransform.Microsoft.Matrix(","M11="+t+",","M12=0,","M21=0,","M22="+t+",","SizingMethod='auto expand');"].join("")},c.prototype._bind=function(e){var n=this;t.on(this.panel,"click",(function(e){var a=t.getTarget(e).getAttribute("drawingType");n.setStyleByDrawingMode(a),n._bindEventByDraingMode(a)}))},c.prototype.setStyleByDrawingMode=function(t){if(t)for(var e=this.panel.getElementsByTagName("a"),n=0,a=e.length;n<a;n++){var i=e[n];if(i.getAttribute("drawingType")==t){var o="BMapLib_box BMapLib_"+t+"_hover";n==a-1&&(o+=" BMapLib_last"),i.className=o}else i.className=i.className.replace(/_hover/,"")}},c.prototype._bindEventByDraingMode=function(t){var e=this.drawingManager;"hander"==t?e.close():(e.setDrawingMode(t),e.open())};var d=[];function u(t){for(var e=d.length;e--;)d[e]!=t&&d[e].close()}}()},959:function(t,e,n){"use strict";var a=n(711);n.n(a).a},960:function(t,e,n){(e=n(10)(!1)).push([t.i,"\n.patrol-map {\r\n    display: flex;\n}\n.patrol-map-setting {\r\n    width: 300px;\r\n    margin-right: 10px;\r\n    overflow-y: auto;\n}\n.patrol-map-setting h3{\r\n    background: #e6e6e6;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    text-indent: 10px;\r\n    font-size: 13px;\r\n    font-weight: 100;\n}\n.patrol-map-lay {\r\n    flex: 1;\n}\n.patrol-map-point-set {\r\n    color: #888;\r\n    border-bottom: 1px solid #EFEFEF;\r\n    padding: 10px 0;\r\n    height: 28px;\r\n    line-height: 28px;\r\n    box-sizing: content-box;\n}\n.patrol-point-unset {\r\n    color: #333;\n}\n.patrol-map-locale {\r\n    border: 1px solid #0093ff;\r\n    height: 28px;\r\n    line-height: 28px;\r\n    color: #0093ff;\r\n    float: right;\r\n    padding: 0 5px;\r\n    border-radius: 3px;\r\n    margin-right: 3px;\n}\n.patrol-map-locale.active {\r\n    background-color: #0093ff;\r\n    color: #FFF;\n}\n.patrol-map-point-set .ivu-icon {\r\n    margin-right: 3px;\n}\n.patrol-map-line-btns {\r\n    height: 40px;\n}\n.patrol-map-line-btns .active {\r\n    background-color: #0093ff;\r\n    color: #FFF;\n}\n.patrol-map-line-btns .disabled {\r\n    border: 1px solid #CCC;\r\n    color: #CCC;\n}\n.patrol-map-line-btns a {\r\n    display: inline-block;\r\n    height: 30px;\r\n    line-height: 30px;\r\n    padding: 0 6px;\r\n    border: 1px solid #0093ff;\r\n    color: #0093ff;\r\n    border-radius: 4px;\r\n    margin-right: 10px;\n}\r\n",""]),t.exports=e}}]);