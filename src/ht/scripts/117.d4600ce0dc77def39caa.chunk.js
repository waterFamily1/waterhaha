(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{1249:function(a,t,e){"use strict";e.r(t);var n=function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"patrol-plan-detail c-main-border"},[e("div",{staticClass:"c-left-border-blue"},[e("h3",[a._v("巡检计划")]),a._v(" "),"Outside"==a.plan.type?e("div",{staticClass:"patrol-plan-map-type"}):a._e(),a._v(" "),e("div",{staticClass:"c-btns-right"},["Ing"==a.plan.status?e("Button",{attrs:{type:"primary",shape:"circle",loading:a.interruptBtnLoading},on:{click:a.interruptPlan}},[a._v("终止")]):a._e(),a._v(" "),"New"==a.plan.status?e("Button",{attrs:{type:"primary",shape:"circle",loading:a.releaseBtnLoading},on:{click:a.releasePlan}},[a._v("下达")]):a._e(),a._v(" "),"New"==a.plan.status?e("Button",{attrs:{type:"primary",shape:"circle"},on:{click:a.editPlan}},[a._v("编辑")]):a._e(),a._v(" "),e("Button",{staticClass:"c-btn-back",staticStyle:{"margin-right":"10px"},attrs:{type:"primary",shape:"circle"},on:{click:a.handleCancle}},[a._v("返回")])],1)]),a._v(" "),e("div",{staticClass:"c-top-border-gray c-form-data-show"},[e("div",{staticClass:"c-form-row-2col"},[e("div",{staticClass:"c-form-item"},[e("label",[a._v("巡检计划名称：")]),a._v("\n                "+a._s(a.plan.name)+"\n            ")]),a._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[a._v("提前通知时间：")]),a._v("\n                "+a._s(a.plan.remindAdvance)+"分钟\n            ")])]),a._v(" "),e("div",{staticClass:"c-form-row-2col"},[e("div",{staticClass:"c-form-item"},[e("label",[a._v("所属组织：")]),a._v("\n                "+a._s(a.plan.org)+"\n            ")]),a._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[a._v("开始时间：")]),a._v("\n                "+a._s(a._f("F")(a.plan.planStart,"yyyy-MM-dd hh:mm"))+"\n            ")])]),a._v(" "),e("div",{staticClass:"c-form-row-2col"},[e("div",{staticClass:"c-form-item"},[e("label",[a._v("执行人员：")]),a._v("\n                "+a._s(a.plan.executor)+"\n            ")]),a._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[a._v("结束时间：")]),a._v("\n                "+a._s(a._f("F")(a.plan.taskEndDate,"yyyy-MM-dd hh:mm"))+"\n            ")])]),a._v(" "),e("div",{staticClass:"c-form-row-2col"},[e("div",{staticClass:"c-form-item"},[e("label",[a._v("计划状态：")]),a._v("\n                "+a._s(a.planStates[a.plan.status])+"\n            ")]),a._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[a._v("持续时间：")]),a._v("\n                "+a._s(a.plan.duration)+"\n            ")])]),a._v(" "),e("div",{staticClass:"c-form-row-2col"},[e("div",{staticClass:"c-form-item"},[e("label",[a._v("节假日设置：")]),a._v("\n                "+a._s(a.plan.holidayDisabled)+"\n            ")]),a._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[a._v("周期：")]),a._v("\n                "+a._s(a.plan.repeatCircle)+"\n            ")])])]),a._v(" "),e("div",{staticClass:"c-top-border-gray"},[e("div",{staticClass:"patrol-points-title"},[e("h3",{staticStyle:{display:"inline-block"}},[a._v("巡检点信息")]),a._v(" "),"Outside"==a.plan.type?e("a",{staticStyle:{color:"#4b7efe","margin-left":"10px","text-decoration":"underline"},attrs:{href:"javascript:;"},on:{click:a.redirectToMap}},[e("Icon",{attrs:{type:"android-pin",size:"16",color:"#E03E3E"}}),a._v(" "),e("span",{staticStyle:{"margin-left":"3px"}},[a._v("查看线路")])],1):a._e()]),a._v(" "),e("Table",{attrs:{columns:a.planPointColumns,data:a.selectedData,stripe:""}})],1)])};n._withStripped=!0;var i=e(23),l=e(11),p=e(539),s={data:function(){return{orderArrayObj:{First:"第一个",Second:"第二个",Third:"第三个",Fourth:"第四个",Last:"最后一个"},periodRankValueObj:{Day:"日子",Weekday:"工作日","Weekend Day":"周末",Sunday:"星期日",Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六"},plan:{},planPointColumns:[{title:"序号",type:"index",width:60},{title:"巡检点名称",key:"patrolPoint",width:200},{title:"描述",key:"description"},{title:"巡检步骤",key:"stepCount"},{title:"区域位置",key:"relatedProcessNames"},{title:"编号",key:"no"}],selectedData:[],interruptBtnLoading:!1,releaseBtnLoading:!1}},created:function(){l.a.initTableColumnTitle(this.planPointColumns)},mounted:function(){var a=this;this.$http.get(p.a.getPlan+"/"+this.$route.params.id).then((function(t){t.planStart=l.a.transDateFromServer(t.planStart,"yyyy-MM-dd hh:mm"),t.planEnd=l.a.transDateFromServer(t.planEnd,"yyyy-MM-dd hh:mm"),a.plan=t,a.setPeriodAndUnit(),a.getTaskEndDate(),a.setRepeatCircleData(),a.plan.holidayDisabled=t.holidayDisabled?"不执行":"执行",a.selectedData=t.pointsList}))},computed:Object(i.b)({planStates:function(a){return a.map.patrol.plan.planStates}}),methods:{editPlan:function(){this.$router.push({name:"patrol-plan-edit",params:{id:this.plan.id}})},interruptPlan:function(){var a=this;this.$Modal.confirm({title:"计划终止",content:"是否要终止当前计划？",onOk:function(){a.interruptBtnLoading=!0,a.$http.put(p.a.interruptPlan+"/"+a.plan.id).then((function(t){t.count&&(a.$Notice.success({title:"终止成功！"}),a.$router.push({name:"patrol-plan"})),a.interruptBtnLoading=!1})).catch((function(t){a.interruptBtnLoading=!1}))}})},releasePlan:function(){var a=this;this.releaseBtnLoading=!0,"Inside"==this.plan.type||this.plan.pathList.length>0?this.$http.put(p.a.releasePlan+"/"+this.plan.id).then((function(t){t&&t.count?(a.$Notice.success({title:"计划下达成功",desc:"已下达"+t.count+"个待执行巡检任务"}),a.$router.push({name:"patrol-plan"})):a.releaseBtnLoading=!1})).catch((function(t){a.releaseBtnLoading=!1})):(this.$Message.error("请维护巡检计划路线"),this.releaseBtnLoading=!1)},handleCancle:function(){this.$router.push({name:"patrol-plan"})},redirectToMap:function(){this.$router.push({name:"patrol-plan-map",params:{id:this.plan.id}})},setPeriodAndUnit:function(){var a=this.plan.periodUnit,t=this.plan.period;isNaN(t)||(this.plan.period=t,"Minute"==a&&(this.plan.duration=t+"分钟"),"Hour"==a&&(this.plan.duration=t+"小时"),"Day"==a&&(this.plan.duration=t+"天"),"Week"==a&&(this.plan.duration=t+"周"))},getTaskEndDate:function(){var a=0,t=this.plan.periodUnit,e=this.plan.period;"Minute"==t&&(a=60*e*1e3),"Hour"==t&&(a=60*e*60*1e3),"Day"==t&&(a=24*e*60*60*1e3),"Week"==t&&(a=7*e*24*60*60*1e3),this.plan.taskEndDate=new Date(new Date(this.plan.planStart).getTime()+a)},setRepeatCircleData:function(){switch(this.plan.periodType){case"Hourly":this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"小时（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"小时（"+this.plan.planStart+"至"+this.plan.planEnd+"）";break;case"Daily":"2;3;4;5;6"==this.plan.periodRank?this.plan.repeatCount?this.plan.repeatCircle="每个工作日（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每个工作日（"+this.plan.planStart+"至"+this.plan.planEnd+"）":this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"天（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"天（"+this.plan.planStart+"至"+this.plan.planEnd+"）";break;case"Weekly":var a=this.plan.periodRank&&this.plan.periodRank.split(","),t=[];a.sort().forEach((function(a){switch(a){case"2":t.push("星期一");break;case"3":t.push("星期二");break;case"4":t.push("星期三");break;case"5":t.push("星期四");break;case"6":t.push("星期五");break;case"7":t.push("星期六");break;case"1":t.push("星期日")}})),this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"周后的"+t.join(",")+"（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"周后的"+t.join(",")+"（"+this.plan.planStart+"至"+this.plan.planEnd+"）";break;case"Monthly":this.plan.periodRankValue?this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"个月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"个月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（"+this.plan.planStart+"至"+this.plan.planEnd+"）":this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"个月第"+this.plan.periodRank+"天（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"个月第"+this.plan.periodRank+"天（"+this.plan.planStart+"至"+this.plan.planEnd+"）";break;case"Yearly":this.plan.periodRankValue?this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（"+this.plan.planStart+"至"+this.plan.planEnd+"）":this.plan.repeatCount?this.plan.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.plan.periodRank+"日（从"+this.plan.planStart+"开始重复"+this.plan.repeatCount+"次）":this.plan.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.plan.periodRank+"日（"+this.plan.planStart+"至"+this.plan.planEnd+"）"}}}},r=(e(961),e(1)),o=Object(r.a)(s,n,[],!1,null,null,null);o.options.__file="src/views/patrol/plan/detail.vue";t.default=o.exports},539:function(a,t,e){"use strict";var n=e(22),i={getTasks:"/patrol/api/tasks",getTaskDetail:"/patrol/api/tasks",delTasks:"/patrol/api/tasks",modifyTask:"/patrol/api/tasks",stop:"/patrol/api/tasks",updatePatrolTaskPoint:"/patrol/api/task-point-step",plan:"/patrol/api/plans",getPlan:"/patrol/api/plans",updatePlan:"/patrol/api/plans",deletePlan:"/patrol/api/plans",planPath:"/patrol/api/plan-path",releasePlan:"/patrol/api/plans/release",interruptPlan:"/patrol/api/plans/interrupt",statistics:"/patrol/api/tasks/statistics",export:n.a+"/patrol/api/tasks/statistics-export",point:"/patrol/api/points",getQrcode:n.a+"/patrol/api/points/qrcode-export",trace:"/patrol/api/tasks/map-track"};t.a=i},710:function(a,t,e){a.exports=e.p+"images/c06aff95ea60ffe5aafe68ea98d65d9e.png"},712:function(a,t,e){var n=e(962);"string"==typeof n&&(n=[[a.i,n,""]]),n.locals&&(a.exports=n.locals);(0,e(17).default)("7eb3f695",n,!1,{})},961:function(a,t,e){"use strict";var n=e(712);e.n(n).a},962:function(a,t,e){var n=e(10),i=e(24),l=e(710);t=n(!1);var p=i(l);t.push([a.i,"\n.patrol-plan-detail .c-form-data-show .c-form-item {\r\n    padding-left: 140px;\n}\n.patrol-plan-detail .c-form-item label {\r\n    width: 140px;\n}\n.patrol-points-title {\r\n    height: 40px;\n}\n.patrol-plan-map-type {\r\n    margin-left: 10px;\r\n    vertical-align: top;\r\n    display: inline-block;\r\n    width: 64px;\r\n    height: 25px;\r\n    background: url("+p+") no-repeat 0 0;\n}\r\n",""]),a.exports=t}}]);