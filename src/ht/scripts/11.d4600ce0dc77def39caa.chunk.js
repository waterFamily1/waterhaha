(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1146:function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"c-tree"},[r("div",{staticClass:"c-tree-left",attrs:{id:"J_TREE_LEFT"}},[r("div",{staticStyle:{padding:"2px"}},[r("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"输入报表名称以检索",clearable:"",filterable:"",remote:"","remote-method":e.onSearch,loading:e.searchLoading},on:{"on-change":e.onSearchItemClick}},e._l(e.searchItems,(function(t){return r("Option",{key:t.id,attrs:{value:JSON.stringify(t)}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),r("div",{staticClass:"padding-l-10",staticStyle:{"border-top":"1px solid #e6e6e6",position:"relative"}},[e.treeLoading?r("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),r("Tree",{attrs:{data:e.treeData,render:e.renderContent}})],1)]),e._v(" "),r("div",{staticClass:"c-main-border c-tree-right",staticStyle:{position:"relative"}},[r("a",{staticStyle:{position:"absolute",top:"5px",right:"30px"},attrs:{href:"javascript:;"},on:{click:e.reportFullscreen}},[r("Icon",{attrs:{type:"arrow-expand",size:"25",color:"#9baeb3"}})],1),e._v(" "),r("div",{staticStyle:{overflow:"auto"},attrs:{id:"J_REPORT"}},[r("fullscreen",{ref:"fullscreen",attrs:{background:"#FFF"},on:{change:e.fullscreenChange}},[r("div",{directives:[{name:"show",rawName:"v-show",value:"normal"==e.reportType,expression:"reportType == 'normal'"}]},[r("Spin",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],attrs:{fix:""}}),e._v(" "),r("div",{staticStyle:{margin:"2px 5px"}},[r("DatePicker",{staticStyle:{width:"200px"},attrs:{type:e.dateType,placeholder:"业务时间"},on:{"on-change":function(t){return e.getNormalData(e.activeTreeId)}},model:{value:e.currentDate,callback:function(t){e.currentDate=t},expression:"currentDate"}}),e._v(" "),r("Button",{staticClass:"c-btn-add",attrs:{type:"primary"},on:{click:e.normalExport}},[e._v("导出")])],1),e._v(" "),r("table",{staticClass:"report-table"},[r("thead",[r("tr",[r("th",{attrs:{rowspan:"2"}},[e._v("时间")]),e._v(" "),e._l(e.groups,(function(t,n){return r("th",{key:n,staticClass:"report-group-th",attrs:{colspan:t.length}},[e._v(e._s(n))])}))],2),e._v(" "),r("tr",e._l(e.reportData.mpoints,(function(t,n){return r("th",{key:n},[e._v(e._s(t.mpointname))])})),0)]),e._v(" "),r("tbody",[r("tr",{directives:[{name:"show",rawName:"v-show",value:0==e.reportData.items.length,expression:"reportData.items.length == 0"}]},[r("td",{staticStyle:{"line-height":"30px","text-align":"center"},attrs:{colspan:e.reportData.mpoints.length+1}},[e._v("暂无数据")])]),e._v(" "),e._l(e.reportData.dates,(function(t){return r("tr",{key:t},[r("td",{staticStyle:{"white-space":"nowrap"}},[e._v(e._s(e._f("F")(t,"yyyy-MM-dd hh:mm:ss")))]),e._v(" "),e._l(e.reportData.mpoints,(function(n,a){return r("td",{key:a},[e._v(e._s(e.findValueByDateAndPid(t,n.mpointid)))])}))],2)}))],2),e._v(" "),r("tfoot",{directives:[{name:"show",rawName:"v-show",value:e.reportData.items.length>0,expression:"reportData.items.length > 0"}]},[r("tr",[r("td",[e._v("最大值")]),e._v(" "),e._l(e.reportData.mpoints,(function(t,n){return r("td",{key:n},[e._v(e._s(e.maxByPoints(t.mpointid)))])}))],2),e._v(" "),r("tr",[r("td",[e._v("最小值")]),e._l(e.reportData.mpoints,(function(t,n){return r("td",{key:n},[e._v(e._s(e.minByPoints(t.mpointid)))])}))],2),e._v(" "),r("tr",[r("td",[e._v("平均值")]),e._l(e.reportData.mpoints,(function(t,n){return r("td",{key:n},[e._v(e._s(e.avgByPoints(t.mpointid)))])}))],2)])])],1),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:"smart"==e.reportType,expression:"reportType == 'smart'"}],attrs:{id:"J_REPORT_IFRAME"}},[r("iframe",{staticStyle:{width:"100%",height:"100%",border:"none"},attrs:{id:"report_smart_iframe"}})])])],1)])])};n._withStripped=!0;var a=r(11),i=r(517),o=r(580),s=r(538),l=r.n(s);function c(e){return e.replace(/(template_)/gi,"")}function u(e,t){var r={};return e.map((function(e){var n=e[t];r[n]?r[n].push(e):r[n]=[e]})),r}r(7).default.use(l.a);var p={data:function(){return{searchLoading:!1,searchItems:[],treeData:[],activeTreeId:"",dateType:"date",currentDate:new Date,reportType:"",loading:!1,reportData:{mpoints:[],dates:[],items:[]},groups:{},rows:{},treeLoading:!1}},watch:{$route:function(e){var t=e.params.id;"report-normal-detail"==e.name?this.getNormalData(t):"report-smart-detail"==e.name&&this.getSmartData(t)}},methods:{onSearch:function(e){var t=this;e&&(this.searchLoading=!0,this.$http.get(o.a.tree,{query:e}).then((function(e){t.searchLoading=!1,t.searchItems=e.filter((function(e){return 11==e.type||12==e.type}))||[]})).catch((function(){t.searchLoading=!1})))},onSearchItemClick:function(e){var t=JSON.parse(e);a.a.setTrueTreeExpand(this.treeData,t.id),this.activeTreeId=t.id,11==t.type?this.getNormalData():12==t.type&&this.getSmartData()},getTreeData:function(){var e=this;this.treeLoading=!0,this.$http.get(o.a.tree).then((function(t){var r=a.a.getItemAndParentsByTypeId(t,!1,[11,12]);e.treeData=a.a.transDataToTree(r.map((function(e){return e.expand=!0,e}))),e.treeLoading=!1}))},renderContent:function(e,t){var r=this,n=(t.root,t.node,t.data),a=n.name;return 11!=n.type&&12!=n.type||(a=[e("span",{class:{"ivu-tree-title":!0,"ivu-tree-title-selected":this.activeTreeId==n.id,"report-tree-icon-normal":11==n.type,"report-tree-icon-smart":12==n.type},on:{click:function(){r.activeTreeId=n.id,11==n.type?r.$router.push({name:"report-normal-detail",params:{id:n.id}}):12==n.type&&r.$router.push({name:"report-smart-detail",params:{id:n.id}})}}},n.name)]),e("div",{class:["c-tree-row"]},a)},getNormalData:function(e){var t=this;this.reportType="normal",this.loading=!0;var r=c(e||this.activeTreeId);this.$http.get(o.a.data,{id:r,date:i.a.transDateFromLocale(i.a.midnight(this.currentDate))}).then((function(e){t.reportData=e,t.groups=u(e.mpoints||[],"groupname"),t.rows=u(e.items||[],"datadt"),t.loading=!1})).catch((function(){t.loading=!1})),this.$http.get(o.a.template+"/"+r).then((function(e){t.dateType="D"==e.temptype?"date":"month"}))},findValueByDateAndPid:function(e,t){for(var r,n=this.rows[e],a=0,i=n.length;a<i;a++)n[a].mpointid==t&&(r=n[a].value);return r},maxByPoints:function(e){var t=this.reportData.items.filter((function(t){return t.mpointid==e}));if(t.length){var r=-1/0;return t.map((function(e){e.value>r&&(r=e.value)})),r===-1/0?"":r}},minByPoints:function(e){var t=this.reportData.items.filter((function(t){return t.mpointid==e}));if(t.length){var r=1/0;return t.map((function(e){null!==e.value&&e.value<r&&(r=e.value)})),r===1/0?"":r}},avgByPoints:function(e){var t=this.reportData.items.filter((function(t){return t.mpointid==e}));if(t.length){var r=0,n=0;return t.map((function(e){r+=e.value||0,n++})),(r/n).toFixed(2)}},normalExport:function(){a.a.download(o.a.exportReport,{id:c(this.activeTreeId),date:a.a.transDateFromLocale(i.a.midnight(this.currentDate))})},getSmartData:function(e){var t=this;this.reportType="smart",this.loading=!1;var r=c(e||this.activeTreeId);this.$http.get(o.a.template+"/"+r).then((function(e){e&&e.rpath&&/http/gi.test(e.rpath)?document.getElementById("report_smart_iframe").src=o.a.redirect+encodeURIComponent(e.rpath):(document.getElementById("report_smart_iframe").src="",t.$Notice.error({title:"智能报表配置错误"}))}))},fullscreenChange:function(e){if("report-smart-detail"==this.$route.name)if(e)document.querySelector("#J_REPORT_IFRAME").style.height=window.screen.height-10+"px";else{var t=document.querySelector(".lay").offsetHeight;document.querySelector("#J_REPORT_IFRAME").style.height=t-10+"px"}},reportFullscreen:function(){this.$refs.fullscreen.toggle()}},mounted:function(){var e=a.a.setTreeLeftHeight(),t=document.querySelector(".lay").offsetWidth;if(document.querySelector("#J_REPORT_IFRAME").style.height=e-10+"px",document.querySelector("#J_REPORT").style.width=t-350+"px",document.querySelector("#J_REPORT").style.height=e-10+"px","report-normal-detail"==this.$route.name){var r=this.$route.params.id;this.getNormalData(r),this.activeTreeId=r}else if("report-smart-detail"==this.$route.name){r=this.$route.params.id;this.getSmartData(r),this.activeTreeId=r}this.getTreeData()}},d=(r(987),r(1)),f=Object(d.a)(p,n,[],!1,null,null,null);f.options.__file="src/views/report/report.vue";t.default=f.exports},512:function(e,t,r){e.exports=r.p+"images/a954021ab2bbe81e01475e318c91e48d.png"},517:function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var a={F:function(e,t){if(!e)return"";"object"!=n(e)&&(e=new Date(e)),t=t||"yyyy-MM-dd";var r=e.getFullYear().toString(),a={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};for(var i in t=t.replace(/(y+)/gi,(function(e,t){return r.substr(4-Math.min(4,t.length))})),a)t=t.replace(new RegExp("("+i+"+)","g"),(function(e,t){return a[i]<10&&t.length>1?"0"+a[i]:a[i]}));return t},str2Date:function(e){if(e)return"object"!=n(e)?new Date(e):e},firstDayByWeek:function(e){var t=a.str2Date(e)||new Date,r=t.getDay(),n=(0==r?7:r)-1;return a.midnight(new Date(t.getTime()-24*n*60*60*1e3))},firstDayByMonth:function(e){var t=a.str2Date(e)||new Date;return a.midnight(new Date(t.getFullYear(),t.getMonth(),1))},firstDayByYear:function(e){var t=a.str2Date(e)||new Date;return a.midnight(new Date(t.getFullYear(),0,1))},countDateByStep:function(e,t,r,n){e=a.formatePolyfill(e);var i,o=a.str2Date(e)||new Date(e),s=o.getTime(),l=(new Date).getTime();switch(r){case"day":i=s+864e5*t;break;case"week":i=s+6048e5*t;break;case"month":i=new Date(o.getFullYear(),o.getMonth()+t,o.getDate()).getTime(),n&&(i=new Date(o.getFullYear(),o.getMonth()+t,o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()).getTime());break;case"year":i=new Date(o.getFullYear()+t,o.getMonth(),o.getDate()).getTime(),n&&(i=new Date(o.getFullYear()+t,o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds()).getTime())}return i>l&&(i=l),n?i:a.midnight(i)},midnight:function(e){return e?a.F(e)+" 00:00:00":""},beforeMidnight:function(e){return e?a.F(e)+" 23:59:59":""},midnightMill:function(e){var t=a.str2Date(e)||new Date;return new Date(a.midnight(t)).getTime()},chain:function(e,t){return a.countDateByStep(e,-1,t)},yearOFyear:function(e){return a.countDateByStep(e,-1,"year")},getPeriods:function(e){var t,r=e.beginDate,n=new Date(a.formatePolyfill(r)),i=n.getTime();switch(e.cycle){case"day":t=i+864e5;break;case"week":t=i+6048e5;break;case"month":t=new Date(n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0).getTime();break;case"year":t=new Date(n.getFullYear()+1,n.getMonth(),n.getDate(),0,0,0).getTime()}return{min:i,max:new Date(t).getTime()}},formatePolyfill:function(e){return"string"!=typeof e?e:("string"==typeof e&&0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),e)},getTerminalsByMonth:function(e,t){var r,n;return 0==t?(r=new Date(e,0,1,0,0,0),n=new Date(e,11,31,23,59,59)):(r=new Date(e,t-1,1,0,0,0),n=new Date(e,t,0,23,59,59)),{start:r,end:n}},transDateFromServer:function(e,t){return e?("string"==typeof e&&0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),a.F(e,t||"yyyy-MM-dd hh:mm")):""},transDateFromLocale:function(e){return e?("string"==typeof e&&(0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),e=new Date(e)),e.toISOString()):""},strToData:function(e){var t=e.split(" ")[0].split("-"),r=[];return void 0!==e.split(" ")[1]&&(r=e.split(" ")[1].split(":")),new Date(t[0],t[1]-1,t[2],null!==r[0]?r[0]:0,null!==r[1]?r[1]:0,null!==r[2]?r[2]:0)}};t.a=a},538:function(e,t,r){e.exports=function(e){function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var r={};return t.m=e,t.c=r,t.i=function(e){return e},t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,r){"use strict";t.b=function(){var e=document.documentElement;return"requestFullscreen"in e||"mozRequestFullScreen"in e&&document.mozFullScreenEnabled||"msRequestFullscreen"in e&&document.msFullscreenEnabled||"webkitRequestFullScreen"in e},t.c=function(){return!!(document.fullscreen||document.mozFullScreen||document.fullscreenElement||document.msFullscreenElement||document.webkitIsFullScreen)},t.g=function(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():console.log("Fullscreen API is not supported.")},t.d=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("Fullscreen API is not supported.")},t.f=function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("webkitfullscreenchange",e)},t.e=function(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("webkitfullscreenchange",e)},t.a=function e(){var t={},r=!1,n=0,a=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(r=arguments[0],n++);n<a;n++)!function(n){for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r&&"[object Object]"===Object.prototype.toString.call(n[a])?t[a]=e(!0,t[a],n[a]):t[a]=n[a])}(arguments[n]);return t}},function(e,t,r){"use strict";function n(){return r.i(o.c)()}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=arguments[1];if(l&&!n()){t=r.i(o.a)(!0,{},s,t);var a=e,i=void 0;t.wrap&&((i=document.createElement("div")).style["overflow-y"]="auto",i.style.background=t.background,i.style.width="100%",i.style.height="100%",a.parentNode.insertBefore(i,a),i.appendChild(a),i.addEventListener("click",(function(e){e.target===this&&r.i(o.d)()}))),a.classList.add(t.fullscreenClass),r.i(o.f)((function e(){var s=n();s||(r.i(o.e)(e),a.classList.remove(t.fullscreenClass),t.wrap&&(i.parentNode.insertBefore(a,i),i.parentNode.removeChild(i))),t.callback&&t.callback(s)})),r.i(o.g)(t.wrap?i:a)}}function i(){l&&n()&&r.i(o.d)()}var o=r(0),s={wrap:!0,background:"#333",callback:function(){},fullscreenClass:"fullscreen"},l=r.i(o.b)();t.a={getState:n,toggle:function(e,t,r){l&&(void 0===r?n()?i():a(e,t):r?a(e,t):i())},enter:a,exit:i}},function(e,t,r){var n=r(5)(r(4),r(6),null,null);e.exports=n.exports},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),a=r.n(n),i=r(1),o=r(0);t.default={install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name||"fullscreen";e.component(n,r.i(o.a)(a.a,{name:n})),e.prototype["$"+n]=i.a}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.default={props:{background:{type:String,default:"#333"},fullscreenClass:{type:String,default:"fullscreen"},fullscreen:{type:Boolean,default:!1}},data:function(){return{supportFullScreen:!1,isFullscreen:!1}},computed:{wrapperStyle:function(){return{background:this.background,"overflow-y":"auto",width:"100%",height:"100%"}}},methods:{toggle:function(e){void 0===e?r.i(n.c)()?this.exit():this.enter():e?this.enter():this.exit()},enter:function(){this.supportFullScreen&&(r.i(n.f)(this.fullScreenCallback),r.i(n.g)(this.$el))},exit:function(){this.supportFullScreen&&this.getState()&&r.i(n.d)()},getState:function(){return r.i(n.c)()},shadeClick:function(e){e.target===this.$el&&this.exit()},fullScreenCallback:function(){this.isFullscreen=r.i(n.c)(),this.isFullscreen||r.i(n.e)(this.fullScreenCallback),this.$emit("change",this.isFullscreen),this.$emit("update:fullscreen",this.isFullscreen)}},watch:{fullscreen:function(e){e!==r.i(n.c)()&&(e?this.enter():this.exit())}},created:function(){this.supportFullScreen=r.i(n.b)()}}},function(e,t){e.exports=function(e,t,r,n){var a,i=e=e||{},o=typeof e.default;"object"!==o&&"function"!==o||(a=e,i=e.default);var s="function"==typeof i?i.options:i;if(t&&(s.render=t.render,s.staticRenderFns=t.staticRenderFns),r&&(s._scopeId=r),n){var l=Object.create(s.computed||null);Object.keys(n).forEach((function(e){var t=n[e];l[e]=function(){return t}})),s.computed=l}return{esModule:a,exports:i,options:s}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{class:e.isFullscreen?[e.fullscreenClass]:[],style:e.isFullscreen?[e.wrapperStyle]:[],on:{click:function(t){e.shadeClick(t)}}},[e._t("default")],2)},staticRenderFns:[]}}])},580:function(e,t,r){"use strict";var n=r(22),a={tree:"/loong/api/reports/tree",normalTree:"/loong/api/normal-reports/tree",smartTree:"/loong/api/smart-reports/tree",briefTree:"/loong/api/datainput-reports/tree",folder:"/loong/api/folders",template:"/loong/api/report-templates",data:"/loong/api/reports/data",getReportUrl:"/loong/api/report/server-url",exportReport:n.a+"/loong/api/reports/export",exportBrief:n.a+"/loong/api/datainput-reports/export",getSessionId:"/loong/api/smart-reports/server-session-id",redirect:n.a+"/loong/api/smart-reports/server-url?reportUrl="};t.a=a},718:function(e,t,r){var n=r(988);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,r(17).default)("59d95093",n,!1,{})},987:function(e,t,r){"use strict";var n=r(718);r.n(n).a},988:function(e,t,r){var n=r(10),a=r(511);(t=n(!1)).i(a),t.push([e.i,"\r\n",""]),e.exports=t}}]);