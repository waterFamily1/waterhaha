(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{1236:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-main-border"},[a("div",{staticClass:"c-left-border-blue"},[a("h3",[e._v("出库新增")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{directives:[{name:"role",rawName:"v-role",value:"checkout-add",expression:"'checkout-add'"}],attrs:{type:"primary",shape:"circle",loading:e.submitLoading},on:{click:e.submit}},[e._v("保存")]),e._v(" "),a("Button",{staticClass:"c-btn-back",attrs:{type:"default",shape:"circle"},on:{click:e.backClick}},[e._v("取消")])],1)]),e._v(" "),a("Form",{ref:"addForm",attrs:{model:e.params,rules:e.formRules,"label-width":100}},[a("div",{staticClass:"c-top-border-gray"},[a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"orgId",label:"所属组织："}},[a("dropdown-tree",{attrs:{url:e.orgTreeApi},on:{input:e.chooseOrg},model:{value:e.org,callback:function(t){e.org=t},expression:"org"}})],1)],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"warehouseNo",label:"出库仓库："}},[a("Select",{staticStyle:{width:"300px"},model:{value:e.params.warehouseNo,callback:function(t){e.$set(e.params,"warehouseNo",t)},expression:"params.warehouseNo"}},e._l(e.warehouseCombo,(function(t,i){return a("Option",{key:t.warehouseNo,attrs:{value:t.warehouseNo},nativeOn:{click:function(a){return e.warehouseChange(t)}}},[e._v(e._s(t.warehouseName))])})),1)],1)],1)]),e._v(" "),a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"userId",label:"出库人员："}},[a("Select",{staticStyle:{width:"300px"},model:{value:e.params.userId,callback:function(t){e.$set(e.params,"userId",t)},expression:"params.userId"}},e._l(e.storeMember,(function(t,i){return a("Option",{key:t.id,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"applicantId",label:"申请人员："}},[a("Select",{staticStyle:{width:"300px"},model:{value:e.params.applicantId,callback:function(t){e.$set(e.params,"applicantId",t)},expression:"params.applicantId"}},e._l(e.applicantMemberArr,(function(t,i){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1)],1)]),e._v(" "),a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"outPutDate",label:"出库时间："}},[a("DatePicker",{staticStyle:{width:"300px"},attrs:{type:"date",placeholder:"请选择出库时间"},model:{value:e.params.outPutDate,callback:function(t){e.$set(e.params,"outPutDate",t)},expression:"params.outPutDate"}})],1)],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{label:"申请用途："}},[a("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea"},model:{value:e.params.applicantPurpose,callback:function(t){e.$set(e.params,"applicantPurpose",t)},expression:"params.applicantPurpose"}})],1)],1)])]),e._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("出库明细")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",size:"small"},on:{click:e.addRow}},[e._v("新增")])],1)]),e._v(" "),a("Table",{attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:""}})],1)]),e._v(" "),a("Modal",{attrs:{width:"800",title:"选择物料"},model:{value:e.modalShown,callback:function(t){e.modalShown=t},expression:"modalShown"}},[a("mg-select-table",{ref:"selectTable",attrs:{columns:e.modalColumns,url:e.materielapi,manual:!0,searchPlaceholder:"物料编号或物料名称"},on:{"on-submit":e.modalSubmit,"on-cancel":e.modalCancel}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};i._withStripped=!0;var o=a(23),r=a(145),n=a(537),s=a(11),l=a(527),c=a(107),u=[],p={data:function(){var e=this;return{warehouseCombo:[],storeMember:[],applicantMemberArr:[],warehouse:{no:"",name:""},org:{id:"",title:"请选择"},params:{orgId:"",warehouseNo:"",userId:"",applicantId:"",outPutDate:"",applicantPurpose:""},submitLoading:!1,formRules:{orgId:[{required:!0,validator:function(e,t,a){t?a():a(new Error("请选择组织"))}}],warehouseNo:[{required:!0,message:"请选择出库仓库",trigger:"change"}],userId:[{required:!0,message:"请选择出库人员",trigger:"change",type:"number"}],applicantId:[{required:!0,message:"请选择申请人员",trigger:"change",type:"number"}],outPutDate:[{required:!0,type:"date",message:"请选择出库时间",trigger:"change"}]},orgTreeApi:c.a.getOrgTreeData,materielapi:l.a.checkout.getMaterielsOutBound,modalShown:!1,modalColumns:[{type:"selection",width:50},{title:"物料编号",key:"materielNumber"},{title:"物料名称",key:"materielName"},{title:"物料类别",key:"categoryName"},{title:"ABC分类",key:"abc"},{title:"品牌",key:"brand"},{title:"型号",key:"model"},{title:"规格",key:"standard"},{title:"库位",key:"locationName"}],columns:[{title:"物料编号",key:"materielNumber"},{title:"物料名称",key:"materielName"},{title:"物料类别",key:"categoryName"},{title:"ABC分类",key:"abc"},{title:"品牌",key:"brand"},{title:"型号",key:"model"},{title:"规格",key:"standard"},{title:"库位",key:"locationName"},{title:"库存数量",key:"amount"},{title:"出库数量",key:"outAmount ",render:function(t,a){var i=e;return t("div",[t("InputNumber",{props:{value:a.row.outAmount||0},on:{input:function(e){a.row.outAmount=e,i.listData[a.index]=a.row}}})])}}],listData:[],storagePos:[],loading:!1}},computed:Object(o.b)({account:function(e){return e.user.account}}),methods:{initData:function(){var e=this,t="",a="",i=(this.account.name,this.account.id);this.account.orgChain.reverse().some((function(e){return 2==e.type&&(t=e.id,a=e.name,!0)})),t&&a&&(this.org.id=t,this.org.title=a,this.params.orgId=t,this.params.orgName=a,this.getWarehouseComboList({orgIds:this.org.id}),this.$http.get(l.a.checkout.getApplicantMember,{orgId:this.org.id}).then((function(t){e.applicantMemberArr=t})),this.getUnderOrganizationUsers({id:t},(function(e){e.storeMember.forEach((function(t){t.id==i&&(e.params.userId=i)}))})))},getUnderOrganizationUsers:function(e,t){var a=this;this.$http.get(l.a.getManaginguser,{orgIds:e.id}).then((function(e){e&&e.items&&(a.storeMember=e.items,t&&t(a))}))},submit:function(){var e=this,t=this;this.$refs.addForm.validate((function(a){if(a){if(0==e.listData.length)return e.$Notice.warning({title:"请增加出库明细"}),!1;if(!e.listData.every((function(e,a){return!!e.warehouseLocationNoId||(t.$Notice.warning({title:"请选择第"+(a+1)+"行中出库库位"}),!1)})))return!1;e.submitLoading=!0,e.params.outboundDetailVos=e.listData.slice(0),e.$http.post(l.a.checkout.addOutbond,e.params).then((function(a){e.submitLoading=!1,a.id&&(e.$Notice.success({title:"保存成功！"}),t.$router.push({name:"storage-checkout-detail",params:{id:a.id}}))})).catch((function(){e.submitLoading=!1}))}}))},backClick:function(){this.$router.back()},chooseOrg:function(){var e=this;this.params.orgId=this.org.id,this.params.orgName=this.org.title,this.params.warehouseNo="",this.params.applicantId="",this.params.userId="",this.warehouseCombo=[],this.org.id&&(this.getWarehouseComboList({orgIds:this.org.id}),this.$http.get(l.a.checkout.getApplicantMember,{orgId:this.org.id}).then((function(t){e.applicantMemberArr=t})),this.getUnderOrganizationUsers(this.org))},addRow:function(){this.params.warehouseNo?this.modalShown=!0:this.$Notice.warning({title:"请先选择出库仓库"})},getWarehouseComboList:function(e){var t=this;this.$http.get(l.a.getWarehouseComboList,e).then((function(e){t.warehouseCombo=e}))},warehouseChange:function(e){var t=this,a=this,i={warehouseNo:e.warehouseNo};a.warehouse.no&&a.warehouse.no!=e.warehouseNo?this.$Modal.confirm({title:"提示",content:"请确认更改出库仓库，更改后将清空已增加的出库明细列表",onOk:function(){a.warehouse.no=e.warehouseNo,a.warehouse.name=e.warehouseName,t.params.warehouseName=e.warehouseName,t.initSelectTable(i),t.listData=[],t.getPositionComboxList(i)},onCancel:function(){t.params.warehouseNo=a.warehouse.no,t.params.warehouseName=a.warehouse.name}}):(a.warehouse.no||(this.initSelectTable(i),this.listData=[],this.getPositionComboxList(i)),a.warehouse.no=e.warehouseNo,a.warehouse.name=e.warehouseName,this.params.warehouseName=e.warehouseName)},initSelectTable:function(e){this.$refs.selectTable.getData(e)},remoteMethodByPosition:function(e){this.getPositionComboxList({warehouseNo:this.params.warehouseNo,queryName:e})},getPositionComboxList:function(e){var t=this;this.loading1=!0,this.$http.get(l.a.checkin.getPositionComboxList,e).then((function(e){t.loading1=!1,t.storagePos=e}))},modalSubmit:function(e){var t=this;e.length?(this.modalShown=!1,u=[],this.listData.forEach((function(e){u.push(Object.assign({},e))})),this.listData=[],e.forEach((function(e){var a=e;u.forEach((function(t){e.id==t.id&&(a=Object.assign({},e,t))})),t.listData.push(Object.assign({},a))})),this.listData.forEach((function(e){var t=e.outAmount;delete e.outAmount,e.outAmount=t||0}))):this.$Notice.warning({title:"请选择物料"})},modalCancel:function(){this.modalShown=!1}},created:function(){s.a.initTableColumnTitle(this.columns),this.initData()},components:{dropdownTree:r.a,mgSelectTable:n.a}},d=a(1),m=Object(d.a)(p,i,[],!1,null,null,null);m.options.__file="src/views/storage/checkout/add.vue";t.default=m.exports},527:function(e,t,a){"use strict";var i=a(22),o={getWarehouseComboList:"/inventory/api/warehouse/comboList",getManaginguser:"/inventory/api/users/managinguser",category:{getTree:"/inventory/api/materiel-category/tree",getInfo:"/inventory/api/materiel-category/materiel",add:"/inventory/api/materiel-category/materiel",edit:"/inventory/api/materiel-category/materiel",del:"/inventory/api/materiel-category/materiel",search:"/inventory/api/materiel-category/list"},inventory:{audit:"/inventory/api/store-adjustment/audited",export:i.a+"/inventory/api/store-adjustment/export",url:"/inventory/api/store-adjustment/adjusment",list:"/inventory/api/store-adjustment/list",detailList:"/inventory/api/store-adjustment/detail/list",itemList:"/inventory/api/store-adjustment/materiel/list",move:"/inventory/api/store-adjustment/move",materielSearch:"/inventory/api/stock/materiel",materielPosition:"/inventory/api/stock/position",materielDepot:"/inventory/api/stock/warehous"},takeStock:{audit:"/inventory/api/materiel-inventory/audited",export:i.a+"/inventory/api/materiel-inventory/export",import:i.a+"/inventory/api/materiel-inventory/import",url:"/inventory/api/materiel-inventory/inventory",detailList:"/inventory/api/materiel-inventory/detail/list",list:"/inventory/api/materiel-inventory/list"},storage:{comboList:"/inventory/api/warehouse/comboList"},material:{getMaterielCategoryTree:"/inventory/api/materiel-category/tree/external",getMateriel:"/inventory/api/materiels",delMateriel:"/inventory/api/materiels",exportMateriel:i.a+"/inventory/api/materiels/excel-export",addMateriel:"/inventory/api/materiel",changeMateriel:"/inventory/api/materiel",getMaterielDetail:"/inventory/api/materiel",getDistribution:"/inventory/api/materielStocks/distribution",getMaterielStockLimits:"/inventory/api/materielStockLimits",bacthAddMaterielStockLimit:"/inventory/api/materielStockLimit/batch-save",updateMaterielStockLimit:"/inventory/api/materielStockLimit",delMaterielStockLimit:"/inventory/api/materielStockLimits",getUnitList:"/inventory/api/materiel/unit",modalMateriel:"/inventory/api/materiel/external",getExcel:i.a+"/inventory/api/excel-temlate-down",importExcel:i.a+"/inventory/api/excel-import",cancelExcelData:"/inventory/api/excel-data-cancel",saveExcelData:"/inventory/api/excel-data-save"},repertory:{getWarehouses:"/inventory/api/warehouses",exportWarehouse:i.a+"/inventory/api/warehouse/excel-export",delWarehouses:"/inventory/api/warehouses",changeWarehouses:"/inventory/api/warehouse",addWarehouse:"/inventory/api/warehouse",getWarehouseDetail:"/inventory/api/warehouse",getWarehouseInfo:"/inventory/api/warehouse/getWarehouseInfo",getPositionOfWarehouse:"/inventory/api/warehousePosition/positionList",bacthAddWarehouseposition:"/inventory/api/warehouseposition/batch-save",updateWarehousePosition:"/inventory/api/warehousePosition",delWarehousePosition:"/inventory/api/warehousePositions",positionByWarehouse:"/inventory/api/warehousePosition/move",checkWarehousenameIsExist:"/inventory/api/warehouse/check-warehousename-isexist",getExcel:i.a+"/inventory/api/warehousePosition/excel-temlate-down",importExcel:i.a+"/inventory/api/warehousePosition/excel-import",cancelExcelData:"/inventory/api/warehousePosition/excel-data-cancel",saveExcelData:"/inventory/api/warehousePosition/excel-data-save"},checkin:{getInbond:"/inventory/api/inbounds",delInbond:"/inventory/api/inbounds",addInbond:"/inventory/api/inbound",getInbondDetail:"/inventory/api/inbound",getInbondRecordList:"/inventory/api/inbound/inboundDetails",getPositionComboxList:"/inventory/api/warehousePosition/positionComboxList",auditeInbound:"/inventory/api/inbound/audite",getMaterielsByWareHouseNo:"/inventory/api/materiel/getMaterielsByWareHouseNo",getMateriels:"/inventory/api/materiel/getMateriels",updateInboundDetail:"/inventory/api/inboundDetail"},checkout:{getApplicantMember:"/uaa/api/users/select",getOutbond:"/inventory/api/outbounds",delOutbond:"/inventory/api/outbounds",addOutbond:"/inventory/api/outbound",getOutbondDetail:"/inventory/api/outbound",getOutbondRecordList:"/inventory/api/outboundDetail",auditeOutbound:"/inventory/api/outbound/audite",updateOutboundDetail:"/inventory/api/outboundDetail",getstock:"/inventory/api/stock/getstock",getMaterielsOutBound:"/inventory/api/materiel/getMaterielsOutBound"},allot:{getTransfer:"/inventory/api/transfer/list",delTransfer:"/inventory/api/transfer/transfer",addTransfer:"/inventory/api/transfer/transfer",getTransferDetail:"/inventory/api/transfer/transfer",getTransferDetailList:"/inventory/api/transfer/detail/list",auditTransfer:"/inventory/api/transfer/audited",updateTransfer:"/inventory/api/transfer/transfer",getMaterielList:"/inventory/api/transfer/materiel/list",getStockPosiComboList:"/inventory/api/stock/position",getWarehousePosition:"/inventory/api/warehousePosition/move"},reporting:{getStockInfo:"/inventory/api/stock/getstock-info",exportStockInfo:i.a+"/inventory/api/stock/getstock-info-excel-export",getStockInoutbound:"/inventory/api/stock/getstock-info-inoutbound",exportStockInoutbound:i.a+"/inventory/api/stock/getstock-info-inoutbound-excel-export",getStockMove:"/inventory/api/stock/get-inventory-mobility-report",exportStockMove:i.a+"/inventory/api/stock/get-inventory-mobility-report-excel-export",getInventoryProfitLossList:"/inventory/api/materiel-inventory/inventory-report",exportInventoryProfitLoss:i.a+"/inventory/api/materiel-inventory/inventory-report-export",getInventoryNumberList:"/inventory/api/materiel-inventory/inventory-report-inventory-number"}};t.a=o},528:function(e,t,a){var i=a(535);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("ad278fbc",i,!1,{})},534:function(e,t,a){"use strict";var i=a(528);a.n(i).a},535:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.mg-select-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-select-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-select-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),e.exports=t},537:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mg-select-table"},[e._t("top"),e._v(" "),a("div",{staticClass:"mg-select-table-header"},[e._t("default",[a("div",{staticClass:"mg-select-table-search"},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:e.searchPlaceholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}},[a("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:e.search},slot:"append"})],1)],1)]),e._v(" "),a("div",{staticClass:"mg-select-table-tip"},[e._v("已选择"),a("strong",[e._v(e._s(e.selectedTemp.length))]),e._v("个 "),a("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanup}},[e._v("[清空]")])])],2),e._v(" "),a("div",{attrs:{id:e.TID}},[a("Table",{ref:e.tableRef,attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:"",size:e.size},on:{"on-select":e.onSelect,"on-select-cancel":e.onSelectCancel,"on-select-all":e.onSelectAll}})],1),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":"",size:e.size},on:{"on-change":e.pageChange}}),e._v(" "),a("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[a("Button",{attrs:{type:"default",shape:"circle"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.submit}},[e._v("确定")])],1)],2)};i._withStripped=!0;var o=a(11),r={name:"mgSelectTable",props:{disabledRow:Boolean,selected:Array,searchPlaceholder:String,columns:{type:Array,default:[]},url:String,size:{type:String,default:"small"},max:Number,manual:Boolean,field:String},watch:{selected:function(e){var t=JSON.stringify(e);this.selectedTemp=JSON.parse(t),this.selectedTruth=JSON.parse(t),this.checkSelection()}},data:function(){return{TID:"",searchParams:{queryName:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(e){var t=this;e&&(this.searchParams=Object.assign({},{queryName:"",currentPage:1,pageSize:10},e)),this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(e){var a=e.items?e.items:[];t.disabledRow&&a.forEach((function(e){e.disabled&&(e._disabled=!0)})),t.field&&a.forEach((function(e){e.id||(e.id=e[t.field])})),t.listData=a,t.total=e.total,t.loading=!1,t.checkSelection()}))},pageChange:function(e){this.searchParams.currentPage=e,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(e,t){var a=this.selectedTemp;this.max&&a.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(t.id)):this.selectedTemp.push(t)},onSelectCancel:function(e,t){var a=this;this.selectedTemp.forEach((function(e,i){e.id==t.id&&a.selectedTemp.splice(i,1)}))},onSelectAll:function(e){0==e.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(e)},addTableToTemp:function(e){var t=this.selectedTemp;e.forEach((function(e){var a=!1;t.forEach((function(t,i){t.id==e.id&&(a=!0)})),a||t.push(e)}))},removeTableFromTemp:function(e){for(var t=this.selectedTemp,a=t.length;a--;){var i=!1;e.forEach((function(e){e.id==t[a].id&&(i=!0)})),i&&t.splice(a,1)}},cancelChecked:function(e){var t=this;this.checkSelection();var a=this.selectedTemp,i=[];a.forEach((function(a){a.id==e&&t.$set(a,"_checked",!1),i.push(a)})),this.selectedTemp=i},checkSelection:function(){var e=this;this.$nextTick((function(){var t=e.listData,a=e.selectedTemp,i=e.$refs[e.tableRef];t.forEach((function(e,t){var o=i.$refs.tbody.objData[t];o._isChecked=!1,a.forEach((function(t){t.id==e.id&&(o._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=o.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=o.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.manual||this.getData()},created:function(){var e=o.a.gusid(6);this.TID="J_TABLE_"+e,this.tableRef="mg-select-table-"+e,o.a.initTableColumnTitle(this.columns)}},n=(a(534),a(1)),s=Object(n.a)(r,i,[],!1,null,null,null);s.options.__file="src/components/mg-select-table.vue";t.a=s.exports}}]);