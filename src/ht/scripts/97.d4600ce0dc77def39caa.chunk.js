(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{1233:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"import-detail c-main-border"},[n("div",{staticClass:"c-left-border-blue"},[n("h3",[e._v("设备信息导入")]),e._v(" "),n("div",{staticClass:"c-btns-right"},[n("Button",{directives:[{name:"show",rawName:"v-show",value:"validate"==e.processActive,expression:"processActive == 'validate'"}],attrs:{type:"primary",shape:"circle"},on:{click:e.cancelClick}},[e._v("重新整理")]),e._v(" "),n("Button",{directives:[{name:"show",rawName:"v-show",value:"complete"!==e.processActive,expression:"processActive !== 'complete'"}],staticClass:"c-btn-back",attrs:{type:"default",shape:"circle"},on:{click:e.backClick}},[e._v("返回")])],1)]),e._v(" "),n("div",{staticClass:"c-top-border-gray"},[n("div",{staticClass:"equ-import-process"},[n("span",{class:{active:"upload"==e.processActive}},[e._v("数据上传")]),e._v(" "),n("span",{class:{active:"validate"==e.processActive}},[e._v("数据验证")]),e._v(" "),n("span",{class:{active:"complete"==e.processActive}},[e._v("完成")])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"upload"==e.processActive,expression:"processActive == 'upload'"}]},[n("div",{staticClass:"equ-import-upload"},[n("Upload",{ref:"upload",attrs:{name:"file",accept:".xls, .xlsx","before-upload":e.beforeUpload,format:["xls","xlsx"],"on-success":e.uploadSucess,"on-error":e.uploadError,action:e.importUrl}},[n("Button",{attrs:{type:"primary",shape:"circle",loading:e.uploadLoading}},[e._v("文件上传")])],1)],1),e._v(" "),n("div",{staticClass:"equ-import-download"},[n("a",{attrs:{href:e.downExcel,download:""}},[e._v("\n                    导入模版下载\n                    "),n("Icon",{attrs:{type:"android-download"}})],1),e._v(" "),n("div",[e._v("上传文件数量不超过2000条")])])]),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"validate"==e.processActive,expression:"processActive == 'validate'"}]},[n("ul",{staticClass:"validate-box clearfix"},[n("li",{staticClass:"all-validate"},[e._v("\n                    共\n                    "),n("em",[e._v(e._s(e.totalNum))]),e._v("行\n                ")]),e._v(" "),n("li",{staticClass:"all-pass"},[e._v("\n                    验证通过\n                    "),n("em",[e._v(e._s(e.passNum))]),e._v("行\n                ")]),e._v(" "),n("li",{staticClass:"all-error"},[e._v("\n                    错误\n                    "),n("em",[e._v(e._s(e.errNum))]),e._v("行\n                ")])]),e._v(" "),n("Tabs",{directives:[{name:"show",rawName:"v-show",value:!!e.errNum,expression:"!!errNum"}],attrs:{animated:!1}},[n("TabPane",{attrs:{label:"设备基本信息",icon:e.equImportResults.length?"information-circled":""}},[n("Table",{directives:[{name:"show",rawName:"v-show",value:e.equImportResults.length,expression:"equImportResults.length"}],attrs:{columns:e.equImportResultsColumns,data:e.equImportResults,loading:e.loading,stripe:""}}),e._v(" "),n("validate-pass",{attrs:{flag:!!e.equImportResults.length}})],1),e._v(" "),n("TabPane",{attrs:{label:"原厂附件",icon:e.equAttachImportResults.length?"information-circled":""}},[n("Table",{directives:[{name:"show",rawName:"v-show",value:e.equAttachImportResults.length,expression:"equAttachImportResults.length"}],attrs:{columns:e.equAttachImportResultsColumns,data:e.equAttachImportResults,loading:e.loading,stripe:""}}),e._v(" "),n("validate-pass",{attrs:{flag:!!e.equAttachImportResults.length}})],1),e._v(" "),n("TabPane",{attrs:{label:"设备参数",icon:e.equParamImportResults.length?"information-circled":""}},[n("Table",{directives:[{name:"show",rawName:"v-show",value:e.equParamImportResults.length,expression:"equParamImportResults.length"}],attrs:{columns:e.equParamImportResultsColumns,data:e.equParamImportResults,loading:e.loading,stripe:""}}),e._v(" "),n("validate-pass",{attrs:{flag:!!e.equParamImportResults.length}})],1),e._v(" "),n("TabPane",{attrs:{label:"上级设备",icon:e.parentEquImportResults.length?"information-circled":""}},[n("Table",{directives:[{name:"show",rawName:"v-show",value:e.parentEquImportResults.length,expression:"parentEquImportResults.length"}],attrs:{columns:e.parentEquImportResultsColumns,data:e.parentEquImportResults,loading:e.loading,stripe:""}}),e._v(" "),n("validate-pass",{attrs:{flag:!!e.parentEquImportResults.length}})],1)],1),e._v(" "),n("validate-pass",{attrs:{flag:!!e.errNum}}),e._v(" "),n("Button",{directives:[{name:"show",rawName:"v-show",value:!e.errNum,expression:"!errNum"}],staticClass:"submit-btn",attrs:{type:"primary",shape:"circle",loading:e.importLoading},on:{click:e.saveExcelData}},[e._v("确定导入")])],1),e._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"complete"==e.processActive,expression:"processActive == 'complete'"}],staticClass:"complete-box"},[n("Icon",{staticStyle:{color:"#56D43F"},attrs:{type:"checkmark-circled",size:"60"}}),e._v(" "),n("h3",{directives:[{name:"show",rawName:"v-show",value:!e.generateNum,expression:"!generateNum"}]},[e._v("本次成功导入"+e._s(e.totalNum)+"行数据")]),e._v(" "),n("h3",{directives:[{name:"show",rawName:"v-show",value:e.generateNum,expression:"generateNum"}]},[e._v("本次成功导入"+e._s(e.totalNum)+"行数据，并另外生成"+e._s(e.generateNum)+"行测点数据")]),e._v(" "),n("Button",{staticClass:"c-btn-back btn-back",attrs:{type:"primary",shape:"circle"},on:{click:e.backClick}},[e._v("返回上一级")])],1)])])};a._withStripped=!0;var r=n(532),i=n(11),o=(n(39),["upload","validate","complete"]),l={components:{"validate-pass":{props:{flag:Boolean},data:function(){return{}},template:'<div v-show="!flag" class="validate-pass-box"><span class="complete-icon"></span><span>文件确认通过</span></div>'}},data:function(){var e=this;return{downExcel:r.a.getExcel,importUrl:r.a.importExcel,processActive:o[0],totalNum:0,passNum:0,errNum:0,generateNum:0,equImportResults:[],equImportResultsColumns:[{title:"行序号",key:"equipment.index",minWidth:80,render:function(e,t){return e("span",t.row.equipment.index)}},{title:"设备名称",key:"equipment.name",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","name")}},{title:"设备编号",key:"code",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","code")}},{title:"设备状态",key:"equipment.state",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","state")}},{title:"设备类型",key:"equipment.typeId",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","typeId")}},{title:"所属组织",key:"equipment.orgName",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","orgName")}},{title:"区域位置",key:"equipment.processName",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","processName")}},{title:"ABC类",key:"equipment.abc",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","abc")}},{title:"责任人",key:"equipment.personResponsible",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","personResponsible")}},{title:"设备型号",key:"equipment.model",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","model")}},{title:"规格",key:"equipment.specification",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","specification")}},{title:"品牌",key:"equipment.brand",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","brand")}},{title:"供应商名称",key:"equipment.vendor",minWidth:120,render:function(t,n){return e.renderHandle(t,n,"equipment","vendor")}},{title:"生产厂家",key:"equipment.manufacturer",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","manufacturer")}},{title:"出厂编号",key:"equipment.serialNumber",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equipment","serialNumber")}},{title:"出厂日期",key:"equipment.manufactureDate",minWidth:150,render:function(t,n){return e.renderHandle(t,n,"equipment","manufactureDate",!0)}},{title:"安装日期",key:"equipment.installDate",minWidth:150,render:function(t,n){return e.renderHandle(t,n,"equipment","installDate",!0)}},{title:"保修期限(年)",key:"equipment.warrantyPeriod",minWidth:150,render:function(t,n){return e.renderHandle(t,n,"equipment","warrantyPeriod")}},{title:"其他错误",key:"equipment.otherError",minWidth:200,render:function(t,n){return e.renderHandle(t,n,"equipment","otherError")}}],equAttachImportResults:[],equAttachImportResultsColumns:[{title:"行序号",key:"equattachBo.index",minWidth:80,render:function(e,t){return e("span",t.row.equattachBo.index)}},{title:"设备编号",key:"equattachBo.equId",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","equId")}},{title:"附件名称",key:"equattachBo.name",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","name")}},{title:"类型",key:"equattachBo.type",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","type")}},{title:"型号",key:"equattachBo.model",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","model")}},{title:"规格",key:"equattachBo.specification",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","specification")}},{title:"出厂数量",key:"equattachBo.quantity",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","quantity")}},{title:"计量单位",key:"equattachBo.unit",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","unit")}},{title:"备注",key:"equattachBo.remarks",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equattachBo","remarks")}},{title:"其他错误",key:"equattachBo.otherError",minWidth:200,render:function(t,n){return e.renderHandle(t,n,"equattachBo","otherError")}}],equParamImportResults:[],equParamImportResultsColumns:[{title:"行序号",key:"equParam.index",minWidth:80,render:function(e,t){return e("span",t.row.equParam.index)}},{title:"设备编号",key:"equParam.equId",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equParam","equId")}},{title:"设备参数",key:"equParam.param",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equParam","param")}},{title:"养护要求",key:"equParam.mtRequirements",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"equParam","mtRequirements")}},{title:"其他错误",key:"equParam.otherError",minWidth:200,render:function(t,n){return e.renderHandle(t,n,"equParam","otherError")}}],parentEquImportResults:[],parentEquImportResultsColumns:[{title:"行序号",key:"parentEquipment.index",minWidth:80,render:function(e,t){return e("span",t.row.parentEquipment.index)}},{title:"设备编号",key:"parentEquipment.equId",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"parentEquipment","equId")}},{title:"上级设备编号",key:"parentEquipment.parentId",minWidth:100,render:function(t,n){return e.renderHandle(t,n,"parentEquipment","parentId")}},{title:"其他错误",key:"parentEquipment.otherError",minWidth:200,render:function(t,n){return e.renderHandle(t,n,"parentEquipment","otherError")}}],excelDataCachekey:"",loading:!1,uploadLoading:!1,importLoading:!1}},computed:{},methods:{backClick:function(){this.$router.back()},beforeUpload:function(){this.uploadLoading=!0},uploadSucess:function(e,t,n){if(this.uploadLoading=!1,e){if(e.equOutnumber||e.attOutnumber||e.paramOutnumber||e.partOutnumber)return this.$refs.upload.clearFiles(),this.$Modal.warning({title:"上传警告",content:"上传数据已超过500行，请重新整理后上传！"}),!1;if(null!=e.allowCreateEquNum)return this.$refs.upload.clearFiles(),this.$Modal.warning({title:"上传警告",content:"剩余可创建设备量："+e.allowCreateEquNum+"<br />此次导入将达到购买上限，请重新整理后上传！"}),!1;if(null!=e.allowCreateMpoiontNum)return this.$refs.upload.clearFiles(),this.$Modal.warning({title:"上传警告",content:"剩余可创建测点量："+e.allowCreateMpoiontNum+"<br />此次导入将达到购买上限，请重新整理后上传！"}),!1;this.processActive=o[1],this.equAttachImportResults=this.dataHandle(e.equAttachImportResults),this.equImportResults=this.dataHandle(e.equImportResults),this.equParamImportResults=this.dataHandle(e.equParamImportResults),this.parentEquImportResults=this.dataHandle(e.parentEquImportResults),this.excelDataCachekey=e.excelDataCachekey,this.totalNum=e.totalNum,this.passNum=e.passNum,this.errNum=e.errNum,this.generateNum=e.generateNum}},uploadError:function(e,t,n){this.uploadLoading=!1,this.$Message.error("文件上传失败！")},saveExcelData:function(){var e=this;this.importLoading=!0,this.errNum?this.$Message.error("Excel表格校验不通过！"):this.$http.get(r.a.saveExcelData,{excelDataCacheKey:this.excelDataCachekey}).then((function(t){e.importLoading=!1,t&&(e.$Notice.success({title:"成功！",desc:"数据保存成功",duration:3}),e.processActive=o[2])})).catch((function(){e.importLoading=!1}))},cancelClick:function(){var e=this;this.processActive=o[0],this.$refs.upload.clearFiles(),this.excelDataCachekey&&this.$http.get(r.a.cancelExcelData,{excelDataCacheKey:this.excelDataCachekey}).then((function(t){t&&e.$Notice.success({title:"取消导入",desc:"取消导入成功！",duration:3})}))},dataHandle:function(e){return e.forEach((function(e,t){e.validateResult.otherError="无",e.validateResult.boxCode&&(e.validateResult.otherError=e.validateResult.boxCode),e.validateResult.generateMpoint&&(e.validateResult.otherError=e.validateResult.generateMpoint),e.validateResult.parseMethod&&(e.validateResult.otherError=e.validateResult.parseMethod),e.validateResult.dbExistFlag&&(e.validateResult.otherError="数据库中已存在当前设备"),e.validateResult.equIdNoExistEqu&&(e.validateResult.otherError="设备编号不存在"),e.validateResult.excelRepeat&&(e.validateResult.otherError="Excel表中设备编号重复")})),e},renderHandle:function(e,t,n,a,r){var o=t.row.validateResult[a],l=!o||"otherError"==a&&"无"==o?"#333":"red",s=o||t.row[n][a];return r&&(s=i.a.transDateFromServer(s)),e("span",{style:{color:l},attrs:{title:s}},s)}}},s=(n(880),n(1)),u=Object(s.a)(l,a,[],!1,null,null,null);u.options.__file="src/views/equ/import.vue";t.default=u.exports},532:function(e,t,n){"use strict";var a=n(22),r={getAllEqu:"/equipment/api/equipments",deleteEqu:"/equipment/api/equipments",getEquDetail:"/equipment/api/equipments/detail/",saveEqu:"/equipment/api/equipments/detail",delAttachment:"/equipment/api/equ-attachs",getSingleEqu:"/equipment/api/equipments/",getParentEqu:"/equipment/api/equipments/parent/",getEquState:"/equipment/api/equipments/state/",getRemarkByEqu:"/equipment/api/equ-comments",addRemarkByEqu:"/equipment/api/equ-comments",pointsByEqu:"/equipment/api/equipments/mpoint",alarmByEqu:"/equipment/api/alarm-records",equRelPoints:"/equipment/api/mpoints/dropdown-box",getQrcode:a.a+"/equipment/api/equipments/qrcode-export",import:"/equipment/api/excel-import",saveExcelData:"/equipment/api/excel-data-save",cancelExcelData:"/equipment/api/excel-data-cancel",getExcel:a.a+"/equipment/api/excel-temlate-down",importExcel:a.a+"/equipment/api/excel-import",qrcodeExportStart:"/equipment/api/equipments/qrcode-export",qrcodeExportProgress:"/equipment/api/equipments/qrcode-export/progress",qrcodeExportDownload:a.a+"/equipment/api/equipments/qrcode-export/download",equTypeTree:"/equipment/api/equ-types/tree",equTypes:"/equipment/api/equ-types",equType:"/equipment/api/equ-types",gatewayParseMethod:"/box/api/terminals/parse-method",getTerminalList:"/box/api/terminals",terminalDetail:"/box/api/terminals/",addTerminal:"/box/api/terminals",delTerminal:"/box/api/terminals",simSelect:"/box/api/sim-manager/cards/select"};t.a=r},546:function(e,t,n){e.exports=n.p+"images/f9339ba968ba75b06c552a91fbe42722.jpg"},552:function(e,t,n){e.exports=n.p+"images/dcd735d5f12eb9b839b5bfcc73fbe386.png"},553:function(e,t,n){e.exports=n.p+"images/fbf666a5531edaf663783cc3a955a010.png"},665:function(e,t,n){var a=n(881);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(17).default)("3410c310",a,!1,{})},880:function(e,t,n){"use strict";var a=n(665);n.n(a).a},881:function(e,t,n){var a=n(10),r=n(24),i=n(552),o=n(553),l=n(546);t=a(!1);var s=r(i),u=r(o),p=r(l);t.push([e.i,".import-detail .equ-import-process {\n  width: 620px;\n  height: 110px;\n  background: #fff url("+s+") repeat-x 0 -9px;\n  margin: 0 auto 20px;\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n}\n.import-detail .equ-import-process span {\n  font-size: 13px;\n  display: inline-block;\n  width: 74px;\n  height: 70px;\n  background: #fff url("+u+") no-repeat 15px -48px;\n  background-size: 60%;\n  text-align: center;\n  color: #666;\n  padding-top: 65px;\n}\n.import-detail .equ-import-process span.active {\n  font-size: 16px;\n  color: #4b7efe;\n  font-weight: 700;\n  background: #fff url("+u+') no-repeat 10px 10px;\n  background-size: 70%;\n}\n.import-detail .equ-import-upload {\n  height: 40px;\n  margin: 100px auto 20px;\n  text-align: center;\n}\n.import-detail .equ-import-upload .ivu-btn {\n  width: 110px;\n  border-radius: 15px;\n  font-size: 13px;\n  color: #fff;\n}\n.import-detail .equ-import-download {\n  text-align: center;\n  height: 40px;\n  margin: 0 auto;\n}\n.import-detail .equ-import-download a {\n  color: #4b7efe;\n  font-size: 13px;\n}\n.import-detail .equ-import-download .ivu-icon {\n  font-size: 14px;\n  margin-left: 7px;\n}\n.import-detail .equ-import-download div {\n  margin-top: 10px;\n}\n.import-detail .ivu-upload-list {\n  margin-top: -80px;\n}\n.import-detail .validate-box {\n  width: 600px;\n  height: 40px;\n  margin: 0 auto 20px;\n}\n.import-detail .validate-box li {\n  float: left;\n  width: 200px;\n  height: 40px;\n  line-height: 40px;\n  list-style: none;\n  text-align: center;\n}\n.import-detail .validate-box li:before {\n  content: "";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  margin-right: 10px;\n  border-radius: 50%;\n}\n.import-detail .validate-box li.all-validate:before {\n  background-color: #4b7efe;\n}\n.import-detail .validate-box li.all-pass:before {\n  background-color: #55d43f;\n}\n.import-detail .validate-box li.all-error:before {\n  background-color: #e03d3e;\n}\n.import-detail .validate-box li em {\n  margin: 0 20px;\n  font-size: 26px;\n  font-weight: 700;\n  font-style: normal;\n  color: #000;\n}\n.import-detail .ivu-tabs {\n  width: 100%;\n}\n.import-detail .ivu-tabs-bar {\n  border-bottom: none;\n}\n.import-detail .ivu-tabs-nav-wrap {\n  border-top: 1px solid #dddee1;\n}\n.import-detail .ivu-icon-information-circled {\n  float: right;\n  margin-right: 0;\n  margin-left: 8px;\n  margin-top: 2px;\n  color: #e03e3c;\n}\n.import-detail .validate-list li {\n  float: left;\n  width: 300px;\n  margin: 20px 30px;\n  list-style: none;\n}\n.import-detail .no-data {\n  height: 50px;\n  line-height: 50px;\n  text-align: center;\n}\n.import-detail .validate-pass-box {\n  border-top: 1px solid #dddee1;\n  text-align: center;\n}\n.import-detail .validate-pass-box > span {\n  display: block;\n  margin-bottom: 15px;\n}\n.import-detail .validate-pass-box .complete-icon {\n  display: inline-block;\n  width: 80px;\n  height: 80px;\n  margin-top: 30px;\n  background: url('+p+") no-repeat;\n  background-size: 100%;\n}\n.import-detail .submit-btn {\n  display: block;\n  width: 120px;\n  margin: 0 auto;\n}\n.import-detail .ivu-tabs-content .validate-pass-box {\n  border-top: none;\n}\n.import-detail .complete-box {\n  margin: 30px auto 0;\n  text-align: center;\n}\n.import-detail .complete-box > h3 {\n  margin: 15px 0;\n}\n.import-detail .complete-box .btn-back {\n  width: 100px;\n  border: solid 1px #4b7efe;\n  color: #4b7efe;\n  background: #fff;\n}\n.import-modal {\n  padding: 20px;\n}\n",""]),e.exports=t}}]);