(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{1027:function(e,t,a){"use strict";var r=a(738);a.n(r).a},1028:function(e,t,a){(t=a(10)(!1)).push([e.i,".role-data {\n  position: relative;\n  border: 1px solid #e6e6e6;\n}\n.role-data .ivu-tabs-bar {\n  border-bottom: 1px solid #e6e6e6;\n}\n.role-data .ivu-tabs-nav-container {\n  margin-bottom: 0;\n}\n.role-data .ivu-tabs-nav-wrap {\n  background-color: #F4F4F4;\n}\n",""]),e.exports=t},1029:function(e,t,a){"use strict";var r=a(739);a.n(r).a},1030:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.role-autho-module {\r\n\tfloat: left;\r\n\twidth: 48%;\r\n\tborder: 1px solid #e6e6e6;\n}\n.role-autho-operates {\r\n\tfloat: right;\r\n\twidth: 48%;\r\n\tborder: 1px solid #e6e6e6;\n}\n.role-autho-h4 {\r\n\theight: 35px;\r\n\tline-height: 35px;\r\n\tborder-bottom: 1px solid #e6e6e6;\r\n\tbackground-color: #F4F4F4;\r\n\ttext-indent: 10px;\n}\n.role-autho-tab .ivu-tabs-bar {\r\n\tmargin-bottom: 0;\n}\n.role-autho-oper-h5 {\r\n\tbackground-color: #E5E8E9;\r\n\theight: 24px;\r\n\tline-height: 24px;\r\n\tpadding-left: 5px;\n}\n.role-autho-opers {\r\n\tpadding: 5px 0 5px 5px;\r\n\tfont-size: 12px;\n}\r\n\r\n",""]),e.exports=t},1031:function(e,t,a){"use strict";var r=a(740);a.n(r).a},1032:function(e,t,a){(t=a(10)(!1)).push([e.i,".personality-template {\n  position: relative;\n  border: 1px solid #e6e6e6;\n}\n.personality-template .ivu-tabs-bar {\n  border-bottom: 1px solid #e6e6e6;\n}\n.personality-template .ivu-tabs-nav-container {\n  margin-bottom: 0;\n}\n.personality-template .ivu-tabs-nav-wrap {\n  background-color: #F4F4F4;\n}\n",""]),e.exports=t},1033:function(e,t,a){"use strict";var r=a(741);a.n(r).a},1034:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.role-user {\r\n\tfloat: left;\r\n\twidth: 49%;\r\n\toverflow:auto;\n}\n.role-divide {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tbottom: 0;\r\n\tleft: 49%;\r\n\twidth: 5px;\r\n\tbackground: #F0F0F0;\n}\n.role-tab {\r\n\tfloat: right;\r\n\twidth: 49%;\r\n\toverflow:auto;\n}\r\n\r\n",""]),e.exports=t},1123:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-tree role"},[a("div",{staticClass:"c-tree-left",attrs:{id:"J_TREE_LEFT"}},[a("h3",[e._v("角色")]),e._v(" "),a("div",{staticClass:"padding0-10"},[a("Tree",{attrs:{data:e.roleTreeData,render:e.renderContent}})],1)]),e._v(" "),a("div",{staticClass:"c-main-border c-tree-right"},[a("div",{staticClass:"c-left-border-blue"},[a("h3",[e._v("权限设置")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{directives:[{name:"role",rawName:"v-role",value:"role-edit",expression:"'role-edit'"}],attrs:{type:"primary",shape:"circle",loading:e.submitLoading},on:{click:e.submit}},[e._v("提交")])],1)]),e._v(" "),a("div",{staticClass:"c-top-border-gray",staticStyle:{width:"100%",padding:"0",position:"relative",overflow:"hidden"}},[a("div",{staticClass:"role-user c-scrollbar",attrs:{id:"J_ROLE_USER"}},[a("role-user",{attrs:{roleId:e.roleId},on:{"on-user-change":e.onUserChange}})],1),e._v(" "),a("div",{staticClass:"role-divide"}),e._v(" "),a("div",{staticClass:"role-tab c-scrollbar",attrs:{id:"J_ROLE_TAB"}},[a("Tabs",{attrs:{value:"role-process",animated:!1}},[a("TabPane",{attrs:{label:"数据权限",name:"role-process"}},[a("role-process",{attrs:{roleId:e.roleId,warehouseDTOs:e.warehouseDTOs},on:{"on-process-change":e.onProcessChange,"on-storage-change":e.onStorageChange}})],1),e._v(" "),a("TabPane",{attrs:{label:"操作权限",name:"role-authority"}},[a("role-authority",{attrs:{appData:e.appData,webData:e.webData,appAuth:e.appAuth,webAuth:e.webAuth,roleId:e.roleId},on:{"on-web-auth-change":e.onWebAuthChange,"on-app-auth-change":e.onAppAuthChange}})],1),e._v(" "),a("TabPane",{attrs:{label:"个性配置",name:"role-template"}},[a("role-template",{attrs:{roleId:e.roleId,tplHomeData:e.tplHomeData,tplCurveData:e.tplCurveData},on:{"on-change":e.onTplChange}})],1)],1)],1)])])])};r._withStripped=!0;var s=a(23),n=a(107),o=a(596),i=a(11),c=a(544),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"roleuser-all"},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("角色用户")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{directives:[{name:"role",rawName:"v-role",value:"role-edit",expression:"'role-edit'"}],staticClass:"c-btn-add",attrs:{type:"default",size:"small"},on:{click:function(t){e.showTable=!0}}},[e._v("添加用户")])],1)]),e._v(" "),a("div",{},[a("Table",{attrs:{columns:e.columns,data:e.selectedUserData,loading:e.loading,stripe:"",size:"small"}})],1),e._v(" "),a("Modal",{staticClass:"roleuser-all",attrs:{title:"添加角色用户",width:650},model:{value:e.showTable,callback:function(t){e.showTable=t},expression:"showTable"}},[a("mg-select-table",{ref:"usersTable",attrs:{columns:e.usersColumns,url:e.modalUrl,manual:!0,selected:e.selectedUserData},on:{"on-submit":e.modalSubmit,"on-cancel":e.modalCancel}},[a("div",[a("label",[e._v("关键字：")]),e._v(" "),a("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"用户名称/手机号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}}),e._v(" "),a("label",{staticStyle:{"margin-left":"10px"}},[e._v("组织结构：")]),e._v(" "),a("dropdown-tree",{attrs:{url:e.orgTreeApi,width:180},model:{value:e.org,callback:function(t){e.org=t},expression:"org"}}),e._v(" "),a("Button",{staticClass:"c-btn-modal-search",attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{staticClass:"c-btn-modal-reset",attrs:{type:"primary"},on:{click:e.searchParamsClean}},[e._v("重置")])],1)]),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};l._withStripped=!0;var u=a(145),h=a(537),p=a(148),d={name:"roleUser",props:{roleId:""},components:{dropdownTree:u.a,mgSelectTable:h.a},watch:{roleId:function(e){this.getRoleUserById(e)},selectedUserData:function(e){this.$emit("on-user-change",{roleId:this.roleId,userIds:i.a.joinIds(e)})}},computed:Object(s.b)({account:function(e){return e.user.account}}),data:function(){var e=this;return{org:{id:"",title:"请选择"},orgTreeApi:n.a.getOrgTreeData,searchParams:{queryName:"",orgId:"",pageSize:10,currentPage:1},total:0,showTable:!1,loading:!1,columns:[{title:"用户名称",key:"name",align:"left"},{title:"部门",key:"dept",align:"left"},{title:"所属组织",key:"orgName",align:"left"},{title:"操作",width:70,render:function(t,a){return i.a.tableBtnStyle(t,(function(){e.delRoleUser(a.row.id)}),"删除","role-edit")}}],usersColumns:[{type:"selection",width:50},{title:"用户名称",key:"name"},{title:"部门",key:"dept"},{title:"所属组织",key:"orgName"}],modalUrl:p.a.getUsers,selectedUserData:[]}},methods:{getAllRoleUsers:function(){this.$refs.usersTable.getData(this.searchParams)},getRoleUserById:function(e){var t=this;return this.loading=!0,this.$http.get(p.a.getUsers,{roleId:e,pageSize:0}).then((function(e){t.loading=!1,e&&e.items&&(t.countDept(e.items),t.selectedUserData=e.items)}))},search:function(){this.searchParams.orgId=this.org.id,this.getAllRoleUsers()},searchParamsClean:function(){this.org={id:"",title:"请选择"};this.searchParams=Object.assign({},this.searchParams,{queryName:"",orgId:"",pageSize:10,currentPage:1})},modalSubmit:function(e){e.length?(this.selectedUserData=e,this.showTable=!1):this.$Notice.warning({title:"请选择用户"})},modalCancel:function(){this.showTable=!1},delRoleUser:function(e){var t=this.selectedUserData;t.forEach((function(a,r){a.id==e&&t.splice(r,1)}))},countDept:function(e){i.a.countDept(e)}},created:function(){i.a.initTableColumnTitle(this.columns),i.a.initTableColumnTitle(this.usersColumns)},mounted:function(){this.getAllRoleUsers()}},m=a(1),f=Object(m.a)(d,l,[],!1,null,null,null);f.options.__file="src/views/system/components/roleuser.vue";var b=f.exports,v=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role-data"},[a("Tabs",{attrs:{value:"role-process",animated:!1}},[a("TabPane",{attrs:{label:"区域视角",name:"role-process"}},[e.loading?a("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),a("Tree",{attrs:{data:e.treeData,"show-checkbox":!0},on:{"on-check-change":e.treeCheckChange}})],1),e._v(" "),a("TabPane",{attrs:{label:"仓库权限",name:"role-storage"}},[a("Tree",{attrs:{data:e.warehouseDTOs,"show-checkbox":!0},on:{"on-check-change":e.storageCheckChange}})],1)],1)],1)};v._withStripped=!0;var _={name:"roleProcess",props:{roleId:"",warehouseDTOs:{type:Array,default:[]}},data:function(){return{loading:!1,treeData:[],storageData:[]}},watch:{roleId:function(e){this.getData()}},methods:{treeCheckChange:function(e){this.$emit("on-process-change",{roleId:this.roleId,value:i.a.joinIds(e)})},storageCheckChange:function(e){this.$emit("on-storage-change",{roleId:this.roleId,value:i.a.joinIds(e)})},getData:function(){var e=this;this.loading=!0,this.$http.get(o.a.getProcessAndAutho+this.roleId).then((function(t){if(e.loading=!1,t.processDTOs){var a=t.processDTOs;a.forEach((function(e){switch(e.checkState){case 0:e.checked=!1;break;case 1:e.checked=!0;break;case-1:e.checked=!1,e.disableCheckbox=!0}})),e.treeData=i.a.transDataToTree(a)}}))}},mounted:function(){}},g=(a(1027),Object(m.a)(_,v,[],!1,null,null,null));g.options.__file="src/views/system/components/process.vue";var T=g.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"role-authority"},[a("div",{staticClass:"role-autho-module",staticStyle:{position:"relative"}},[a("h4",{staticClass:"role-autho-h4"},[e._v("模块权限")]),e._v(" "),e.authoLoading?a("Spin",{attrs:{fix:""}},[a("Icon",{staticClass:"spin-icon-load",attrs:{type:"load-c",size:"28"}})],1):e._e(),e._v(" "),a("Tabs",{staticClass:"role-autho-tab",attrs:{value:e.currentMod,animated:!1},on:{"on-click":e.modClick}},[a("TabPane",{attrs:{label:"平台",name:"web"}},[a("Tree",{ref:"webTree",attrs:{data:e.webData,"show-checkbox":!0,render:e.renderContent},on:{"on-check-change":e.webDataCheckChange}})],1),e._v(" "),a("TabPane",{attrs:{label:"APP",name:"app"}},[a("Tree",{ref:"appTree",attrs:{data:e.appData,"show-checkbox":!0,render:e.renderContent},on:{"on-check-change":e.appDataCheckChange}})],1)],1)],1),e._v(" "),a("div",{staticClass:"role-autho-operates"},[a("h4",{staticClass:"role-autho-h4"},[e._v("操作权限")]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"web"==e.currentMod,expression:"currentMod == 'web'"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.pWebAuth.length,expression:"pWebAuth.length == 0"}],staticClass:"c-nodata-tip"},[e._v("暂无数据")]),e._v(" "),e._l(e.pWebAuth,(function(t){return a("div",{key:t.menuId},[a("div",{staticClass:"role-autho-oper-h5"},[e._v("\r\n\t\t\t\t\t"+e._s(t.menuName)+"\r\n\t\t\t\t")]),e._v(" "),a("div",{staticClass:"role-autho-opers"},[a("CheckboxGroup",{on:{"on-change":function(t){return e.checkGroupChange("web")}},model:{value:t.checkedGroup,callback:function(a){e.$set(t,"checkedGroup",a)},expression:"item.checkedGroup"}},e._l(t.menuOperDTOs,(function(t){return a("Checkbox",{key:t.id,attrs:{label:t.id,value:t.id,disabled:-1==t.state}},[e._v(e._s(e.authoritys[t.operation]))])})),1)],1)])}))],2),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"app"==e.currentMod,expression:"currentMod == 'app'"}]},[a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.pAppAuth.length,expression:"pAppAuth.length == 0"}],staticClass:"c-nodata-tip"},[e._v("暂无数据")]),e._v(" "),e._l(e.pAppAuth,(function(t){return a("div",{key:t.menuId},[a("div",{staticClass:"role-autho-oper-h5"},[e._v("\r\n\t\t\t\t\t"+e._s(t.menuName)+"\r\n\t\t\t\t")]),e._v(" "),a("div",{staticClass:"role-autho-opers"},[a("CheckboxGroup",{on:{"on-change":function(t){return e.checkGroupChange("app")}},model:{value:t.checkedGroup,callback:function(a){e.$set(t,"checkedGroup",a)},expression:"item.checkedGroup"}},e._l(t.menuOperDTOs,(function(t){return a("Checkbox",{key:t.id,attrs:{label:t.id,value:t.id,disabled:-1==t.state}},[e._v(e._s(e.authoritys[t.operation]))])})),1)],1)])}))],2)])])};D._withStripped=!0;var I={ROLE_TENANT_ADMIN:"租户管理员",UAA_ROLE_EDIT:"设置",UAA_ORG_EDIT:"设置",UAA_USER_ADD:"新增",UAA_USER_UPD:"编辑",UAA_USER_DEL:"删除",UAA_USER_IMPORT:"导入",UAA_PROC_EDIT:"设置",UAA_PROC_QR:"导出二维码",UAA_PROC_IMPORT:"导入",MPT_MPT_SET:"测点设置",EQU_EQUTYPE_EDIT:"设置",EQU_EQUTYPE_IMPORT:"导入",EQU_EQU_ADD:"新增",EQU_EQU_UPD:"编辑",EQU_EQU_DEL:"删除",EQU_EQU_IMPORT:"导入台账",EQU_ESTATA_QR:"导出二维码",PTL_POINT_ADD:"新增",PTL_POINT_UPD:"编辑",PTL_POINT_DEL:"删除",PTL_POINT_QR:"导出二维码",PTL_PLAN_ADD:"新增",PTL_PLAN_UPD:"编辑",PTL_PLAN_DEL:"删除",PTL_PLAN_ISSUE:"下达",PTL_PLAN_TERM:"终止",PTL_TASK_DEL:"删除",PTL_TASK_UPD:"编辑",PTL_TASK_ASSIGN:"分派",PTL_TASK_TERM:"终止",PTL_STAT_EXPORT:"导出",EQU_FAULT_ASSIGN:"分派",EQU_FAULT_DISPOSE:"处理",EQU_FSTAT_EXPORT:"导出",EQU_REPAIR_ASSIGN:"分派",EQU_REPAIR_DISPOSE:"处理",EQU_RSTAT_EXPORT:"导出",INV_MATTYPE_EDIT:"设置",INV_MAT_ADD:"新增",INV_MAT_UPD:"编辑",INV_MAT_DEL:"删除",INV_MAT_IMPORT:"导入",INV_MAT_EXPORT:"导出",INV_SH_ADD:"新增",INV_SH_UPD:"编辑",INV_SH_DEL:"删除",INV_SH_EXPORT:"导出",INV_IN_ADD:"新增",INV_IN_UPD:"编辑",INV_IN_DEL:"删除",INV_OUT_ADD:"新增",INV_OUT_UPD:"编辑",INV_OUT_DEL:"删除",INV_XFE_ADD:"新增",INV_XFE_UPD:"编辑",INV_XFE_DEL:"删除",INV_INV_ADD:"新增",INV_INV_UPD:"编辑",INV_INV_DEL:"删除",INV_ADJ_ADD:"新增",INV_ADJ_UPD:"编辑",INV_ADJ_DEL:"删除",INV_ADJ_MV:"移库",INV_ADJ_EXPORT:"导出",KB_DIR_EDIT:"目录设置",KB_DOC_ADD:"上传",KB_DOC_UPD:"编辑",KB_DOC_MOVE:"移动",KB_DOC_DEL:"删除",KB_TAG_EDIT:"设置",DQ_REC_ADD:"重新计算",DQ_REC_SEE:"重算日志"};function k(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function A(e,t){var a={add:[],remove:[]};return e.forEach((function(e){var r=!1;t.forEach((function(t){e==t&&(r=!0)})),r||a.remove.push(e)})),t.forEach((function(t){var r=!1;e.forEach((function(e){e==t&&(r=!0)})),r||a.add.push(t)})),a}var y={name:"roleAuthority",props:{appData:{type:Array,default:[]},webData:{type:Array,default:[]},appAuth:{type:Array,default:[]},webAuth:{type:Array,default:[]},roleId:""},data:function(){return{authoritys:I,currentMod:"web",pWebAuth:[],pAppAuth:[],web:{menuIds:"",operIds:""},app:{menuIds:"",operIds:""},authoLoading:!1,lastWebData:[],lastAppData:[]}},watch:{webAuth:function(e){this.pWebAuth=e,this.lastWebData=e.map((function(e){return e.menuId}))},appAuth:function(e){this.pAppAuth=e,this.lastAppData=e.map((function(e){return e.menuId}))}},methods:{webDataCheckChange:function(e){var t=this,a=this.getTreeChecked("webTree"),r=[];if(a){var s=A(this.lastWebData,a.split(","));this.web={menuIds:a,operIds:"",roleId:this.roleId},s.add.length?(this.authoLoading=!0,this.$http.get(o.a.getWebModAuthoList,{menuIds:s.add.join(","),roleId:this.roleId}).then((function(e){var a;e=t.checkOper(e),(a=t.pWebAuth).push.apply(a,k(e)),t.authoLoading=!1,t.pWebAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&r.push.apply(r,e.checkedGroup)})),t.web.operIds=r.join(),t.$emit("on-web-auth-change",t.web)}))):s.remove.length&&(s.remove.forEach((function(e){t.pWebAuth.forEach((function(a,r){a.menuId==e&&t.pWebAuth.splice(r,1)}))})),this.pWebAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&r.push.apply(r,e.checkedGroup)})),this.web.operIds=r.join(),this.$emit("on-web-auth-change",this.web))}else this.pWebAuth=[],this.web={menuIds:"",operIds:"",roleId:this.roleId},this.$emit("on-web-auth-change",this.web);this.lastWebData=a.split(",")},appDataCheckChange:function(e){var t=this,a=this.getTreeChecked("appTree"),r=[];if(a){var s=A(this.lastAppData,a.split(","));this.app={menuIds:a,operIds:"",roleId:this.roleId},s.add.length?(this.authoLoading=!0,this.$http.get(o.a.getAppModAuthoList,{menuIds:s.add.join(","),roleId:this.roleId}).then((function(e){var a;e=t.checkOper(e),(a=t.pAppAuth).push.apply(a,k(e)),t.authoLoading=!1,t.pAppAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&r.push.apply(r,e.checkedGroup)})),t.$emit("on-app-auth-change",t.app)}))):s.remove.length&&(s.remove.forEach((function(e){t.pAppAuth.forEach((function(a,r){a.menuId==e&&t.pAppAuth.splice(r,1)}))})),this.pAppAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&r.push.apply(r,e.checkedGroup)})),this.$emit("on-app-auth-change",this.app))}else this.pAppAuth=[],this.app={menuIds:"",operIds:"",roleId:this.roleId};this.lastAppData=a.split(",")},renderContent:function(e,t){t.root,t.node;var a=t.data,r=e("Icon",{style:{color:"#999",fontSize:"17px"},props:{type:"ios-locked"}});return a.locked?e("span",[r,e("span",{style:{color:"#999",marginLeft:"5px"}},a.title)]):a.disabled?e("span",{style:{color:"#999"}},a.title):e("span",a.title)},checkOper:function(e){var t=this;return e.forEach((function(e){var a=[];e.menuOperDTOs.forEach((function(t){switch(t.state){case 0:e.checked=!1;break;case 1:e.checked=!0,a.push(t.id);break;case-1:e.disabled=!0,e.disableCheckbox=!0}})),t.$set(e,"checkedGroup",a)})),e},modClick:function(e){this.currentMod=e},checkGroupChange:function(e){if("web"==e){var t=[];this.pWebAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&t.push.apply(t,e.checkedGroup)})),this.web={menuIds:this.getTreeChecked("webTree"),operIds:t.join(),roleId:this.roleId},this.$emit("on-web-auth-change",this.web)}else if("app"==e){t=[];this.pAppAuth.forEach((function(e){e.checkedGroup&&e.checkedGroup.length&&t.push.apply(t,e.checkedGroup)})),this.app={menuIds:this.getTreeChecked("appTree"),operIds:t.join(),roleId:this.roleId},this.$emit("on-app-auth-change",this.app)}},getTreeChecked:function(e){var t=[];return this.$refs[e].getCheckedNodes().forEach((function(a){"appTree"==e?!a.parentId&&0!==a.parentId||0!=a.state&&1!=a.state||t.push(a.id):!a.parentId||0!=a.state&&1!=a.state||t.push(a.id)})),t=t.join()}},mounted:function(){}},w=(a(1029),Object(m.a)(y,D,[],!1,null,null,null));w.options.__file="src/views/system/components/authority.vue";var O=w.exports,E=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"personality-template"},[a("Tabs",{attrs:{value:"tpl-home",animated:!1,size:"small"}},[a("TabPane",{attrs:{label:"首页模版",name:"tpl-home"}},[a("div",{staticClass:"padding0-20"},[0==e.tplHomeData.length?a("div",{staticClass:"c-nodata-tip"},[e._v("暂无数据")]):e._e(),e._v(" "),a("RadioGroup",{attrs:{vertical:""},on:{"on-change":e.changeTpl},model:{value:e.homeTpl,callback:function(t){e.homeTpl=t},expression:"homeTpl"}},e._l(e.tplHomeData,(function(t){return a("Radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1)]),e._v(" "),a("TabPane",{attrs:{label:"数据曲线模版",name:"tpl-curves"}},[a("div",{staticClass:"padding0-20"},[0==e.tplCurveData.length?a("div",{staticClass:"c-nodata-tip"},[e._v("暂无数据")]):e._e(),e._v(" "),a("RadioGroup",{attrs:{vertical:""},on:{"on-change":e.changeTpl},model:{value:e.curvesTpl,callback:function(t){e.curvesTpl=t},expression:"curvesTpl"}},e._l(e.tplCurveData,(function(t){return a("Radio",{key:t.id,attrs:{label:t.id}},[e._v(e._s(t.name))])})),1)],1)])],1)],1)};E._withStripped=!0;var C={name:"roleTemplate",props:{roleId:[String,Number],tplHomeData:Array,tplCurveData:Array},watch:{tplHomeData:function(){for(var e=this.tplHomeData,t=e.length,a="",r=0;r<t;r++)if(1==e[r].checkState){a=e[r].id;break}this.homeTpl=a},tplCurveData:function(){for(var e=this.tplCurveData,t=e.length,a="",r=0;r<t;r++)if(1==e[r].checkState){a=e[r].id;break}this.curvesTpl=a}},data:function(){return{homeTpl:"",curvesTpl:""}},methods:{changeTpl:function(){this.$emit("on-change",{roleId:this.roleId,curveId:this.curvesTpl,homepageId:this.homeTpl})}},mounted:function(){}},P=(a(1031),Object(m.a)(C,E,[],!1,null,null,null));P.options.__file="src/views/system/components/template.vue";var x={data:function(){return{activeTreeId:"",roleTreeData:[],roleId:"",processData:[],appData:[],webData:[],appAuth:[],webAuth:[],warehouseDTOs:[],submitData:{roleUserDTO:{roleId:"",userIds:""},processDTO:{roleId:"",value:""},appMenuOperDTO:{roleId:"",menuIds:"",operIds:""},webMenuOperDTO:{roleId:"",menuIds:"",operIds:""},warehouseDTO:{roleId:"",value:""}},submitLoading:!1,tplHomeData:[],tplCurveData:[]}},components:{roleUser:b,roleProcess:T,roleAuthority:O,roleTemplate:P.exports},computed:Object(s.b)({opers:function(e){return e.user.account.webOpers}}),created:function(){this.getRoleTree()},mounted:function(){var e=i.a.setTreeLeftHeight();document.querySelector("#J_ROLE_USER").style.height=document.querySelector("#J_ROLE_TAB").style.height=e-55+"px"},methods:{getRoleTree:function(e){var t=this;this.$http.get(n.a.getRoleTree).then((function(a){a&&a.length&&(void 0!==e?(t.activeTreeId=e,i.a.setTreeExpand(a,e)):i.a.setTreeRootExpand(a),t.roleTreeData=i.a.transDataToTree(a))}))},renderContent:function(e,t){var a,r=this,s=(t.root,t.node,t.data),n=[];return"org"==s.type&&c.a.authorityAdmin(this.opers)&&(n=[e("Poptip",{props:{width:300,transfer:!0}},[e("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-add":!0}},["新建"]),e("div",{slot:"content"},[e("div",{style:{lineHeight:"30px"}},["新角色名称："]),e("input",{attrs:{width:100,height:26,type:"text"},domProps:{value:s.newValue||""},style:{border:"1px solid #eaeaea",marginRight:"10px",verticalAlign:"bottom"},on:{input:function(e){s.newValue=e.target.value}},ref:"newRoleName"}),e("Button",{on:{click:function(){r.addRole(s)}},style:{"margin-right":"8px"},props:{type:"primary",size:"small"}},["保存"]),e("Button",{on:{click:function(){document.body.click()}},class:{"c-btn-back":!0},props:{type:"primary",size:"small"}},["取消"])])])]),"role"==s.type&&c.a.authorityAdmin(this.opers)&&(n=[e("Poptip",{props:{width:300,transfer:!0}},[e("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-edit":!0}},["编辑"]),e("div",{slot:"content"},[e("div",{style:{lineHeight:"30px"}},["角色名称："]),e("input",{attrs:{width:100,height:26,type:"text"},domProps:{value:s.name||""},style:{border:"1px solid #eaeaea",marginRight:"10px",verticalAlign:"bottom"},on:{input:function(e){s.name=e.target.value}}}),e("Button",{on:{click:function(){r.editRole(s)}},style:{"margin-right":"8px"},props:{type:"primary",size:"small"}},["保存"]),e("Button",{on:{click:function(){document.body.click()}},class:{"c-btn-back":!0},props:{type:"primary",size:"small"}},["取消"])])]),i.a.treeBtnDelStyle(e,(function(){r.delRole(s)}))]),"role"==s.type&&(a=e("Icon",{style:{color:"#7897f1",fontSize:"17px"},props:{type:"android-person"}},[])),e("div",{class:{"c-tree-row":!0}},[a||"",e("span",{class:{"ivu-tree-title":!0,"ivu-tree-title-selected":s.id==this.activeTreeId},attrs:{title:s.title},on:{click:function(){"role"==s.type&&(r.activeTreeId=s.id,r.selectTree(s))}}},[s.title]),e("span",{class:{"c-tree-btns":!0}},n)])},addRole:function(e){var t=this;this.$http.post(o.a.createRole,{id:"",name:e.newValue,orgId:e.busId,version:"0"}).then((function(e){e.id&&(document.body.click(),t.$Notice.success({title:"新建成功"}),t.getRoleTree(-e.id))}))},editRole:function(e){var t=this;e.name?this.$http.put(o.a.editRole,{id:e.busId,name:e.name,orgId:e.parentId,version:"0"}).then((function(a){a.count&&(t.$Notice.success({title:"修改成功"}),t.getRoleTree(e.id))})):this.$Notice.warning({title:"请输入角色名称"})},delRole:function(e){var t=this;this.$http.del(o.a.deleteRole,{ids:e.busId}).then((function(a){a.count&&(t.$Notice.success({title:"删除成功"}),t.getRoleTree(e.parentId))}))},selectTree:function(e){var t=this;this.roleId=e.busId,this.$http.get(o.a.getProcessAndAutho+e.busId).then((function(e){if(e.processDTOs){var a=e.processDTOs;a.forEach((function(e){switch(e.checkState){case 0:e.checked=!1;break;case 1:e.checked=!0;break;case-1:e.disableCheckbox=!0}})),t.submitData.processDTO={roleId:t.roleId,value:i.a.joinIds(a,"id","checked")},t.processData=i.a.transDataToTree(a)}if(e.appMenuDTOs){var r=e.appMenuDTOs;r.forEach((function(e){switch(e.state){case 0:e.checked=!1;break;case 1:e.checked=!0;break;case-1:e.locked=!0,e.disableCheckbox=!0;break;case-2:e.disableCheckbox=!0}}));var s=[];r.forEach((function(e){1==e.state&&s.push(e.id)})),t.submitData.appMenuOperDTO.roleId=t.roleId,t.submitData.appMenuOperDTO.menuIds=s.join(),t.appData=i.a.transDataToTree(r)}if(e.webMenuDTOs){var n=e.webMenuDTOs;n.forEach((function(e){switch(e.state){case 0:e.checked=!1;break;case 1:e.checked=!0;break;case-1:e.locked=!0,e.disableCheckbox=!0;break;case-2:e.disableCheckbox=!0}}));s=[];n.forEach((function(e){0!=e.parentId&&1==e.state&&s.push(e.id)})),t.submitData.webMenuOperDTO.roleId=t.roleId,t.submitData.webMenuOperDTO.menuIds=s.join(),t.webData=i.a.transDataToTree(n)}if(e.webOperDTOs){var o=e.webOperDTOs;s=[];o.forEach((function(e){var t=[];e.menuOperDTOs.forEach((function(a){switch(a.state){case 0:e.checked=!1;break;case 1:e.checked=!0,s.push(a.id),t.push(a.id);break;case-1:e.disabled=!0,e.disableCheckbox=!0}})),e.checkedGroup=t})),t.submitData.webMenuOperDTO.roleId=t.roleId,t.submitData.webMenuOperDTO.operIds=s.join(),t.webAuth=o}if(e.appOperDTOs){var c=e.appOperDTOs;s=[];c.forEach((function(e){var t=[];e.menuOperDTOs.forEach((function(a){switch(a.state){case 0:e.checked=!1;break;case 1:e.checked=!0,s.push(a.id),t.push(a.id);break;case-1:e.disabled=!0,e.disableCheckbox=!0}})),e.checkedGroup=t})),t.submitData.appMenuOperDTO.roleId=t.roleId,t.submitData.appMenuOperDTO.operIds=s.join(),t.appAuth=c}if(e.templateDTOs&&(t.tplHomeData=e.templateDTOs.homepage,t.tplCurveData=e.templateDTOs.curve),e.warehouseDTOs){var l=e.warehouseDTOs,u=[];l.forEach((function(e){switch(e.checkState){case 0:e.checked=!1;break;case 1:e.checked=!0,u.push(e.id);break;case-1:e.disableCheckbox=!0}})),t.submitData.warehouseDTO.roleId=t.roleId,t.submitData.warehouseDTO.value=u.join(),t.warehouseDTOs=i.a.transDataToTree(l)}}))},onUserChange:function(e){this.submitData.roleUserDTO=e},onProcessChange:function(e){this.submitData.processDTO=e},onStorageChange:function(e){this.submitData.warehouseDTO=e},onWebAuthChange:function(e){this.submitData.webMenuOperDTO=e},onAppAuthChange:function(e){this.submitData.appMenuOperDTO=e},onTplChange:function(e){this.submitData.templateDTO=e},save:function(){var e=this;this.submitLoading=!0,this.$http.post(o.a.saveRole,this.submitData).then((function(t){t.id&&e.$Notice.success({title:"操作成功！"}),e.submitLoading=!1})).catch((function(t){e.submitLoading=!1}))},submit:function(){var e=this;this.submitData.roleUserDTO.roleId?this.$Modal.confirm({title:"确认操作",content:"修改角色权限后，相关用户会强制退出，重新登录后才能使用。是否确定提交？",onOk:function(){e.save()}}):this.$Notice.warning({title:"请选择一个角色"})}}},S=(a(1033),Object(m.a)(x,r,[],!1,null,null,null));S.options.__file="src/views/system/role.vue";t.default=S.exports},528:function(e,t,a){var r=a(535);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a(17).default)("ad278fbc",r,!1,{})},534:function(e,t,a){"use strict";var r=a(528);a.n(r).a},535:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.mg-select-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-select-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-select-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),e.exports=t},537:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mg-select-table"},[e._t("top"),e._v(" "),a("div",{staticClass:"mg-select-table-header"},[e._t("default",[a("div",{staticClass:"mg-select-table-search"},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:e.searchPlaceholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}},[a("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:e.search},slot:"append"})],1)],1)]),e._v(" "),a("div",{staticClass:"mg-select-table-tip"},[e._v("已选择"),a("strong",[e._v(e._s(e.selectedTemp.length))]),e._v("个 "),a("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanup}},[e._v("[清空]")])])],2),e._v(" "),a("div",{attrs:{id:e.TID}},[a("Table",{ref:e.tableRef,attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:"",size:e.size},on:{"on-select":e.onSelect,"on-select-cancel":e.onSelectCancel,"on-select-all":e.onSelectAll}})],1),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":"",size:e.size},on:{"on-change":e.pageChange}}),e._v(" "),a("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[a("Button",{attrs:{type:"default",shape:"circle"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.submit}},[e._v("确定")])],1)],2)};r._withStripped=!0;var s=a(11),n={name:"mgSelectTable",props:{disabledRow:Boolean,selected:Array,searchPlaceholder:String,columns:{type:Array,default:[]},url:String,size:{type:String,default:"small"},max:Number,manual:Boolean,field:String},watch:{selected:function(e){var t=JSON.stringify(e);this.selectedTemp=JSON.parse(t),this.selectedTruth=JSON.parse(t),this.checkSelection()}},data:function(){return{TID:"",searchParams:{queryName:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(e){var t=this;e&&(this.searchParams=Object.assign({},{queryName:"",currentPage:1,pageSize:10},e)),this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(e){var a=e.items?e.items:[];t.disabledRow&&a.forEach((function(e){e.disabled&&(e._disabled=!0)})),t.field&&a.forEach((function(e){e.id||(e.id=e[t.field])})),t.listData=a,t.total=e.total,t.loading=!1,t.checkSelection()}))},pageChange:function(e){this.searchParams.currentPage=e,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(e,t){var a=this.selectedTemp;this.max&&a.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(t.id)):this.selectedTemp.push(t)},onSelectCancel:function(e,t){var a=this;this.selectedTemp.forEach((function(e,r){e.id==t.id&&a.selectedTemp.splice(r,1)}))},onSelectAll:function(e){0==e.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(e)},addTableToTemp:function(e){var t=this.selectedTemp;e.forEach((function(e){var a=!1;t.forEach((function(t,r){t.id==e.id&&(a=!0)})),a||t.push(e)}))},removeTableFromTemp:function(e){for(var t=this.selectedTemp,a=t.length;a--;){var r=!1;e.forEach((function(e){e.id==t[a].id&&(r=!0)})),r&&t.splice(a,1)}},cancelChecked:function(e){var t=this;this.checkSelection();var a=this.selectedTemp,r=[];a.forEach((function(a){a.id==e&&t.$set(a,"_checked",!1),r.push(a)})),this.selectedTemp=r},checkSelection:function(){var e=this;this.$nextTick((function(){var t=e.listData,a=e.selectedTemp,r=e.$refs[e.tableRef];t.forEach((function(e,t){var s=r.$refs.tbody.objData[t];s._isChecked=!1,a.forEach((function(t){t.id==e.id&&(s._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=s.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=s.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.manual||this.getData()},created:function(){var e=s.a.gusid(6);this.TID="J_TABLE_"+e,this.tableRef="mg-select-table-"+e,s.a.initTableColumnTitle(this.columns)}},o=(a(534),a(1)),i=Object(o.a)(n,r,[],!1,null,null,null);i.options.__file="src/components/mg-select-table.vue";t.a=i.exports},544:function(e,t,a){"use strict";var r=a(49),s={authorityAdmin:function(e){if(-1!=e.indexOf("ROLE_TENANT_ADMIN")||-1!=e.indexOf("UAA_ROLE_EDIT"))return!0},authorityEquAdmin:function(e){if(-1!=e.indexOf("ROLE_TENANT_ADMIN")||-1!=e.indexOf("EQU_EQUTYPE_EDIT"))return!0},authorityProcAdmin:function(e){if(-1!=e.indexOf("UAA_PROC_EDIT"))return!0},author0:function(e){if(-1!=e.indexOf("ROLE_TENANT_ADMIN"))return!0},authority:function(e){var t=JSON.parse(sessionStorage.getItem("__MANGO_U_")||"{}").webOpers;return!!t&&(-1!==t.indexOf(r.a[e])||-1!=t.indexOf(r.a.all))},author2:function(e){if(-1!=e.indexOf("UAA_ORG_EDIT"))return!0}};t.a=s},596:function(e,t,a){"use strict";t.a={getRoleTree:"/uaa/api/roles/tree",getRoles:"/uaa/api/roles",createRole:"/uaa/api/roles",editRole:"/uaa/api/roles",deleteRole:"/uaa/api/roles",saveRoleUser:"/uaa/api/role-users",getProcessAndAutho:"/uaa/api/roles/detail/",getAppModAuthoList:"/uaa/api/roles/app-menu-and-oper",getWebModAuthoList:"/uaa/api/roles/web-menu-and-oper",saveRole:"/uaa/api/roles/detail"}},738:function(e,t,a){var r=a(1028);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a(17).default)("299b81b8",r,!1,{})},739:function(e,t,a){var r=a(1030);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a(17).default)("2ce27fbb",r,!1,{})},740:function(e,t,a){var r=a(1032);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a(17).default)("5bdc5f94",r,!1,{})},741:function(e,t,a){var r=a(1034);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,a(17).default)("3c787110",r,!1,{})}}]);