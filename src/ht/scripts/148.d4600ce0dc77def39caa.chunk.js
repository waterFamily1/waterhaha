(window.webpackJsonp=window.webpackJsonp||[]).push([[148],{1252:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"c-tree"},[e("div",{staticClass:"c-tree-left",attrs:{id:"J_TREE_LEFT"}},[e("h3",[t._v("组织结构")]),t._v(" "),e("div",{staticClass:"padding-l-10"},[e("Tree",{attrs:{data:t.treeData,render:t.renderContent}})],1)]),t._v(" "),e("div",{staticClass:"c-main-border c-tree-right"},[e("div",{staticClass:"c-plain-bg-h"},[e("h3",[t._v("组织信息")]),t._v(" "),e("div",{staticClass:"c-btns-right"},[e("Button",{directives:[{name:"show",rawName:"v-show",value:"info"!=t.status,expression:"status != 'info'"}],attrs:{type:"primary",shape:"circle"},on:{click:t.submit}},[t._v("保存")]),t._v(" "),e("Button",{directives:[{name:"show",rawName:"v-show",value:"info"!=t.status,expression:"status != 'info'"}],staticClass:"v-btn-back",attrs:{type:"default",shape:"circle"},on:{click:t.cancel}},[t._v("取消")])],1)]),t._v(" "),e("div",{staticClass:"base-org-detail"},[e("Form",{ref:"form",attrs:{model:t.params,rules:t.rules}},[e("h4",[t._v("组织名称")]),t._v(" "),e("div",{staticClass:"base-org-border"},["info"==t.status?e("span",[t._v(t._s(t.activeData.name))]):t._e(),t._v(" "),"add"==t.status||"edit"==t.status?e("FormItem",{attrs:{prop:"name"}},[e("Input",{staticStyle:{width:"300px"},model:{value:t.params.name,callback:function(a){t.$set(t.params,"name",a)},expression:"params.name"}})],1):t._e()],1),t._v(" "),e("h4",[t._v("组织类别")]),t._v(" "),e("div",{staticClass:"base-org-border"},["info"==t.status?e("span",[t._v(t._s(t.activeData.typeText))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:"type"}},["add"==t.status||"edit"==t.status?e("RadioGroup",{on:{"on-change":t.radioGroupChange},model:{value:t.params.type,callback:function(a){t.$set(t.params,"type",a)},expression:"params.type"}},t._l(t.types,(function(a){return e("Radio",{attrs:{label:a.value,disabled:a.disabled}},[t._v(t._s(a.label))])})),1):t._e()],1)],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:t.activeData.isCompany,expression:"activeData.isCompany"}],staticClass:"base-org-company c-form-row-1col"},[e("h3",{staticClass:"c-gray-bg-h",staticStyle:{margin:"10px 0"}},[t._v("公司信息")]),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("公司全称：")]),t._v(" "),"info"==t.status?e("span",[t._v(t._s(t.activeData.fullName))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:"fullName"}},["add"==t.status||"edit"==t.status?e("Input",{staticStyle:{width:"300px"},model:{value:t.params.fullName,callback:function(a){t.$set(t.params,"fullName",a)},expression:"params.fullName"}}):t._e()],1)],1),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("负责人：")]),t._v(" "),"info"==t.status?e("span",[t._v(t._s(t.activeData.leader))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:""}},["add"==t.status||"edit"==t.status?e("Input",{staticStyle:{width:"300px"},model:{value:t.params.leader,callback:function(a){t.$set(t.params,"leader",a)},expression:"params.leader"}}):t._e()],1)],1),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("手机：")]),t._v(" "),"info"==t.status?e("span",[t._v(t._s(t.activeData.tel))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:""}},["add"==t.status||"edit"==t.status?e("Input",{staticStyle:{width:"300px"},model:{value:t.params.tel,callback:function(a){t.$set(t.params,"tel",a)},expression:"params.tel"}}):t._e()],1)],1),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("地址：")]),t._v(" "),"info"==t.status?e("span",[t._v(t._s(t.activeData.address))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:""}},["add"==t.status||"edit"==t.status?e("Input",{staticStyle:{width:"300px"},model:{value:t.params.address,callback:function(a){t.$set(t.params,"address",a)},expression:"params.address"}}):t._e()],1)],1),t._v(" "),e("div",{staticClass:"c-form-item"},[e("label",[t._v("附属信息：")]),t._v(" "),"info"==t.status?e("span",[t._v(t._s(t.activeData.remarks))]):t._e(),t._v(" "),e("FormItem",{attrs:{prop:""}},["add"==t.status||"edit"==t.status?e("Input",{staticStyle:{width:"300px"},attrs:{type:"textarea",maxlength:200},model:{value:t.params.remarks,callback:function(a){t.$set(t.params,"remarks",a)},expression:"params.remarks"}}):t._e()],1)],1)])])],1)])])};s._withStripped=!0;var r=e(23),i=e(148),n=e(107),o=e(11),d=e(544),c={data:function(){return{status:"info",activeTreeId:"",treeData:[],activeData:{name:"",typeText:"",fullName:"",address:"",tel:"",leader:"",isCompany:!1},params:{id:"",parentId:"",name:"",type:null},rules:{name:{required:!0,message:"请输入名称",trigger:"change"},type:{type:"number",required:!0,message:"请选择类型",trigger:"change"}}}},mounted:function(){this.getOrgTree(),o.a.setTreeLeftHeight()},computed:Object(r.b)({opers:function(t){return t.user.account.webOpers},types:function(t){return t.map.org.type},typeText:function(t){return t.map.org.typeText}}),methods:{radioGroupChange:function(t){this.activeData.isCompany=1==t},submit:function(){var t=this,a=this.status;this.$refs.form.validate((function(e){if(e){var s={name:t.params.name,typeText:t.typeText[t.params.type],fullName:t.params.fullName,address:t.params.address,tel:t.params.tel,leader:t.params.leader,remarks:t.params.remarks,isCompany:1==t.params.type};"add"==a&&t.$http.post(i.a.addOrg,{name:t.params.name,type:t.params.type,parentId:t.params.parentId,fullName:t.params.fullName,leader:t.params.leader,tel:t.params.tel,address:t.params.address,remarks:t.params.remarks}).then((function(a){a.id&&(t.status="info",t.activeData=s,t.$Notice.success({title:"新建成功"}),t.getOrgTree(a.id))})),"edit"==a&&t.$http.put(i.a.editOrg,{name:t.params.name,type:t.params.type,id:t.params.id,fullName:t.params.fullName,leader:t.params.leader,tel:t.params.tel,address:t.params.address,remarks:t.params.remarks}).then((function(a){a.count&&(t.status="info",t.activeData=s,t.$Notice.success({title:"编辑成功"}),t.getOrgTree(t.params.id))}))}}))},cancel:function(){this.status="info"},getOrgTree:function(t){var a=this;this.$http.get(n.a.getOrgTreeData+"?exNoAuth=true").then((function(e){void 0!==t?(o.a.setTreeExpand(e,t),a.activeTreeId=t):o.a.setTreeRootExpand(e),a.treeData=o.a.transDataToTree(e)}))},delOrg:function(t){var a=this;this.$http.del(i.a.delOrg+t.id).then((function(e){e.count&&(a.activeData={name:"",typeText:"",fullName:"",address:"",tel:"",leader:"",isCompany:!1},a.$Notice.success({title:"删除成功"}),a.getOrgTree(t.parentId))}))},editOrg:function(t){this.resetForm(),this.status="edit",this.activeTreeId=t.id,this.params=Object.assign({},this.params,t),this.activeData=Object.assign({},this.activeData,t),this.activeData.isCompany=1==this.params.type,this.types.forEach((function(t){t.disabled=!0}))},addOrg:function(t){var a,e=this;this.resetForm(),this.status="add",this.activeTreeId=t.id,this.activeData=Object.assign({},this.activeData,t),this.params={name:"",type:null,parentId:t.id},this.types.forEach((function(s){t.isRoot?1!=s.value?s.disabled=!0:s.disabled=!1:d.a.author0(e.opers)?s.value<t.type?s.disabled=!0:(a||(a=s.value),s.disabled=!1):s.value<=t.type?3==s.value?s.disabled=!1:s.disabled=!0:(a||(a=s.value),s.disabled=!1)})),t.isRoot?this.params.type=1:this.params.type=a,this.activeData.isCompany=1==this.params.type},renderContent:function(t,a){var e=this,s=(a.root,a.node,a.data),r=[],i=t("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-add":!0},on:{click:function(){e.addOrg(s)}}},["新建"]),n=t("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-edit":!0},on:{click:function(){e.editOrg(s)}}},["编辑"]);if(0==s.parentId)return t("div",{class:{"c-tree-row":!0}},[t("span",s.name),t("span",{class:{"c-tree-btns":!0}},d.a.author0(this.opers)?[i]:"")]);if(d.a.author0(this.opers))r=4==s.type?[n,o.a.treeBtnDelStyle(t,(function(){e.delOrg(s)}),(function(){}),(function(){e.activeTreeId=s.id}))]:[n,o.a.treeBtnDelStyle(t,(function(){e.delOrg(s)}),(function(){}),(function(){e.activeTreeId=s.id})),i];else if(d.a.author2(this.opers))switch(s.type){case 2:r=[i];break;case 3:r=[n,o.a.treeBtnDelStyle(t,(function(){e.delOrg(s)}),(function(){}),(function(){e.activeTreeId=s.id})),i];break;case 4:r=[n,o.a.treeBtnDelStyle(t,(function(){e.delOrg(s)}),(function(){}),(function(){e.activeTreeId=s.id}))]}return t("div",{class:{"c-tree-row":!0}},[t("span",{class:{"ivu-tree-title":!0,"ivu-tree-title-selected":s.id==this.activeTreeId},attrs:{title:s.name},on:{click:function(){e.resetForm(),e.activeTreeId=s.id,e.activeData.name=s.name,e.activeData.typeText=e.typeText[s.type],e.activeData.fullName=s.fullName,e.activeData.leader=s.leader,e.activeData.tel=s.tel,e.activeData.address=s.address,e.activeData.remarks=s.remarks,e.status="info",1==s.type?e.activeData.isCompany=!0:e.activeData.isCompany=!1}}},[s.name]),t("span",{class:{"c-tree-btns":!0}},r)])},resetForm:function(){this.$refs.form.resetFields()}}},l=(e(872),e(1)),p=Object(l.a)(c,s,[],!1,null,null,null);p.options.__file="src/views/basic/org.vue";a.default=p.exports},544:function(t,a,e){"use strict";var s=e(49),r={authorityAdmin:function(t){if(-1!=t.indexOf("ROLE_TENANT_ADMIN")||-1!=t.indexOf("UAA_ROLE_EDIT"))return!0},authorityEquAdmin:function(t){if(-1!=t.indexOf("ROLE_TENANT_ADMIN")||-1!=t.indexOf("EQU_EQUTYPE_EDIT"))return!0},authorityProcAdmin:function(t){if(-1!=t.indexOf("UAA_PROC_EDIT"))return!0},author0:function(t){if(-1!=t.indexOf("ROLE_TENANT_ADMIN"))return!0},authority:function(t){var a=JSON.parse(sessionStorage.getItem("__MANGO_U_")||"{}").webOpers;return!!a&&(-1!==a.indexOf(s.a[t])||-1!=a.indexOf(s.a.all))},author2:function(t){if(-1!=t.indexOf("UAA_ORG_EDIT"))return!0}};a.a=r},649:function(t,a,e){var s=e(873);"string"==typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);(0,e(17).default)("346d729b",s,!1,{})},872:function(t,a,e){"use strict";var s=e(649);e.n(s).a},873:function(t,a,e){(a=e(10)(!1)).push([t.i,"\n.base-org-detail {\r\n    padding: 20px 50px;\n}\n.base-org-detail h4 {\r\n    height: 30px;\r\n    margin-top: 10px;\n}\n.base-org-border {\r\n    border-bottom: 1px dashed #f0f0f0;\n}\n.base-org-detail .ivu-form-item {\r\n    margin-bottom: 10px;\n}\n.base-org-detail .c-form-item label {\r\n    width: 70px;\n}\r\n",""]),t.exports=a}}]);