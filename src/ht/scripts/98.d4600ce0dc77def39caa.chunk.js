(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{1144:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"import-detail c-main-border"},[n("div",{staticClass:"c-left-border-blue"},[n("h3",[t._v("测点导入")]),t._v(" "),n("div",{staticClass:"c-btns-right"},[n("Button",{directives:[{name:"show",rawName:"v-show",value:"validate"==t.processActive,expression:"processActive == 'validate'"}],attrs:{type:"primary",shape:"circle"},on:{click:t.cancelClick}},[t._v("重新整理")]),t._v(" "),n("Button",{directives:[{name:"show",rawName:"v-show",value:"complete"!==t.processActive,expression:"processActive !== 'complete'"}],staticClass:"c-btn-back",attrs:{type:"default",shape:"circle"},on:{click:t.backClick}},[t._v("返回")])],1)]),t._v(" "),n("div",{staticClass:"c-top-border-gray"},[n("div",{staticClass:"equ-import-process"},[n("span",{class:{active:"upload"==t.processActive}},[t._v("数据上传")]),t._v(" "),n("span",{class:{active:"validate"==t.processActive}},[t._v("数据验证")]),t._v(" "),n("span",{class:{active:"complete"==t.processActive}},[t._v("完成")])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"upload"==t.processActive,expression:"processActive == 'upload'"}]},[n("div",{staticClass:"equ-import-upload"},[n("Upload",{ref:"upload",attrs:{name:"file",accept:".xls, .xlsx",format:["xls","xlsx"],"on-success":t.uploadSucess,"on-error":t.uploadError,action:t.importUrl}},[n("Button",{attrs:{type:"primary",shape:"circle"}},[t._v("文件上传")])],1)],1),t._v(" "),n("div",{staticClass:"equ-import-download"},[n("a",{attrs:{href:t.downExcel,download:""}},[t._v("\n                    导入模版下载\n                    "),n("Icon",{attrs:{type:"android-download"}})],1),t._v(" "),n("div",[t._v("上传文件数量不超过500条")])])]),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"validate"==t.processActive,expression:"processActive == 'validate'"}]},[n("ul",{staticClass:"validate-box clearfix"},[n("li",{staticClass:"all-validate"},[t._v("\n                    共\n                    "),n("em",[t._v(t._s(t.totalNum))]),t._v("行\n                ")]),t._v(" "),n("li",{staticClass:"all-pass"},[t._v("\n                    验证通过\n                    "),n("em",[t._v(t._s(t.passNum))]),t._v("行\n                ")]),t._v(" "),n("li",{staticClass:"all-error"},[t._v("\n                    错误\n                    "),n("em",[t._v(t._s(t.errNum))]),t._v("行\n                ")])]),t._v(" "),n("Tabs",{directives:[{name:"show",rawName:"v-show",value:!!t.errNum,expression:"!!errNum"}],attrs:{animated:!1}},[n("TabPane",{attrs:{label:"测点信息",icon:t.mpointImportResults.length?"information-circled":""}},[n("Table",{directives:[{name:"show",rawName:"v-show",value:t.mpointImportResults.length,expression:"mpointImportResults.length"}],attrs:{columns:t.mpointImportResultsColumns,data:t.mpointImportResults,loading:t.loading,stripe:""}}),t._v(" "),n("validate-pass",{attrs:{flag:!!t.mpointImportResults.length}})],1)],1),t._v(" "),n("validate-pass",{attrs:{flag:!!t.errNum}}),t._v(" "),n("Button",{directives:[{name:"show",rawName:"v-show",value:!t.errNum,expression:"!errNum"}],staticClass:"submit-btn",attrs:{type:"primary",shape:"circle"},on:{click:t.saveExcelData}},[t._v("确定导入")])],1),t._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:"complete"==t.processActive,expression:"processActive == 'complete'"}],staticClass:"complete-box"},[n("Icon",{staticStyle:{color:"#56D43F"},attrs:{type:"checkmark-circled",size:"60"}}),t._v(" "),n("h3",[t._v("本次成功导入"+t._s(t.totalNum)+"行数据")]),t._v(" "),n("Button",{staticClass:"c-btn-back btn-back",attrs:{type:"primary",shape:"circle"},on:{click:t.backClick}},[t._v("返回上一级")])],1)])])};i._withStripped=!0;var a=n(520),o=n(11),r=(n(39),["upload","validate","complete"]),l={components:{"validate-pass":{props:{flag:Boolean},data:function(){return{}},template:'<div v-show="!flag" class="validate-pass-box"><span class="complete-icon"></span><span>文件确认通过</span></div>'}},data:function(){var t=this;return{downExcel:a.a.downloadTemplate,importUrl:a.a.importExcel,processActive:r[0],totalNum:0,passNum:0,errNum:0,mpointImportResults:[],mpointImportResultsColumns:[{title:"行序号",key:"mpoint.index",minWidth:80,render:function(t,e){return t("span",e.row.mpoint.index)}},{title:"区域位置",key:"mpoint.siteName",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","siteName")}},{title:"测点名称",key:"mpoint.mpointName",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","mpointName")}},{title:"所属设备",key:"mpoint.equipmentName",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","equipmentName")}},{title:"数据来源",key:"mpoint.datasource",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","datasource")}},{title:"数据分类",key:"mpoint.categoryName",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","categoryName")}},{title:"信号类型",key:"mpoint.datype",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","datype")}},{title:"单位",key:"mpoint.unit",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","unit")}},{title:"显示小数位",key:"mpoint.numtail",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","numtail")}},{title:"状态值",key:"mpoint.enumvalue",minWidth:100,render:function(e,n){return t.renderHandle(e,n,"mpoint","enumvalue")}},{title:"备注",key:"mpoint.remarks",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","remarks")}},{title:"倍数",key:"mpoint.magnification",minWidth:110,render:function(e,n){return t.renderHandle(e,n,"mpoint","magnification")}},{title:"基数",key:"mpoint.cardinality",minWidth:110,render:function(e,n){return t.renderHandle(e,n,"mpoint","cardinality")}},{title:"上限",key:"mpoint.upperRange",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","upperRange")}},{title:"下限",key:"mpoint.lowerRange",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","lowerRange")}},{title:"斜率",key:"mpoint.slope",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","slope")}},{title:"单调递增",key:"mpoint.increase",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","increase")}},{title:"等级",key:"mpoint.coefficient",minWidth:150,render:function(e,n){return t.renderHandle(e,n,"mpoint","coefficient")}},{title:"其他错误",key:"mpoint.otherError",minWidth:200,render:function(e,n){return t.renderHandle(e,n,"mpoint","otherError")}}],excelDataCachekey:"",loading:!1}},computed:{},methods:{backClick:function(){this.$router.back()},uploadSucess:function(t,e,n){if(t){if(t.outnumber)return this.$refs.upload.clearFiles(),this.$Modal.warning({title:"上传警告",render:function(t){return t("div",{class:{"import-modal":!0}},"上传数据已超过500行，请重新整理后上传！")}}),!1;this.processActive=r[1],this.mpointImportResults=this.dataHandle(t.importResults),this.excelDataCachekey=t.excelDataCachekey,this.totalNum=t.totalNum,this.passNum=t.passNum,this.errNum=t.errNum}},uploadError:function(t,e,n){this.$Message.error("文件上传失败！")},saveExcelData:function(){var t=this;this.errNum?this.$Message.error("Excel表格校验不通过！"):this.$http.post(a.a.saveExcelData,{excelDataCacheKey:this.excelDataCachekey}).then((function(e){e&&(t.$Notice.success({title:"成功！",desc:"数据保存成功",duration:3}),t.processActive=r[2])}))},cancelClick:function(){var t=this;this.processActive=r[0],this.$refs.upload.clearFiles(),this.excelDataCachekey&&this.$http.del(a.a.cancelExcelData,{excelDataCacheKey:this.excelDataCachekey}).then((function(e){t.$Notice.success({title:"取消导入",desc:"取消导入成功！",duration:3})}))},dataHandle:function(t){return t.forEach((function(t,e){t.validateResult.otherError="无",t.validateResult.dbExistFlag&&(t.validateResult.otherError="数据库中已经存在"),t.validateResult.excelRepeat&&(t.validateResult.otherError="excel中重复存在"),t.validateResult.siteNameNotExist&&(t.validateResult.otherError="区域位置不存在"),t.validateResult.equipmentNotExist&&(t.validateResult.otherError="设备不存在"),t.validateResult.categoryNameNotExist&&(t.validateResult.otherError="数据分类不存在"),t.validateResult.datasourceFormatError&&(t.validateResult.otherError="数据类型必须是自动采集/人工录入"),t.validateResult.datypeFormatError&&(t.validateResult.otherError="数据类型必须是状态信号/数值信号"),t.validateResult.numtailFormatError1&&(t.validateResult.otherError="显示小数位数必须是0/1/2/3/4"),t.validateResult.enumvalueFormatError&&(t.validateResult.otherError="枚举值格式不正确(例如： 0,关;1,开;)"),t.validateResult.rangeError&&(t.validateResult.otherError="范围值下限不能大于范围值上限")})),t},renderHandle:function(t,e,n,i,a){var r=e.row.validateResult[i],l=!r||"otherError"==i&&"无"==r?"#333":"red",s=r||e.row[n][i];return a&&(s=o.a.transDateFromServer(s)),r||"datasource"!=i||(s="INPUT"==s?"人工录入":"自动采集"),r||"datype"!=i||(s="State"==s?"状态信号":"数值信号"),t("span",{style:{color:l},attrs:{title:s}},s)}}},s=(n(947),n(1)),p=Object(s.a)(l,i,[],!1,null,null,null);p.options.__file="src/views/mpoint/mpoint/import.vue";e.default=p.exports},520:function(t,e,n){"use strict";var i=n(22),a={modalMpoints:"/loong/api/mpoints/dialog",alarmChart:"/loong/api/mpoints/alarm-condition",downloadTemplate:i.a+"/loong/api/mpoints/excel-template-download",exportTemplate:i.a+"/loong/api/mpoints/export",importExcel:i.a+"/loong/api/mpoints/import",saveExcelData:"/loong/api/mpoints/import-save",cancelExcelData:"/loong/api/mpoints/import-cancel",getCategroyData:"/loong/api/mpoints-datacategory",getMpointsList:"/loong/api/mpoints",deleteMpoints:"/loong/api/mpoints",deleteAllMpoints:"/loong/api/mpoints/all",batchSave:"/loong/api/mpoints/batch",autoMpoints:"/loong/api/mpoints-auto",datainputMpoints:"/loong/api/mpoints-datainput",taskMpoints:"/loong/api/mpoints-task",getCalcMpointDetail:"/loong/api/mpoints-calc",getCycle:"/loong/api/mpoints-calc-cycle",getAnalysisMpointDetail:"/loong/api/mpoints-analysis",getMpointNumByType:"/loong/api/mpoints/batch/all",getMpointDataImportList:"/loong/api/mpoint-data-imports",deleteMpointDataImport:"/loong/api/mpoint-data-imports",stopMpointDataImport:"/loong/api/mpoint-data-imports",pointDataImportTempleDownload:i.a+"/loong/api/mpoint-data-imports/templeDownload",pointDataImportFileUpload:i.a+"/loong/api/mpoint-data-imports/fileUpload"};e.a=a},546:function(t,e,n){t.exports=n.p+"images/f9339ba968ba75b06c552a91fbe42722.jpg"},552:function(t,e,n){t.exports=n.p+"images/dcd735d5f12eb9b839b5bfcc73fbe386.png"},553:function(t,e,n){t.exports=n.p+"images/fbf666a5531edaf663783cc3a955a010.png"},705:function(t,e,n){var i=n(948);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,n(17).default)("2d8596bb",i,!1,{})},947:function(t,e,n){"use strict";var i=n(705);n.n(i).a},948:function(t,e,n){var i=n(10),a=n(24),o=n(552),r=n(553),l=n(546);e=i(!1);var s=a(o),p=a(r),d=a(l);e.push([t.i,".import-detail .equ-import-process {\n  width: 620px;\n  height: 110px;\n  background: #fff url("+s+") repeat-x 0 -9px;\n  margin: 0 auto 20px;\n  display: flex;\n  align-items: flex-start;\n  justify-content: space-between;\n}\n.import-detail .equ-import-process span {\n  font-size: 13px;\n  display: inline-block;\n  width: 74px;\n  height: 70px;\n  background: #fff url("+p+") no-repeat 15px -48px;\n  background-size: 60%;\n  text-align: center;\n  color: #666;\n  padding-top: 65px;\n}\n.import-detail .equ-import-process span.active {\n  font-size: 16px;\n  color: #4b7efe;\n  font-weight: 700;\n  background: #fff url("+p+') no-repeat 10px 10px;\n  background-size: 70%;\n}\n.import-detail .equ-import-upload {\n  height: 40px;\n  margin: 100px auto 20px;\n  text-align: center;\n}\n.import-detail .equ-import-upload .ivu-btn {\n  width: 110px;\n  border-radius: 15px;\n  font-size: 13px;\n  color: #fff;\n}\n.import-detail .equ-import-download {\n  text-align: center;\n  height: 40px;\n  margin: 0 auto;\n}\n.import-detail .equ-import-download a {\n  color: #4b7efe;\n  font-size: 13px;\n}\n.import-detail .equ-import-download .ivu-icon {\n  font-size: 14px;\n  margin-left: 7px;\n}\n.import-detail .equ-import-download div {\n  margin-top: 10px;\n}\n.import-detail .ivu-upload-list {\n  margin-top: -80px;\n}\n.import-detail .validate-box {\n  width: 600px;\n  height: 40px;\n  margin: 0 auto 20px;\n}\n.import-detail .validate-box li {\n  float: left;\n  width: 200px;\n  height: 40px;\n  line-height: 40px;\n  list-style: none;\n  text-align: center;\n}\n.import-detail .validate-box li:before {\n  content: "";\n  display: inline-block;\n  width: 10px;\n  height: 10px;\n  margin-right: 10px;\n  border-radius: 50%;\n}\n.import-detail .validate-box li.all-validate:before {\n  background-color: #4b7efe;\n}\n.import-detail .validate-box li.all-pass:before {\n  background-color: #55d43f;\n}\n.import-detail .validate-box li.all-error:before {\n  background-color: #e03d3e;\n}\n.import-detail .validate-box li em {\n  margin: 0 20px;\n  font-size: 26px;\n  font-weight: 700;\n  font-style: normal;\n  color: #000;\n}\n.import-detail .ivu-tabs {\n  width: 100%;\n}\n.import-detail .ivu-tabs-bar {\n  border-bottom: none;\n}\n.import-detail .ivu-tabs-nav-wrap {\n  border-top: 1px solid #dddee1;\n}\n.import-detail .ivu-icon-information-circled {\n  float: right;\n  margin-right: 0;\n  margin-left: 8px;\n  margin-top: 2px;\n  color: #e03e3c;\n}\n.import-detail .validate-list li {\n  float: left;\n  width: 300px;\n  margin: 20px 30px;\n  list-style: none;\n}\n.import-detail .no-data {\n  height: 50px;\n  line-height: 50px;\n  text-align: center;\n}\n.import-detail .validate-pass-box {\n  border-top: 1px solid #dddee1;\n  text-align: center;\n}\n.import-detail .validate-pass-box > span {\n  display: block;\n  margin-bottom: 15px;\n}\n.import-detail .validate-pass-box .complete-icon {\n  display: inline-block;\n  width: 80px;\n  height: 80px;\n  margin-top: 30px;\n  background: url('+d+") no-repeat;\n  background-size: 100%;\n}\n.import-detail .submit-btn {\n  display: block;\n  width: 120px;\n  margin: 0 auto;\n}\n.import-detail .ivu-tabs-content .validate-pass-box {\n  border-top: none;\n}\n.import-detail .complete-box {\n  margin: 30px auto 0;\n  text-align: center;\n}\n.import-detail .complete-box > h3 {\n  margin: 15px 0;\n}\n.import-detail .complete-box .btn-back {\n  width: 100px;\n  border: solid 1px #4b7efe;\n  color: #4b7efe;\n  background: #fff;\n}\n.import-modal {\n  text-align: center;\n  padding: 30px 0 0;\n}\n",""]),t.exports=e}}]);