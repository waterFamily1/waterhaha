(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{1276:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home-item home-kpi"},[a("h3",[t._v("数据KPI "),t.isEdit?a("a",{staticClass:"home-edit-btn",attrs:{href:"javascript:;"},on:{click:function(e){t.pointsModalShown=!0}}},[t._v("编辑")]):t._e(),t.isEdit?a("a",{staticClass:"home-del-btn",attrs:{href:"javascript:;"},on:{click:t.del}},[t._v("删除")]):t._e()]),t._v(" "),a("div",{staticClass:"home-card-flex"},[0==t.selectedData.length?a("div",{staticClass:"home-mod-empty"},[t._v("请点击编辑，添加数据KPI")]):t._e(),t._v(" "),t._l(t.selectedData,(function(e,i){return a("div",{key:e.id,staticClass:"home-card-item",class:"home-kpi-"+i%4,on:{click:function(a){return t.linkToDataAnalysis(e)}}},[a("div",{staticClass:"home-card-top",attrs:{title:e.mpointName}},[t._v(t._s(e.mpointName))]),t._v(" "),e.value?a("div",{staticClass:"home-card-value"},[a("strong",{attrs:{title:e.value}},[t._v(t._s(e.value))]),e.unit?a("span",[t._v(t._s(e.unit))]):t._e()]):a("div",{staticClass:"home-card-value home-card-nodata"},[t._v("暂无数据")]),t._v(" "),a("div",{staticClass:"home-card-bottom",attrs:{title:e.siteName}},[t._v(t._s(e.siteName))])])}))],2),t._v(" "),a("Modal",{attrs:{width:"600",title:"选择测点"},model:{value:t.pointsModalShown,callback:function(e){t.pointsModalShown=e},expression:"pointsModalShown"}},[a("mg-mpoint-table",{attrs:{query:{datasource:"CALC,INPUT,ANALYSIS"},columns:t.modalColumns,selected:t.selected,max:8},on:{"on-submit":t.onModalSelect,"on-cancel":t.onModalSelectCancel}}),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};i._withStripped=!0;var n=a(23),o=(a(11),a(31)),s=a(555),r={props:{isEdit:Boolean,itemData:Object,orgId:{type:[String,Number],default:-1}},name:"daxKpi",components:{mgMpointTable:s.a},computed:Object(n.b)({sourceText:function(t){return t.map.mpoint.sourceText},datypeText:function(t){return t.map.mpoint.datypeText}}),data:function(){var t=this;return{loading:!1,pointsModalShown:!1,selectedData:[],modalColumns:[{type:"selection",width:50},{title:"区域位置",key:"siteName"},{title:"测点名称",key:"mpointName"},{title:"数据来源",key:"datasource",render:function(e,a){return e("span",t.sourceText[a.row.datasource])}},{title:"数据分类",key:"datype",render:function(e,a){return e("span",t.datypeText[a.row.datype])}}],modalUrl:o.a.daxKPIPoints,selected:[]}},methods:{del:function(){this.$emit("on-delete",this.itemData)},getSelectedData:function(){var t=this,e=[];this.itemData.data&&this.itemData.data.ids&&this.$http.get(o.a.mult_data_mpoints,{ids:this.itemData.data.ids}).then((function(a){a.length>8&&(a.length=8),a.forEach((function(t){e.push(t)})),t.selectedData=a,t.selected=t.selectedData}))},onModalSelectCancel:function(t,e){this.pointsModalShown=!1},onModalSelect:function(t){var e=this,a=[];t.forEach((function(t){a.push(t.id)})),a.length?this.$http.post(o.a.modSave,{i:this.itemData.i,data:JSON.stringify({ids:a.join()})}).then((function(t){e.$Notice.success({title:"添加成功！"}),e.pointsModalShown=!1,e.itemData.data.ids=a.join(),e.getSelectedData()})):this.$Notice.info({title:"请选择测点"})},linkToDataAnalysis:function(t){this.$router.push({name:"data-analysis-info",params:{id:t.id}})}},mounted:function(){this.getSelectedData()}},l=(a(834),a(1)),c=Object(l.a)(r,i,[],!1,null,null,null);c.options.__file="src/views/home/components/6/kpi.vue";e.default=c.exports},518:function(t,e,a){var i=a(530);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(17).default)("4411afe8",i,!1,{})},520:function(t,e,a){"use strict";var i=a(22),n={modalMpoints:"/loong/api/mpoints/dialog",alarmChart:"/loong/api/mpoints/alarm-condition",downloadTemplate:i.a+"/loong/api/mpoints/excel-template-download",exportTemplate:i.a+"/loong/api/mpoints/export",importExcel:i.a+"/loong/api/mpoints/import",saveExcelData:"/loong/api/mpoints/import-save",cancelExcelData:"/loong/api/mpoints/import-cancel",getCategroyData:"/loong/api/mpoints-datacategory",getMpointsList:"/loong/api/mpoints",deleteMpoints:"/loong/api/mpoints",deleteAllMpoints:"/loong/api/mpoints/all",batchSave:"/loong/api/mpoints/batch",autoMpoints:"/loong/api/mpoints-auto",datainputMpoints:"/loong/api/mpoints-datainput",taskMpoints:"/loong/api/mpoints-task",getCalcMpointDetail:"/loong/api/mpoints-calc",getCycle:"/loong/api/mpoints-calc-cycle",getAnalysisMpointDetail:"/loong/api/mpoints-analysis",getMpointNumByType:"/loong/api/mpoints/batch/all",getMpointDataImportList:"/loong/api/mpoint-data-imports",deleteMpointDataImport:"/loong/api/mpoint-data-imports",stopMpointDataImport:"/loong/api/mpoint-data-imports",pointDataImportTempleDownload:i.a+"/loong/api/mpoint-data-imports/templeDownload",pointDataImportFileUpload:i.a+"/loong/api/mpoint-data-imports/fileUpload"};e.a=n},529:function(t,e,a){"use strict";var i=a(518);a.n(i).a},530:function(t,e,a){(e=a(10)(!1)).push([t.i,"\n.cmp-dropdown-tree {\r\n    display: inline-block;\r\n    position: relative;\r\n    vertical-align: middle;\r\n    line-height: normal;\n}\n.ivu-form-item-error .cmp-dropdown-tree-label {\r\n    border: 1px solid #ed3f14;\n}\n.ivu-form-item-error .cmp-dropdown-tree-arrow {\r\n    border-left: 1px solid #ed3f14;\n}\n.cmp-dropdown-tree-label {\r\n    height: 28px;\r\n    width: 100%;\r\n    border: 1px solid #eaeaea;\r\n    display: flex;\r\n    border-radius: 3px;\r\n    cursor: pointer;\n}\n.cmp-dropdown-tree-text {\r\n    line-height: 28px;\r\n    text-indent: 5px;\r\n    flex: 1;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\n}\n.cmp-dropdown-tree-arrow {\r\n    margin-top: -1px;\r\n    width: 28px;\r\n    height: 28px;\r\n    border-left: 1px solid #eaeaea;\r\n    text-align: center;\r\n    line-height: 28px;\n}\n.cmp-dropdown-tree .ivu-input-group-append {\r\n    width: 25px;\r\n    height: 28px;\r\n    overflow: hidden;\r\n    padding: 0;\n}\n.cmp-dropdown-tree .ivu-btn {\r\n    padding: 5px 10px;\n}\n.cmp-dropdown-tree-tree {\r\n    z-index: 901;\r\n    position: absolute;\r\n    top: 37px;\r\n    left: 0;\r\n    min-width: 300px;\r\n    max-height: 400px;\r\n    overflow: auto;\r\n    padding: 5px 10px;\r\n    background-color: #fff;\r\n    box-shadow: 1px 1px 5px #999;\r\n    border-radius: 3px;\n}\r\n",""]),t.exports=e},531:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:t.hideTree,expression:"hideTree"}],staticClass:"cmp-dropdown-tree",style:{width:t.width+"px"}},[a("div",{staticClass:"cmp-dropdown-tree-label",on:{click:t.labelClick}},[a("div",{staticClass:"cmp-dropdown-tree-text"},[t._v(t._s(t.value.title))]),t._v(" "),a("div",{staticClass:"cmp-dropdown-tree-arrow"},[a("Icon",{directives:[{name:"show",rawName:"v-show",value:1!=t.isShowTree,expression:"isShowTree != true"}],attrs:{type:"ios-arrow-down"}}),t._v(" "),a("Icon",{directives:[{name:"show",rawName:"v-show",value:1==t.isShowTree,expression:"isShowTree == true"}],attrs:{type:"ios-arrow-up"}})],1)]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowTree,expression:"isShowTree"}],staticClass:"cmp-dropdown-tree-tree"},[a("Tree",{attrs:{data:t.datas,"show-checkbox":t.showCheckbox,multiple:t.multiple},on:{"on-select-change":t.selectTree}})],1)])};i._withStripped=!0;var n=a(11),o=a(146),s=a(147);function r(t){return function(t){if(Array.isArray(t)){for(var e=0,a=new Array(t.length);e<t.length;e++)a[e]=t[e];return a}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(t){!function t(e){e.forEach((function(e,a){e.childrenIds=function t(e,a){a=a||[];return e.forEach((function(e){e.children.length&&t(e.children,a),a.push(Math.abs(e.id))})),a}(e.children),e.children.length&&t(e.children)}))}(t)}var c={name:"myProcessTreeAuthority",mixins:[o.a],props:{field:String,value:Object,data:Array,url:String,query:Object,showCheckbox:Boolean,multiple:Boolean,width:{type:[Number,String],default:300},type:String},watch:{"value.id":function(t){t?this.flatDatas.length&&(n.a.setTrueTreeExpand(this.datas,t),n.a.setTrueTreeSelected(this.datas,t)):(!function t(e){for(var a,i=e.length,n=0;n<i;n++)1==(a=e[n]).selected&&(a.selected=!1),a.children.length&&t(a.children)}(this.datas),this.$emit("input",{id:"",title:"请选择"}))},data:function(t){this.datas=t}},data:function(){return{datas:this.data,flatDatas:[],isShowTree:!1}},methods:{selectTree:function(t){var e=this,a=[],i=[],n=[],o=this.field||"id",s=[];t.forEach((function(t){a.push(Math.abs(t[o])),i.push(t.key),n.push(t.title),s=s.concat(Math.abs(t[o]),t.childrenIds)})),s=r(new Set(s)),this.$emit("input",{id:a.join(),key:i.join(),title:n.join(),childrenIds:s}),this.$emit("on-change",{id:a.join(),key:i.join(),title:n.join(),childrenIds:s}),this.multiple||(this.isShowTree=!1),setTimeout((function(){e.dispatch("FormItem","on-form-change",{id:a.join(),key:i.join(),title:n.join(),childrenIds:s})}),100)},hideTree:function(){this.isShowTree=!1},labelClick:function(){this.isShowTree=!this.isShowTree}},directives:{clickoutside:s.a},mounted:function(){var t=this;this.url&&this.$http.get(this.url,this.query).then((function(e){e&&e.length&&(e.forEach((function(t){!1===t.authorized&&(t.render=function(t,e){e.root,e.node;return t("span",[e.data.name])})})),"EQUTYPE"==t.type&&e.forEach((function(t){var a=e.filter((function(e){return e.parentId==t.id}));("org"==t.type||a.length>0)&&(t.render=function(t,e){e.root,e.node;return t("span",[e.data.name])})})),"PROCESS"==t.type&&e.forEach((function(t){1==t.type&&(t.render=function(t,e){e.root,e.node;return t("span",[e.data.name])})})),t.flatDatas=e,t.value.id&&(n.a.setTreeExpand(t.flatDatas,t.value.id),n.a.setFlatTreeSelected(t.flatDatas,t.value.id)),t.datas=n.a.transDataToTree(t.flatDatas),l(t.datas))}))}},d=(a(529),a(1)),p=Object(d.a)(c,i,[],!1,null,null,null);p.options.__file="src/components/my-process-tree-authority.vue";e.a=p.exports},536:function(t,e,a){var i=a(551);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(17).default)("f8fc3b20",i,!1,{})},550:function(t,e,a){"use strict";var i=a(536);a.n(i).a},551:function(t,e,a){(e=a(10)(!1)).push([t.i,"\n.mg-mp-table-header {\r\n\tdisplay: flex;\r\n\theight: 40px;\n}\n.mg-mp-table-search {\r\n\twidth: 250px;\n}\n.mg-mp-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-mp-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-mp-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),t.exports=e},555:function(t,e,a){"use strict";var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"mg-mp-table"},[a("div",[a("div",[a("div",{staticClass:"c-form-item"},[a("label",{staticStyle:{width:"auto"}},[t._v("关键字：")]),t._v(" "),a("Input",{staticStyle:{width:"160px"},attrs:{placeholder:t.searchPlaceholder,clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.searchParams.queryName,callback:function(e){t.$set(t.searchParams,"queryName",e)},expression:"searchParams.queryName"}})],1),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",{staticStyle:{width:"auto"}},[t._v("区域位置：")]),t._v(" "),a("my-process-tree-authority",{ref:"processTree",staticStyle:{width:"160px"},attrs:{url:t.treeApi.getProcessTreeData},on:{"on-change":t.processSelect},model:{value:t.relProcess,callback:function(e){t.relProcess=e},expression:"relProcess"}})],1),t._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("Button",{staticClass:"c-btn-modal-search",attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),a("Button",{staticClass:"c-btn-modal-reset",attrs:{type:"primary"},on:{click:t.searchParamsClean}},[t._v("重置")])],1)]),t._v(" "),a("div",{staticClass:"mg-mp-table-tip"},[t._v("已选择"),a("strong",[t._v(t._s(t.selectedTemp.length))]),t._v("个 "),a("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:t.cleanup}},[t._v("[清空]")])])]),t._v(" "),a("div",{attrs:{id:t.TID}},[a("Table",{ref:t.tableRef,attrs:{columns:t.inColumns,data:t.listData,loading:t.loading,stripe:"",size:"small"},on:{"on-select":t.onSelect,"on-select-cancel":t.onSelectCancel,"on-select-all":t.onSelectAll}})],1),t._v(" "),a("Page",{staticClass:"table-page",attrs:{total:t.total,"page-size":t.searchParams.pageSize,current:t.searchParams.currentPage,"show-total":"","show-elevator":"",size:"small"},on:{"on-change":t.pageChange}}),t._v(" "),a("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[a("Button",{attrs:{type:"default",shape:"circle"},on:{click:t.cancel}},[t._v("取消")]),t._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.submit}},[t._v("确定")])],1)],1)};i._withStripped=!0;var n=a(11),o=a(107),s=a(520),r={name:"mgMpointTable",components:{myProcessTreeAuthority:a(531).a},props:{columns:Array,disabledRow:Boolean,selected:Array,max:Number,manual:Boolean,field:String,query:Object},watch:{selected:function(t){var e=JSON.stringify(t);this.selectedTemp=JSON.parse(e),this.selectedTruth=JSON.parse(e),this.checkSelection()}},data:function(){return{searchPlaceholder:"输入测点名称以检索",relProcess:{id:"",title:"请选择"},treeApi:o.a,url:s.a.modalMpoints,inColumns:[{type:"selection",width:50},{title:"测点编号",width:120,key:"mpointId"},{title:"区域位置",key:"siteName"},{title:"测点名称",key:"mpointName"}],TID:"",searchParams:{queryName:"",siteId:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{searchParamsClean:function(){this.searchParams=Object.assign({},{queryName:"",siteId:"",currentPage:1,pageSize:10},this.query||{}),this.relProcess={id:"",title:"请选择"}},processSelect:function(t){this.searchParams.siteId=t.id},cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(){var t=this;this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(e){var a=e.items?e.items:[];t.disabledRow&&a.forEach((function(t){t.disabled&&(t._disabled=!0)})),t.field&&a.forEach((function(e){e.id||(e.id=e[t.field])})),t.listData=a,t.total=e.total,t.loading=!1,t.checkSelection()}))},pageChange:function(t){this.searchParams.currentPage=t,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(t,e){var a=this.selectedTemp;this.max&&a.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(e.id)):this.selectedTemp.push(e)},onSelectCancel:function(t,e){var a=this;this.selectedTemp.forEach((function(t,i){t.id==e.id&&a.selectedTemp.splice(i,1)}))},onSelectAll:function(t){0==t.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(t)},addTableToTemp:function(t){var e=this.selectedTemp;t.forEach((function(t){var a=!1;e.forEach((function(e,i){e.id==t.id&&(a=!0)})),a||e.push(t)}))},removeTableFromTemp:function(t){for(var e=this.selectedTemp,a=e.length;a--;){var i=!1;t.forEach((function(t){t.id==e[a].id&&(i=!0)})),i&&e.splice(a,1)}},cancelChecked:function(t){var e=this;this.checkSelection();var a=this.selectedTemp,i=[];a.forEach((function(a){a.id==t&&e.$set(a,"_checked",!1),i.push(a)})),this.selectedTemp=i},checkSelection:function(){var t=this;this.$nextTick((function(){var e=t.listData,a=t.selectedTemp,i=t.$refs[t.tableRef];e.forEach((function(t,e){var n=i.$refs.tbody.objData[e];n._isChecked=!1,a.forEach((function(e){e.id==t.id&&(n._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=n.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=n.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.query&&(this.searchParams=Object.assign({},{queryName:"",siteId:"",currentPage:1,pageSize:10},this.query)),this.getData()},created:function(){var t=n.a.gusid(6);this.TID="J_TABLE_"+t,this.tableRef="mg-select-table-"+t,this.columns&&(this.inColumns=this.columns),n.a.initTableColumnTitle(this.inColumns)}},l=(a(550),a(1)),c=Object(l.a)(r,i,[],!1,null,null,null);c.options.__file="src/components/mg-mpoint-table.vue";e.a=c.exports},630:function(t,e,a){var i=a(835);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(17).default)("d9c476cc",i,!1,{})},834:function(t,e,a){"use strict";var i=a(630);a.n(i).a},835:function(t,e,a){var i=a(10),n=a(212);(e=i(!1)).i(n),e.push([t.i,"\r\n",""]),t.exports=e}}]);