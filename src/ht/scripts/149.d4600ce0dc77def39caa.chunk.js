(window.webpackJsonp=window.webpackJsonp||[]).push([[149],{1186:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-sub-lay message-box"},[a("div",{staticClass:"c-sub-menu"},[a("ul",e._l(e.typeMap,(function(t,n){return a("li",{key:n,class:{active:e.params.category==n},on:{click:function(t){return e.tabClick(n)}}},[a("Badge",{attrs:{dot:"",count:Number(e.unreadFlag[n])}},[a("a",{attrs:{href:"javascript:void(null)"}},[e._v(e._s(t))])])],1)})),0)]),e._v(" "),a("div",{staticClass:"c-sub-main c-scrollbar"},[e.loading?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),a("div",{staticClass:"select-box",class:{"no-border":e.noBorder}},[a("Select",{staticStyle:{width:"100px"},model:{value:e.params.unread,callback:function(t){e.$set(e.params,"unread",t)},expression:"params.unread"}},[a("Option",{attrs:{value:0}},[e._v("全部")]),e._v(" "),a("Option",{attrs:{value:1}},[e._v("未读消息")]),e._v(" "),a("Option",{attrs:{value:2}},[e._v("已读消息")])],1),e._v(" "),a("span",{staticClass:"c-btns-right all-readed-btn",on:{click:e.allReaded}},[e._v("\n                   全部已读\n            ")])],1),e._v(" "),e._l(e.allMessageList.items,(function(t,n){return a("div",{key:n},[a("Row",{directives:[{name:"show",rawName:"v-show",value:t.title,expression:"items.title"}],staticClass:"list-title",attrs:{type:"flex",align:"middle"}},[a("Col",[e._v(e._s(t.title))])],1),e._v(" "),a("Table",{ref:"selection",refInFor:!0,attrs:{border:"","row-class-name":e.rowClassName,columns:e.columns,data:t.list,"show-header":!1},on:{"on-row-click":e.showMessageDetail,"on-select":e.selectItem,"on-select-cancel":e.selectCancel}})],1)})),e._v(" "),a("Row",{directives:[{name:"show",rawName:"v-show",value:!e.allMessageList.items.length,expression:"!allMessageList.items.length"}],staticClass:"c-nodata-tip"},[a("col"),e._v("暂无数据")]),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.allMessageList.total,"page-size":e.params.pageSize,current:e.params.currentPage,"show-total":"","show-elevator":""},on:{"on-change":e.pageChange}})],2)])};n._withStripped=!0;var s=a(23),r=a(11),i=a(60);function o(e){var t=e?new Date(e):new Date,a=t.getYear();a<1e3&&(a+=1900);var n=[31,31,30,31,30,31,31,30,31,30,31];Math.round(t.getYear()/4)==t.getYear()/4?n[1]=29:n[1]=28;for(var s=0,r=0;r<t.getMonth();r++)s+=n[r];return{day:s+=t.getDate()}}function l(e){var t=e.data,a=void 0===t?[]:t,n=e.key,s=void 0===n?"showTime":n,r=function(e){return(e?new Date(e):new Date).getFullYear()},i=[],l=[],c=[],d=[];a.forEach((function(e,t,a){var n,u;n=e[s],u=e,r(n)===r()&&o().day-o(n).day<8?i.push(u):r(n)===r()&&o().day-o(n).day>7&&o().day-o(n).day<31?l.push(u):r(n)===r()&&o().day-o(n).day>30&&o().day-o(n).day<90?c.push(u):d.push(u)}));var u=[];return i.length&&u.push({title:"",list:i}),l.length&&u.push({title:"一周前",list:l}),c.length&&u.push({title:"一个月前",list:c}),d.length&&u.push({title:"三个月前",list:d}),u}var c={data:function(){return{params:{type:"web",unread:0,category:this.$route.params.type,currentPage:1,pageSize:10},unreadFlag:{task:!1,system:!1,alarm:!1,maintain:!1},allMessageList:{items:[],total:0},loading:!1,columns:[{title:"Name",key:"title",width:200,ellipsis:!0,render:function(e,t){return e("span",{attrs:{title:t.row.title}},t.row.title)}},{title:"content",key:"content",ellipsis:!0,render:function(e,t){var a=t.row.readStatus?"android-drafts":"android-mail",n=t.row.content.replace(/(<a>|<\/a>)/g,"");return e("div",[e("icon",{class:{icon:!0,read:t.row.readStatus,unread:!t.row.readStatus},attrs:{type:a}}),e("span",{attrs:{title:n},domProps:{innerHTML:t.row.content}})])}},{title:"time",key:"realSendTime",width:200,render:function(e,t){return e("span",r.a.transDateFromServer(t.row.realSendTime,"yyyy-MM-dd hh:mm"))}}],allSelectValue:!1,noBorder:!1}},computed:Object(s.b)({typeMap:function(e){return e.map.message.typeMap},typeCodes:function(e){return e.map.message.typeCodes}}),watch:{"$route.params.type":function(e){this.params.category=e,this.getList()},"params.unread":function(e){this.params.currentPage=1,this.getList()}},filters:{realSendTimeText:function(e){return r.a.formatDateTime(new Date(e),"yyyy-MM-dd hh:mm")}},methods:{allReaded:function(){var e=this;this.$http.put(i.a.readAllMessage,{category:Number(this.typeCodes[this.params.category])}).then((function(t){e.$Notice.success({title:"成功",desc:"操作成功",duration:3}),e.getList(),e.getUnreadFlag()})).catch((function(){}))},getList:function(){var e=this;this.loading=!0,this.$http.get(i.a.getAllMessage,Object.assign({},this.params,{category:this.typeCodes[this.params.category],unread:null,readFlag:[null,"unread","read"][this.params.unread]})).then((function(t){e.loading=!1,t.items=l({type:"d",data:t.items,key:"realSendTime"}),e.allMessageList.items=t.items||[],e.allMessageList.total=t.total||0,e.noBorder=!t.items[0].title})).catch((function(){e.loading=!1}))},showMessageDetail:function(e){this.$router.push({name:"message-detail",params:{type:e.readStatus?"read":"unread",id:e.id}})},getUnreadFlag:function(){var e=this;this.$http.get(i.a.getUnreadFlag).then((function(t){e.unreadFlag.task=t.task,e.unreadFlag.system=t.system,e.unreadFlag.alarm=t.alarm}))},tabClick:function(e){this.params.currentPage=1,this.$router.replace({name:"message",params:{type:e}})},pageChange:function(e){this.params.currentPage=e,this.getList()},rowClassName:function(e,t){return!0===e.readStatus?"message-read-row":"message-unread-row"},allSelect:function(e){this.$refs.selection.forEach((function(t){t.selectAll(e)}))},selectItem:function(e,t){var a=this.$refs.selection.every((function(e){return e.getSelection().length===e.data.length}));this.allSelectValue=a},selectCancel:function(e,t){this.allSelectValue=!1},delClick:function(){var e=[];this.$refs.selection.forEach((function(t){e=e.concat(t.getSelection())}))}},mounted:function(){this.getList(),this.getUnreadFlag()}},d=(a(802),a(1)),u=Object(d.a)(c,n,[],!1,null,null,null);u.options.__file="src/views/message/list.vue";t.default=u.exports},614:function(e,t,a){var n=a(803);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,a(17).default)("619d6ab2",n,!1,{})},802:function(e,t,a){"use strict";var n=a(614);a.n(n).a},803:function(e,t,a){var n=a(10),s=a(24),r=a(804);t=n(!1);var i=s(r);t.push([e.i,".message-box .ivu-table-cell a {\n  color: #9c9999;\n}\n.message-box .select-box {\n  width: 100%;\n  height: 50px;\n  line-height: 30px;\n  padding: 10px 20px;\n  border-bottom: 1px solid #eee;\n}\n.message-box .select-box.no-border {\n  border-bottom: 0;\n}\n.message-box .select-box .all-readed-btn {\n  color: #4b7efe;\n  background: url("+i+") 0px 5px no-repeat;\n  padding-left: 20px;\n  cursor: pointer;\n}\n.message-box .c-right-list.c-main-border {\n  position: relative;\n  width: auto;\n  border: 10px solid #f0f0f0;\n}\n.message-box .list-title {\n  height: 50px;\n  line-height: 50px;\n  padding-left: 20px;\n}\n.message-box .icon {\n  margin-right: 10px;\n  font-size: 20px;\n  vertical-align: middle;\n}\n.message-box .icon.unread {\n  color: #4b7efe;\n}\n.message-box .message-read-row,\n.message-box .message-read-row a {\n  color: #9c9999;\n  cursor: pointer;\n}\n.message-box .message-unread-row,\n.message-box .message-unread-row a {\n  color: #333;\n  cursor: pointer;\n}\n.message-box .ivu-table-wrapper {\n  border: none;\n  border-top: 1px solid #dddee1;\n}\n.message-box .ivu-table-border td,\n.message-box .ivu-table-border th {\n  border-right: none;\n}\n.message-box .ivu-table:after {\n  width: 0;\n}\n.message-box .table-page {\n  padding: 10px;\n}\n.message-box .ivu-badge-dot {\n  right: -13px;\n}\n",""]),e.exports=t},804:function(e,t,a){e.exports=a.p+"images/7bfc9fb6c7722c2754a1ec6cd124e71e.png"}}]);