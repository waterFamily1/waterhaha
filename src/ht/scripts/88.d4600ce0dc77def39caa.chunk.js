(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{1139:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-tree"},[a("div",{staticClass:"c-tree-left",attrs:{id:"J_TREE_LEFT"}},[a("div",{staticStyle:{padding:"2px"}},[a("Select",{staticStyle:{width:"100%"},attrs:{placeholder:"输入智能报表名称以检索",clearable:"",filterable:"",remote:"","remote-method":e.onSearch,loading:e.searchLoading},on:{"on-change":e.onSearchItemClick}},e._l(e.searchItems,(function(t){return a("Option",{key:t.id,attrs:{value:JSON.stringify(t)}},[e._v(e._s(t.name))])})),1)],1),e._v(" "),a("div",{staticClass:"padding-l-10",staticStyle:{"border-top":"1px solid #e6e6e6",position:"relative"}},[e.treeLoading?a("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),a("Tree",{attrs:{data:e.treeData,render:e.renderContent}})],1)]),e._v(" "),a("div",{staticClass:"c-main-border c-tree-right"},[a("div",{directives:[{name:"show",rawName:"v-show",value:"F"==e.activeType,expression:"activeType == 'F'"}]},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("智能报表目录")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveFolder}},[e._v("保存")])],1)]),e._v(" "),a("div",{staticStyle:{margin:"20px"}},[a("Form",{ref:"folderForm",attrs:{model:e.folderData,"label-width":120}},[a("FormItem",{attrs:{label:"目录名称：",prop:"folderName",rules:{required:!0,message:"请输入目录名称",trigger:"blur"}}},[a("Input",{staticStyle:{width:"200px"},attrs:{maxlength:20,placeholder:"目录名称"},model:{value:e.folderData.folderName,callback:function(t){e.$set(e.folderData,"folderName",t)},expression:"folderData.folderName"}})],1)],1)],1)]),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"T"==e.activeType,expression:"activeType == 'T'"}]},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[e._v("智能报表模板")]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{attrs:{type:"primary",loading:e.saveLoading},on:{click:e.saveTempl}},[e._v("保存")]),e._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:1==e.saveType,expression:"saveType == 1"}],attrs:{type:"primary"},on:{click:e.linkToReort}},[e._v("预览")])],1)]),e._v(" "),a("Form",{ref:"form",attrs:{model:e.tmpData,rules:e.formRules,"label-width":120}},[a("div",{staticClass:"c-form-row-1col",staticStyle:{"margin-top":"30px"}},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"rname",label:"报表模板名称："}},[a("Input",{staticStyle:{width:"400px"},model:{value:e.tmpData.rname,callback:function(t){e.$set(e.tmpData,"rname",t)},expression:"tmpData.rname"}})],1)],1)]),e._v(" "),a("div",{staticClass:"c-form-row-1col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"rpath",label:"报表路径："}},[a("Input",{staticStyle:{width:"400px"},model:{value:e.tmpData.rpath,callback:function(t){e.$set(e.tmpData,"rpath",t)},expression:"tmpData.rpath"}})],1)],1)]),e._v(" "),a("div",{staticClass:"c-form-row-1col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{label:"备注："}},[a("Input",{staticStyle:{width:"400px"},attrs:{type:"textarea"},model:{value:e.tmpData.remark,callback:function(t){e.$set(e.tmpData,"remark",t)},expression:"tmpData.remark"}})],1)],1)])])],1)])])};i._withStripped=!0;a(23);var r=a(11),s=a(580);a(39);function n(e,t){return(t||"template_")+e}var o={data:function(){return{treeLoading:!1,searchLoading:!1,searchItems:[],treeData:[],activeTreeId:"",activeType:"",saveType:0,saveLoading:!1,folderData:{folderName:""},tmpData:{rname:"",rpath:"",remark:""},formRules:{rname:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"名称不能超过20个字符",trigger:"change"}],rpath:[{required:!0,message:"请输入路径",trigger:"blur"}]}}},methods:{onSearch:function(e){var t=this;e&&(this.searchLoading=!0,this.$http.get(s.a.smartTree,{query:e}).then((function(e){t.searchLoading=!1,t.searchItems=e.filter((function(e){return 12==e.type}))||[]})).catch((function(){t.searchLoading=!1})))},onSearchItemClick:function(e){var t=JSON.parse(e);r.a.setTrueTreeExpand(this.treeData,t.id),this.activeTreeId=t.id,this.activeType="T",this.saveType=1,this.getTemplData(t.id)},getTreeData:function(){var e=this;this.treeLoading=!0,this.$http.get(s.a.smartTree).then((function(t){e.treeData=r.a.transDataToTree(t.map((function(e){return e.expand=!0,e}))),e.treeLoading=!1}))},renderContent:function(e,t){var a=this,i=(t.root,t.node,t.data),s=e("a",{attrs:{href:"javascript:;"},on:{click:function(){a.addFolder(i)}}},["新增目录"]),n=e("a",{attrs:{href:"javascript:;"},class:{"c-tree-btn-edit":!0},on:{click:function(){a.addTemplate(i)}}},["新增模板"]),o=r.a.treeBtnDelStyle(e,(function(){a.delClick(i)})),c=[];return"1"==i.type?c=[s]:"2"==i.type||"3"==i.type||"4"==i.type?c=[s,n]:"10"==i.type?c=[n,o]:"11"!=i.type&&"12"!=i.type||(c=[o]),e("div",{class:{"c-tree-row":!0}},[e("span",{class:{"ivu-tree-title":10==i.type||11==i.type||12==i.type,"ivu-tree-title-selected":i.id==this.activeTreeId,"report-tree-icon-smart":12==i.type,"report-tree-icon-folder":10==i.type},on:{click:function(){10!=i.type&&11!=i.type&&12!=i.type||a.infoClick(i)}}},[i.title]),e("div",{class:{"c-tree-btns":!0}},c)])},delClick:function(e){var t,a=this;10==e.type?t=s.a.folder:12==e.type&&(t=s.a.template),t&&this.$http.del(t,{ids:e.id}).then((function(e){e.count&&(a.$Notice.success({title:"删除成功"}),a.getTreeData())}))},infoClick:function(e){this.activeTreeId=e.id,this.saveType=1,10==e.type?(this.activeType="F",this.folderData.folderName=e.title):12==e.type&&(this.activeType="T",this.getTemplData(e.id))},addFolder:function(e){this.activeType="F",this.activeTreeId=e.id,this.folderData.folderName="",this.saveType=0},saveFolder:function(){var e=this,t="put",a={id:this.activeTreeId,fname:this.folderData.folderName};0==this.saveType&&(t="post",a={siteid:this.activeTreeId,fname:this.folderData.folderName}),this.$refs.folderForm.validate((function(i){i&&(e.saveLoading=!0,e.$http[t](s.a.folder,a).then((function(t){e.saveLoading=!1,e.$Notice.success({title:"数据保存成功"}),0==e.saveType&&(e.saveType=1,e.activeTreeId=n(t.id,"folder_")),e.getTreeData()})))}))},addTemplate:function(e){this.activeTreeId=e.id,this.activeType="T",this.tmpData={rname:"",rpath:"",remark:"",rtype:"Smart"},10==e.type?this.tmpData.folderid=e.id:this.tmpData.siteid=e.id,this.groupsData=[],this.saveType=0},getTemplData:function(e){var t=this;this.$http.get(s.a.template+"/"+function(e){return e.replace(/(template_)/gi,"")}(e)).then((function(e){t.tmpData=e}))},saveTempl:function(){var e=this;this.$refs.form.validate((function(t){if(t){var a=1==e.saveType?"put":"post";e.saveLoading=!0,e.$http[a](s.a.template,e.tmpData).then((function(t){e.saveLoading=!1,e.$Notice.success({title:"保存成功"}),0==e.saveType&&(e.saveType=1,e.activeTreeId=n(t.id),e.getTemplData(t.id)),e.getTreeData()}))}}))},linkToReort:function(){this.$router.push({name:"report-smart-detail",params:{id:this.activeTreeId}})}},components:{mgSelectTable:a(537).a},mounted:function(){r.a.setTreeLeftHeight(),this.getTreeData()}},c=(a(993),a(1)),l=Object(c.a)(o,i,[],!1,null,null,null);l.options.__file="src/views/report/setting-smart.vue";t.default=l.exports},512:function(e,t,a){e.exports=a.p+"images/a954021ab2bbe81e01475e318c91e48d.png"},528:function(e,t,a){var i=a(535);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("ad278fbc",i,!1,{})},534:function(e,t,a){"use strict";var i=a(528);a.n(i).a},535:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.mg-select-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-select-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-select-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),e.exports=t},537:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"mg-select-table"},[e._t("top"),e._v(" "),a("div",{staticClass:"mg-select-table-header"},[e._t("default",[a("div",{staticClass:"mg-select-table-search"},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:e.searchPlaceholder,clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}},[a("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:e.search},slot:"append"})],1)],1)]),e._v(" "),a("div",{staticClass:"mg-select-table-tip"},[e._v("已选择"),a("strong",[e._v(e._s(e.selectedTemp.length))]),e._v("个 "),a("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanup}},[e._v("[清空]")])])],2),e._v(" "),a("div",{attrs:{id:e.TID}},[a("Table",{ref:e.tableRef,attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:"",size:e.size},on:{"on-select":e.onSelect,"on-select-cancel":e.onSelectCancel,"on-select-all":e.onSelectAll}})],1),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":"",size:e.size},on:{"on-change":e.pageChange}}),e._v(" "),a("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[a("Button",{attrs:{type:"default",shape:"circle"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.submit}},[e._v("确定")])],1)],2)};i._withStripped=!0;var r=a(11),s={name:"mgSelectTable",props:{disabledRow:Boolean,selected:Array,searchPlaceholder:String,columns:{type:Array,default:[]},url:String,size:{type:String,default:"small"},max:Number,manual:Boolean,field:String},watch:{selected:function(e){var t=JSON.stringify(e);this.selectedTemp=JSON.parse(t),this.selectedTruth=JSON.parse(t),this.checkSelection()}},data:function(){return{TID:"",searchParams:{queryName:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(e){var t=this;e&&(this.searchParams=Object.assign({},{queryName:"",currentPage:1,pageSize:10},e)),this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(e){var a=e.items?e.items:[];t.disabledRow&&a.forEach((function(e){e.disabled&&(e._disabled=!0)})),t.field&&a.forEach((function(e){e.id||(e.id=e[t.field])})),t.listData=a,t.total=e.total,t.loading=!1,t.checkSelection()}))},pageChange:function(e){this.searchParams.currentPage=e,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(e,t){var a=this.selectedTemp;this.max&&a.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(t.id)):this.selectedTemp.push(t)},onSelectCancel:function(e,t){var a=this;this.selectedTemp.forEach((function(e,i){e.id==t.id&&a.selectedTemp.splice(i,1)}))},onSelectAll:function(e){0==e.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(e)},addTableToTemp:function(e){var t=this.selectedTemp;e.forEach((function(e){var a=!1;t.forEach((function(t,i){t.id==e.id&&(a=!0)})),a||t.push(e)}))},removeTableFromTemp:function(e){for(var t=this.selectedTemp,a=t.length;a--;){var i=!1;e.forEach((function(e){e.id==t[a].id&&(i=!0)})),i&&t.splice(a,1)}},cancelChecked:function(e){var t=this;this.checkSelection();var a=this.selectedTemp,i=[];a.forEach((function(a){a.id==e&&t.$set(a,"_checked",!1),i.push(a)})),this.selectedTemp=i},checkSelection:function(){var e=this;this.$nextTick((function(){var t=e.listData,a=e.selectedTemp,i=e.$refs[e.tableRef];t.forEach((function(e,t){var r=i.$refs.tbody.objData[t];r._isChecked=!1,a.forEach((function(t){t.id==e.id&&(r._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=r.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=r.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.manual||this.getData()},created:function(){var e=r.a.gusid(6);this.TID="J_TABLE_"+e,this.tableRef="mg-select-table-"+e,r.a.initTableColumnTitle(this.columns)}},n=(a(534),a(1)),o=Object(n.a)(s,i,[],!1,null,null,null);o.options.__file="src/components/mg-select-table.vue";t.a=o.exports},580:function(e,t,a){"use strict";var i=a(22),r={tree:"/loong/api/reports/tree",normalTree:"/loong/api/normal-reports/tree",smartTree:"/loong/api/smart-reports/tree",briefTree:"/loong/api/datainput-reports/tree",folder:"/loong/api/folders",template:"/loong/api/report-templates",data:"/loong/api/reports/data",getReportUrl:"/loong/api/report/server-url",exportReport:i.a+"/loong/api/reports/export",exportBrief:i.a+"/loong/api/datainput-reports/export",getSessionId:"/loong/api/smart-reports/server-session-id",redirect:i.a+"/loong/api/smart-reports/server-url?reportUrl="};t.a=r},721:function(e,t,a){var i=a(994);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);(0,a(17).default)("4bf66b9e",i,!1,{})},993:function(e,t,a){"use strict";var i=a(721);a.n(i).a},994:function(e,t,a){var i=a(10),r=a(511);(t=i(!1)).i(r),t.push([e.i,"\r\n",""]),e.exports=t}}]);