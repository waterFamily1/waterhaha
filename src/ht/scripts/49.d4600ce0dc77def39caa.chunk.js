(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{1281:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"home-item"},[n("h3",[e._v("地图巡检跟踪 "),n("a",{staticClass:"home-fullscreen-trigger",attrs:{href:"javascript:;"},on:{click:e.toggle}},[e._v("全屏")]),e.isEdit?n("a",{staticClass:"home-del-btn",attrs:{href:"javascript:;"},on:{click:e.del}},[e._v("删除")]):e._e()]),e._v(" "),n("div",{staticStyle:{height:"30px",position:"relative"}},[n("mg-day-select",{attrs:{loading:e.loading},on:{"on-change":e.patrolMonthChange},model:{value:e.day,callback:function(t){e.day=t},expression:"day"}}),e._v(" "),n("span",{directives:[{name:"show",rawName:"v-show",value:e.mapLoading,expression:"mapLoading"}],staticStyle:{position:"absolute",left:"10px",top:"0",color:"#999"}},[e._v("正在加载地图...")])],1),e._v(" "),n("div",{staticStyle:{margin:"0 5px",position:"relative"}},[n("fullscreen",{ref:"fullscreen",on:{change:e.fullscreenChange}},[n("div",{staticClass:"home-patrol-map",attrs:{id:"home-patrol-map"}}),e._v(" "),n("div",{staticClass:"bdmap-search"},[n("Icon",{attrs:{type:"ios-search",size:"20",color:"#CCCCCC"}}),e._v(" "),n("input",{staticClass:"bdmap-search-key",attrs:{type:"text",id:"home-bdmap-search-key"}})],1)])],1)])};a._withStripped=!0;var o,i=n(538),r=n.n(i),l=n(7),c=n(23),s=n(11),u=n(558),d=n(31),p=n(773);l.default.use(r.a);var f=s.a.F(new Date,"yyyy-MM-dd"),h={components:{mgDaySelect:p.a},props:{isEdit:Boolean,itemData:Object},data:function(){return{mapLoading:!0,loading:!1,day:f}},computed:Object(c.b)({patrol:function(e){return e.map.patrol},account:function(e){return e.user.account}}),methods:{toggle:function(){this.$refs.fullscreen.toggle()},fullscreenChange:function(e){e?(o.panBy(1,1),o.enableScrollWheelZoom()):o.disableScrollWheelZoom()},patrolMonthChange:function(){o.clearOverlays(),this.getData()},getData:function(){var e=this,t=this;this.loading=!0;var n=this.account.orgId,a=this.day;this.$http.get(d.a.patrol,{orgId:n,executeDate:s.a.transDateFromLocale(a+" 00:00:00"),home:1}).then((function(n){n.items&&n.items.length?(t.mapLoading=!1,n.items.forEach((function(t){t.executeStatus=e.patrol.task.state[t.executeStatus],u.a.drawPatrol(o,t)}))):(t.mapLoading=!1,u.a.placePoint(o,(function(){t.mapLoading=!1}))),e.loading=!1}))},del:function(){this.$emit("on-delete",this.itemData)}},mounted:function(){var e=this;u.a.create((function(){o=new BMap.Map("home-patrol-map",{enableMapClick:!1}),u.a.setStyle(o);var t=new BMap.NavigationControl;o.addControl(t),e.getData(),u.a.addSearch(o,"home-bdmap-search-key")}))}},g=(n(810),n(1)),v=Object(g.a)(h,a,[],!1,null,null,null);v.options.__file="src/views/home/components/2/patrol.vue";t.default=v.exports},538:function(e,t,n){e.exports=function(e){function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:a})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";t.b=function(){var e=document.documentElement;return"requestFullscreen"in e||"mozRequestFullScreen"in e&&document.mozFullScreenEnabled||"msRequestFullscreen"in e&&document.msFullscreenEnabled||"webkitRequestFullScreen"in e},t.c=function(){return!!(document.fullscreen||document.mozFullScreen||document.fullscreenElement||document.msFullscreenElement||document.webkitIsFullScreen)},t.g=function(e){e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():console.log("Fullscreen API is not supported.")},t.d=function(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("Fullscreen API is not supported.")},t.f=function(e){document.addEventListener("fullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("MSFullscreenChange",e),document.addEventListener("webkitfullscreenchange",e)},t.e=function(e){document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("MSFullscreenChange",e),document.removeEventListener("webkitfullscreenchange",e)},t.a=function e(){var t={},n=!1,a=0,o=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(n=arguments[0],a++);a<o;a++)!function(a){for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&(n&&"[object Object]"===Object.prototype.toString.call(a[o])?t[o]=e(!0,t[o],a[o]):t[o]=a[o])}(arguments[a]);return t}},function(e,t,n){"use strict";function a(){return n.i(r.c)()}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.body,t=arguments[1];if(c&&!a()){t=n.i(r.a)(!0,{},l,t);var o=e,i=void 0;t.wrap&&((i=document.createElement("div")).style["overflow-y"]="auto",i.style.background=t.background,i.style.width="100%",i.style.height="100%",o.parentNode.insertBefore(i,o),i.appendChild(o),i.addEventListener("click",(function(e){e.target===this&&n.i(r.d)()}))),o.classList.add(t.fullscreenClass),n.i(r.f)((function e(){var l=a();l||(n.i(r.e)(e),o.classList.remove(t.fullscreenClass),t.wrap&&(i.parentNode.insertBefore(o,i),i.parentNode.removeChild(i))),t.callback&&t.callback(l)})),n.i(r.g)(t.wrap?i:o)}}function i(){c&&a()&&n.i(r.d)()}var r=n(0),l={wrap:!0,background:"#333",callback:function(){},fullscreenClass:"fullscreen"},c=n.i(r.b)();t.a={getState:a,toggle:function(e,t,n){c&&(void 0===n?a()?i():o(e,t):n?o(e,t):i())},enter:o,exit:i}},function(e,t,n){var a=n(5)(n(4),n(6),null,null);e.exports=a.exports},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),o=n.n(a),i=n(1),r=n(0);t.default={install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.name||"fullscreen";e.component(a,n.i(r.a)(o.a,{name:a})),e.prototype["$"+a]=i.a}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);t.default={props:{background:{type:String,default:"#333"},fullscreenClass:{type:String,default:"fullscreen"},fullscreen:{type:Boolean,default:!1}},data:function(){return{supportFullScreen:!1,isFullscreen:!1}},computed:{wrapperStyle:function(){return{background:this.background,"overflow-y":"auto",width:"100%",height:"100%"}}},methods:{toggle:function(e){void 0===e?n.i(a.c)()?this.exit():this.enter():e?this.enter():this.exit()},enter:function(){this.supportFullScreen&&(n.i(a.f)(this.fullScreenCallback),n.i(a.g)(this.$el))},exit:function(){this.supportFullScreen&&this.getState()&&n.i(a.d)()},getState:function(){return n.i(a.c)()},shadeClick:function(e){e.target===this.$el&&this.exit()},fullScreenCallback:function(){this.isFullscreen=n.i(a.c)(),this.isFullscreen||n.i(a.e)(this.fullScreenCallback),this.$emit("change",this.isFullscreen),this.$emit("update:fullscreen",this.isFullscreen)}},watch:{fullscreen:function(e){e!==n.i(a.c)()&&(e?this.enter():this.exit())}},created:function(){this.supportFullScreen=n.i(a.b)()}}},function(e,t){e.exports=function(e,t,n,a){var o,i=e=e||{},r=typeof e.default;"object"!==r&&"function"!==r||(o=e,i=e.default);var l="function"==typeof i?i.options:i;if(t&&(l.render=t.render,l.staticRenderFns=t.staticRenderFns),n&&(l._scopeId=n),a){var c=Object.create(l.computed||null);Object.keys(a).forEach((function(e){var t=a[e];c[e]=function(){return t}})),l.computed=c}return{esModule:o,exports:i,options:l}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{class:e.isFullscreen?[e.fullscreenClass]:[],style:e.isFullscreen?[e.wrapperStyle]:[],on:{click:function(t){e.shadeClick(t)}}},[e._t("default")],2)},staticRenderFns:[]}}])},558:function(e,t,n){"use strict";var a=n(7),o=n(11);function i(e,t){return{lng:(e.lng+t.lng)/2,lat:(e.lat+t.lat)/2}}var r=n(559),l=n(560),c=n(561),s=n(562),u=n(563),d=n(564),p=n(565),f=n(566),h=(new a.default,[{featureType:"all",elementType:"all",stylers:{lightness:10,saturation:-100}}]);t.a={create:function(e){if("undefined"==typeof BMap){var t=document.createElement("script");t.src="https://api.map.baidu.com/api?v=2.0&ak=0lPULNZ5PmrFVg76kFuRjezF&callback=MG__MAP__CALLBACK",document.body.appendChild(t),window.MG__MAP__CALLBACK=function(){e&&e()}}else e&&e()},addTiles:function(e){if(e){var t=new BMap.TileLayer({isTransparentPng:!0});t.getTilesUrl=function(e,t){return"/images/tiles/"+t+"/"+e.x+"/"+e.y+".png"},e.addTileLayer(t)}},placePoint:function(e,t){e&&(new BMap.Geolocation).getCurrentPosition((function(n){var a={lng:121.480576,lat:31.235906};this.getStatus()==BMAP_STATUS_SUCCESS&&(a.lng=n.point.lng,a.lat=n.point.lat),e.centerAndZoom(new BMap.Point(a.lng,a.lat),15),t&&t(a)}),{enableHighAccuracy:!0})},setStyle:function(e){e&&e.setMapStyle({styleJson:h})},setZoom:function(e,t,n){var a=e.getViewport(t.map((function(e){return{lng:e.longitude,lat:e.latitude}}))),o=a.zoom,i=a.center;e.centerAndZoom(i,n||o)},drawPatrolTask:function(e,t){var n,a=t.patrolPointDetailDTOs||[],o=t.patrolTaskPlanPaths||[];if(e&&a.length&&o.length&&(this.setZoom(e,a),a.forEach((function(t){var a=new BMap.Point(t.longitude,t.latitude);switch(t.status){case"正常":n=new BMap.Icon(l,new BMap.Size(16,21));break;case"异常":n=new BMap.Icon(s,new BMap.Size(16,21));break;case"未检":n=new BMap.Icon(c,new BMap.Size(16,21),{anchor:new BMap.Size(8,21)});break;default:n=new BMap.Icon(r,new BMap.Size(16,21))}var o=new BMap.Marker(a,{icon:n});e.addOverlay(o);var i=new BMap.Label(t.patrolPoint,{position:a,offset:new BMap.Size(10,-15)});i.setStyle({borderColor:"#0093ff",color:"#0093ff"}),e.addOverlay(i);var u="",d="";t.uninspectedStep&&t.uninspectedStep.length?t.uninspectedStep.forEach((function(e){d+="<li>"+e+"</li>"})):d="<li>无</li>","异常"==t.status&&(u="<div ><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>漏检结果</div><ul style='padding-top:2px;clear:both;color:gray;'>"+d+"</ul></div>");var p=new BMap.InfoWindow("<div style='overflow:auto;'><div style='font-size:large;font-weight:bold;'>"+t.patrolPoint+"</div><div><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>报缺数</div>"+t.faultCount+"</div>"+u+"</div>",{width:0,height:0,title:"",enableMessage:!1});o.addEventListener("click",(function(){e.openInfoWindow(p,a)}))})),!(o.length<2)))for(var i=[],u=0,d=o.length;u<=d;u++){var p,f,h;u!=d&&(p=o[u],f=new BMap.Point(p.longitude,p.latitude)),i.length<2?i.push(f):(h=new BMap.Polyline(i,{strokeColor:"valid"==p.validate?"#3a6bdb":"#9b9b9b",strokeWeight:4}),e.addOverlay(h),u!=d&&(i=[i[1],f]))}},drawPatrol:function(e,t,n){var a,r=t.patrolTaskPointTrackDTOs||[],u=t.patrolTaskPlanPaths||[];if(e&&r.length&&u.length&&(this.setZoom(e,r),r.forEach((function(t){var n=new BMap.Point(t.longitude,t.latitude);switch(t.status){case"正常":a=new BMap.Icon(l,new BMap.Size(16,21));break;case"异常":a=new BMap.Icon(s,new BMap.Size(16,21));break;case"未检":a=new BMap.Icon(c,new BMap.Size(16,21),{anchor:new BMap.Size(8,21)})}var o=new BMap.Marker(n,{icon:a});e.addOverlay(o);var i=new BMap.Label(t.patrolPointName,{position:n,offset:new BMap.Size(10,-15)});i.setStyle({borderColor:"#0093ff",color:"#0093ff"}),e.addOverlay(i);var r="",u="";t.uninspectedStep&&t.uninspectedStep.length?t.uninspectedStep.forEach((function(e){u+="<li>"+e+"</li>"})):u="<li>无</li>","异常"==t.status&&(r="<div ><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>漏检结果</div><ul style='padding-top:2px;clear:both;color:gray;'>"+u+"</ul></div>");var d=new BMap.InfoWindow("<div style='overflow:auto;'><div style='font-size:large;font-weight:bold;'>"+t.patrolPointName+"</div><div><div style='padding:2px 0 2px 0;font-weight:bold;border-bottom:solid 1px #eee;'>报缺数</div>"+t.faultCount+"</div>"+r+"</div>",{width:0,height:0,title:"",enableMessage:!1});o.addEventListener("click",(function(){e.openInfoWindow(d,n)}))})),!(u.length<2)))for(var d=new BMap.InfoWindow("<h5>"+t.name+"</h5><div>"+t.executeStatus+"</div><div>时间："+o.a.transDateFromServer(t.startTime,"hh:mm")+" - "+o.a.transDateFromServer(t.endTime,"hh:mm")+"</div><div>发现缺陷："+t.faultCount+"</div><div>巡检点："+t.inspectedCount+"/"+t.patrolPointCount+"</div><div>计划距离："+t.planPathLength+"米</div><div>有效距离："+t.validPathLength+"米</div>",{width:270,height:140,title:"",enableMessage:!1}),p=[],f=0,h=u.length;f<=h;f++){var g,v,m;f!=h&&(g=u[f],v=new BMap.Point(g.longitude,g.latitude)),p.length<2?p.push(v):((m=new BMap.Polyline(p,{strokeColor:"valid"==g.validate?"#3a6bdb":"#9b9b9b",strokeWeight:4})).addEventListener("mouseover",(function(){this.setStrokeStyle("dashed")})),m.addEventListener("mouseout",(function(){this.setStrokeStyle("solid")})),m.addEventListener("click",(function(t){var n=t.target.getPath()[0],a=t.target.getPath()[1];e.openInfoWindow(d,new BMap.Point(i(n,a).lng,i(n,a).lat))})),e.addOverlay(m),f!=h&&(p=[p[1],v]))}},addSearch:function(e,t,n){new BMap.Autocomplete({input:t||"bdmap-search-key",location:e}).addEventListener("onconfirm",(function(t){var a=t.item.value,o=a.province+a.city+a.district+a.street+a.business,i=new BMap.LocalSearch(e,{onSearchComplete:function(){var t=i.getResults().getPoi(0).point;e.centerAndZoom(t,18),n&&n(t)}});i.search(o)}))},getBDPoints:function(e){if(!e)return[];var t=[];return e.forEach((function(e){e.longitude&&e.latitude&&t.push(new BMap.Point(e.longitude,e.latitude))})),t},hitPoint:function(e,t,n){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]),t.forEach((function(t){if(t.longitude&&t.latitude){var a=new BMap.Point(t.longitude,t.latitude),o=new BMap.Marker(a,{icon:new BMap.Icon(r,new BMap.Size(16,21))});n&&"boolean"==typeof n?o.disableDragging():"function"==typeof n&&(o.enableDragging(),o.addEventListener("dragend",(function(e){n(e)})));var i=new BMap.Label(t.patrolPoint,{offset:new BMap.Size(20,-10)});i.setStyle({borderColor:"#0093ff",color:"#0093ff"}),o.setLabel(i),o.setTitle(t.id),e.addOverlay(o)}}))},renderLine:function(e,t,n){var a=new BMap.Polyline(t,Object.assign({enableEditing:!1,enableClicking:!0,strokeWeight:"5",strokeOpacity:.65},n||{}));return e.addOverlay(a),a},hitProcess:function(e,t,n,a){var o=[],i=[];return t.forEach((function(t,a){if(t.longitude&&t.latitude){var r=t.handleStatus?u:d,l=new BMap.Point(t.longitude,t.latitude),c=new BMap.Marker(l,{icon:new BMap.Icon(r,new BMap.Size(36,30))}),s=(12*t.name.length+20)/2,p=new BMap.Label(t.name,{offset:new BMap.Size(18-s,-26)});p.setStyle({backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",color:"#4A4A4A",borderRadius:"2px",boxShadow:"2px 2px 4px 0px rgba(0,0,0,0.13)",padding:"3px 10px",cursor:"pointer"}),c.setLabel(p),c.setZIndex(2e3+a),e.addOverlay(c),i.push(c),p.addEventListener("click",(function(){n&&n(this,l,t)})),c.addEventListener("click",(function(){n&&n(this,l,t)})),o.push(l)}})),a&&a(i),o},hitStaff:function(e,t,n,a){var o=[],i=[];return t.forEach((function(t,a){if(t.longitude&&t.latitude){var r=1==t.haveTask?p:f,l=new BMap.Point(t.longitude,t.latitude),c=new BMap.Marker(l,{icon:new BMap.Icon(r,new BMap.Size(23,32))}),s=(12*t.userName.length+20)/2,u=new BMap.Label(t.userName,{offset:new BMap.Size(12-s,-26)});u.setStyle({backgroundColor:"#FFFFFF",borderColor:"#FFFFFF",color:"#4A4A4A",borderRadius:"2px",boxShadow:"2px 2px 4px 0px rgba(0,0,0,0.13)",padding:"3px 10px"}),c.setLabel(u),c.setZIndex(1e3+a),e.addOverlay(c),i.push(c),c.addEventListener("click",(function(){n&&n(this,l,t)})),o.push(l)}})),a&&a(i),o}}},559:function(e,t,n){e.exports=n.p+"images/f2b760922921a7f0fd4d402145d6dbd5.png"},560:function(e,t,n){e.exports=n.p+"images/5a97737f8744e4f0a37e9eadcaae7469.png"},561:function(e,t,n){e.exports=n.p+"images/e91e0c308e4bdfa03605696ce3358b1b.png"},562:function(e,t,n){e.exports=n.p+"images/bd4523e3b67968731b5d77d0a89dcb9f.png"},563:function(e,t,n){e.exports=n.p+"images/6cc09be5e8a6202e732126b57d5d92da.png"},564:function(e,t,n){e.exports=n.p+"images/96e02f4efb20c9a13722cc8ae3fd59d8.png"},565:function(e,t,n){e.exports=n.p+"images/5980ed2516736ab58921267e07915b43.png"},566:function(e,t,n){e.exports=n.p+"images/1316c96a11c16e1faf98fa712e4b33c8.png"},581:function(e,t,n){var a=n(618);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(17).default)("08b4527c",a,!1,{})},617:function(e,t,n){"use strict";var a=n(581);n.n(a).a},618:function(e,t,n){(t=n(10)(!1)).push([e.i,"\n.cmp-month-select {text-align: center;}\n.cmp-month-select .ivu-btn {background-color:#FFF;color:#999;border: 1px solid #999;width: 20px;\r\n    height: 20px;line-height: 20px;}\n.cmp-month-select-current {margin: 2px 20px;display: inline-block;vertical-align: top;color: #576374;font-weight: 700;}\r\n",""]),e.exports=t},619:function(e,t,n){var a=n(811);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,n(17).default)("17730d16",a,!1,{})},773:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"cmp-month-select"},[n("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-arrow-left"},on:{click:e.prev}}),e._v(" "),n("span",{staticClass:"cmp-month-select-current"},[e._v(e._s(e.value))]),e._v(" "),n("Button",{attrs:{type:"primary",shape:"circle",icon:"ios-arrow-right",disabled:e.disabled},on:{click:e.next}})],1)};a._withStripped=!0;var o=n(11);function i(e){var t=1*new Date(e)-864e5,n=1*new Date(e)+864e5;return{prev:o.a.F(new Date(t),"yyyy-MM-dd"),next:o.a.F(new Date(n),"yyyy-MM-dd")}}var r=o.a.F(new Date,"yyyy-MM-dd"),l={name:"mgDaySelect",props:{loading:!1,value:String},data:function(){return{disabled:!0}},mounted:function(){},methods:{prev:function(){if(!this.loading){var e=i(this.value).prev;this.$emit("input",e),this.$emit("on-change",e)}this.disabled=e==r},next:function(){if(!this.loading){var e=i(this.value).next;this.$emit("input",e),this.$emit("on-change",e)}this.disabled=e==r}}},c=(n(617),n(1)),s=Object(c.a)(l,a,[],!1,null,null,null);s.options.__file="src/components/mg-day-select.vue";t.a=s.exports},810:function(e,t,n){"use strict";var a=n(619);n.n(a).a},811:function(e,t,n){(t=n(10)(!1)).push([e.i,"\n.home-patrol-map {\r\n\twidth: 100%;\r\n\theight: 410px\n}\n.fullscreen .home-patrol-map {\r\n\theight: 100%;\n}\r\n",""]),e.exports=t}}]);