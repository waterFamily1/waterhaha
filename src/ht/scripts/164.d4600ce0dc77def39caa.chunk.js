(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{1274:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"point-list c-main-border"},[a("div",{staticClass:"c-left-border-blue"},[a("div",{staticClass:"c-search-main"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("关键字：")]),t._v(" "),a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"巡检点名称"},on:{"on-enter":t.search},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.searchParams.queryName,callback:function(e){t.$set(t.searchParams,"queryName",e)},expression:"searchParams.queryName"}})],1),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[t._v("区域位置：")]),a("dropdown-tree",{ref:"processTree",attrs:{multiple:!0,url:t.treeApi.getProcessTreeData,width:200},model:{value:t.relProcess,callback:function(e){t.relProcess=e},expression:"relProcess"}})],1),t._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),a("Button",{staticClass:"c-btn-reset",attrs:{type:"primary",shape:"circle"},on:{click:t.searchParamsClean}},[t._v("重置")])],1)])]),t._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("div",{directives:[{name:"role",rawName:"v-role:multiple",value:"point-exp,point-add,point-del",expression:"'point-exp,point-add,point-del'",arg:"multiple"}],staticClass:"c-table-top-btns"},[a("Dropdown",{directives:[{name:"role",rawName:"v-role",value:"point-exp",expression:"'point-exp'"}],on:{"on-click":t.importCode}},[a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",loading:t.expLoading}},[t._v("导出二维码 "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),t._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:"true"}},[t._v("全部巡检点")]),t._v(" "),a("DropdownItem",{attrs:{name:"false"}},[t._v("选中巡检点")])],1)],1),t._v(" "),a("Button",{directives:[{name:"role",rawName:"v-role",value:"point-add",expression:"'point-add'"}],staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle"},on:{click:t.createPatrolPoint}},[t._v("新增")]),t._v(" "),a("Button",{directives:[{name:"role",rawName:"v-role",value:"point-del",expression:"'point-del'"}],staticClass:"c-btn-add",attrs:{type:"default",shape:"circle"},on:{click:t.deletePatrolPoint}},[t._v("删除")]),t._v(" "),a("Button",{directives:[{name:"role",rawName:"v-role",value:"point-add",expression:"'point-add'"}],staticClass:"c-btn-add",attrs:{type:"default",shape:"circle"},on:{click:t.importPatrolPoint}},[t._v("导入")])],1),t._v(" "),a("Table",{ref:"pointTable",attrs:{columns:t.columns,data:t.listData,loading:t.loading,stripe:""},on:{"on-selection-change":t.onSelect}}),t._v(" "),a("Page",{staticClass:"table-page",attrs:{total:t.total,"page-size":t.searchParams.pageSize,current:t.searchParams.currentPage,"show-total":"","show-elevator":""},on:{"on-change":t.pageChange}})],1)])};s._withStripped=!0;var r=a(145),i=a(11),o=a(539),n=a(107),l={components:{dropdownTree:r.a},name:"patrol-point",data:function(){var t=this;return{treeApi:n.a,expLoading:!1,relProcess:{id:"",title:"请选择"},searchParams:{queryName:"",processIds:"",pageSize:10,currentPage:1},columns:[{type:"selection",width:50},{title:"巡检点",key:"patrolPoint"},{title:"描述",key:"description"},{title:"巡检步骤",key:"stepCount",width:100},{title:"区域位置",key:"relatedProcessNames"},{title:"编号",key:"no",width:100},{title:"操作",key:"action",align:"left",width:100,render:function(e,a){return e("div",[i.a.tableBtnStyle(e,(function(){t.showPointDetail(a.row)}),"查看")])}}],total:0,listData:[],selected:[],loading:!1}},methods:{getData:function(){var t=this;this.$setSearchParams((function(e){t.searchParams=e,t.relProcess.id=t.searchParams.processIds,t.relProcess.title=t.searchParams.processNames})),this.loading=!0,this.$http.get(o.a.point,Object.assign({},this.searchParams,{topId:this.$route.params.topId})).then((function(e){t.loading=!1,e&&e.total>=0&&(t.total=e.total,t.listData=e.items?e.items:[])}))},search:function(){this.searchParams.currentPage=1,this.searchParams.processIds=this.relProcess.id,this.searchParams.processNames=this.relProcess.title,this.getData(),this.$addRouteFilter({routeName:"patrol-point",searchParams:this.searchParams})},searchParamsClean:function(){this.relProcess.id="",this.relProcess.title="请选择",this.searchParams.queryName="",this.searchParams.processIds="",this.$cleanRouteFilter()},pageChange:function(t){this.searchParams.currentPage=t,this.getData(),this.$addRouteFilter({routeName:"patrol-point",searchParams:this.searchParams})},createPatrolPoint:function(){this.$router.push({name:"patrol-point-add"})},updatePatrolPoint:function(t){this.$router.push({name:"patrol-point-edit",params:t})},showPointDetail:function(t){this.$router.push({name:"patrol-point-detail",params:t})},onSelect:function(t,e){this.selected=t},deletePatrolPoint:function(){var t=this;if(this.selected.length>0){for(var e=[],a=0;a<this.selected.length;a++)e.push(this.selected[a].id);this.$Modal.confirm({title:"提示",content:"<p>确定要删除？</p>",onOk:function(){t.$http.del(o.a.point+"?ids="+e).then((function(e){e.count&&(t.$Notice.success({title:"成功",desc:"删除成功！",duration:3}),t.search())}))},onCancel:function(){}})}else this.$Notice.warning({title:"警告",desc:"请选中后删除",duration:3})},importCode:function(t){var e=this,a={ids:"",getAll:"true"===t,queryName:this.searchParams.queryName,processIds:this.relProcess.id};if(!a.getAll&&!this.selected.length)return this.$Message.warning("请选择导出巡检点！"),!1;a.ids=this.selected.map((function(t){return t.id})).join(),i.a.download(o.a.getQrcode,a,(function(){e.expLoading=!1}))},importPatrolPoint:function(){this.$router.push({name:"import",params:{id:"patrol-point"}})}},created:function(){i.a.initTableColumnTitle(this.columns),this.search()}},c=a(1),p=Object(c.a)(l,s,[],!1,null,null,null);p.options.__file="src/views/patrol/point/list.vue";e.default=p.exports},539:function(t,e,a){"use strict";var s=a(22),r={getTasks:"/patrol/api/tasks",getTaskDetail:"/patrol/api/tasks",delTasks:"/patrol/api/tasks",modifyTask:"/patrol/api/tasks",stop:"/patrol/api/tasks",updatePatrolTaskPoint:"/patrol/api/task-point-step",plan:"/patrol/api/plans",getPlan:"/patrol/api/plans",updatePlan:"/patrol/api/plans",deletePlan:"/patrol/api/plans",planPath:"/patrol/api/plan-path",releasePlan:"/patrol/api/plans/release",interruptPlan:"/patrol/api/plans/interrupt",statistics:"/patrol/api/tasks/statistics",export:s.a+"/patrol/api/tasks/statistics-export",point:"/patrol/api/points",getQrcode:s.a+"/patrol/api/points/qrcode-export",trace:"/patrol/api/tasks/map-track"};e.a=r}}]);