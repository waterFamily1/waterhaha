(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{1046:function(e,t,a){"use strict";var s=a(746);a.n(s).a},1047:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.comb-modal .modal-search{margin-bottom: 0;}\n.mpoint-all .c-search-main{height: auto;}\r\n/* .comb-modal .ivu-table-header .ivu-checkbox-wrapper{display: none;} */\r\n",""]),e.exports=t},1048:function(e,t,a){"use strict";var s=a(747);a.n(s).a},1049:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.margin-bottom {\r\n    margin-bottom: 20px;\n}\n.div-mt .ivu-tooltip-inner{\r\n    max-width: 270px;\n}\r\n",""]),e.exports=t},1050:function(e,t,a){"use strict";var s=a(748);a.n(s).a},1051:function(e,t,a){(t=a(10)(!1)).push([e.i,'.w300 {\n  width: 300px;\n}\n.form-item-subscribe-list .ivu-form-item-content {\n  border: 1px solid #ddd;\n  border-radius: 5px;\n  padding-left: 10px;\n  padding-bottom: 5px;\n  overflow: hidden;\n}\n.form-item-subscribe-list .ivu-form-item-label:before {\n  content: "*";\n  display: inline-block;\n  margin-right: 4px;\n  line-height: 1;\n  font-family: SimSun;\n  font-size: 13px;\n  color: #ed3f14;\n}\n.button300 {\n  position: absolute;\n  top: 2px;\n  right: -55px;\n}\n.position300 {\n  position: relative;\n}\n',""]),e.exports=t},1132:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c-main-border"},[a("div",{staticClass:"c-left-border-blue"},[a("h3",[e._v(e._s(e.titleName))]),e._v(" "),a("div",{staticClass:"c-btns-right"},[a("Button",{attrs:{type:"primary",shape:"circle",loading:e.submitLoading},on:{click:function(t){return e.handleSubmit("formValidate")}}},[e._v("保存")]),e._v(" "),a("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"default",shape:"circle"},on:{click:e.handleCancle}},[e._v("取消")])],1)]),e._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":80}},[a("Row",{staticClass:"div-mt"},[a("Col",{attrs:{xs:8,sm:8,md:8,lg:8}},[a("FormItem",{attrs:{label:"报警类型:",prop:"alarmType"}},[a("Select",{model:{value:e.formValidate.alarmType,callback:function(t){e.$set(e.formValidate,"alarmType",t)},expression:"formValidate.alarmType"}},e._l(e.alarmTypes,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),a("FormItem",{attrs:{label:"报警对象:",prop:"alarmObject"}},[a("Input",{attrs:{placeholder:"请选择报警对象",readonly:""},on:{"on-focus":e.addComb},model:{value:e.formValidate.alarmObject,callback:function(t){e.$set(e.formValidate,"alarmObject",t)},expression:"formValidate.alarmObject"}})],1),e._v(" "),a("FormItem",{attrs:{label:"订阅方式:",prop:"subscribeMode"}},[a("Select",{attrs:{multiple:""},model:{value:e.subscribeModeValues,callback:function(t){e.subscribeModeValues=t},expression:"subscribeModeValues"}},e._l(e.subscribeModes,(function(t){return a("Option",{key:t.value,attrs:{value:t.value}},[e._v(e._s(t.label))])})),1)],1),e._v(" "),a("FormItem",{staticClass:"orgId",attrs:{label:"阈值:",prop:"threshold"}},[a("Input",{staticStyle:{width:"292px"},attrs:{placeholder:"请输入阈值"},model:{value:e.formValidate.threshold,callback:function(t){e.$set(e.formValidate,"threshold",t)},expression:"formValidate.threshold"}}),e._v(" "),a("label",[e._v("%")]),e._v(" "),a("Tooltip",{style:{position:"absolute",top:"3px",right:"-20px"},attrs:{placement:"right"}},[a("Icon",{attrs:{type:"help-circled",size:"18",color:"#0097cf"}}),e._v(" "),a("div",{attrs:{slot:"content"},slot:"content"},[a("p",[e._v("流量剩余百分比小于等于阈值时触发报警")]),e._v(" "),a("p",[e._v("阈值范围值为1~100之间")])])],1)],1),e._v(" "),a("div",{staticClass:"position300"},[a("FormItem",{staticClass:"form-item-subscribe-list",attrs:{label:"订阅人:",prop:"userId"}},[0==e.subscribeListArray.length?a("span",[e._v(" ")]):e._l(e.subscribeListArray,(function(t,s){return a("Tag",{key:s,attrs:{name:t.value,closable:""},on:{"on-close":e.handleCloseTag}},[e._v(e._s(t.label))])}))],2),e._v(" "),a("Button",{staticClass:"button300",on:{click:e.showSubscribeListModal}},[e._v("选择")])],1)],1)],1)],1)],1),e._v(" "),a("list-comb",{ref:"listComb",on:{"add-click":e.handleCombAdd}}),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,width:"500",closable:!0,title:"报警订阅新增对象"},model:{value:e.subscribeListModalShow,callback:function(t){e.subscribeListModalShow=t},expression:"subscribeListModalShow"}},[a("Form",{ref:"subscribeListForm",attrs:{model:e.forms,rules:e.ruleValidate,"label-width":100}},[a("Row",[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"所属组织",prop:"siteId",required:""}},[a("dropdown-tree",{attrs:{url:e.processTreeApi,query:e.query},on:{input:e.chooseSite},model:{value:e.forms.site,callback:function(t){e.$set(e.forms,"site",t)},expression:"forms.site"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"用户",prop:"userIds"}},[a("Select",{staticClass:"w300",attrs:{"label-in-value":!0,multiple:""},on:{"on-change":e.userSelectChange},model:{value:e.forms.userIds,callback:function(t){e.$set(e.forms,"userIds",t)},expression:"forms.userIds"}},e._l(e.users,(function(t,s){return a("Option",{key:s,attrs:{value:t.id}},[e._v(e._s(t.name))])})),1)],1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"c-modal-footer-btns"},[a("Button",{attrs:{type:"default",shape:"circle",size:"large"},on:{click:function(t){e.subscribeListModalShow=!1}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle",size:"large"},on:{click:e.choose}},[e._v("确定")])],1)])],1)],1)};s._withStripped=!0;var i=a(145),r=a(11),o=a(107),l=a(148),n=a(569),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.showModal?a("div",[a("Modal",{ref:"modal1",staticClass:"mpoint-all comb-modal",attrs:{title:"选择报警对象","mask-closable":!1,width:"650"},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[a("div",{staticClass:"c-search-main modal-search"},[a("Row",[a("Form",{attrs:{"label-width":120},nativeOn:{submit:function(e){e.preventDefault()}}},[a("FormItem",{attrs:{label:"关键字："}},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"ICCID"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchButton(t)}},model:{value:e.search.queryName,callback:function(t){e.$set(e.search,"queryName",t)},expression:"search.queryName"}}),e._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.searchButton}},[e._v("搜索")])],1)],1)],1)],1)],1),e._v(" "),a("Table",{ref:"selection",attrs:{width:"100%",columns:e.columnsData,data:e.data,loading:e.loading,size:"small",stripe:""},on:{"on-select-all":e.onSelect,"on-select":e.onSelect,"on-selection-change":e.onSelect}}),e._v(" "),a("div",{staticStyle:{padding:"10px 0","text-align":"right"}},[a("Page",{ref:"page",attrs:{total:e.total,"page-size":e.search.pageSize,current:e.search.currentPage,"show-total":"","show-elevator":"",size:"small"},on:{"on-change":e.modalPageChange}})],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"c-modal-footer-btns"},[a("Button",{attrs:{type:"default",shape:"circle",size:"large"},on:{click:function(t){e.showModal=!1}}},[e._v("取消")]),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle",size:"large",loading:e.submitLoading},on:{click:e.chooses}},[e._v("确定")])],1)])],1)],1):e._e()};c._withStripped=!0;var u={data:function(){return{submitLoading:!1,showModal:!1,hasEdit:!1,formInline:{combineName:""},search:{queryName:"",currentPage:1,pageSize:10},columnsData:[{type:"selection",width:60,align:"left"},{title:"报警对象",key:"iccid",align:"left"},{title:"备注",key:"remark"}],data:[],total:0,loading:!1,selectedTemp:[],combineId:""}},created:function(){r.a.initTableColumnTitle(this.columnsData)},methods:{reset:function(){this.search={queryName:"",currentPage:1,pageSize:10},this.selectedTemp=[],this.combineId=""},searchButton:function(){this.search.currentPage=1,this.getModalData()},getModalData:function(){var e=this;this.loading=!0,this.$http.get(n.a.sims,this.search).then((function(t){e.data=t.items,e.total=t.total,e.loading=!1}))},searchPoints:function(){this.search.currentPage=1,this.getModalData()},modalPageChange:function(e){this.search.currentPage=e,this.getModalData()},chooses:function(){this.submitLoading=!0;var e=[],t=this.selectedTemp;return t.forEach((function(t){e.push(t.iccid)})),e.length?this.hasEdit&&e.length>1?(this.$Notice.info({title:"编辑状态下只能选择一个报警对象"}),void(this.submitLoading=!1)):(this.showModal=!1,this.submitLoading=!1,this.selectedTemp=[],void this.$emit("add-click",t)):(this.$Notice.info({title:"未选择任意报警对象"}),void(this.submitLoading=!1))},onSelect:function(e,t){this.selectedTemp=e}}},d=(a(1046),a(1)),m=Object(d.a)(u,c,[],!1,null,null,null);m.options.__file="src/views/sim/sim-alarm/select-object-list.vue";var h=m.exports,b={components:{dropdownTree:i.a,listComb:h},data:function(){return{submitLoading:!1,ISADD:!0,titleName:"新增报警",treeApi:o.a,isShowOrgTree:!1,subscribeListModalShow:!1,processTreeApi:o.a.getOrgTreeData,userSelectArry:[],subscribeListArray:[],users:{},query:{exNoAuth:!0},subscribeModeValues:[1],formValidate:{threshold:"",alarmType:1,subscribeMode:"",alarmObject:"",userId:""},forms:{site:{id:"",title:"请选择"},userIds:[]},alarmTypes:[{label:"单卡报警",value:1}],subscribeModes:[{label:"系统消息",value:1},{label:"短信",value:2}],ruleValidate:{alarmObject:[{required:!0,validator:function(e,t,a){""!=t?a():a(new Error("请选择报警对象"))}}],threshold:[{validator:function(e,t,a){""!=t?t>=1&&t<=100?a():a(new Error("与之范围为1~100")):a(new Error("请输入阈值"))},trigger:"blur"}],siteId:[{validator:function(e,t,a){t?a():a(new Error("请选择所属组织"))}}],userIds:[{required:!0,message:"请选择用户"}]},defaultProps:{children:"children",label:"title"}}},mounted:function(){var e=this;this.$route.params&&this.$route.params.id?this.ISADD=!1:this.ISADD=!0,this.ISADD||(this.titleName="编辑报警",this.$http.get(n.a.getAlarm+"?id="+this.$route.params.id).then((function(t){e.formValidate=t;var a=t.subscribeMode.split(",");2==a.length?e.subscribeModeValues=[1,2]:e.subscribeModeValues=[Number(a[0])],e.subscribeListArray=t.alarmUsers})))},methods:{filterNode:function(e,t){return!e||-1!==t.title.indexOf(e)},handleSubmit:function(e){var t=this;this.$refs[e].validate((function(e){if(e){if(2==t.subscribeModeValues.length?t.formValidate.subscribeMode="1,2":t.formValidate.subscribeMode=t.subscribeModeValues[0]+"",t.subscribeListArray.length<=0)return void t.$Notice.warning({title:"警告",desc:"订阅人不可为空",duration:3});t.submitLoading=!0,t.formValidate.userId=t.subscribeListArray.map((function(e){return e.value})).join(","),t.ISADD?t.$http.post(n.a.addAlarm,t.formValidate).then((function(e){e?(t.$Notice.success({title:"成功",desc:"添加成功",duration:3}),t.$router.push({name:"sim-alarm"})):t.submitLoading=!1})):t.$http.put(n.a.updateAlarm,t.formValidate).then((function(e){e?(t.$Notice.success({title:"成功",desc:"添加成功",duration:3}),t.$router.push({name:"sim-alarm"})):t.submitLoading=!1}))}}))},handleReset:function(e){this.$refs[e].resetFields()},handleCancle:function(){this.$router.push({name:"sim-alarm"})},contactUs:function(){this.$router.push({name:"feedback"})},chooseSite:function(e){var t=this;e.id&&(this.forms.siteId=e.id,this.$http.get(l.a.getUsers,{orgId:e.id,pageSize:0}).then((function(e){t.users=e.items})))},showSubscribeListModal:function(){this.$refs.subscribeListForm.resetFields(),this.forms.site.id="",this.forms.site.title="请选择",this.forms.userIds=[],this.users={},this.subscribeListModalShow=!0},userSelectChange:function(e){this.userSelectArry=e},choose:function(){var e=this;this.$refs.subscribeListForm.validate((function(t){t&&(e.subscribeListArray=e.mergeArray(e.userSelectArry,e.subscribeListArray),e.subscribeListModalShow=!1)}))},mergeArray:function(e,t){for(var a=0;a<e.length;a++)for(var s=0;s<t.length;s++)e[a].value==t[s].value&&(e[a].isRepeat=!0);return t.concat(e).filter((function(e){return 1!=e.isRepeat}))},handleCloseTag:function(e,t){var a=this.subscribeListArray.filter((function(e){return e.value!=t}));this.subscribeListArray=a},addComb:function(){var e=this;this.$nextTick((function(){e.$route.params.data=[],e.$refs.listComb.showModal=!0,e.$refs.listComb.hasEdit=!e.ISADD,e.$refs.listComb.formInline.combineName="",e.$refs.listComb.search.currentPage=1,e.$refs.listComb.search.queryName="",e.$refs.listComb.reset(),e.$refs.listComb.getModalData()}))},handleCombAdd:function(e){var t=[];e.forEach((function(e){t.push(e.iccid)})),this.formValidate.alarmObject=t.join(",")}}},p=(a(1048),a(1050),Object(d.a)(b,s,[],!1,null,null,null));p.options.__file="src/views/sim/sim-alarm/alarm-edit.vue";t.default=p.exports},569:function(e,t,a){"use strict";var s=a(22),i={sims:"/box/api/sim-manager/cards",updateData:"/box/api/sim-manager/cards/update",addCard:"/box/api/sim-manager/cards",getDetail:"/box/api/sim-manager/cards/detail",getChartData:"/box/api/sim-manager/card/flow",deleteCards:"/box/api/sim-manager/cards",getExcel:s.a+"/box/api/sim-manager/excel-temlate-down",importExcel:s.a+"/box/api/sim-manager/excel-import",saveExcelData:"/box/api/sim-manager/excel-data-save",cancelExcelData:"/box/api/sim-manager/excel-data-cancel",alarms:"/box/api/sim-alarm/alarms",addAlarm:"/box/api/sim-alarm/alarms",getAlarm:"/box/api/sim-alarm/alarm",updateAlarm:"/box/api/sim-alarm/alarm",deleteAlarms:"/box/api/sim-alarm/alarms"};t.a=i},746:function(e,t,a){var s=a(1047);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(17).default)("d103e01c",s,!1,{})},747:function(e,t,a){var s=a(1049);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(17).default)("03fb2ef0",s,!1,{})},748:function(e,t,a){var s=a(1051);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(17).default)("4dfb9688",s,!1,{})}}]);