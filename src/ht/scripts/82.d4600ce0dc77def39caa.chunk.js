(window.webpackJsonp=window.webpackJsonp||[]).push([[82],{1230:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"equ-status c-main-border"},[a("div",{staticClass:"c-left-border-blue"},[a("div",{staticClass:"c-search-main"},[a("div",{staticClass:"c-form-item"},[a("label",[e._v("关键字：")]),a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"编号/名称/型号"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}})],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[e._v("区域位置：")]),a("dropdown-tree",{attrs:{url:e.treeApi.getProcessTreeData,multiple:!0,width:200},model:{value:e.relProcess,callback:function(t){e.relProcess=t},expression:"relProcess"}})],1),e._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[e._v("设备类型：")]),a("mg-equ-type",{model:{value:e.equTypes,callback:function(t){e.equTypes=t},expression:"equTypes"}})],1),e._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.advSearch=!e.advSearch}}},[a("Icon",{directives:[{name:"show",rawName:"v-show",value:!e.advSearch,expression:"!advSearch"}],attrs:{type:"ios-arrow-down"}}),a("Icon",{directives:[{name:"show",rawName:"v-show",value:e.advSearch,expression:"advSearch"}],attrs:{type:"ios-arrow-up"}}),e._v("高级搜索")],1),e._v(" "),a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),a("Button",{staticClass:"c-btn-reset",attrs:{type:"primary",shape:"circle"},on:{click:e.searchParamsClean}},[e._v("重置")])],1)]),e._v(" "),a("collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.advSearch,expression:"advSearch"}],staticClass:"c-adv-search"},[a("div",{staticClass:"c-adv-search-row"},[a("div",{staticClass:"c-form-item c-form-item-tab"},[a("label",[e._v("运行状态：")]),e._v(" "),a("mg-tab",{attrs:{groups:e.runStates,multiple:!0,entire:!0},on:{"on-click":e.search},model:{value:e.maintainState,callback:function(t){e.maintainState=t},expression:"maintainState"}})],1)]),e._v(" "),a("div",{staticClass:"c-adv-search-row"},[a("div",{staticClass:"c-form-item c-form-item-tab"},[a("label",[e._v("ABC类：")]),e._v(" "),a("mg-tab",{attrs:{groups:e.abc,multiple:!0,entire:!0},on:{"on-click":e.search},model:{value:e.abcs,callback:function(t){e.abcs=t},expression:"abcs"}})],1)])])])],1),e._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("div",{directives:[{name:"role",rawName:"v-role",value:"equ-state-exp",expression:"'equ-state-exp'"}],staticClass:"c-table-top-btns"},[a("Dropdown",{staticClass:"fl export-box",on:{"on-click":e.importCode}},[a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle"}},[e._v("导出二维码 "),a("Icon",{attrs:{type:"arrow-down-b"}})],1),e._v(" "),a("DropdownMenu",{attrs:{slot:"list"},slot:"list"},[a("DropdownItem",{attrs:{name:"true"}},[e._v("全部设备")]),e._v(" "),a("DropdownItem",{attrs:{name:"false"}},[e._v("选中设备")])],1)],1)],1),e._v(" "),a("Table",{attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:""},on:{"on-selection-change":e.getSelect}}),e._v(" "),a("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":""},on:{"on-change":e.pageChange}})],1),e._v(" "),a("Modal",{attrs:{title:"导出二维码"},model:{value:e.showCodeProgress,callback:function(t){e.showCodeProgress=t},expression:"showCodeProgress"}},[a("p",[e._v("正在导出中，请稍后...")]),e._v(" "),a("Progress",{attrs:{percent:e.codeProgress}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};s._withStripped=!0;var i=a(23),n=a(519),r=a(145),o=a(781),c=a(524),l=a(11),d=a(107),p=a(532),u={components:{CollapseTransition:n.a,dropdownTree:r.a,mgEquType:o.a,mgTab:c.a},name:"equ-status-list",data:function(){var e=this,t=this;return{advSearch:!1,treeApi:d.a,showCodeProgress:!1,codeProgressId:0,codeProgress:0,codeTimer:null,operations:"",equTypes:[],maintainState:[],abcs:[],searchParams:{typeIds:"",queryName:"",processIds:"",maintainState:"",abcs:"",pageSize:10,currentPage:1},relProcess:{id:"",title:"请选择"},listData:[],total:0,loading:!1,columns:[{type:"selection",width:50},{title:"设备名称",key:"name"},{title:"设备编号",key:"code"},{title:"设备类型",key:"typeName",width:100},{title:"型号",key:"model",width:100},{title:"所属组织",key:"orgName",width:120},{title:"ABC类",key:"abc",width:100,render:function(e,a){return e("span",t.abcText[a.row.abc])}},{title:"区域位置",key:"processName",width:140},{title:"运行状态",key:"state",width:80,render:function(e,a){return e("span",t.runStatesText[a.row.maintainState])}},{title:"资产状态",key:"state",width:80,render:function(e,a){return e("span",t.stateText[a.row.state])}},{title:"操作",key:"action",width:80,render:function(t,a){return t("div",[l.a.tableBtnStyle(t,(function(){e.$router.push({name:"equ-status-detail",params:{id:a.row.id}})}),"查看")])}}],selectList:[]}},computed:Object(i.b)({stateText:function(e){return e.map.equ.statesText},abc:function(e){return e.map.equ.abc},abcText:function(e){return e.map.equ.abcText},runStates:function(e){return e.map.equ.runStates},runStatesText:function(e){return e.map.equ.runStatesText}}),methods:{getData:function(){var e=this;this.$setSearchParams((function(t){e.searchParams=t,e.relProcess.id=t.processIds,e.relProcess.title=t.processNames||"请选择",e.equTypes=t.equTypes||[]})),this.loading=!0,this.$http.get(p.a.getAllEqu,this.searchParams).then((function(t){t.items&&(e.listData=t.items,e.total=t.total,e.operations=window.localStorage.operations),e.loading=!1}))},search:function(){var e=this.equTypes.map((function(e){return e.id})).join();this.searchParams=Object.assign({},this.searchParams,{currentPage:1,processIds:this.relProcess.id,processNames:this.relProcess.title,typeIds:e}),this.searchParams.equTypes=this.equTypes.map((function(e){return{id:e.id,name:e.name}})),this.searchParams.maintainState=this.maintainState.join(),this.searchParams.abcs=this.abcs.join(),this.$addRouteFilter({routeName:"equ-status-list",searchParams:this.searchParams}),this.getData()},searchParamsClean:function(){this.searchParams.queryName="",this.relProcess.id="",this.relProcess.title="请选择",this.equTypes=[],this.maintainState=[],this.abcs=[],this.$cleanRouteFilter()},pageChange:function(e){this.searchParams.currentPage=e,this.$addRouteFilter({routeName:"equ-status-list",searchParams:this.searchParams}),this.getData()},getSelect:function(e){this.selectList=e},importCode:function(e){var t=this;if("true"!=e&&0==this.selectList.length)return this.$Message.warning("请选择导出设备！"),!1;this.codeProgressId=0,this.codeProgress=0,clearInterval(this.codeTimer);var a={all:!1,ids:"",queryName:this.searchParams.queryName,processIds:this.relProcess.id,typeIds:this.equTypes.map((function(e){return e.id})).join()};"true"==e?a.all=!0:a.ids=this.selectList.map((function(e){return e.id})).join(),this.$http.get(p.a.qrcodeExportStart,a).then((function(e){t.showCodeProgress=!0,t.codeProgressId=e.key,t.codeTimer=setInterval((function(){t.$http.get(p.a.qrcodeExportProgress,{key:t.codeProgressId}).then((function(e){if(t.codeProgress=parseInt(e.finished/e.total*100),e.total==e.finished){clearInterval(t.codeTimer);var a=p.a.qrcodeExportDownload+"?key="+t.codeProgressId;l.a.download(a),t.showCodeProgress=!1}}))}),1e3)}))}},created:function(){l.a.initTableColumnTitle(this.columns)},mounted:function(){this.getData()}},m=a(1),h=Object(m.a)(u,s,[],!1,null,null,null);h.options.__file="src/views/equ/status/list.vue";t.default=h.exports},516:function(e,t,a){var s=a(526);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(17).default)("5a7c571a",s,!1,{})},519:function(e,t,a){"use strict";function s(e,t){if(!e||!t)return!1;if(-1!==t.indexOf(" "))throw new Error("className should not contain space.");return e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1}function i(e,t){if(e){for(var a=e.className,i=(t||"").split(" "),n=0,r=i.length;n<r;n++){var o=i[n];o&&(e.classList?e.classList.add(o):s(e,o)||(a+=" "+o))}e.classList||(e.className=a)}}function n(e,t){if(e&&t){for(var a=t.split(" "),i=" "+e.className+" ",n=0,r=a.length;n<r;n++){var o=a[n];o&&(e.classList?e.classList.remove(o):s(e,o)&&(i=i.replace(" "+o+" "," ")))}e.classList||(e.className=trim(i))}}var r={beforeEnter:function(e){i(e,"collapse-transition"),e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height="0",e.style.paddingTop=0,e.style.paddingBottom=0},enter:function(e){e.dataset.oldOverflow=e.style.overflow,0!==e.scrollHeight?(e.style.height=e.scrollHeight+"px",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom):(e.style.height="",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom),e.style.overflow="hidden"},afterEnter:function(e){n(e,"collapse-transition"),e.style.height="",e.style.overflow=e.dataset.oldOverflow},beforeLeave:function(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.height=e.scrollHeight+"px",e.style.overflow="hidden"},leave:function(e){0!==e.scrollHeight&&(i(e,"collapse-transition"),e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave:function(e){n(e,"collapse-transition"),e.style.height="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom}};t.a={name:"CollapseTransition",functional:!0,render:function(e,t){var a=t.children;return e("transition",{on:r},a)}}},524:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cmp-tab",class:{"cmp-tab-underline":e.underline}},e._l(e.items,(function(t){return a("a",{key:t.value,class:{active:e.activeIds.indexOf(t.value)>-1},attrs:{href:"javascript:;"},on:{click:function(a){return e.selectTab(t)}}},[e._v(e._s(t.label))])})),0)};function i(e){return function(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}s._withStripped=!0;var n=null,r={name:"mgTab",props:{groups:Array,value:Array,multiple:{type:Boolean,default:!1},entire:{type:Boolean,default:!1},underline:Boolean},data:function(){return{activeIds:this.value,items:i(this.groups)}},watch:{groups:function(e){this.entire?this.items=[{label:"全部",value:n}].concat(i(e)):this.items=e},value:function(e){this.activeIds=e}},mounted:function(){this.entire&&this.items.unshift({label:"全部",value:n})},methods:{isSelected:function(e){return this.activeIds.indexOf(e)>-1},removeFromSelected:function(e){var t=this;this.activeIds.forEach((function(a,s){a==e&&t.activeIds.splice(s,1)}))},selectTab:function(e){this.entire&&e.value===n?this.activeIds=[n]:this.multiple?this.isSelected(e.value)?this.removeFromSelected(e.value):(this.activeIds.push(e.value),this.entire&&this.removeFromSelected(n)):(this.activeIds=[],this.activeIds.push(e.value)),this.$emit("input",this.activeIds),this.$emit("on-click",this.activeIds)},setValue:function(e){this.activeIds=e,this.$emit("input",this.activeIds)}}},o=(a(525),a(1)),c=Object(o.a)(r,s,[],!1,null,null,null);c.options.__file="src/components/mg-tab.vue";t.a=c.exports},525:function(e,t,a){"use strict";var s=a(516);a.n(s).a},526:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.cmp-tab {\r\n\tdisplay: inline-block;\n}\n.cmp-tab a {\r\n\tmargin-right: 20px;\t\r\n\tcolor: #576374;\n}\n.cmp-tab .active{\r\n\tcolor: #4B7EFE;\n}\n.cmp-tab-underline a {\r\n\tpadding: 2px 1px;\r\n\ttext-align: center;\n}\n.cmp-tab-underline .active  {\r\n\tborder-bottom: 2px solid #4B7EFE;\n}\r\n",""]),e.exports=t},532:function(e,t,a){"use strict";var s=a(22),i={getAllEqu:"/equipment/api/equipments",deleteEqu:"/equipment/api/equipments",getEquDetail:"/equipment/api/equipments/detail/",saveEqu:"/equipment/api/equipments/detail",delAttachment:"/equipment/api/equ-attachs",getSingleEqu:"/equipment/api/equipments/",getParentEqu:"/equipment/api/equipments/parent/",getEquState:"/equipment/api/equipments/state/",getRemarkByEqu:"/equipment/api/equ-comments",addRemarkByEqu:"/equipment/api/equ-comments",pointsByEqu:"/equipment/api/equipments/mpoint",alarmByEqu:"/equipment/api/alarm-records",equRelPoints:"/equipment/api/mpoints/dropdown-box",getQrcode:s.a+"/equipment/api/equipments/qrcode-export",import:"/equipment/api/excel-import",saveExcelData:"/equipment/api/excel-data-save",cancelExcelData:"/equipment/api/excel-data-cancel",getExcel:s.a+"/equipment/api/excel-temlate-down",importExcel:s.a+"/equipment/api/excel-import",qrcodeExportStart:"/equipment/api/equipments/qrcode-export",qrcodeExportProgress:"/equipment/api/equipments/qrcode-export/progress",qrcodeExportDownload:s.a+"/equipment/api/equipments/qrcode-export/download",equTypeTree:"/equipment/api/equ-types/tree",equTypes:"/equipment/api/equ-types",equType:"/equipment/api/equ-types",gatewayParseMethod:"/box/api/terminals/parse-method",getTerminalList:"/box/api/terminals",terminalDetail:"/box/api/terminals/",addTerminal:"/box/api/terminals",delTerminal:"/box/api/terminals",simSelect:"/box/api/sim-manager/cards/select"};t.a=i},586:function(e,t,a){var s=a(652);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,a(17).default)("892b5f38",s,!1,{})},651:function(e,t,a){"use strict";var s=a(586);a.n(s).a},652:function(e,t,a){(t=a(10)(!1)).push([e.i,"\n.cmp-equ-type {\r\n    display: inline-block;\r\n    position: relative;\n}\n.cmp-equ-type-input {\r\n    display: inline-block;\r\n    height: 30px;\n}\n.cmp-equ-type-selected {\r\n    position: absolute;\r\n    left: 210px;\r\n    top: 0;\r\n\r\n    display: block;\r\n    padding-right: 15px;\r\n\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    max-width: 200px;\r\n    overflow: hidden;\r\n    color: #4b7efe;\r\n    text-decoration: underline;\n}\n.cmp-equ-type-selected .ivu-icon {\r\n    position: absolute;\r\n    right: 2px;\r\n    top: 2px;\r\n    background-color: #FFF;\n}\n.cmp-equ-type-list {\r\n    z-index: 901;\r\n    position: absolute;\r\n    top: 32px;\r\n    right: 0;\r\n    width: 550px;\r\n    max-height: 400px;\r\n    overflow: auto;\r\n    padding: 5px 10px;\r\n    background-color: #FFF;\r\n    box-shadow: 1px 1px 5px #999;\r\n    border-radius: 3px;\n}\n.cmp-equ-type-mod {\r\n    margin-top: 15px;\r\n    padding-bottom: 10px;\n}\n.cmp-equ-type-header {\r\n    height: 25px;\n}\n.cmp-equ-type-subtitle{\r\n    display: inline-block;\r\n    padding: 0 3px;\r\n    cursor: pointer;\r\n    font-weight: 700;\n}\n.cmp-equ-type-more {\r\n    float: right;\r\n    font-weight: 100;\r\n    color: #999;\r\n    font-size: 12px;\n}\n.cmp-equ-type-items span {\r\n    display: inline-block;\r\n    margin-right: 20px;\r\n    cursor: pointer;\r\n    padding: 0 3px;\n}\n.cmp-equ-type-list .selected {\r\n    background-color: #dbe5ff;\n}\r\n\r\n",""]),e.exports=t},781:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.hide,expression:"hide"}],staticClass:"cmp-equ-type"},[a("div",{staticClass:"cmp-equ-type-input"},[a("Input",{staticStyle:{width:"200px"},attrs:{placeholder:"搜索设备类型",clearable:""},on:{"on-focus":function(t){e.isShown=!0},"on-change":e.keyChange},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShown,expression:"isShown"}],staticClass:"cmp-equ-type-list"},[e.loading?a("Spin",{attrs:{size:"small",fix:""}}):e._e(),e._v(" "),e._l(e.datas,(function(t){return a("div",{key:t.id,staticClass:"cmp-equ-type-mod"},[a("h4",{staticClass:"cmp-equ-type-header"},[a("span",{staticClass:"cmp-equ-type-subtitle",class:{selected:t.selected},on:{click:function(a){return e.itemClick(t)}}},[e._v(e._s(t.name))])]),e._v(" "),a("div",{staticClass:"cmp-equ-type-items"},e._l(t.children,(function(t){return a("span",{key:t.id,class:{selected:t.selected},on:{click:function(a){return e.itemClick(t)}}},[e._v(e._s(t.name))])})),0)])})),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:0==e.datas.length,expression:"datas.length == 0"}],staticClass:"c-nodata-tip"},[e._v("暂无数据")])],2),e._v(" "),a("a",{directives:[{name:"show",rawName:"v-show",value:e.selectedStr,expression:"selectedStr"}],staticClass:"cmp-equ-type-selected",attrs:{href:"javascript:;",title:e.selectedStr},on:{click:e.delSelected}},[a("span",{staticClass:"curves-selected-name"},[e._v(e._s(e.selectedStr))]),a("Icon",{attrs:{type:"ios-close-outline",size:"13",color:"#4b7efe"}})],1)])};s._withStripped=!0;var i,n=a(107),r=a(11),o=a(146),c=a(147),l={name:"mgEquType",mixins:[o.a],directives:{clickoutside:c.a},props:{value:Array},watch:{value:function(e){this.selectedData=e||[],this.checkListFromSelected(this.datas)}},computed:{selectedStr:function(){return this.selectedData.map((function(e){return e.name})).join()}},data:function(){return{isShown:!1,datas:[{name:"生产设备",id:1,children:[{name:"特种设备",id:2},{name:"容量器皿",id:3}]},{name:"监控设备",id:4,children:[{name:"特种设3备",id:5},{name:"容4量器皿",id:9}]},{name:"保养设备",id:6,children:[{name:"设3备",id:7},{name:"器皿",id:8}]}],searchKey:"",selectedData:[],loading:!1}},methods:{hide:function(){this.isShown=!1},itemClick:function(e){var t=this;this.checkItemFromSelected(e.id,(function(a,s){a?t.selectedData.splice(s,1):t.selectedData.push(e),e.selected=!a})),this.$emit("input",this.selectedData)},checkItemFromSelected:function(e,t){for(var a=this.selectedData,s=!1,i=0,n=a.length;i<n;i++)if(a[i].id==e){s=!0;break}return t&&t(s,i),s},checkListFromSelected:function(e){var t=this.selectedData,a=e||this.datas;this.setListUnselected(a);!function e(a){a.forEach((function(a){t.forEach((function(e){a.id==e.id&&(a.selected=!0)})),a.children&&e(a.children)}))}(a)},delSelected:function(e){this.selectedData=[],this.setListUnselected(this.datas),this.$emit("input",this.selectedData)},keyChange:function(){var e=this;i&&clearTimeout(i),i=setTimeout((function(){e.getData((function(t){e.checkListFromSelected(t)}))}),200)},setListUnselected:function(e){!function e(t){t.forEach((function(t){t.selected=!1,t.children&&e(t.children)}))}(e)},getData:function(e){var t=this;this.loading=!0,this.$http.get(n.a.getEquType,{queryName:this.searchKey,level:2}).then((function(a){a&&a.items&&(t.datas=r.a.transDataToTree(a.items),e&&e(a.items)),t.loading=!1}))}},mounted:function(){var e=this;this.getData((function(t){e.checkListFromSelected(t)}))}},d=(a(651),a(1)),p=Object(d.a)(l,s,[],!1,null,null,null);p.options.__file="src/components/mg-equ-type.vue";t.a=p.exports}}]);