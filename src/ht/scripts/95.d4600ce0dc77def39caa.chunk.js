(window.webpackJsonp=window.webpackJsonp||[]).push([[95],{1052:function(t,e,a){"use strict";var n=a(749);a.n(n).a},1053:function(t,e,a){(e=a(10)(!1)).push([t.i,'\n.test-mode .list-title {\r\n  color: #333;\r\n  font-size: 14px;\r\n  font-weight: 600;\r\n  height: 40px;\r\n  line-height: 30px;\r\n  position: relative;\r\n  padding-bottom: 10px;\r\n  margin-bottom: 10px;\n}\n.test-mode .list-title:before {\r\n  content: "";\r\n  position: absolute;\r\n  left: -10px;\r\n  bottom: 0;\r\n  right: -10px;\r\n  border-bottom: 1px solid #e9eaec;\n}\n.switch-test-mode-wrap .switch-test-mode-tip-text {\r\n  text-align: center;\r\n  height: 20px;\r\n  line-height: 20px;\r\n  margin: 12px auto 28px;\r\n  color: #4b7efe;\r\n  font-size: 14px;\r\n  font-weight: bold;\n}\n.test-mode-report-download{\n}\n.test-mode-report-download .download-tip-text{\r\n width:274px;\r\n height:40px;\r\n line-height:40px;\r\n margin:30px auto 20px;\r\n font-size: 14px;\r\n color: #333;\r\n text-align: center;\r\n border-bottom:2px dashed #e9eaec;\n}\n.test-mode-report-download .btn-wrap{\r\n  text-align: center;\n}\n.test-mode-report-download .pdf-btn{\r\n  width:160px;\r\n  height:40px;\r\n  margin-right:10px;\r\n  background-color: #8691fd;\n}\n.test-mode-report-download .word-btn{\r\n  width:160px;\r\n  height:40px;\n}\r\n',""]),t.exports=e},1211:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"c-main-border test-mode"},[a("div",{staticClass:"c-left-border-blue"},[a("div",{staticClass:"c-search-main"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("创建时间：")]),t._v(" "),a("datepicker-ranger",{attrs:{width:"110px"},model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[t._v("区域位置：")]),t._v(" "),a("dropdown-tree",{attrs:{url:t.processTreeApi,width:160,multiple:!1},model:{value:t.site,callback:function(e){t.site=e},expression:"site"}})],1),t._v(" "),a("div",{staticClass:"c-adv-search-btn"},[a("Button",{attrs:{type:"primary",shape:"circle"},on:{click:t.search}},[t._v("搜索")]),t._v(" "),a("Button",{staticClass:"c-btn-reset",attrs:{type:"primary",shape:"circle"},on:{click:t.searchParamsClean}},[t._v("重置")])],1)])]),t._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("h3",{staticClass:"list-title"},[t._v("测试列表")]),t._v(" "),a("div",{staticClass:"c-table-top-btns"},[t.isInTestMode?t._e():a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",loading:t.addLoading},on:{click:t.addTestMode}},[t._v("新建")]),t._v(" "),t.isInTestMode?a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",loading:t.closeLoading},on:{click:t.closeTestModeBtn}},[t._v("关闭测试模式")]):t._e()],1),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.listData,loading:t.loading,stripe:""}}),t._v(" "),a("Page",{staticClass:"table-page",attrs:{total:t.total,"page-size":t.searchParams.pageSize,current:t.searchParams.currentPage,"show-total":"","show-elevator":""},on:{"on-change":t.pageChange}})],1),t._v(" "),a("Modal",{staticClass:"switch-test-mode-wrap",attrs:{width:"368",title:"提示"},model:{value:t.modalShown,callback:function(e){t.modalShown=e},expression:"modalShown"}},[a("div",{staticClass:"switch-test-mode-tip-text"},[t._v("平台将切换至测试模式")]),t._v(" "),a("Form",{ref:"addForm",attrs:{model:t.params,rules:t.formRules,"label-width":110}},[a("div",{staticClass:"c-form-row-1col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"duration",label:"自动解除时间"}},[a("Select",{staticStyle:{width:"200px"},model:{value:t.params.duration,callback:function(e){t.$set(t.params,"duration",e)},expression:"params.duration"}},t._l(t.timeType,(function(e,n){return a("Option",{key:e.value,attrs:{value:e.value}},[t._v(t._s(e.label))])})),1)],1)],1)]),t._v(" "),a("div",{staticClass:"c-form-row-1col"},[a("div",{staticClass:"c-form-item"},[a("FormItem",{attrs:{prop:"siteId",label:"添加区域位置"}},[a("dropdown-tree",{attrs:{url:t.processTreeApi,width:200,multiple:!0},on:{input:t.chooseSite},model:{value:t.params.site,callback:function(e){t.$set(t.params,"site",e)},expression:"params.site"}})],1)],1)])]),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("div",{staticClass:"c-modal-footer-btns"},[a("Button",{attrs:{type:"default",shape:"circle",size:"large"},on:{click:function(e){t.modalShown=!1}}},[t._v("否")]),t._v(" "),a("Button",{attrs:{type:"primary",shape:"circle",size:"large"},on:{click:t.confirm}},[t._v("是")])],1)])],1),t._v(" "),a("Modal",{staticClass:"test-mode-report-download",attrs:{width:"392",title:"报告下载"},model:{value:t.modalShowByReport,callback:function(e){t.modalShowByReport=e},expression:"modalShowByReport"}},[a("div",{staticClass:"download-tip-text"},[t._v("点所需文件格式进行下载")]),t._v(" "),a("div",{staticClass:"btn-wrap"},[a("Button",{staticClass:"pdf-btn",attrs:{type:"primary",shape:"circle",size:"large"},on:{click:function(e){return t.downReport(2)}}},[t._v("PDF文件")]),t._v(" "),a("Button",{staticClass:"word-btn",attrs:{type:"primary",shape:"circle",size:"large"},on:{click:function(e){return t.downReport(1)}}},[t._v("word文件")])],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"})])],1)};n._withStripped=!0;var r=a(145),i=a(523),s=a(11),o=a(150),d=a(107),l={name:"test-mode",data:function(){var t=this;return{site:{id:"",title:"请选择"},dateRange:{start:"",end:""},testModeId:null,taskId:null,searchParams:{queryName:"",areaId:"",startDate:"",endDate:"",pageSize:10,currentPage:1},columns:[{title:"日期",key:"createDate",width:130,render:function(t,e){return t("span",[s.a.transDateFromServer(e.row.createDate,"yyyy-MM-dd hh:mm:ss").split(" ")[0]])}},{title:"测试开始",key:"startTime",width:110,render:function(t,e){return s.a.tableDatetime(t,e.row.startTime)}},{title:"测试结束",key:"endTime",width:110,render:function(t,e){return s.a.tableDatetime(t,e.row.endTime)}},{title:"测试时长",key:"duration",render:function(t,e){return t("span",e.row.duration+(e.row.durationUnit?e.row.durationUnit:""))}},{title:"区域位置",key:"areaName"},{title:"报警数量",key:"alarmCount"},{title:"测点数量",key:"measuringPointCount"},{title:"操作",key:"act",width:120,render:function(e,a){var n=[];return 1==a.row.relieveFlag&&n.push(s.a.tableBtnStyle(e,(function(){t.openDownReport(a.row.taskId)}),"报告")),n.push(s.a.tableBtnStyle(e,(function(){t.$router.push({name:"test-mode-detail",params:{id:a.row.id||0}})}),"查看")),e("div",n)}}],listData:[],loading:!1,total:0,isInTestMode:!1,modalShown:!1,modalShowByReport:!1,timeType:[{value:3,label:"3小时"},{value:6,label:"6小时"},{value:12,label:"12小时"},{value:24,label:"24小时"}],params:{site:{id:"",title:"请选择"},duration:3,durationUnit:"h"},formRules:{siteId:[{required:!0,validator:function(t,e,a){e?a():a(new Error("请选择区域位置"))}}],duration:[{required:!0,message:"请选择自动解除时间",trigger:"change",type:"number"}]},processTreeApi:d.a.getProcessTreeData,addLoading:!1,closeLoading:!1}},methods:{getList:function(){var t=this;this.loading=!0,this.$http.get(o.a.getTestMode,this.searchParams).then((function(e){t.listData=e.items||[],t.total=e.total,t.loading=!1}))},search:function(){this.searchParams.areaId=this.site.id,this.searchParams.startDate=this.dateRange.start,this.searchParams.endDate=this.dateRange.end,this.searchParams.currentPage=1,this.getList()},searchParamsClean:function(){this.site={id:"",title:"请选择"},this.dateRange={start:"",end:""};this.searchParams=Object.assign({},this.searchParams,{queryName:"",areaId:"",startDate:"",endDate:"",pageSize:10,currentPage:1})},pageChange:function(t){this.searchParams.currentPage=t,this.getList()},addTestMode:function(){this.params={site:{id:"",title:"请选择"},duration:3,durationUnit:"h"},this.modalShown=!0},closeTestModeBtn:function(){var t=this,e=this;this.$Modal.confirm({title:"提示",content:"是否关闭测试模式",onOk:function(){t.closeLoading=!0,t.$http.put(o.a.closeTestMode,{id:e.testModeId}).then((function(){t.closeLoading=!1,t.searchParamsClean(),t.search(),t.testModeId=null,t.$Notice.success({title:"关闭成功"}),t.isInTestMode=!1,t.$parent.$refs["mg-header"].closeTestMode()}))}})},autoCloseTestMode:function(){this.testModeId=null,this.isInTestMode=!1,this.searchParamsClean(),this.search()},chooseSite:function(){this.params.siteId=this.params.site.id},confirm:function(){var t=this,e=this;this.params.siteId=this.params.site.id,this.$refs.addForm.validate((function(a){a&&(t.modalShown=!1,t.addLoading=!0,t.$http.post(o.a.addTestMode,{areaId:e.params.siteId,duration:e.params.duration,durationUnit:e.params.durationUnit}).then((function(a){t.addLoading=!1,t.searchParamsClean(),t.search(),e.testModeId=a.id,t.isInTestMode=!0,e.$parent.$refs["mg-header"].openTestMode(a.endTime)})))}))},openDownReport:function(t){this.taskId=t,this.modalShowByReport=!0},downReport:function(t){var e=this.taskId||"",a=t;this.modalShowByReport=!1,window.open(o.a.maintainReportExport+"?maintainTaskId="+e+"&type="+a)}},components:{dropdownTree:r.a,datepickerRanger:i.a},created:function(){var t=this;s.a.initTableColumnTitle(this.columns),this.getList(),this.$http.get(o.a.checkInTest,{}).then((function(e){1==e.isInTestPatter&&(t.testModeId=e.id,t.isInTestMode=!0)}))}},c=(a(1052),a(1)),u=Object(c.a)(l,n,[],!1,null,null,null);u.options.__file="src/views/system/test-mode/list.vue";e.default=u.exports},515:function(t,e,a){var n=a(522);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(17).default)("43cd0b0e",n,!1,{})},517:function(t,e,a){"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r={F:function(t,e){if(!t)return"";"object"!=n(t)&&(t=new Date(t)),e=e||"yyyy-MM-dd";var a=t.getFullYear().toString(),r={M:t.getMonth()+1,d:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()};for(var i in e=e.replace(/(y+)/gi,(function(t,e){return a.substr(4-Math.min(4,e.length))})),r)e=e.replace(new RegExp("("+i+"+)","g"),(function(t,e){return r[i]<10&&e.length>1?"0"+r[i]:r[i]}));return e},str2Date:function(t){if(t)return"object"!=n(t)?new Date(t):t},firstDayByWeek:function(t){var e=r.str2Date(t)||new Date,a=e.getDay(),n=(0==a?7:a)-1;return r.midnight(new Date(e.getTime()-24*n*60*60*1e3))},firstDayByMonth:function(t){var e=r.str2Date(t)||new Date;return r.midnight(new Date(e.getFullYear(),e.getMonth(),1))},firstDayByYear:function(t){var e=r.str2Date(t)||new Date;return r.midnight(new Date(e.getFullYear(),0,1))},countDateByStep:function(t,e,a,n){t=r.formatePolyfill(t);var i,s=r.str2Date(t)||new Date(t),o=s.getTime(),d=(new Date).getTime();switch(a){case"day":i=o+864e5*e;break;case"week":i=o+6048e5*e;break;case"month":i=new Date(s.getFullYear(),s.getMonth()+e,s.getDate()).getTime(),n&&(i=new Date(s.getFullYear(),s.getMonth()+e,s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()).getTime());break;case"year":i=new Date(s.getFullYear()+e,s.getMonth(),s.getDate()).getTime(),n&&(i=new Date(s.getFullYear()+e,s.getMonth(),s.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()).getTime())}return i>d&&(i=d),n?i:r.midnight(i)},midnight:function(t){return t?r.F(t)+" 00:00:00":""},beforeMidnight:function(t){return t?r.F(t)+" 23:59:59":""},midnightMill:function(t){var e=r.str2Date(t)||new Date;return new Date(r.midnight(e)).getTime()},chain:function(t,e){return r.countDateByStep(t,-1,e)},yearOFyear:function(t){return r.countDateByStep(t,-1,"year")},getPeriods:function(t){var e,a=t.beginDate,n=new Date(r.formatePolyfill(a)),i=n.getTime();switch(t.cycle){case"day":e=i+864e5;break;case"week":e=i+6048e5;break;case"month":e=new Date(n.getFullYear(),n.getMonth()+1,n.getDate(),0,0,0).getTime();break;case"year":e=new Date(n.getFullYear()+1,n.getMonth(),n.getDate(),0,0,0).getTime()}return{min:i,max:new Date(e).getTime()}},formatePolyfill:function(t){return"string"!=typeof t?t:("string"==typeof t&&0==/[TZ]/.test(t)&&(t=t.replace(/-/g,"/")),t)},getTerminalsByMonth:function(t,e){var a,n;return 0==e?(a=new Date(t,0,1,0,0,0),n=new Date(t,11,31,23,59,59)):(a=new Date(t,e-1,1,0,0,0),n=new Date(t,e,0,23,59,59)),{start:a,end:n}},transDateFromServer:function(t,e){return t?("string"==typeof t&&0==/[TZ]/.test(t)&&(t=t.replace(/-/g,"/")),r.F(t,e||"yyyy-MM-dd hh:mm")):""},transDateFromLocale:function(t){return t?("string"==typeof t&&(0==/[TZ]/.test(t)&&(t=t.replace(/-/g,"/")),t=new Date(t)),t.toISOString()):""},strToData:function(t){var e=t.split(" ")[0].split("-"),a=[];return void 0!==t.split(" ")[1]&&(a=t.split(" ")[1].split(":")),new Date(e[0],e[1]-1,e[2],null!==a[0]?a[0]:0,null!==a[1]?a[1]:0,null!==a[2]?a[2]:0)}};e.a=r},521:function(t,e,a){"use strict";var n=a(515);a.n(n).a},522:function(t,e,a){(e=a(10)(!1)).push([t.i,"\n.cmp-datepicker {\r\n\tdisplay: inline-block;\n}\r\n",""]),t.exports=e},523:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cmp-datepicker"},[a("DatePicker",{style:{width:t.width},attrs:{type:"date",placeholder:"开始日期",value:t.dateRange.start,disabled:t.disabled,options:t.startDateOptions},on:{"on-change":t.startDateChange}}),t._v(" "),a("span",[t._v(" - ")]),t._v(" "),a("DatePicker",{style:{width:t.width},attrs:{type:"date",placeholder:"结束日期",value:t.dateRange.end,disabled:t.disabled,options:t.endDateOptions},on:{"on-change":t.endDateChange}})],1)};n._withStripped=!0;var r=a(11),i=a(517),s={name:"datepickerRanger",props:{value:Object,width:String,disabled:{type:Boolean,default:!1},enabled:String},watch:{"value.start":function(t){this.dateRange.start=r.a.transDateFromServer(t,"yyyy-MM-dd")},"value.end":function(t){this.dateRange.end=r.a.transDateFromServer(t,"yyyy-MM-dd")}},data:function(){var t=this,e=i.a.midnightMill();return{dateRange:{start:r.a.transDateFromServer(this.value.start,"yyyy-MM-dd"),end:r.a.transDateFromServer(this.value.end,"yyyy-MM-dd")},startDateOptions:{disabledDate:function(a){return"coming"==t.enabled?a&&a.valueOf()<e:"halfYear"===t.enabled?a&&a.valueOf()<e-15552e6:t.dateRange.end&&a&&a.valueOf()>1*new Date(t.dateRange.end+" 23:59:59")}},endDateOptions:{disabledDate:function(a){var n=1*new Date(t.dateRange.start+" 00:00:00"),r=a&&a.valueOf();return"past"==t.enabled?a&&r>e:t.dateRange.start&&a&&r<n}}}},methods:{startDateChange:function(t){this.dateRange.start=t;var e=this.dateRange.start?r.a.transDateFromLocale(this.dateRange.start+" 00:00:00"):"",a=this.dateRange.end?r.a.transDateFromLocale(this.dateRange.end+" 23:59:59"):"";this.$emit("input",{start:e,end:a}),this.$emit("on-change",{start:e,end:a})},endDateChange:function(t){this.dateRange.end=t;var e=this.dateRange.start?r.a.transDateFromLocale(this.dateRange.start+" 00:00:00"):"",a=this.dateRange.end?r.a.transDateFromLocale(this.dateRange.end+" 23:59:59"):"";this.$emit("input",{start:e,end:a}),this.$emit("on-change",{start:e,end:a})}}},o=(a(521),a(1)),d=Object(o.a)(s,n,[],!1,null,null,null);d.options.__file="src/components/datepicker-ranger.vue";e.a=d.exports},749:function(t,e,a){var n=a(1053);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);(0,a(17).default)("e692ba9e",n,!1,{})}}]);