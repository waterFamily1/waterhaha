(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1063:function(e,t,r){"use strict";var a=r(754);r.n(a).a},1064:function(e,t,r){var a=r(10),i=r(506);(t=a(!1)).i(i),t.push([e.i,".video-alarm-item {\n  height: 40px;\n}\n.video-alarm-item .ivu-select {\n  display: inline-block;\n  width: 70px;\n}\n",""]),e.exports=t},1196:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"c-main-border"},[r("div",{staticClass:"c-left-border-blue"},[r("h3",[e._v("视频添加")]),e._v(" "),r("div",{staticClass:"c-btns-right"},[r("Button",{attrs:{type:"primary",shape:"circle"},on:{click:function(t){return e.submit("videoForm")}}},[e._v("保存")]),e._v(" "),r("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:e.back}},[e._v("取消")])],1)]),e._v(" "),r("div",{staticClass:"c-top-border-gray padding20-0"},[r("Form",{ref:"videoForm",attrs:{model:e.videoForm,rules:e.formRules,"label-width":150}},[r("div",{staticClass:"c-form-row-2col"},[r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"processid",label:"区域位置：",required:""}},[r("my-process-tree-authority",{ref:"processTree",attrs:{url:e.treeApi.getProcessTreeData,width:200,query:{exType:2}},on:{input:e.chooseSite},model:{value:e.process,callback:function(t){e.process=t},expression:"process"}})],1)],1),e._v(" "),r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"name",label:"视频名称："}},[r("Input",{attrs:{placeholder:"视频名称"},model:{value:e.videoForm.name,callback:function(t){e.$set(e.videoForm,"name",t)},expression:"videoForm.name"}})],1)],1)]),e._v(" "),r("div",{staticClass:"c-form-row-1col"},[r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"url",label:"URL地址："}},[r("Input",{staticStyle:{width:"677px"},attrs:{placeholder:"URL"},model:{value:e.videoForm.url,callback:function(t){e.$set(e.videoForm,"url",t)},expression:"videoForm.url"}})],1)],1)]),e._v(" "),r("div",{staticClass:"c-form-row-2col"},[r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"takeThumb",label:"定时抓拍："}},[r("i-switch",{model:{value:e.videoForm.takeThumb,callback:function(t){e.$set(e.videoForm,"takeThumb",t)},expression:"videoForm.takeThumb"}})],1)],1),e._v(" "),r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"takeThumbCycle",label:"定时抓拍周期："}},[r("Input",{staticStyle:{width:"100px"},attrs:{number:!0,disabled:!e.videoForm.takeThumb},model:{value:e.videoForm.takeThumbCycle,callback:function(t){e.$set(e.videoForm,"takeThumbCycle",t)},expression:"videoForm.takeThumbCycle"}},[r("span",{attrs:{slot:"append"},slot:"append"},[e._v("分钟")])])],1)],1)]),e._v(" "),r("div",{staticClass:"c-form-row-2col"},[r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{prop:"alarmid",label:"触发报警："}},[r("span",[e._v(e._s(e.videoForm.alarmName))]),e._v(" "),r("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:function(t){e.modalShown=!0}}},[e._v("[选择]")]),e._v(" "),r("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanAlarm}},[e._v("[清除]")])])],1),e._v(" "),r("div",{staticClass:"c-form-item"},[r("FormItem",{staticClass:"c-position-relative",attrs:{prop:"alarmThumbInterval",label:"触发间隔："}},[r("Input",{staticStyle:{width:"100px"},attrs:{number:!0},model:{value:e.videoForm.alarmThumbInterval,callback:function(t){e.$set(e.videoForm,"alarmThumbInterval",t)},expression:"videoForm.alarmThumbInterval"}},[r("span",{attrs:{slot:"append"},slot:"append"},[e._v("分钟")])])],1)],1)]),e._v(" "),r("div",{staticClass:"c-form-row-1col"},[r("div",{staticClass:"c-form-item"},[r("FormItem",{attrs:{label:"触发抓拍频率："}},[r("div",{staticClass:"video-alarm-item"},[r("span",[e._v("抓拍")]),e._v(" "),r("Select",{attrs:{size:"small"},model:{value:e.videoForm.alarmThumbSec,callback:function(t){e.$set(e.videoForm,"alarmThumbSec",t)},expression:"videoForm.alarmThumbSec"}},e._l(e.secondCount,(function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),1),e._v(" "),r("span",[e._v("张，每张间隔1秒钟")])],1),e._v(" "),r("div",{staticClass:"video-alarm-item"},[r("span",[e._v("抓拍")]),e._v(" "),r("Select",{attrs:{size:"small"},model:{value:e.videoForm.alarmThumbMin,callback:function(t){e.$set(e.videoForm,"alarmThumbMin",t)},expression:"videoForm.alarmThumbMin"}},e._l(e.minCount,(function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),1),e._v(" "),r("span",[e._v("张，每张间隔1分钟")])],1),e._v(" "),r("div",{staticClass:"video-alarm-item"},[r("span",[e._v("抓拍")]),e._v(" "),r("Select",{attrs:{size:"small"},model:{value:e.videoForm.alarmThumbTenMin,callback:function(t){e.$set(e.videoForm,"alarmThumbTenMin",t)},expression:"videoForm.alarmThumbTenMin"}},e._l(e.tenMinCount,(function(t,a){return r("Option",{key:a,attrs:{value:t}},[e._v(e._s(t))])})),1),e._v(" "),r("span",[e._v("张，每张间隔10分钟")])],1)])],1)])])],1),e._v(" "),r("Modal",{attrs:{width:"600",title:"选择报警定义"},model:{value:e.modalShown,callback:function(t){e.modalShown=t},expression:"modalShown"}},[r("mg-single-select-table",{ref:"modalTable",attrs:{columns:e.modalColumns,url:e.modalUrl,searchPlaceholder:"编号/报警名称"},on:{"on-select":e.selectAlarm}},[r("div",{},[r("label",[e._v("关键字：")]),e._v(" "),r("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"编号/报警名称",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.searchParams.queryName,callback:function(t){e.$set(e.searchParams,"queryName",t)},expression:"searchParams.queryName"}}),e._v(" "),r("label",[e._v("区域位置：")]),e._v(" "),r("dropdown-tree",{attrs:{url:e.treeApi.getProcessTreeData,width:180,multiple:!0},on:{"on-change":e.changeProcess},model:{value:e.relProcess,callback:function(t){e.relProcess=t},expression:"relProcess"}}),e._v(" "),r("Button",{staticClass:"c-btn-modal-search",attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),r("Button",{staticClass:"c-btn-modal-reset",attrs:{type:"primary"},on:{click:e.searchParamsClean}},[e._v("重置")])],1)]),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"})],1)],1)};a._withStripped=!0;var i=r(23),o=r(531),n=(r(11),r(107)),s=r(576),l=r(149),c=r(543),d=r(145),m={components:{myProcessTreeAuthority:o.a,mgSingleSelectTable:l.a,dropdownTree:d.a},data:function(){return{treeApi:n.a,process:{id:null,title:"请选择"},videoForm:{id:null,processid:"",name:"",url:"",takeThumb:!1,takeThumbCycle:60,alarmid:null,alarmName:"",alarmThumbInterval:10,alarmThumbSec:"3",alarmThumbMin:"2",alarmThumbTenMin:"1"},formRules:{processid:[{validator:function(e,t,r){t?r():r(new Error("请选择区域位置"))}}],name:[{required:!0,message:"请输入视频名称",trigger:"blur"},{max:20,message:"名称不能超过20个字符",trigger:"change"}],url:[{required:!0,message:"请输入URL",trigger:"blur"},{type:"url",message:"请输入正确的URL格式"}],takeThumbCycle:[{message:"请输入数值",type:"number",trigger:"change"},{validator:function(e,t,r){if(t){/^[1-9]\d*$/.test(t)?r():r(new Error("请输入正整数"))}else r()}}],alarmThumbInterval:[{message:"请输入数值",type:"number",trigger:"change"},{validator:function(e,t,r){if(t){/^[1-9]\d*$/.test(t)?r():r(new Error("请输入正整数"))}else r()}}]},modalShown:!1,modalColumns:[{title:"报警名称编号",key:"nameNumber"},{title:"报警名称",key:"alarmName"},{title:"报警等级",key:"alarmLevel",render:function(e,t){return e("span",{class:["alarm-lev-"+t.row.alarmLevel]},t.row.alarmLevel+"级")}},{title:"区域位置",key:"siteName"}],modalUrl:c.a.modalDefines,relProcess:{id:null,title:"请选择"},searchParams:{queryName:"",siteId:"",pageSize:10,currentPage:1}}},watch:{process:{handler:function(e,t){this.videoForm.processid=e.id,this.videoForm.processName=e.title},deep:!0}},computed:Object(i.b)({secondCount:function(e){return e.map.video.secondCount},minCount:function(e){return e.map.video.minCount},tenMinCount:function(e){return e.map.video.tenMinCount}}),created:function(){var e=this;this.$route.params.id&&this.$http.get(s.a.getVideo+this.$route.params.id).then((function(t){e.videoForm=t,e.process.id=t.processid,e.process.title=t.processName,e.videoForm.takeThumb="Y"==t.takeThumb,e.videoForm.alarmThumbSec=t.alarmThumbSec.toString(),e.videoForm.alarmThumbMin=t.alarmThumbMin.toString(),e.videoForm.alarmThumbTenMin=t.alarmThumbTenMin.toString()}))},methods:{chooseSite:function(e){this.videoForm.processid=e.id},selectAlarm:function(e){this.videoForm.alarmid=e.id,this.videoForm.alarmName=e.alarmName,this.modalShown=!1},cleanAlarm:function(){this.videoForm.alarmid=null,this.videoForm.alarmName=null},submit:function(e){var t=this,r=JSON.parse(JSON.stringify(this.videoForm));r.takeThumbCycle=r.takeThumb?r.takeThumbCycle:"",r.takeThumb=r.takeThumb?"Y":"N",r.takeThumbCycle=""==r.takeThumbCycle?null:r.takeThumbCycle,r.alarmThumbInterval=""==r.alarmThumbInterval?null:r.alarmThumbInterval,this.$refs[e].validate((function(e){e&&(t.$route.params.id?t.$http.put:t.$http.post)(s.a.saveVideo,r).then((function(e){(e.count||e.id)&&(t.$Notice.success({title:"成功",desc:"数据保存成功",duration:3}),t.$router.push({name:"video-list"}))}))}))},back:function(){this.$router.back()},changeProcess:function(e){this.searchParams.siteId=e.id},search:function(){this.$refs.modalTable.getData(this.searchParams)},searchParamsClean:function(){this.relProcess.id="",this.relProcess.title="请选择",this.searchParams={queryName:"",siteId:"",pageSize:10,currentPage:1}}}},u=(r(1063),r(1)),p=Object(u.a)(m,a,[],!1,null,null,null);p.options.__file="src/views/monitor-screen/video/form.vue";t.default=p.exports},507:function(e,t,r){e.exports=r.p+"images/3a23524e9c2a6dd02c2c02fb7847102e.png"},518:function(e,t,r){var a=r(530);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,r(17).default)("4411afe8",a,!1,{})},529:function(e,t,r){"use strict";var a=r(518);r.n(a).a},530:function(e,t,r){(t=r(10)(!1)).push([e.i,"\n.cmp-dropdown-tree {\r\n    display: inline-block;\r\n    position: relative;\r\n    vertical-align: middle;\r\n    line-height: normal;\n}\n.ivu-form-item-error .cmp-dropdown-tree-label {\r\n    border: 1px solid #ed3f14;\n}\n.ivu-form-item-error .cmp-dropdown-tree-arrow {\r\n    border-left: 1px solid #ed3f14;\n}\n.cmp-dropdown-tree-label {\r\n    height: 28px;\r\n    width: 100%;\r\n    border: 1px solid #eaeaea;\r\n    display: flex;\r\n    border-radius: 3px;\r\n    cursor: pointer;\n}\n.cmp-dropdown-tree-text {\r\n    line-height: 28px;\r\n    text-indent: 5px;\r\n    flex: 1;\r\n    white-space: nowrap;\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\n}\n.cmp-dropdown-tree-arrow {\r\n    margin-top: -1px;\r\n    width: 28px;\r\n    height: 28px;\r\n    border-left: 1px solid #eaeaea;\r\n    text-align: center;\r\n    line-height: 28px;\n}\n.cmp-dropdown-tree .ivu-input-group-append {\r\n    width: 25px;\r\n    height: 28px;\r\n    overflow: hidden;\r\n    padding: 0;\n}\n.cmp-dropdown-tree .ivu-btn {\r\n    padding: 5px 10px;\n}\n.cmp-dropdown-tree-tree {\r\n    z-index: 901;\r\n    position: absolute;\r\n    top: 37px;\r\n    left: 0;\r\n    min-width: 300px;\r\n    max-height: 400px;\r\n    overflow: auto;\r\n    padding: 5px 10px;\r\n    background-color: #fff;\r\n    box-shadow: 1px 1px 5px #999;\r\n    border-radius: 3px;\n}\r\n",""]),e.exports=t},531:function(e,t,r){"use strict";var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.hideTree,expression:"hideTree"}],staticClass:"cmp-dropdown-tree",style:{width:e.width+"px"}},[r("div",{staticClass:"cmp-dropdown-tree-label",on:{click:e.labelClick}},[r("div",{staticClass:"cmp-dropdown-tree-text"},[e._v(e._s(e.value.title))]),e._v(" "),r("div",{staticClass:"cmp-dropdown-tree-arrow"},[r("Icon",{directives:[{name:"show",rawName:"v-show",value:1!=e.isShowTree,expression:"isShowTree != true"}],attrs:{type:"ios-arrow-down"}}),e._v(" "),r("Icon",{directives:[{name:"show",rawName:"v-show",value:1==e.isShowTree,expression:"isShowTree == true"}],attrs:{type:"ios-arrow-up"}})],1)]),e._v(" "),r("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"cmp-dropdown-tree-tree"},[r("Tree",{attrs:{data:e.datas,"show-checkbox":e.showCheckbox,multiple:e.multiple},on:{"on-select-change":e.selectTree}})],1)])};a._withStripped=!0;var i=r(11),o=r(146),n=r(147);function s(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function l(e){!function e(t){t.forEach((function(t,r){t.childrenIds=function e(t,r){r=r||[];return t.forEach((function(t){t.children.length&&e(t.children,r),r.push(Math.abs(t.id))})),r}(t.children),t.children.length&&e(t.children)}))}(e)}var c={name:"myProcessTreeAuthority",mixins:[o.a],props:{field:String,value:Object,data:Array,url:String,query:Object,showCheckbox:Boolean,multiple:Boolean,width:{type:[Number,String],default:300},type:String},watch:{"value.id":function(e){e?this.flatDatas.length&&(i.a.setTrueTreeExpand(this.datas,e),i.a.setTrueTreeSelected(this.datas,e)):(!function e(t){for(var r,a=t.length,i=0;i<a;i++)1==(r=t[i]).selected&&(r.selected=!1),r.children.length&&e(r.children)}(this.datas),this.$emit("input",{id:"",title:"请选择"}))},data:function(e){this.datas=e}},data:function(){return{datas:this.data,flatDatas:[],isShowTree:!1}},methods:{selectTree:function(e){var t=this,r=[],a=[],i=[],o=this.field||"id",n=[];e.forEach((function(e){r.push(Math.abs(e[o])),a.push(e.key),i.push(e.title),n=n.concat(Math.abs(e[o]),e.childrenIds)})),n=s(new Set(n)),this.$emit("input",{id:r.join(),key:a.join(),title:i.join(),childrenIds:n}),this.$emit("on-change",{id:r.join(),key:a.join(),title:i.join(),childrenIds:n}),this.multiple||(this.isShowTree=!1),setTimeout((function(){t.dispatch("FormItem","on-form-change",{id:r.join(),key:a.join(),title:i.join(),childrenIds:n})}),100)},hideTree:function(){this.isShowTree=!1},labelClick:function(){this.isShowTree=!this.isShowTree}},directives:{clickoutside:n.a},mounted:function(){var e=this;this.url&&this.$http.get(this.url,this.query).then((function(t){t&&t.length&&(t.forEach((function(e){!1===e.authorized&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),"EQUTYPE"==e.type&&t.forEach((function(e){var r=t.filter((function(t){return t.parentId==e.id}));("org"==e.type||r.length>0)&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),"PROCESS"==e.type&&t.forEach((function(e){1==e.type&&(e.render=function(e,t){t.root,t.node;return e("span",[t.data.name])})})),e.flatDatas=t,e.value.id&&(i.a.setTreeExpand(e.flatDatas,e.value.id),i.a.setFlatTreeSelected(e.flatDatas,e.value.id)),e.datas=i.a.transDataToTree(e.flatDatas),l(e.datas))}))}},d=(r(529),r(1)),m=Object(d.a)(c,a,[],!1,null,null,null);m.options.__file="src/components/my-process-tree-authority.vue";t.a=m.exports},543:function(e,t,r){"use strict";r(22);t.a={updateDefineStatus:"/loong/api/alarm-definitions/status",defines:"/loong/api/alarm-definitions",modalDefines:"/loong/api/alarm-definitions",history:"/loong/api/alarm-records",history_detail:"/loong/api/alarm-records/detail",release:"/loong/api/alarm-records/confirm",getAlarmData:"/loong/api/alarm-records",subscribe:"/loong/api/alarm-subscriptions"}},576:function(e,t,r){"use strict";r(22);t.a={getVideoList:"/loong/api/videos",getVideo:"/loong/api/videos/",saveVideo:"/loong/api/videos",delVideo:"/loong/api/videos",getVideoTree:"/loong/api/videos/tree",getVideoThumbByType:"/loong/api/thumbs",getAlarmThumbIsread:"/loong/api/thumbs/count",setIsRead:"/loong/api/thumbs",getAlarmDataMonth:"/loong/api/thumbs/count"}},754:function(e,t,r){var a=r(1064);"string"==typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);(0,r(17).default)("6749b8e1",a,!1,{})}}]);