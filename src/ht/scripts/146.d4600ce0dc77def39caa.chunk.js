(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{1015:function(t,e,a){"use strict";var i=a(732);a.n(i).a},1016:function(t,e,a){(e=a(10)(!1)).push([t.i,"\n.take-stock-detail-btns .ivu-upload {\r\n    display: inline-block;\n}\n.confirm-modal-p {\r\n    padding-right: 40px;\r\n    line-height: 1.8;\n}\r\n",""]),t.exports=e},1254:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"fault c-main-border"},[a("div",{staticClass:"c-left-border-blue"},[a("h3",[t._v("盘点信息")]),t._v(" "),a("div",{staticClass:"c-btns-right"},[0==t.info.auditedFlag?a("Button",{attrs:{type:"primary",shape:"circle",loading:t.auditLoading},on:{click:t.audit}},[t._v("审核")]):t._e(),t._v(" "),0==t.info.auditedFlag?a("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:t.back}},[t._v("取消")]):t._e(),t._v(" "),1==t.info.auditedFlag?a("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:t.back}},[t._v("返回")]):t._e()],1)]),t._v(" "),a("div",{staticClass:"c-top-border-gray c-form-data-show padding20-0"},[a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("盘点单号：")]),t._v("\n                "+t._s(t.info.materielInventoryNumber)+"\n            ")]),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[t._v("组织信息：")]),t._v("\n                "+t._s(t.info.orgName)+"\n            ")])]),t._v(" "),a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("盘点人员：")]),t._v("\n                "+t._s(t.info.userName)+"\n            ")]),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[t._v("盘点仓库：")]),t._v("\n                "+t._s(t.info.warehouseName)+"\n            ")])]),t._v(" "),a("div",{staticClass:"c-form-row-2col"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("创建时间：")]),t._v("\n                "+t._s(t._f("F")(t.info.createDate,"yyyy-MM-dd hh:mm"))+"\n            ")]),t._v(" "),a("div",{staticClass:"c-form-item"},[a("label",[t._v("审核状态：")]),t._v("\n                "+t._s(t.auditStateText[t.info.auditedFlag])+"\n            ")])]),t._v(" "),a("div",{staticClass:"c-form-row-1col"},[a("div",{staticClass:"c-form-item"},[a("label",[t._v("备注：")]),t._v("\n                "+t._s(t.info.remark)+"\n            ")])])]),t._v(" "),a("div",{staticClass:"c-top-border-gray"},[a("div",{staticClass:"c-plain-bg-h"},[a("h3",[t._v("盘点明细")]),t._v(" "),0==t.info.auditedFlag?a("div",{staticClass:"c-btns-right take-stock-detail-btns"},[a("Button",{directives:[{name:"show",rawName:"v-show",value:"info"==t.status,expression:"status == 'info'"}],staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",size:"small"},on:{click:t.exportData}},[t._v("导出库存盘点单")]),t._v(" "),a("Upload",{directives:[{name:"show",rawName:"v-show",value:"info"==t.status,expression:"status == 'info'"}],ref:"upload",attrs:{name:"file",accept:".xls, .xlsx",data:t.uploadParams,format:["xls","xlsx"],"on-success":t.uploadSucess,"on-error":t.uploadError,action:t.importUrl,"show-upload-list":!1}},[a("Button",{staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",size:"small"}},[t._v("导入库存盘点单")])],1),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:"info"==t.status&&t.tableDatas.length,expression:"status == 'info' && tableDatas.length"}],staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",size:"small"},on:{click:t.editTable}},[t._v("编辑")]),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:"edit"==t.status,expression:"status == 'edit'"}],staticClass:"c-btn-add",attrs:{type:"primary",shape:"circle",size:"small",loading:t.updateLoading},on:{click:t.updateTable}},[t._v("提交")]),t._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:"edit"==t.status,expression:"status == 'edit'"}],staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle",size:"small"},on:{click:t.cancelEditTable}},[t._v("取消")])],1):t._e()]),t._v(" "),a("div",{staticClass:"padding10-0"},[a("Input",{staticStyle:{width:"180px"},attrs:{placeholder:"物料编号或物料名称",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search(e)}},model:{value:t.searchParams.queryName,callback:function(e){t.$set(t.searchParams,"queryName",e)},expression:"searchParams.queryName"}}),t._v(" "),a("Button",{staticClass:"c-btn-add",attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")])],1),t._v(" "),a("Table",{attrs:{columns:t.columns,data:t.tableDatas,loading:t.loading,stripe:""}}),t._v(" "),a("Page",{staticClass:"table-page",attrs:{total:t.total,"page-size":t.searchParams.pageSize,current:t.searchParams.currentPage,"show-total":"","show-elevator":""},on:{"on-change":t.pageChange}})],1)])};i._withStripped=!0;var n=a(23),o=a(11),r=a(527),s=(a(107),{data:function(){var t=this;return{auditLoading:!1,status:"info",info:{},searchParams:{id:t.$route.params.id,queryName:"",pageSize:10,currentPage:1},columns:[{title:"物料编号",key:"materielNumber"},{title:"物料名称",key:"materielName"},{title:"型号",key:"model"},{title:"规格",key:"standard"},{title:"库位",key:"warehousePositionName"},{title:"账面数量",key:"storageAmount"},{title:"计量单位",key:"measurementUnit"},{title:"盘点数量",key:"amount",render:function(e,a){return"info"==t.status?(a.row.amount=a.row.amountCache,e("span",a.row.amount)):"edit"==t.status?e("input",{style:{width:"50px"},attrs:{type:"text",maxlength:"5",id:"storage_invertory_item_"+a.row.id},domProps:{value:a.row.amount},on:{input:function(t){var e=t.target.value;isNaN(e)&&(e=t.target.value=0),a.row.amount=e}}}):void 0}},{title:"盈亏数量",key:"",render:function(t,e){var a=Number(e.row.amount)-Number(e.row.storageAmount),i="#333";return a>0?i="#b32f2f":a<0&&(i="#2f7b34"),t("span",{style:{color:i}},a)}},{title:"描述",key:"remark"}],tableDatas:[],loading:!1,total:0,uploadParams:{id:t.$route.params.id},importUrl:r.a.takeStock.import,updateLoading:!1}},computed:Object(n.b)({auditState:function(t){return t.map.storage.inventory.auditState},auditStateText:function(t){return t.map.storage.inventory.auditStateText}}),created:function(){o.a.initTableColumnTitle(this.columns)},mounted:function(){this.getData(),this.getItems()},methods:{getData:function(){var t=this,e=this.$route.params.id;e&&this.$http.get(r.a.takeStock.url,{id:e}).then((function(e){t.info=e}))},getItems:function(){var t=this;this.loading=!0,this.$http.get(r.a.takeStock.detailList,this.searchParams).then((function(e){e.items.forEach((function(t){t.amountCache=t.amount})),t.tableDatas=e.items,t.total=e.total,t.loading=!1,t.status="info"}))},audit:function(){var t=this,e=this.$route.params.id;e&&(0!=this.tableDatas.length?this.$Modal.confirm({title:"审核提示",content:'<p class="confirm-modal-p">请确认该盘点单所有物料已盘点并完成导入，审核后将根据导入的库存盘点单对物料库存数量调整</p>',onOk:function(){t.auditLoading=!0,t.$http.get(r.a.takeStock.audit,{id:e}).then((function(e){t.$Notice.success({title:"审核成功"}),t.auditLoading=!1,t.getData()})).catch((function(){t.auditLoading=!1}))}}):this.$Notice.warning({title:"请先添加盘点明细"}))},back:function(){this.$router.back()},search:function(){this.getItems()},pageChange:function(t){this.searchParams.currentPage=t,this.getItems()},exportData:function(){o.a.download(r.a.takeStock.export,{id:this.$route.params.id})},editTable:function(){this.status="edit"},cancelEditTable:function(){this.status="info"},checkAmount:function(){var t=this.tableDatas,e=!0;return t.forEach((function(t){""===t.amount&&(e=!1)})),e},updateTable:function(){var t=this,e=this.tableDatas;e.forEach((function(t){t.amount=document.querySelector("#storage_invertory_item_"+t.id).value})),e.length?this.checkAmount()?(this.updateLoading=!0,this.$http.put(r.a.takeStock.url,{id:this.$route.params.id,details:this.tableDatas}).then((function(e){t.updateLoading=!1,t.$Notice.success({title:"修改成功"}),t.getItems()})).catch((function(){t.updateLoading=!1}))):this.$Notice.warning({title:"您有库存数量为空"}):this.$Notice.warning({title:"请新增盘点明细"})},uploadSucess:function(t){0==t.errNum?(this.$Notice.success({title:"导入成功！"}),this.searchParams.queryName="",this.searchParams.currentPage=1,this.getItems()):this.$Notice.error({title:"导入失败！",desc:"发现校验错误:"+t.errNum+"处"})},uploadError:function(){this.$Notice.error({title:"导入失败！"})}}}),l=(a(1015),a(1)),c=Object(l.a)(s,i,[],!1,null,null,null);c.options.__file="src/views/storage/take-stock/detail.vue";e.default=c.exports},527:function(t,e,a){"use strict";var i=a(22),n={getWarehouseComboList:"/inventory/api/warehouse/comboList",getManaginguser:"/inventory/api/users/managinguser",category:{getTree:"/inventory/api/materiel-category/tree",getInfo:"/inventory/api/materiel-category/materiel",add:"/inventory/api/materiel-category/materiel",edit:"/inventory/api/materiel-category/materiel",del:"/inventory/api/materiel-category/materiel",search:"/inventory/api/materiel-category/list"},inventory:{audit:"/inventory/api/store-adjustment/audited",export:i.a+"/inventory/api/store-adjustment/export",url:"/inventory/api/store-adjustment/adjusment",list:"/inventory/api/store-adjustment/list",detailList:"/inventory/api/store-adjustment/detail/list",itemList:"/inventory/api/store-adjustment/materiel/list",move:"/inventory/api/store-adjustment/move",materielSearch:"/inventory/api/stock/materiel",materielPosition:"/inventory/api/stock/position",materielDepot:"/inventory/api/stock/warehous"},takeStock:{audit:"/inventory/api/materiel-inventory/audited",export:i.a+"/inventory/api/materiel-inventory/export",import:i.a+"/inventory/api/materiel-inventory/import",url:"/inventory/api/materiel-inventory/inventory",detailList:"/inventory/api/materiel-inventory/detail/list",list:"/inventory/api/materiel-inventory/list"},storage:{comboList:"/inventory/api/warehouse/comboList"},material:{getMaterielCategoryTree:"/inventory/api/materiel-category/tree/external",getMateriel:"/inventory/api/materiels",delMateriel:"/inventory/api/materiels",exportMateriel:i.a+"/inventory/api/materiels/excel-export",addMateriel:"/inventory/api/materiel",changeMateriel:"/inventory/api/materiel",getMaterielDetail:"/inventory/api/materiel",getDistribution:"/inventory/api/materielStocks/distribution",getMaterielStockLimits:"/inventory/api/materielStockLimits",bacthAddMaterielStockLimit:"/inventory/api/materielStockLimit/batch-save",updateMaterielStockLimit:"/inventory/api/materielStockLimit",delMaterielStockLimit:"/inventory/api/materielStockLimits",getUnitList:"/inventory/api/materiel/unit",modalMateriel:"/inventory/api/materiel/external",getExcel:i.a+"/inventory/api/excel-temlate-down",importExcel:i.a+"/inventory/api/excel-import",cancelExcelData:"/inventory/api/excel-data-cancel",saveExcelData:"/inventory/api/excel-data-save"},repertory:{getWarehouses:"/inventory/api/warehouses",exportWarehouse:i.a+"/inventory/api/warehouse/excel-export",delWarehouses:"/inventory/api/warehouses",changeWarehouses:"/inventory/api/warehouse",addWarehouse:"/inventory/api/warehouse",getWarehouseDetail:"/inventory/api/warehouse",getWarehouseInfo:"/inventory/api/warehouse/getWarehouseInfo",getPositionOfWarehouse:"/inventory/api/warehousePosition/positionList",bacthAddWarehouseposition:"/inventory/api/warehouseposition/batch-save",updateWarehousePosition:"/inventory/api/warehousePosition",delWarehousePosition:"/inventory/api/warehousePositions",positionByWarehouse:"/inventory/api/warehousePosition/move",checkWarehousenameIsExist:"/inventory/api/warehouse/check-warehousename-isexist",getExcel:i.a+"/inventory/api/warehousePosition/excel-temlate-down",importExcel:i.a+"/inventory/api/warehousePosition/excel-import",cancelExcelData:"/inventory/api/warehousePosition/excel-data-cancel",saveExcelData:"/inventory/api/warehousePosition/excel-data-save"},checkin:{getInbond:"/inventory/api/inbounds",delInbond:"/inventory/api/inbounds",addInbond:"/inventory/api/inbound",getInbondDetail:"/inventory/api/inbound",getInbondRecordList:"/inventory/api/inbound/inboundDetails",getPositionComboxList:"/inventory/api/warehousePosition/positionComboxList",auditeInbound:"/inventory/api/inbound/audite",getMaterielsByWareHouseNo:"/inventory/api/materiel/getMaterielsByWareHouseNo",getMateriels:"/inventory/api/materiel/getMateriels",updateInboundDetail:"/inventory/api/inboundDetail"},checkout:{getApplicantMember:"/uaa/api/users/select",getOutbond:"/inventory/api/outbounds",delOutbond:"/inventory/api/outbounds",addOutbond:"/inventory/api/outbound",getOutbondDetail:"/inventory/api/outbound",getOutbondRecordList:"/inventory/api/outboundDetail",auditeOutbound:"/inventory/api/outbound/audite",updateOutboundDetail:"/inventory/api/outboundDetail",getstock:"/inventory/api/stock/getstock",getMaterielsOutBound:"/inventory/api/materiel/getMaterielsOutBound"},allot:{getTransfer:"/inventory/api/transfer/list",delTransfer:"/inventory/api/transfer/transfer",addTransfer:"/inventory/api/transfer/transfer",getTransferDetail:"/inventory/api/transfer/transfer",getTransferDetailList:"/inventory/api/transfer/detail/list",auditTransfer:"/inventory/api/transfer/audited",updateTransfer:"/inventory/api/transfer/transfer",getMaterielList:"/inventory/api/transfer/materiel/list",getStockPosiComboList:"/inventory/api/stock/position",getWarehousePosition:"/inventory/api/warehousePosition/move"},reporting:{getStockInfo:"/inventory/api/stock/getstock-info",exportStockInfo:i.a+"/inventory/api/stock/getstock-info-excel-export",getStockInoutbound:"/inventory/api/stock/getstock-info-inoutbound",exportStockInoutbound:i.a+"/inventory/api/stock/getstock-info-inoutbound-excel-export",getStockMove:"/inventory/api/stock/get-inventory-mobility-report",exportStockMove:i.a+"/inventory/api/stock/get-inventory-mobility-report-excel-export",getInventoryProfitLossList:"/inventory/api/materiel-inventory/inventory-report",exportInventoryProfitLoss:i.a+"/inventory/api/materiel-inventory/inventory-report-export",getInventoryNumberList:"/inventory/api/materiel-inventory/inventory-report-inventory-number"}};e.a=n},732:function(t,e,a){var i=a(1016);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);(0,a(17).default)("896708ea",i,!1,{})}}]);