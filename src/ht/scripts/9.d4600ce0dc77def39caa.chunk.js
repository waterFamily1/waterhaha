(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{1217:function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"patrol-plan-add c-main-border"},[t("div",{staticClass:"c-left-border-blue"},[t("h3",[e._v("巡检计划")]),e._v(" "),"Outside"==e.plan.type?t("div",{staticClass:"patrol-plan-map-type"}):e._e(),e._v(" "),t("div",{staticClass:"c-btns-right"},[t("Button",{attrs:{type:"primary",shape:"circle",loading:e.submitLoading},on:{click:e.handleSubmit}},[e._v("保存")]),e._v(" "),t("Button",{staticClass:"c-btn-back",attrs:{type:"primary",shape:"circle"},on:{click:e.handleCancle}},[e._v("取消")])],1)]),e._v(" "),t("Form",{ref:"planForm",staticClass:"patrol-plan-form",attrs:{model:e.plan,rules:e.ruleValidate,"label-width":140}},[t("div",{staticClass:"c-top-border-gray"},[t("div",{staticClass:"c-form-row-2col"},[t("div",{staticClass:"c-form-item"},[t("FormItem",{attrs:{label:"巡检计划名称:",prop:"name"}},[t("Input",{staticStyle:{width:"300px"},model:{value:e.plan.name,callback:function(a){e.$set(e.plan,"name",a)},expression:"plan.name"}})],1)],1),e._v(" "),t("div",{staticClass:"c-form-item"},[t("FormItem",{attrs:{label:"提前通知时间:",prop:"remindAdvance"}},[t("Input",{staticStyle:{width:"50px","margin-right":"10px"},attrs:{number:!0},model:{value:e.plan.remindAdvance,callback:function(a){e.$set(e.plan,"remindAdvance",a)},expression:"plan.remindAdvance"}}),e._v("分钟\n                    ")],1)],1)]),e._v(" "),t("div",{staticClass:"c-form-row-2col"},[t("div",{staticClass:"c-form-item"},[t("FormItem",{attrs:{label:"所属组织:",prop:"orgId"}},[t("dropdown-tree",{attrs:{url:e.orgTreeApi},on:{"on-change":e.orgSelect},model:{value:e.org,callback:function(a){e.org=a},expression:"org"}})],1)],1),e._v(" "),t("div",{staticClass:"c-form-item plan-date-item"},[t("FormItem",{attrs:{label:"开始时间:"}},[t("DatePicker",{staticStyle:{width:"150px"},attrs:{id:"planStart",clearable:!1,editable:!1,format:"yyyy/MM/dd（ddddd）",options:e.optionsByPlanStart},on:{"on-change":e.taskStartChange},model:{value:e.repeatCircleData.planStart,callback:function(a){e.$set(e.repeatCircleData,"planStart",a)},expression:"repeatCircleData.planStart"}}),e._v(" "),t("TimePicker",{staticStyle:{width:"112px"},attrs:{format:"HH:mm",placeholder:"",disabled:e.disabledByStartTime,clearable:!1},on:{"on-change":e.taskStartTimeChange},model:{value:e.repeatCircleData.startTime,callback:function(a){e.$set(e.repeatCircleData,"startTime",a)},expression:"repeatCircleData.startTime"}})],1),e._v(" "),t("Checkbox",{staticClass:"all-day-btn",on:{"on-change":e.selectedAllDayTask},model:{value:e.allDay,callback:function(a){e.allDay=a},expression:"allDay"}},[e._v("全天任务")])],1)]),e._v(" "),t("div",{staticClass:"c-form-row-2col"},[t("div",{staticClass:"c-form-item"},[t("FormItem",{attrs:{label:"执行人员:"}},[t("Select",{staticStyle:{width:"300px"},model:{value:e.plan.executorId,callback:function(a){e.$set(e.plan,"executorId",a)},expression:"plan.executorId"}},e._l(e.executorNames,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)],1),e._v(" "),t("div",{staticClass:"c-form-item plan-date-item"},[t("FormItem",{attrs:{label:"结束时间:",prop:"taskEndDate"}},[t("DatePicker",{staticStyle:{width:"150px"},attrs:{id:"taskEndDate",clearable:!1,editable:!1,format:"yyyy/MM/dd（ddddd）",options:e.optionsByTaskEndDate},on:{"on-change":e.taskEndDateChange},model:{value:e.repeatCircleData.taskEndDate,callback:function(a){e.$set(e.repeatCircleData,"taskEndDate",a)},expression:"repeatCircleData.taskEndDate"}}),e._v(" "),t("TimePicker",{staticStyle:{width:"112px"},attrs:{format:"HH:mm",placeholder:"",disabled:e.disabledByEndTime,clearable:!1},on:{"on-change":e.taskEndTimeChange},model:{value:e.repeatCircleData.endTime,callback:function(a){e.$set(e.repeatCircleData,"endTime",a)},expression:"repeatCircleData.endTime"}})],1),e._v(" "),t("Poptip",{staticClass:"repeat-circle-btn-wrap",attrs:{trigger:"hover","word-wrap":!0,placement:"bottom"}},[t("i",{staticClass:"refresh-btn",on:{click:e.repeatCircle}},[e._v("重复周期")]),e._v(" "),t("div",{attrs:{slot:"content"},slot:"content"},[t("div",[e._v("周期："+e._s(e.repeatCircleData.repeatCircle))]),e._v(" "),t("p",[e._v("持续时间："+e._s(e.repeatCircleData.duration))])])])],1)]),e._v(" "),t("div",{staticClass:"c-form-row-2col"},[t("div",{staticClass:"c-form-item plan-date-item"},[t("FormItem",{attrs:{label:"计划状态:"}},[t("span",[e._v(e._s(e.planStates[e.plan.status]))])])],1),e._v(" "),t("div",{staticClass:"c-form-item"},[t("FormItem",{attrs:{label:"节假日设置:"}},[t("RadioGroup",{model:{value:e.plan.holidayDisabled,callback:function(a){e.$set(e.plan,"holidayDisabled",a)},expression:"plan.holidayDisabled"}},[t("Radio",{attrs:{value:0,label:0}},[e._v("执行")]),e._v(" "),t("Radio",{attrs:{value:1,label:1}},[e._v("不执行")])],1)],1)],1)])])]),e._v(" "),t("div",{staticClass:"c-top-border-gray"},[t("div",{staticClass:"patrol-points-title"},[t("h3",{staticStyle:{display:"inline-block"}},[e._v("巡检点信息")]),e._v(" "),"Outside"==e.plan.type&&"edit"==e.pageStatus?t("a",{staticStyle:{color:"#0bb1df","margin-left":"10px","text-decoration":"underline"},attrs:{href:"javascript:;"},on:{click:e.redirectToMap}},[t("Icon",{attrs:{type:"android-pin",size:"16",color:"#E03E3E"}}),e._v(" "),t("span",{staticStyle:{"margin-left":"3px"}},[e._v("编辑线路")])],1):e._e(),e._v(" "),t("div",{staticClass:"c-btns-right"},[t("Button",{attrs:{type:"primary",shape:"circle"},on:{click:function(a){e.pointsModalShown=!0}}},[e._v("添加巡检点")])],1)]),e._v(" "),t("Table",{attrs:{columns:e.planPointColumns,data:e.selectedData,stripe:""}})],1),e._v(" "),t("Modal",{attrs:{width:800,title:"选择巡检点","class-name":"patrol-points-modal"},model:{value:e.pointsModalShown,callback:function(a){e.pointsModalShown=a},expression:"pointsModalShown"}},[t("mg-select-table",{ref:"mpointsTable",attrs:{columns:e.modalColumns,url:e.pointsApi,selected:e.selectedPoints,searchPlaceholder:"巡检点名称",manual:!0},on:{"on-submit":e.modalSelect,"on-cancel":function(a){e.pointsModalShown=!1}}},[t("div",{},[t("label",[e._v("关键字：")]),e._v(" "),t("Input",{staticStyle:{width:"150px"},attrs:{placeholder:"巡检点名称",clearable:""},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.search(a)}},model:{value:e.searchParams.queryName,callback:function(a){e.$set(e.searchParams,"queryName",a)},expression:"searchParams.queryName"}}),e._v(" "),t("label",[e._v("区域位置：")]),e._v(" "),t("dropdown-tree",{attrs:{url:e.processTreeApi,width:150,multiple:!0},on:{"on-change":e.changeProcess},model:{value:e.relProcess,callback:function(a){e.relProcess=a},expression:"relProcess"}}),e._v(" "),t("Button",{staticClass:"c-btn-modal-search",attrs:{type:"primary"},on:{click:e.search}},[e._v("搜索")]),e._v(" "),t("Button",{staticClass:"c-btn-modal-reset",attrs:{type:"primary"},on:{click:e.searchParamsClean}},[e._v("重置")])],1)]),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"})],1),e._v(" "),t("Modal",{attrs:{"mask-closable":!1,closable:!1,width:540,height:615,styles:{top:"10px"},title:"重复周期","class-name":"patrol-repeat-circle-modal"},model:{value:e.repeatCircleShown,callback:function(a){e.repeatCircleShown=a},expression:"repeatCircleShown"}},[t("Form",{ref:"repeatCircleForm",attrs:{model:e.repeatCircleData,rules:e.ruleValidateByRepeatCircle,"label-width":80}},[t("div",{staticClass:"part-1"},[t("h3",[e._v("任务时间")]),e._v(" "),t("FormItem",{attrs:{label:"开始"}},[t("TimePicker",{staticStyle:{width:"112px"},attrs:{format:"HH:mm",clearable:!1},on:{"on-change":e.taskStartTimeChangeByModal},model:{value:e.repeatCircleData.startTime,callback:function(a){e.$set(e.repeatCircleData,"startTime",a)},expression:"repeatCircleData.startTime"}})],1),e._v(" "),t("FormItem",{attrs:{label:"结束"}},[t("TimePicker",{staticStyle:{width:"112px"},attrs:{format:"HH:mm",clearable:!1},on:{"on-change":e.taskEndTimeChangeByModal},model:{value:e.repeatCircleData.endTime,callback:function(a){e.$set(e.repeatCircleData,"endTime",a)},expression:"repeatCircleData.endTime"}})],1),e._v(" "),t("FormItem",{attrs:{label:"持续时间",prop:"duration"}},[t("Select",{staticStyle:{width:"112px"},model:{value:e.repeatCircleData.durationLabel,callback:function(a){e.$set(e.repeatCircleData,"durationLabel",a)},expression:"repeatCircleData.durationLabel"}},e._l(e.durationList,(function(a){return t("Option",{key:a.label,attrs:{value:a.label},nativeOn:{click:function(t){return e.changePeriod(a)}}},[e._v(e._s(a.label))])})),1),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.repeatCircleData.duration,expression:"repeatCircleData.duration"}],staticClass:"duration-input",attrs:{type:"text"},domProps:{value:e.repeatCircleData.duration},on:{blur:e.blurDuration,input:function(a){a.target.composing||e.$set(e.repeatCircleData,"duration",a.target.value)}}})],1)],1),e._v(" "),t("div",{staticClass:"part-2"},[t("h3",[e._v("定期模式")]),e._v(" "),t("div",{staticClass:"ivu-form-item regular-mode-list"},[t("RadioGroup",{attrs:{vertical:""},on:{"on-change":e.changeRegularMode},model:{value:e.repeatCircleData.periodType,callback:function(a){e.$set(e.repeatCircleData,"periodType",a)},expression:"repeatCircleData.periodType"}},e._l(e.regularModeList,(function(a){return t("Radio",{attrs:{label:a.value}},[t("span",[e._v(e._s(a.label))])])})),1)],1),e._v(" "),t("div",{staticClass:"regular-mode-content"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"Hourly"==e.repeatCircleData.periodType,expression:"repeatCircleData.periodType=='Hourly'"}],staticClass:"regular-mode-hour"},[t("span",[e._v("每")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:0,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue,callback:function(a){e.$set(e.repeatCircleData,"periodValue",a)},expression:"repeatCircleData.periodValue"}}),e._v(" "),t("span",[e._v("小时")])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"Daily"==e.repeatCircleData.periodType,expression:"repeatCircleData.periodType=='Daily'"}],staticClass:"regular-mode-day"},[t("RadioGroup",{attrs:{vertical:""},on:{"on-change":e.accordingToDayChange},model:{value:e.repeatCircleData.accordingToDay,callback:function(a){e.$set(e.repeatCircleData,"accordingToDay",a)},expression:"repeatCircleData.accordingToDay"}},[t("Radio",{attrs:{label:"day"}},[t("span",[e._v("每")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue,callback:function(a){e.$set(e.repeatCircleData,"periodValue",a)},expression:"repeatCircleData.periodValue"}}),e._v(" "),t("span",[e._v("天")])],1),e._v(" "),t("Radio",{attrs:{label:"2;3;4;5;6"}},[t("span",[e._v("每个工作日")])])],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"Weekly"==e.repeatCircleData.periodType,expression:"repeatCircleData.periodType=='Weekly'"}],staticClass:"regular-mode-week"},[t("span",[e._v("重复间隔为")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue,callback:function(a){e.$set(e.repeatCircleData,"periodValue",a)},expression:"repeatCircleData.periodValue"}}),e._v(" "),t("span",[e._v("周后的：")]),e._v(" "),t("CheckboxGroup",{model:{value:e.repeatCircleData.periodRankArr,callback:function(a){e.$set(e.repeatCircleData,"periodRankArr",a)},expression:"repeatCircleData.periodRankArr"}},e._l(e.weekList,(function(a){return t("Checkbox",{attrs:{label:a.value}},[t("span",[e._v(e._s(a.label))])])})),1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"Monthly"==e.repeatCircleData.periodType,expression:"repeatCircleData.periodType=='Monthly'"}],staticClass:"regular-mode-month"},[t("RadioGroup",{attrs:{vertical:""},model:{value:e.repeatCircleData.accordingToMonth,callback:function(a){e.$set(e.repeatCircleData,"accordingToMonth",a)},expression:"repeatCircleData.accordingToMonth"}},[t("Radio",{attrs:{label:"1"}},[e._v(" ")]),e._v(" "),t("Radio",{attrs:{label:"2"}},[e._v(" ")])],1),e._v(" "),t("ul",[t("li",[t("span",[e._v("每")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue,callback:function(a){e.$set(e.repeatCircleData,"periodValue",a)},expression:"repeatCircleData.periodValue"}}),e._v(" "),t("span",[e._v("个月的第")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,max:31,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodRank,callback:function(a){e.$set(e.repeatCircleData,"periodRank",a)},expression:"repeatCircleData.periodRank"}}),e._v(" "),t("span",[e._v("天")])],1),e._v(" "),t("li",[t("span",[e._v("每")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue2,callback:function(a){e.$set(e.repeatCircleData,"periodValue2",a)},expression:"repeatCircleData.periodValue2"}}),e._v(" "),t("span",[e._v("个月的第")]),e._v(" "),t("Select",{staticStyle:{width:"90px"},model:{value:e.repeatCircleData.periodRank2,callback:function(a){e.$set(e.repeatCircleData,"periodRank2",a)},expression:"repeatCircleData.periodRank2"}},e._l(e.orderArray,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1),e._v(" "),t("Select",{staticStyle:{width:"90px"},model:{value:e.repeatCircleData.periodRankValue,callback:function(a){e.$set(e.repeatCircleData,"periodRankValue",a)},expression:"repeatCircleData.periodRankValue"}},e._l(e.periodRankValueArr,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)])],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:"Yearly"==e.repeatCircleData.periodType,expression:"repeatCircleData.periodType=='Yearly'"}],staticClass:"regular-mode-year"},[t("span",[e._v("重复间隔为")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodValue,callback:function(a){e.$set(e.repeatCircleData,"periodValue",a)},expression:"repeatCircleData.periodValue"}}),e._v(" "),t("span",[e._v("年后的：")]),e._v(" "),t("RadioGroup",{attrs:{vertical:""},model:{value:e.repeatCircleData.accordingToYear,callback:function(a){e.$set(e.repeatCircleData,"accordingToYear",a)},expression:"repeatCircleData.accordingToYear"}},[t("Radio",{attrs:{label:"1"}},[e._v(" ")]),e._v(" "),t("Radio",{attrs:{label:"2"}},[e._v(" ")])],1),e._v(" "),t("ul",[t("li",[t("span",[e._v("时间")]),e._v(" "),t("Select",{staticStyle:{width:"80px"},model:{value:e.repeatCircleData.periodMonth,callback:function(a){e.$set(e.repeatCircleData,"periodMonth",a)},expression:"repeatCircleData.periodMonth"}},e._l(e.monthList,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,max:31,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.periodRank,callback:function(a){e.$set(e.repeatCircleData,"periodRank",a)},expression:"repeatCircleData.periodRank"}}),e._v(" "),t("span",[e._v("日")])],1),e._v(" "),t("li",[t("span",[e._v("时间")]),e._v(" "),t("Select",{staticStyle:{width:"80px"},model:{value:e.repeatCircleData.periodMonth2,callback:function(a){e.$set(e.repeatCircleData,"periodMonth2",a)},expression:"repeatCircleData.periodMonth2"}},e._l(e.monthList,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1),e._v(" "),t("span",[e._v("的")]),e._v(" "),t("Select",{staticStyle:{width:"90px"},model:{value:e.repeatCircleData.periodRank2,callback:function(a){e.$set(e.repeatCircleData,"periodRank2",a)},expression:"repeatCircleData.periodRank2"}},e._l(e.orderArray,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1),e._v(" "),t("Select",{staticStyle:{width:"90px"},model:{value:e.repeatCircleData.periodRankValue,callback:function(a){e.$set(e.repeatCircleData,"periodRankValue",a)},expression:"repeatCircleData.periodRankValue"}},e._l(e.periodRankValueArr,(function(a){return t("Option",{key:a.value,attrs:{value:a.value}},[e._v(e._s(a.label))])})),1)],1)])],1)])]),e._v(" "),t("div",{staticClass:"part-3"},[t("h3",[e._v("重复范围")]),e._v(" "),t("div",{staticStyle:{position:"relative"}},[t("FormItem",{staticStyle:{display:"inline-block"},attrs:{label:"开始日期:"}},[t("DatePicker",{staticStyle:{width:"150px"},attrs:{id:"planStartByModal",clearable:!1,editable:!1,format:"yyyy/MM/dd（ddddd）",options:e.optionsByPlanStartModal},on:{"on-change":e.planStartChangeByModal},model:{value:e.repeatCircleData.planStart,callback:function(a){e.$set(e.repeatCircleData,"planStart",a)},expression:"repeatCircleData.planStart"}})],1),e._v(" "),t("RadioGroup",{attrs:{vertical:""},model:{value:e.repeatCircleData.repeatType,callback:function(a){e.$set(e.repeatCircleData,"repeatType",a)},expression:"repeatCircleData.repeatType"}},[t("Radio",{attrs:{label:"1"}},[e._v(" ")]),e._v(" "),t("Radio",{attrs:{label:"2"}},[e._v(" ")])],1),e._v(" "),t("ul",{staticClass:"repeat-type"},[t("li",[t("span",[e._v("重复")]),e._v(" "),t("InputNumber",{staticStyle:{width:"60px"},attrs:{min:1,step:1,formatter:e.inputNumberFormatter},model:{value:e.repeatCircleData.repeatCount,callback:function(a){e.$set(e.repeatCircleData,"repeatCount",a)},expression:"repeatCircleData.repeatCount"}}),e._v(" "),t("span",[e._v("次结束")])],1),e._v(" "),t("li",[t("span",[e._v("结束日期")]),e._v(" "),t("DatePicker",{staticStyle:{width:"150px"},attrs:{id:"planEndByModal",clearable:!1,editable:!1,format:"yyyy/MM/dd（ddddd）",options:e.optionsByPlanEnd},model:{value:e.repeatCircleData.planEnd,callback:function(a){e.$set(e.repeatCircleData,"planEnd",a)},expression:"repeatCircleData.planEnd"}})],1)])],1)])]),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("div",{staticClass:"c-modal-footer-btns"},[t("Button",{attrs:{type:"default",shape:"circle",size:"large"},on:{click:e.repeatCircleCancle}},[e._v("取消")]),e._v(" "),t("Button",{attrs:{type:"primary",shape:"circle",size:"large"},on:{click:e.repeatCircleConfirm}},[e._v("确定")])],1)])],1)],1)};r._withStripped=!0;var i=t(23),l=t(145),n=t(523),o=t(107),s=t(39),p=t(539),c=t(11),d=(t(517),t(537));function u(e,a){if(e){var t=c.a.F(new Date(e),"yyyy-MM-dd");return c.a.transDateFromLocale(t+" "+a)}}function h(e){return c.a.transDateFromServer(e,"hh:mm")}var m={components:{dropdownTree:l.a,datepickerRanger:n.a,mgSelectTable:d.a},data:function(){var e=this;return{submitLoading:!1,orderArrayObj:{First:"第一个",Second:"第二个",Third:"第三个",Fourth:"第四个",Last:"最后一个"},periodRankValueObj:{Day:"日子",Weekday:"工作日","Weekend Day":"周末",Sunday:"星期日",Monday:"星期一",Tuesday:"星期二",Wednesday:"星期三",Thursday:"星期四",Friday:"星期五",Saturday:"星期六"},durationList:[{label:"30分钟",unit:"Minute"},{label:"1小时",unit:"Hour"},{label:"2小时",unit:"Hour"},{label:"3小时",unit:"Hour"},{label:"4小时",unit:"Hour"},{label:"5小时",unit:"Hour"},{label:"6小时",unit:"Hour"},{label:"7小时",unit:"Hour"},{label:"8小时",unit:"Hour"},{label:"9小时",unit:"Hour"},{label:"10小时",unit:"Hour"},{label:"11小时",unit:"Hour"},{label:"1天",unit:"Day"},{label:"2天",unit:"Day"},{label:"3天",unit:"Day"},{label:"4天",unit:"Day"},{label:"1周",unit:"Week"},{label:"2周",unit:"Week"}],regularModeList:[{value:"Hourly",label:"按小时"},{value:"Daily",label:"按天"},{value:"Weekly",label:"按周"},{value:"Monthly",label:"按月"},{value:"Yearly",label:"按年"}],weekList:[{value:"2",label:"星期一"},{value:"3",label:"星期二"},{value:"4",label:"星期三"},{value:"5",label:"星期四"},{value:"6",label:"星期五"},{value:"7",label:"星期六"},{value:"1",label:"星期日"}],monthList:[{value:1,label:"1月"},{value:2,label:"2月"},{value:3,label:"3月"},{value:4,label:"4月"},{value:5,label:"5月"},{value:6,label:"6月"},{value:7,label:"7月"},{value:8,label:"8月"},{value:9,label:"9月"},{value:10,label:"10月"},{value:11,label:"11月"},{value:12,label:"12月"}],orderArray:[{value:"First",label:"第一个"},{value:"Second",label:"第二个"},{value:"Third",label:"第三个"},{value:"Fourth",label:"第四个"},{value:"Last",label:"最后一个"}],periodRankValueArr:[{value:"Day",label:"日子"},{value:"Weekday",label:"工作日"},{value:"Weekend Day",label:"周末"},{value:"Sunday",label:"星期日"},{value:"Monday",label:"星期一"},{value:"Tuesday",label:"星期二"},{value:"Wednesday",label:"星期三"},{value:"Thursday",label:"星期四"},{value:"Friday",label:"星期五"},{value:"Saturday",label:"星期六"}],open:!1,pageStatus:"",orgTreeApi:o.a.getOrgTreeData,executorNames:[],org:{id:"",title:"请选择"},allDay:!1,firstSetRepeatCircle:!0,plan:{id:"",name:"",status:"",orgId:"",planStart:"",planEnd:"",executorId:"",period:30,periodUnit:"Minute",periodType:"Daily",periodValue:1,remindAdvance:5,holidayDisabled:0,pointsList:[]},ruleValidate:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{max:20,message:"名称不能超过20个字符",trigger:"change"}],orgId:[{required:!0,message:"请选择组织"}],remindAdvance:[{message:"请输入数值",type:"number",trigger:"change"}]},ruleValidateByRepeatCircle:{},planPointColumns:[{title:"序号",type:"index",width:60},{title:"巡检点名称",key:"patrolPoint",width:200},{title:"描述",key:"description"},{title:"巡检步骤",key:"stepCount"},{title:"区域位置",key:"relatedProcessNames"},{title:"编号",key:"no"},{title:"操作",width:150,render:function(a,t){return a("a",{attrs:{href:"javascript:;"},style:{color:"#346C93",margin:"0 10px 0 0"},on:{click:function(){e.deletePoint(t.row)}}},"删除")}}],pointsModalShown:!1,selectedData:[],selectedTemp:[],selectedPoints:[],modalSearchParams:{queryName:"",pageSize:10,currentPage:1},modalColumns:[{type:"selection",width:60},{title:"巡检点",key:"patrolPoint"},{title:"描述",key:"description"},{title:"巡检步骤",key:"stepCount"},{title:"区域位置",key:"relatedProcessNames"},{title:"编号",key:"no"}],modalListData:[],modalLoading:!1,modalTotal:0,pointsApi:p.a.point,relProcess:{id:null,title:"请选择"},processTreeApi:o.a.getProcessTreeData,searchParams:{queryName:"",processIds:"",pageSize:10,currentPage:1},repeatCircleShown:!1,disabledByStartTime:!1,disabledByEndTime:!1,repeatCircleData:{startTime:"",endTime:"",planStart:"",planEnd:"",taskEndDate:"",duration:"30分钟",durationLabel:"30分钟",periodType:"Daily",periodValue:1,periodValue2:1,periodMonth:"",periodMonth2:"",periodRankArr:[],periodRank:1,periodRank2:"",periodRankValue:"",repeatCount:1,accordingToDay:"day",accordingToMonth:"1",accordingToYear:"1",repeatType:"2"},optionsByPlanStart:{disabledDate:function(a){return!!a&&(e.repeatCircleData.taskEndDate?a.valueOf()<Date.now()-864e5||a.valueOf()>new Date(e.repeatCircleData.taskEndDate).getTime():a.valueOf()<Date.now()-864e5)}},optionsByPlanStartModal:{disabledDate:function(a){return!!a&&(e.repeatCircleData.planEnd?a.valueOf()<Date.now()-864e5||a.valueOf()>new Date(e.repeatCircleData.planEnd).getTime():a.valueOf()<Date.now()-864e5)}},optionsByTaskEndDate:{disabledDate:function(a){return!!a&&(e.repeatCircleData.planStart?a.valueOf()<Date.now()-864e5||a.valueOf()<new Date(e.repeatCircleData.planStart).getTime():a.valueOf()<Date.now()-864e5)}},optionsByPlanEnd:{disabledDate:function(a){return!!a&&(e.repeatCircleData.planStart?a.valueOf()<Date.now()-864e5||a.valueOf()<new Date(e.repeatCircleData.planStart).getTime():a.valueOf()<Date.now()-864e5)}}}},watch:{"repeatCircleData.endTime":function(e){e&&this.plan.planEnd&&(this.plan.planEnd=new Date(u(this.plan.planEnd,this.repeatCircleData.endTime)),this.renderRepeatCircle())}},created:function(){c.a.initTableColumnTitle(this.planPointColumns)},mounted:function(){var e=this.$route.name,a=this.$route.query,t=this.$route.params;if("patrol-plan-edit"==e)this.pageStatus="edit",this.getData(t.id);else if("patrol-plan-add"==e){this.pageStatus="add",this.plan.status="New","map"==a.type?this.plan.type="Outside":this.plan.type="Inside";var r=c.a.transDateFromServer(u(new Date,"08:00"),"yyyy-MM-dd hh:mm"),i=c.a.transDateFromServer(u(new Date,"08:30"),"yyyy-MM-dd hh:mm");this.plan.planStart=r,this.plan.planEnd=i,this.repeatCircleData.taskEndDate=i,this.repeatCircleData.planStart=r,this.repeatCircleData.planEnd=i,this.repeatCircleData.startTime="08:00",this.repeatCircleData.endTime="08:30",this.renderRepeatCircle()}else"patrol-plan-copy"==e&&(this.pageStatus="copy",this.getData(t.id));this.$refs.mpointsTable.getData(this.searchParams)},computed:Object(i.b)({planStates:function(e){return e.map.patrol.plan.planStates}}),methods:{getPeriodAndUnit:function(){var e=this.repeatCircleData.duration||0,a=parseFloat(e);isNaN(a)||(this.plan.period=a,this.plan.periodUnit="Hour",e.indexOf&&(-1!=e.indexOf("分钟")?this.plan.periodUnit="Minute":-1!=e.indexOf("小时")?this.plan.periodUnit="Hour":-1!=e.indexOf("天")?this.plan.periodUnit="Day":-1!=e.indexOf("周")&&(this.plan.periodUnit="Week")))},setPeriodAndUnit:function(){var e=this.plan.periodUnit,a=this.plan.period;isNaN(a)||(this.plan.period=a,"Minute"==e&&(this.repeatCircleData.duration=a+"分钟"),"Hour"==e&&(this.repeatCircleData.duration=a+"小时"),"Day"==e&&(this.repeatCircleData.duration=a+"天"),"Week"==e&&(this.repeatCircleData.duration=a+"周"),this.repeatCircleData.durationLabel=this.repeatCircleData.duration)},calcDuration:function(e){var a=u(this.repeatCircleData.planStart,this.repeatCircleData.startTime);if(this.repeatCircleData.taskEndDate&&this.repeatCircleData.endTime){var t=u(this.repeatCircleData.taskEndDate,this.repeatCircleData.endTime);this.repeatCircleData.duration=function(e,a,t){if(e&&a){var r=(new Date(a).getTime()-new Date(e).getTime())/1e3/60;return r>60||60==r?r%60==0||r%30==0?r=r/60%24==0?parseFloat(r/60/24)+"天":parseFloat((r/60).toFixed(1))+"小时":r+="分钟":r<0?(r="0分钟",t.repeatCircleData.endTime=t.repeatCircleData.startTime):r+="分钟",r}}(a,t,this),this.repeatCircleData.durationLabel=this.repeatCircleData.duration,e&&e(this)}},taskStartChange:function(e){this.plan.planStart=new Date(u(this.repeatCircleData.planStart,this.repeatCircleData.startTime)),this.calcDuration((function(e){e.getPeriodAndUnit(),e.renderRepeatCircle()}))},taskEndDateChange:function(e){if(this.firstSetRepeatCircle){var a=new Date(u(this.repeatCircleData.taskEndDate,this.repeatCircleData.endTime));this.repeatCircleData.planEnd=a,this.plan.planEnd=a}this.calcDuration((function(e){e.getPeriodAndUnit(),e.renderRepeatCircle()}))},getTaskEndDateByDuration:function(){var e=this.repeatCircleData.duration,a=parseFloat(this.repeatCircleData.duration),t=0;e.indexOf&&(t=-1!=e.indexOf("分钟")?60*a*1e3:-1!=e.indexOf("小时")?60*a*60*1e3:-1!=e.indexOf("天")?24*a*60*60*1e3:-1!=e.indexOf("周")?7*a*24*60*60*1e3:60*a*60*1e3,this.repeatCircleData.taskEndDate=new Date(new Date(u(this.repeatCircleData.planStart,this.repeatCircleData.startTime)).getTime()+t),this.repeatCircleData.endTime=h(this.repeatCircleData.taskEndDate))},taskStartTimeChange:function(){this.plan.planStart=new Date(u(this.repeatCircleData.planStart,this.repeatCircleData.startTime)),this.getTaskEndDateByDuration(),this.renderRepeatCircle()},taskEndTimeChange:function(){this.calcDuration((function(e){e.getPeriodAndUnit(),e.renderRepeatCircle()}))},taskStartTimeChangeByModal:function(){this.getTaskEndDateByDuration()},taskEndTimeChangeByModal:function(){this.calcDuration()},planStartChangeByModal:function(){var e=u(this.repeatCircleData.planStart,this.repeatCircleData.startTime),a=u(this.repeatCircleData.taskEndDate,this.repeatCircleData.endTime);new Date(e).getTime()>new Date(a).getTime()&&this.getTaskEndDateByDuration()},selectedAllDayTask:function(e){if(this.allDay){this.repeatCircleData.startTime="00:00",this.disabledByStartTime=!0,this.repeatCircleData.endTime="00:00",this.disabledByEndTime=!0;var a=new Date(u(this.repeatCircleData.planStart,"00:00")),t=new Date(a.getTime()+864e5);this.plan.planStart=a,this.plan.planEnd=t,this.repeatCircleData.planStart=a,this.repeatCircleData.planEnd=t,this.repeatCircleData.taskEndDate=t,this.calcDuration(),this.getPeriodAndUnit(),this.repeatCircleData.periodType="Daily",this.repeatCircleData.periodValue=1,this.plan.periodType="Daily",this.plan.periodValue=1,this.plan.periodRank=null,this.plan.periodMonth=null,this.plan.periodRankValue=null,this.renderRepeatCircle()}else this.disabledByStartTime=!1,this.disabledByEndTime=!1},changePeriod:function(e){var a=0;"Minute"==e.unit&&(a=60*parseFloat(e.label)*1e3),"Hour"==e.unit&&(a=60*parseFloat(e.label)*60*1e3),"Day"==e.unit&&(a=24*parseFloat(e.label)*60*60*1e3),"Week"==e.unit&&(a=7*parseFloat(e.label)*24*60*60*1e3);var t=new Date(new Date(u(this.repeatCircleData.planStart,this.repeatCircleData.startTime)).getTime()+a);this.repeatCircleData.taskEndDate=t,this.repeatCircleData.planEnd=t,this.repeatCircleData.endTime=h(t),this.repeatCircleData.duration=e.label},blurDuration:function(e){this.repeatCircleData.startTime||(this.repeatCircleData.startTime="00:00");var a=new Date(u(this.repeatCircleData.planStart,this.repeatCircleData.startTime)),t=this.repeatCircleData.duration||0,r=parseFloat(parseFloat(t).toFixed(1));isNaN(r)&&(r=0);var i="小时",l=0;t.indexOf?-1!=t.indexOf("分钟")?(i="分钟",l=60*r*1e3):-1!=t.indexOf("小时")?(i="小时",l=60*r*60*1e3):-1!=t.indexOf("天")?(i="天",l=24*r*60*60*1e3):-1!=t.indexOf("周")&&(i="周",l=7*r*24*60*60*1e3):l=60*r*60*1e3;var n=new Date(a.getTime()+l);this.repeatCircleData.taskEndDate=n,this.repeatCircleData.planEnd=n,this.repeatCircleData.endTime=h(n),this.repeatCircleData.duration=r+""+i,this.repeatCircleData.durationLabel=this.repeatCircleData.duration},inputNumberFormatter:function(e){return parseInt(e)},changeRegularMode:function(e){this.repeatCircleData.periodValue=1,this.repeatCircleData.periodValue2=1,this.repeatCircleData.periodMonth="",this.repeatCircleData.periodMonth2="",this.repeatCircleData.periodRank=1,this.repeatCircleData.periodRank2="",this.repeatCircleData.periodRankValue=""},accordingToDayChange:function(e){"day"!=e&&(this.repeatCircleData.periodRank="2;3;4;5;6")},repeatCircle:function(){this.repeatCircleShown=!0},repeatCircleCancle:function(){this.repeatCircleShown=!1,this.setRepeatCircleData()},repeatCircleConfirm:function(){if(!this.repeatCircleData.duration)return this.$Notice.warning({title:"请添加持续时间"}),!1;if(this.plan.periodType=this.repeatCircleData.periodType,"Hourly"==this.repeatCircleData.periodType){if(!this.repeatCircleData.periodValue)return this.$Notice.warning({title:"请输入按小时定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue,this.plan.periodRank=null,this.plan.periodMonth=null,this.plan.periodRankValue=null}if("Daily"==this.repeatCircleData.periodType)if("day"==this.repeatCircleData.accordingToDay){if(!this.repeatCircleData.periodValue)return this.$Notice.warning({title:"请输入按天定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue,this.plan.periodRank=null,this.plan.periodMonth=null,this.plan.periodRankValue=null}else this.plan.periodRank=this.repeatCircleData.periodRank,this.plan.periodValue=1,this.plan.periodMonth=null,this.plan.periodRankValue=null;if("Weekly"==this.repeatCircleData.periodType){if(!this.repeatCircleData.periodValue)return this.$Notice.warning({title:"请输入按周定期模式的周期值"}),!1;if(this.plan.periodValue=this.repeatCircleData.periodValue,0==this.repeatCircleData.periodRankArr.length)return this.$Notice.warning({title:"请选择按周定期模式的星期"}),!1;this.plan.periodRank=this.repeatCircleData.periodRankArr.join(","),this.plan.periodMonth=null,this.plan.periodRankValue=null}if("Monthly"==this.repeatCircleData.periodType)if("1"==this.repeatCircleData.accordingToMonth){if(!this.repeatCircleData.periodValue||!this.repeatCircleData.periodRank)return this.$Notice.warning({title:"请输入按月定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue,this.plan.periodMonth=null,this.plan.periodRank=this.repeatCircleData.periodRank,this.plan.periodRankValue=null}else{if(!(this.repeatCircleData.periodValue2&&this.repeatCircleData.periodRank2&&this.repeatCircleData.periodRankValue))return this.$Notice.warning({title:"请输入按月定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue2,this.plan.periodMonth=null,this.plan.periodRank=this.repeatCircleData.periodRank2,this.plan.periodRankValue=this.repeatCircleData.periodRankValue}if("Yearly"==this.repeatCircleData.periodType)if("1"==this.repeatCircleData.accordingToYear){if(!(this.repeatCircleData.periodValue&&this.repeatCircleData.periodMonth&&this.repeatCircleData.periodRank))return this.$Notice.warning({title:"请输入按年定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue,this.plan.periodMonth=this.repeatCircleData.periodMonth,this.plan.periodRank=this.repeatCircleData.periodRank,this.plan.periodRankValue=null}else{if(!(this.repeatCircleData.periodValue&&this.repeatCircleData.periodMonth2&&this.repeatCircleData.periodRank2&&this.repeatCircleData.periodRankValue))return this.$Notice.warning({title:"请输入按年定期模式的周期值"}),!1;this.plan.periodValue=this.repeatCircleData.periodValue,this.plan.periodMonth=this.repeatCircleData.periodMonth2,this.plan.periodRank=this.repeatCircleData.periodRank2,this.plan.periodRankValue=this.repeatCircleData.periodRankValue}if("2"==this.repeatCircleData.repeatType){if(!this.repeatCircleData.planEnd)return this.$Notice.warning({title:"请选择结束时间"}),!1;this.plan.planEnd=u(this.repeatCircleData.planEnd,this.repeatCircleData.endTime),this.plan.repeatCount=null}else{if(!this.repeatCircleData.repeatCount)return this.$Notice.warning({title:"请输入重复次数"}),!1;this.plan.repeatCount=this.repeatCircleData.repeatCount,this.plan.planEnd=null}this.plan.planStart=u(this.repeatCircleData.planStart,this.repeatCircleData.startTime),this.firstSetRepeatCircle=!1,this.renderRepeatCircle(),this.repeatCircleShown=!1},setRepeatCircleData:function(){switch(this.repeatCircleData.planStart=this.plan.planStart,this.repeatCircleData.startTime=h(this.plan.planStart),this.repeatCircleData.planEnd=this.plan.planEnd,this.setPeriodAndUnit(),this.getTaskEndDateByDuration(),this.renderRepeatCircle(),this.repeatCircleData.periodType=this.plan.periodType,this.plan.periodType){case"Hourly":this.repeatCircleData.periodValue=this.plan.periodValue;break;case"Daily":"2;3;4;5;6"==this.plan.periodRank?this.repeatCircleData.accordingToDay="2;3;4;5;6":this.repeatCircleData.accordingToDay="day",this.repeatCircleData.periodValue=this.plan.periodValue,this.repeatCircleData.periodRank=this.plan.periodRank;break;case"Weekly":this.repeatCircleData.periodValue=this.plan.periodValue,this.repeatCircleData.periodRankArr=this.plan.periodRank&&this.plan.periodRank.split(",");break;case"Monthly":this.plan.periodRankValue?(this.repeatCircleData.accordingToMonth="2",this.repeatCircleData.periodValue2=this.plan.periodValue,this.repeatCircleData.periodRank2=this.plan.periodRank,this.repeatCircleData.periodRankValue=this.plan.periodRankValue):(this.repeatCircleData.accordingToMonth="1",this.repeatCircleData.periodValue=this.plan.periodValue,this.repeatCircleData.periodRank=Number(this.plan.periodRank));break;case"Yearly":this.plan.periodRankValue?(this.repeatCircleData.accordingToYear="2",this.repeatCircleData.periodValue=this.plan.periodValue,this.repeatCircleData.periodMonth2=this.plan.periodMonth,this.repeatCircleData.periodRank2=this.plan.periodRank,this.repeatCircleData.periodRankValue=this.plan.periodRankValue):(this.repeatCircleData.accordingToYear="1",this.repeatCircleData.periodValue=this.plan.periodValue,this.repeatCircleData.periodMonth=this.plan.periodMonth,this.repeatCircleData.periodRank=Number(this.plan.periodRank))}this.plan.repeatCount?(this.repeatCircleData.repeatCount=this.plan.repeatCount,this.repeatCircleData.repeatType="1"):this.repeatCircleData.repeatType="2"},renderRepeatCircle:function(){var e=this.plan.periodType,a=c.a.transDateFromServer(this.plan.planStart,"yyyy-MM-dd hh:mm"),t=c.a.transDateFromServer(this.plan.planEnd,"yyyy-MM-dd hh:mm");switch(e){case"Hourly":this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"小时（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"小时（"+a+"至"+t+"）";break;case"Daily":"2;3;4;5;6"==this.plan.periodRank?this.plan.repeatCount?this.repeatCircleData.repeatCircle="每个工作日（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每个工作日（"+a+"至"+t+"）":this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"天（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"天（"+a+"至"+t+"）";break;case"Weekly":var r=this.plan.periodRank&&this.plan.periodRank.split(","),i=[];r.sort().forEach((function(e){switch(e){case"2":i.push("星期一");break;case"3":i.push("星期二");break;case"4":i.push("星期三");break;case"5":i.push("星期四");break;case"6":i.push("星期五");break;case"7":i.push("星期六");break;case"1":i.push("星期日")}})),this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"周后的"+i.join(",")+"（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"周后的"+i.join(",")+"（"+a+"至"+t+"）";break;case"Monthly":this.plan.periodRankValue?this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"个月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"个月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（"+a+"至"+t+"）":this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"个月第"+this.plan.periodRank+"天（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"个月第"+this.plan.periodRank+"天（"+a+"至"+t+"）";break;case"Yearly":this.plan.periodRankValue?this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.orderArrayObj[this.plan.periodRank]+this.periodRankValueObj[this.plan.periodRankValue]+"（"+a+"至"+t+"）":this.plan.repeatCount?this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.plan.periodRank+"日（从"+a+"开始重复"+this.plan.repeatCount+"次）":this.repeatCircleData.repeatCircle="每"+this.plan.periodValue+"年后的"+this.plan.periodMonth+"月"+this.plan.periodRank+"日（"+a+"至"+t+"）"}},handleSubmit:function(){var e=this,a="post";this.$refs.planForm.validate((function(t){if(t){if(!e.plan.pointsList.length)return void e.$Notice.info({title:"请添加巡检点信息"});e.getPeriodAndUnit(),e.plan.orgId=e.org.id;var r=Object.assign({},e.plan);if(r.planStart=u(r.planStart,e.repeatCircleData.startTime),r.planEnd&&(r.planEnd=u(r.planEnd,e.repeatCircleData.endTime),new Date(r.planStart).getTime()>new Date(r.planEnd).getTime()||new Date(r.planStart).getTime()==new Date(r.planEnd).getTime()))return e.$Notice.warning({title:"巡检计划的开始日期不可大于或等于结束日期"}),!1;"edit"==e.pageStatus&&(a="put"),"patrol-plan-copy"==e.$route.name&&(r.id=""),e.submitLoading=!0,e.$http[a](p.a.updatePlan,r).then((function(a){(a.id||a.count)&&(e.submitLoading=!1,e.$Notice.success({title:"数据保存成功"}),"Outside"==e.plan.type?e.$router.push({name:"patrol-plan-map-edit",params:{id:r.id||a.id}}):e.$router.push({name:"patrol-plan"}))})).catch((function(){e.submitLoading=!1}))}}))},handleCancle:function(){var e=this;"add"==this.pageStatus?this.$Modal.confirm({title:"提示",content:"当前内容未保存，是否确定取消？",onOk:function(){e.$router.back()}}):this.$router.back()},getData:function(e){var a=this;this.$http.get(p.a.getPlan+"/"+e).then((function(e){"copy"==a.pageStatus&&(e.status="New"),a.plan=Object.assign({},a.plan,e),a.plan.planStart=c.a.transDateFromServer(a.plan.planStart,"yyyy-MM-dd hh:mm"),a.plan.planEnd=c.a.transDateFromServer(a.plan.planEnd,"yyyy-MM-dd hh:mm"),a.setPeriodAndUnit(),a.setRepeatCircleData(),a.renderRepeatCircle(),a.org.title=e.org,a.org.id=e.orgId,a.executorNames=a.getOperators(e.orgId),a.plan.holidayDisabled=Number(e.holidayDisabled),a.selectedData=[],a.selectedPoints=[],e.pointsList.forEach((function(e){a.selectedData.push(e),a.selectedPoints.push(e)}))}))},orgSelect:function(e){this.plan.orgId=e.id,this.getOperators(e.id)},getOperators:function(e){var a=this;this.$http.get(s.a.underOrganizationUsers,{orgId:e}).then((function(e){a.executorNames=e}))},modalSelect:function(e){this.selectedTemp=e;var a=[];this.selectedTemp.forEach((function(e){a.push(e)})),this.selectedData=a,this.pointsModalShown=!1,this.plan.pointsList=a},deletePoint:function(e){var a=this,t=this.selectedData,r=this.selectedPoints;t.forEach((function(t,r){t.id==e.id&&a.selectedData.splice(r,1)})),r.forEach((function(t,r){t.id==e.id&&a.selectedPoints.splice(r,1)})),this.plan.pointsList=t},add:function(){var e=[];this.selectedTemp.forEach((function(a){e.push(a)})),this.selectedData=e,this.pointsModalShown=!1,this.plan.pointsList=e},redirectToMap:function(){this.$router.push({name:"patrol-plan-map-edit",params:{id:this.plan.id}})},changeProcess:function(e){this.searchParams.processIds=e.id},search:function(){this.$refs.mpointsTable.getData(this.searchParams)},searchParamsClean:function(){this.relProcess.id="",this.relProcess.title="请选择",this.searchParams={queryName:"",processIds:"",pageSize:10,currentPage:1}}}},D=(t(955),t(1)),v=Object(D.a)(m,r,[],!1,null,null,null);v.options.__file="src/views/patrol/plan/add.vue";a.default=v.exports},515:function(e,a,t){var r=t(522);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,t(17).default)("43cd0b0e",r,!1,{})},517:function(e,a,t){"use strict";function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var i={F:function(e,a){if(!e)return"";"object"!=r(e)&&(e=new Date(e)),a=a||"yyyy-MM-dd";var t=e.getFullYear().toString(),i={M:e.getMonth()+1,d:e.getDate(),h:e.getHours(),m:e.getMinutes(),s:e.getSeconds()};for(var l in a=a.replace(/(y+)/gi,(function(e,a){return t.substr(4-Math.min(4,a.length))})),i)a=a.replace(new RegExp("("+l+"+)","g"),(function(e,a){return i[l]<10&&a.length>1?"0"+i[l]:i[l]}));return a},str2Date:function(e){if(e)return"object"!=r(e)?new Date(e):e},firstDayByWeek:function(e){var a=i.str2Date(e)||new Date,t=a.getDay(),r=(0==t?7:t)-1;return i.midnight(new Date(a.getTime()-24*r*60*60*1e3))},firstDayByMonth:function(e){var a=i.str2Date(e)||new Date;return i.midnight(new Date(a.getFullYear(),a.getMonth(),1))},firstDayByYear:function(e){var a=i.str2Date(e)||new Date;return i.midnight(new Date(a.getFullYear(),0,1))},countDateByStep:function(e,a,t,r){e=i.formatePolyfill(e);var l,n=i.str2Date(e)||new Date(e),o=n.getTime(),s=(new Date).getTime();switch(t){case"day":l=o+864e5*a;break;case"week":l=o+6048e5*a;break;case"month":l=new Date(n.getFullYear(),n.getMonth()+a,n.getDate()).getTime(),r&&(l=new Date(n.getFullYear(),n.getMonth()+a,n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()).getTime());break;case"year":l=new Date(n.getFullYear()+a,n.getMonth(),n.getDate()).getTime(),r&&(l=new Date(n.getFullYear()+a,n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()).getTime())}return l>s&&(l=s),r?l:i.midnight(l)},midnight:function(e){return e?i.F(e)+" 00:00:00":""},beforeMidnight:function(e){return e?i.F(e)+" 23:59:59":""},midnightMill:function(e){var a=i.str2Date(e)||new Date;return new Date(i.midnight(a)).getTime()},chain:function(e,a){return i.countDateByStep(e,-1,a)},yearOFyear:function(e){return i.countDateByStep(e,-1,"year")},getPeriods:function(e){var a,t=e.beginDate,r=new Date(i.formatePolyfill(t)),l=r.getTime();switch(e.cycle){case"day":a=l+864e5;break;case"week":a=l+6048e5;break;case"month":a=new Date(r.getFullYear(),r.getMonth()+1,r.getDate(),0,0,0).getTime();break;case"year":a=new Date(r.getFullYear()+1,r.getMonth(),r.getDate(),0,0,0).getTime()}return{min:l,max:new Date(a).getTime()}},formatePolyfill:function(e){return"string"!=typeof e?e:("string"==typeof e&&0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),e)},getTerminalsByMonth:function(e,a){var t,r;return 0==a?(t=new Date(e,0,1,0,0,0),r=new Date(e,11,31,23,59,59)):(t=new Date(e,a-1,1,0,0,0),r=new Date(e,a,0,23,59,59)),{start:t,end:r}},transDateFromServer:function(e,a){return e?("string"==typeof e&&0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),i.F(e,a||"yyyy-MM-dd hh:mm")):""},transDateFromLocale:function(e){return e?("string"==typeof e&&(0==/[TZ]/.test(e)&&(e=e.replace(/-/g,"/")),e=new Date(e)),e.toISOString()):""},strToData:function(e){var a=e.split(" ")[0].split("-"),t=[];return void 0!==e.split(" ")[1]&&(t=e.split(" ")[1].split(":")),new Date(a[0],a[1]-1,a[2],null!==t[0]?t[0]:0,null!==t[1]?t[1]:0,null!==t[2]?t[2]:0)}};a.a=i},521:function(e,a,t){"use strict";var r=t(515);t.n(r).a},522:function(e,a,t){(a=t(10)(!1)).push([e.i,"\n.cmp-datepicker {\r\n\tdisplay: inline-block;\n}\r\n",""]),e.exports=a},523:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"cmp-datepicker"},[t("DatePicker",{style:{width:e.width},attrs:{type:"date",placeholder:"开始日期",value:e.dateRange.start,disabled:e.disabled,options:e.startDateOptions},on:{"on-change":e.startDateChange}}),e._v(" "),t("span",[e._v(" - ")]),e._v(" "),t("DatePicker",{style:{width:e.width},attrs:{type:"date",placeholder:"结束日期",value:e.dateRange.end,disabled:e.disabled,options:e.endDateOptions},on:{"on-change":e.endDateChange}})],1)};r._withStripped=!0;var i=t(11),l=t(517),n={name:"datepickerRanger",props:{value:Object,width:String,disabled:{type:Boolean,default:!1},enabled:String},watch:{"value.start":function(e){this.dateRange.start=i.a.transDateFromServer(e,"yyyy-MM-dd")},"value.end":function(e){this.dateRange.end=i.a.transDateFromServer(e,"yyyy-MM-dd")}},data:function(){var e=this,a=l.a.midnightMill();return{dateRange:{start:i.a.transDateFromServer(this.value.start,"yyyy-MM-dd"),end:i.a.transDateFromServer(this.value.end,"yyyy-MM-dd")},startDateOptions:{disabledDate:function(t){return"coming"==e.enabled?t&&t.valueOf()<a:"halfYear"===e.enabled?t&&t.valueOf()<a-15552e6:e.dateRange.end&&t&&t.valueOf()>1*new Date(e.dateRange.end+" 23:59:59")}},endDateOptions:{disabledDate:function(t){var r=1*new Date(e.dateRange.start+" 00:00:00"),i=t&&t.valueOf();return"past"==e.enabled?t&&i>a:e.dateRange.start&&t&&i<r}}}},methods:{startDateChange:function(e){this.dateRange.start=e;var a=this.dateRange.start?i.a.transDateFromLocale(this.dateRange.start+" 00:00:00"):"",t=this.dateRange.end?i.a.transDateFromLocale(this.dateRange.end+" 23:59:59"):"";this.$emit("input",{start:a,end:t}),this.$emit("on-change",{start:a,end:t})},endDateChange:function(e){this.dateRange.end=e;var a=this.dateRange.start?i.a.transDateFromLocale(this.dateRange.start+" 00:00:00"):"",t=this.dateRange.end?i.a.transDateFromLocale(this.dateRange.end+" 23:59:59"):"";this.$emit("input",{start:a,end:t}),this.$emit("on-change",{start:a,end:t})}}},o=(t(521),t(1)),s=Object(o.a)(n,r,[],!1,null,null,null);s.options.__file="src/components/datepicker-ranger.vue";a.a=s.exports},528:function(e,a,t){var r=t(535);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,t(17).default)("ad278fbc",r,!1,{})},534:function(e,a,t){"use strict";var r=t(528);t.n(r).a},535:function(e,a,t){(a=t(10)(!1)).push([e.i,"\n.mg-select-table-tip {\r\n\ttext-align: right;\r\n\tline-height: 30px;\r\n\tcolor: #999;\n}\n.mg-select-table-tip strong {\r\n\tcolor: #777;\r\n\tmargin: 0 3px;\n}\n.mg-select-table-search .ivu-icon {\r\n\tright: 35px;\n}\r\n",""]),e.exports=a},537:function(e,a,t){"use strict";var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"mg-select-table"},[e._t("top"),e._v(" "),t("div",{staticClass:"mg-select-table-header"},[e._t("default",[t("div",{staticClass:"mg-select-table-search"},[t("Input",{staticStyle:{width:"200px"},attrs:{placeholder:e.searchPlaceholder,clearable:""},nativeOn:{keyup:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.search(a)}},model:{value:e.searchParams.queryName,callback:function(a){e.$set(e.searchParams,"queryName",a)},expression:"searchParams.queryName"}},[t("Button",{attrs:{slot:"append",icon:"ios-search"},on:{click:e.search},slot:"append"})],1)],1)]),e._v(" "),t("div",{staticClass:"mg-select-table-tip"},[e._v("已选择"),t("strong",[e._v(e._s(e.selectedTemp.length))]),e._v("个 "),t("a",{staticClass:"c-btn-text",attrs:{href:"javascript:;"},on:{click:e.cleanup}},[e._v("[清空]")])])],2),e._v(" "),t("div",{attrs:{id:e.TID}},[t("Table",{ref:e.tableRef,attrs:{columns:e.columns,data:e.listData,loading:e.loading,stripe:"",size:e.size},on:{"on-select":e.onSelect,"on-select-cancel":e.onSelectCancel,"on-select-all":e.onSelectAll}})],1),e._v(" "),t("Page",{staticClass:"table-page",attrs:{total:e.total,"page-size":e.searchParams.pageSize,current:e.searchParams.currentPage,"show-total":"","show-elevator":"",size:e.size},on:{"on-change":e.pageChange}}),e._v(" "),t("div",{staticClass:"c-modal-footer-btns",staticStyle:{margin:"30px auto 0"}},[t("Button",{attrs:{type:"default",shape:"circle"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),t("Button",{attrs:{type:"primary",shape:"circle"},on:{click:e.submit}},[e._v("确定")])],1)],2)};r._withStripped=!0;var i=t(11),l={name:"mgSelectTable",props:{disabledRow:Boolean,selected:Array,searchPlaceholder:String,columns:{type:Array,default:[]},url:String,size:{type:String,default:"small"},max:Number,manual:Boolean,field:String},watch:{selected:function(e){var a=JSON.stringify(e);this.selectedTemp=JSON.parse(a),this.selectedTruth=JSON.parse(a),this.checkSelection()}},data:function(){return{TID:"",searchParams:{queryName:"",currentPage:1,pageSize:10},listData:[],selectedTemp:[],selectedTruth:[],loading:!1,total:0,tableRef:""}},methods:{cleanup:function(){this.selectedTemp=[],this.selectedTruth=[],this.checkSelection()},getData:function(e){var a=this;e&&(this.searchParams=Object.assign({},{queryName:"",currentPage:1,pageSize:10},e)),this.loading=!0,this.$http.get(this.url,this.searchParams).then((function(e){var t=e.items?e.items:[];a.disabledRow&&t.forEach((function(e){e.disabled&&(e._disabled=!0)})),a.field&&t.forEach((function(e){e.id||(e.id=e[a.field])})),a.listData=t,a.total=e.total,a.loading=!1,a.checkSelection()}))},pageChange:function(e){this.searchParams.currentPage=e,this.getData()},search:function(){this.searchParams.currentPage=1,this.getData()},onSelect:function(e,a){var t=this.selectedTemp;this.max&&t.length>=this.max?(this.$Notice.info({title:"最多选择"+this.max+"个"}),this.cancelChecked(a.id)):this.selectedTemp.push(a)},onSelectCancel:function(e,a){var t=this;this.selectedTemp.forEach((function(e,r){e.id==a.id&&t.selectedTemp.splice(r,1)}))},onSelectAll:function(e){0==e.length?this.removeTableFromTemp(this.listData):this.addTableToTemp(e)},addTableToTemp:function(e){var a=this.selectedTemp;e.forEach((function(e){var t=!1;a.forEach((function(a,r){a.id==e.id&&(t=!0)})),t||a.push(e)}))},removeTableFromTemp:function(e){for(var a=this.selectedTemp,t=a.length;t--;){var r=!1;e.forEach((function(e){e.id==a[t].id&&(r=!0)})),r&&a.splice(t,1)}},cancelChecked:function(e){var a=this;this.checkSelection();var t=this.selectedTemp,r=[];t.forEach((function(t){t.id==e&&a.$set(t,"_checked",!1),r.push(t)})),this.selectedTemp=r},checkSelection:function(){var e=this;this.$nextTick((function(){var a=e.listData,t=e.selectedTemp,r=e.$refs[e.tableRef];a.forEach((function(e,a){var i=r.$refs.tbody.objData[a];i._isChecked=!1,t.forEach((function(a){a.id==e.id&&(i._isChecked=!0)}))}))}))},submit:function(){this.selectedTruth=i.a.copyArray(this.selectedTemp),this.$emit("on-submit",this.selectedTruth)},cancel:function(){this.selectedTemp=i.a.copyArray(this.selectedTruth),this.checkSelection(),this.$emit("on-cancel")}},mounted:function(){this.max&&(document.querySelector("#"+this.TID).querySelector(".ivu-table-header").querySelector(".ivu-table-cell").style.display="none"),this.manual||this.getData()},created:function(){var e=i.a.gusid(6);this.TID="J_TABLE_"+e,this.tableRef="mg-select-table-"+e,i.a.initTableColumnTitle(this.columns)}},n=(t(534),t(1)),o=Object(n.a)(l,r,[],!1,null,null,null);o.options.__file="src/components/mg-select-table.vue";a.a=o.exports},539:function(e,a,t){"use strict";var r=t(22),i={getTasks:"/patrol/api/tasks",getTaskDetail:"/patrol/api/tasks",delTasks:"/patrol/api/tasks",modifyTask:"/patrol/api/tasks",stop:"/patrol/api/tasks",updatePatrolTaskPoint:"/patrol/api/task-point-step",plan:"/patrol/api/plans",getPlan:"/patrol/api/plans",updatePlan:"/patrol/api/plans",deletePlan:"/patrol/api/plans",planPath:"/patrol/api/plan-path",releasePlan:"/patrol/api/plans/release",interruptPlan:"/patrol/api/plans/interrupt",statistics:"/patrol/api/tasks/statistics",export:r.a+"/patrol/api/tasks/statistics-export",point:"/patrol/api/points",getQrcode:r.a+"/patrol/api/points/qrcode-export",trace:"/patrol/api/tasks/map-track"};a.a=i},709:function(e,a,t){var r=t(956);"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,t(17).default)("2901dcd1",r,!1,{})},710:function(e,a,t){e.exports=t.p+"images/c06aff95ea60ffe5aafe68ea98d65d9e.png"},955:function(e,a,t){"use strict";var r=t(709);t.n(r).a},956:function(e,a,t){var r=t(10),i=t(24),l=t(957),n=t(710);a=r(!1);var o=i(l),s=i(n);a.push([e.i,"\n.patrol-points-title {\r\n    height: 40px;\n}\n.patrol-points-title h3 {\r\n    float: left;\n}\n.patrol-plan-form .c-form-row-2col {\r\n    height: auto;\n}\n.patrol-plan-form .c-form-row-2col .plan-date-item {\r\n    position: relative;\n}\n.patrol-plan-form .c-form-row-2col .plan-date-item .repeat-circle-btn-wrap {\r\n    position: absolute;\r\n    left: 432px;\r\n    top: 6px;\n}\n.patrol-plan-form .c-form-row-2col .plan-date-item .refresh-btn {\r\n    display: block;\r\n    width: 100px;\r\n    height: 22px;\r\n    line-height: 22px;\r\n    font-style: normal;\r\n    font-size: 14px;\r\n    color: #4b7efe;\r\n    padding-left: 20px;\r\n    background: url("+o+") no-repeat 0 0;\r\n    background-size: 16%;\r\n    cursor: pointer;\n}\n.patrol-plan-form .c-form-row-2col .plan-date-item .all-day-btn {\r\n    font-size: 14px;\r\n    position: absolute;\r\n    left: 406px;\r\n    top: 0px;\n}\n.patrol-plan-form .ivu-form-item {\r\n    margin-bottom: 10px;\n}\n.patrol-plan-form .ivu-form-item-error {\r\n    margin-bottom: 25px;\n}\n.patrol-points-modal .c-search-main {\r\n    margin-bottom: 10px;\n}\n.patrol-plan-map-type {\r\n    margin-left: 10px;\r\n    vertical-align: top;\r\n    display: inline-block;\r\n    width: 64px;\r\n    height: 25px;\r\n    background: url("+s+") no-repeat 0 0;\n}\n.patrol-repeat-circle-modal .ivu-modal-body {\r\n    font-size: 13px;\n}\n.patrol-repeat-circle-modal .ivu-modal-footer {\r\n    padding-top: 0;\r\n    padding-bottom: 1px;\n}\n.patrol-repeat-circle-modal .part-1 .duration-input {\r\n    width: 85px;\r\n    height: 26px;\r\n    position: absolute;\r\n    top: 4px;\r\n    left: 2px;\r\n    color: #495060;\r\n    padding-left: 5px;\r\n    border: none;\n}\n.patrol-repeat-circle-modal .part-2,\r\n.patrol-repeat-circle-modal .part-3 {\r\n    margin-top: 10px;\r\n    padding-top: 10px;\r\n    border-top: 1px solid #f1f1f1;\n}\n.patrol-repeat-circle-modal .part-3 .ivu-radio-group {\r\n    margin-left: 10px;\n}\n.patrol-repeat-circle-modal .part-3 .ivu-radio-wrapper {\r\n    margin-bottom: 10px;\n}\n.patrol-repeat-circle-modal h3 {\r\n    font-size: 14px;\r\n    color: #4b7efe;\r\n    margin-bottom: 10px;\n}\n.patrol-repeat-circle-modal .ivu-form-item {\r\n    margin-bottom: 10px;\n}\n.patrol-repeat-circle-modal .ivu-form-item .ivu-form-item-label {\r\n    text-align: left;\r\n    font-size: 13px;\r\n    color: #666;\n}\n.patrol-repeat-circle-modal .regular-mode-list {\r\n    display: inline-block;\r\n    width: 100px;\r\n    border-right: 1px solid #f1f1f1;\r\n    margin-bottom: 0;\n}\n.patrol-repeat-circle-modal .regular-mode-content {\r\n    display: inline-block;\r\n    width: 400px;\r\n    padding-left: 10px;\n}\n.patrol-repeat-circle-modal .regular-mode-day .ivu-radio-wrapper,\r\n.patrol-repeat-circle-modal .regular-mode-month .ivu-radio-wrapper,\r\n.patrol-repeat-circle-modal .regular-mode-year .ivu-radio-wrapper {\r\n    margin: 10px 0;\n}\n.patrol-repeat-circle-modal .regular-mode-week .ivu-checkbox-wrapper {\r\n    margin: 5px 0;\n}\n.regular-mode-week .ivu-checkbox-group {\r\n    margin-top: 10px;\n}\n.regular-mode-month {\r\n    position: relative;\n}\n.regular-mode-month > ul {\r\n    position: absolute;\r\n    left: 15px;\r\n    top: 0;\n}\n.regular-mode-month > ul > li {\r\n    margin: 12px 5px 0;\r\n    list-style: none;\n}\n.regular-mode-year {\r\n    position: relative;\n}\n.regular-mode-year .ivu-radio-group {\r\n    display: block;\n}\n.regular-mode-year > ul {\r\n    position: absolute;\r\n    left: 15px;\r\n    top: 28px;\n}\n.regular-mode-year > ul > li {\r\n    margin: 12px 5px 0;\r\n    list-style: none;\n}\n.repeat-type {\r\n    position: absolute;\r\n    left: 260px;\r\n    top: -10px;\n}\n.repeat-type > li {\r\n    font-size: 13px;\r\n    margin: 12px 5px 0;\r\n    list-style: none;\n}\r\n",""]),e.exports=a},957:function(e,a,t){e.exports=t.p+"images/95e28e4d59ff9e5d57344ebc2a3084db.png"}}]);