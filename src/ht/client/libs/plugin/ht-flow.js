!function(V){"use strict";var k=V.ht,_=k.Default,j=_.getInternal(),e=j.ui(),n=null,l="__segmentLengths",m="__lineTotalLength",y="__linePoints",K="__distance0",D="flow.count",H="flow.step",S="flow.element.max",t="flow.element.count",Q="flow.element.min",P="flow.element.space",v="flow.element.autorotate",b="flow.element.background",A="flow.element.shadow.max",o="flow.element.shadow.min",z="flow.element.shadow.begincolor",I="flow.element.shadow.endcolor",i="flow.element.shadow.visible",u="flow.element.image",C="flow",x=k.Math.Vector2,W=new x;new x,new x;var X=k.List,f=function(L,t,S,c,z,O){var u,k,K,b,P,f,d,X,T,h,N,g=[];if(Math.abs(c)>2*Math.PI&&(c=2*Math.PI),P=Math.ceil(Math.abs(c)/(Math.PI/4)),u=c/P,k=-u,K=-S,P>0){f=L+Math.cos(S)*z,d=t+Math.sin(-S)*O,g.push({x:f,y:d});for(var l=0;P>l;l++)K+=k,b=K-k/2,X=L+Math.cos(K)*z,T=t+Math.sin(K)*O,h=L+Math.cos(b)*(z/Math.cos(k/2)),N=t+Math.sin(b)*(O/Math.cos(k/2)),g.push({x:h,y:N}),g.push({x:X,y:T})}return g},M=function(Y){if(Y){var h=Y._data;if(h instanceof k.Shape)return{points:h.getPoints(),segments:h.getSegments()};var n;if(h instanceof k.Edge&&(n=Y._78o)){var D,R,H=n.type,p=n.points,E=n.segments,u=n.edgeTypeInfo;if(!H||p){var O=n.sourcePoint,x=O.x,P=O.y,Q=n.targetPoint,j=Q.x,g=Q.y;if(H)E?(D=new X({x:x,y:P}),D.addAll(p),D.add({x:j,y:g}),R=new X(E._as)):(D=new X({x:x,y:P}),p.each(function($){D.add($)}),D.add({x:j,y:g}));else if(n.looped){D=new X(f(x,P,0,2*Math.PI,n.radius,n.radius)),R=new X([1]);for(var N=0;N<(D.size()-1)/2;N++)R.add(3)}else D=new X,n.center?(D.add({x:n.c1.x,y:n.c1.y}),D.add({x:x,y:P}),D.add({x:j,y:g}),D.add({x:n.c2.x,y:n.c2.y})):(D.add({x:x,y:P}),D.add({x:j,y:g}))}else u&&(D=new X(u.points._as),u.segments&&(R=new X(u.segments._as)));return{points:D,segments:R}}}},Z=function(G,R,S){if(null==R){var A=M(G);if(!A)return;R=A.points,S=A.segments}if(R){if(Array.isArray(R)&&(R=new X(R)),"number"==typeof R.get(0)){for(var Q=new k.List,J=0;J<R.size();J+=2)Q.add({x:R.get(J),y:R.get(J+1)});R=Q}if(!S){S=[1];for(var r=R.length-1;r>0;r--)S.push(2)}Array.isArray(S)&&(S=new X(S));for(var O=j.toPointsArray(R._as,S._as,50),K=O.length,m=[],J=0;K>J;J++){var b=O[J];b.length>1&&m.push(b)}return m}},U=function(d,y){for(var m=[],Y=d.length,s=0;Y>s;s++){var $=d[s];$._as&&($=$._as);for(var v=$[0],Z=1;Z<$.length;Z++)m.push([v,$[Z]]),v=$[Z]}for(var M=[],s=0;s<m.length;s++){var x=R(m[s][0],m[s][1],y);M.push(x)}return{distance:M,segments:m}},d=function(v,V,P){if(v){for(var q,H=U(v,V),w=H.distance,Q=H.segments,i=1/0,p=null,M=0,f=w.length;f>M;M++){var R=w[M];R.z<i&&(q=M,i=R.z,p=R)}if(null==P&&(P=.1),p.z<P){for(var b=0,S=0;q>=S;S++)b+=_.getDistance(Q[S][0],q>S?Q[S][1]:p);return b}}},R=function(L,Z,I){var l=L.x,X=L.y,r=Z.x,R=Z.y,y=I.x,i=I.y,V=r-l,P=R-X,F=Math.sqrt(V*V+P*P),E=V/F,o=P/F,J=(-l+y)*E+(-X+i)*o,b={x:l+J*E,y:X+J*o};return b.x>=Math.min(L.x,Z.x)&&b.x<=Math.max(L.x,Z.x)&&b.y>=Math.min(L.y,Z.y)&&b.y<=Math.max(L.y,Z.y)||(b.x=Math.abs(b.x-L.x)<Math.abs(b.x-Z.x)?L.x:Z.x,b.y=Math.abs(b.y-L.y)<Math.abs(b.y-Z.y)?L.y:Z.y),V=y-b.x,P=i-b.y,b.z=Math.sqrt(V*V+P*P),b},O=function(i,H){if(i){var t=U(i,H).distance,X=1/0,N=null;return t.forEach(function(W){W.z<X&&(X=W.z,N=W)}),N}},B=function(w){for(var J=0,h=w.length-1,j=0;h>j;j++){var i=w[j],k=w[j+1],g=k.x-i.x,o=k.y-i.y;J+=Math.sqrt(g*g+o*o)}return J},L=function(q,b){for(var N=0,p=b.length,M=0;p>M;M++){var k=b[M];if(N+=k,N>q)return M}return Math.min(M,p-1)},J=function(X,B){for(var Z=0,f=0,u=0,L=X.length-1,A=0;L>A;A++){var b=X[A],K=X[A+1],S=K.x-b.x,y=K.y-b.y;if(u=Math.sqrt(S*S+y*y),Z+=u,Z>B){Z-=u,f=A;break}}var p=X[f],F=X[f+1],c=Math.atan2(F.y-p.y,F.x-p.x),I=B-Z,y=Math.sin(c)*I,S=Math.cos(c)*I;return{x:p.x+S,y:p.y+y}},q=function(p,K,f){if(!p)return f;if(0===K){var j=p[0][0],d=p[0][1];return f+Math.atan2(d.y-j.y,d.x-j.x)}if(100===K){p=p[p.length-1];var j=p[p.length-2],d=p[p.length-1];return f+Math.atan2(d.y-j.y,d.x-j.x)}for(var W=0,N=[],R=p.length,S=0;R>S;S++){var n=p[S],A=B(n);W+=A,N.push(A)}for(var G=W*K/100,U=L(G,N),u=0,O=0;U>O;O++)u+=N[O];G-=u;for(var k=J(p[U],G),Y=p[U],e=0,i=0,v=0;v<Y.length-1;v++){var _=Y[v],l=Y[v+1],m=l.x-_.x,Z=l.y-_.y,r=Math.sqrt(m*m+Z*Z);if(e+=r,e>G){i=v;break}}var t=Y[i];return f+Math.atan2(k.y-t.y,k.x-t.x)},p=function(y){var u=0;if(y)if(Array.isArray(y[0]))for(var C=y.length,a=0;C>a;a++){var P=y[a],I=B(P);u+=I}else u=B(y);return u},c=function(e,M,_,K){return W.set(M,_).rotateAround(null,K),e?{x:e.x+W.x,y:e.y+W.y}:{x:W.x,y:W.y}},r=function(O){var r=O._data,o=Z(O);if(o){r.s("flow.reverse")&&(o.reverse(),o.forEach(function(z){z.reverse()}));for(var j=0,z=[],f=o.length,W=0;f>W;W++){var g=o[W],T=B(g);j+=T,z.push(T)}if(r[l]=z,r[m]=j,r[y]=o,r instanceof k.Edge){var V=_.unionPoint(o),R=V.x+V.width/2,M=V.y+V.height/2;r.$10e={x:R,y:M}}Y(O,!0)}},N=function(A,S){if(A){var b;if(0===S)b=A[0][0];else if(100===S)A=A[A.length-1],b=A[A.length-1];else{for(var e=0,y=[],c=A.length,k=0;c>k;k++){var E=A[k],Q=B(E);e+=Q,y.push(Q)}for(var Y=e*S/100,o=L(Y,y),q=0,T=0;o>T;T++)q+=y[T];Y-=q,b=J(A[o],Y)}return b}},Y=function(M,q){var P=M._data,e=P[m],h=P.s(D),o=P.s(H),_=0,F=P[l],Z=P.s(S),p=P.s(Q),Y=P.s(t),b=(Z-p)/(Y-1),d=[];if(F){if(1===Y)d.push(Z);else if(2===Y)d.push(Z),d.push(p);else{if(!(Y>2))return;d.push(Z);for(var A=Y-2;A>0;A--)d.push(p+b*A);d.push(p)}var y=0,k=0;d.forEach(function(F){Y-1>y&&(k+=P.getFlowElementSpace(F)),y++}),k+=(Z+p)/2,_=(e-h*k+k)/h;var U=M[K];for(null==U&&(U=0),q||(U+=o);U>e+k;){var v=M._overCount;v?v++:v=1,v>=h&&(v=null),M._overCount=v,P.s("flow.autoreverse")?v?U-=_+k:(U=0,P.s("flow.reverse",!P.s("flow.reverse"))):U-=_+k}M[K]=U}},G="prototype",E=k.graph.GraphView[G],s=k.Data[G],g=e.DataUI[G],T=e.ShapeUI[G],$=e.EdgeUI[G],F=k.DataModel[G],h=k.Style;h[S]==n&&(h[S]=7),h[Q]==n&&(h[Q]=0),h[D]==n&&(h[D]=1),h[H]==n&&(h[H]=3),h[t]==n&&(h[t]=10),h[P]==n&&(h[P]=3.5),h[v]==n&&(h[v]=!1),h[b]==n&&(h[b]="rgba(255, 255, 114, 0.4)"),h[z]==n&&(h[z]="rgba(255, 255, 0, 0.3)"),h[I]==n&&(h[I]="rgba(255, 255, 0, 0)"),h[i]==n&&(h[i]=1),h[A]==n&&(h[A]=22),h[o]==n&&(h[o]=4),E.calculatePointLength=function(G,C,V){var w=this.getDataUI(G),m=Z(w);return d(m,C,V)},_.calculatePointLength=function(e,c,$,K){var E=Z(n,e,c);return d(E,$,K)},_.calculateClosestPointOnLine=R,E.calculateClosestPoint=function(E,p){var u=this.getDataUI(E),M=Z(u);return O(M,p)},_.calculateClosestPoint=function(l,g,x){var z=Z(n,l,g);return O(z,x)},E.getPercentAngle=function(P,a){var z=this.getDataUI(P),T=Z(z);return P.getRotation?P.getRotation():0,q(T,a,P.getRotation?P.getRotation():0)},_.getPercentAngle=function($,U,R){var E=Z(n,$,U);return q(E,R,0)},E.calculateLength=function(C){var j=this.getDataUI(C),U=Z(j);return p(U)},_.calculateLength=function(k,e){var g=Z(n,k,e);return p(g)},E.getPercentPosition=function(J,E){var e=this.getDataUI(J),p=Z(e);return N(p,E)},_.getPercentPositionOnPoints=function(C,_,j){var t=Z(n,C,_);return N(t,j)};var a=function(f){var M=f.data,A=this.dm();if(M&&"add"===f.kind){var l=A.$3e;l&&M.s(C)&&l.indexOf(M)<0&&l.push(M)}"clear"===f.kind&&(A.$3e=[])},w=function(r){var v=r.property,j=r.data,Z=r.newValue,g=this.dm().$3e;if(g&&"s:flow"===v)if(Z)g.indexOf(j)<0&&g.push(j);else for(var G=g.length,m=0;G>m;m++)if(g[m]===j){g.splice(m,1);break}},ln=E.setDataModel;E.setDataModel=function(t){var A=this,d=A._dataModel;if(d!==t){d&&(d.umm(a,A),d.umd(w,A),d.$3e=[]),t.mm(a,A),t.md(w,A);var e=t.$3e=[];t.each(function(D){D.s(C)&&e.indexOf(D)<0&&e.push(D)}),ln.call(A,t)}},s.getFlowElementSpace=function(){return this.s(P)};var $g=function(s){var N=this,b=N._data,q=b[m],W=b[l],p=b[y],d=b.s(D),j=0,e=N[K],O=b.s(S),w=b.s(Q),E=b.s(t),u=b.s(o),V=b.s(A),M=b.s(v),r=(V-u)/(E-1),z=(O-w)/(E-1),H=b.getRotation?b.getRotation():0,R=b.getPosition?b.p():b.$10e,$=[],Z=[];if(e!=n){if(1===E)$.push(O);else if(2===E)$.push(O),$.push(w);else{if(!(E>2))return;$.push(O);for(var a=E-2;a>0;a--)$.push(w+z*a);$.push(w)}if(1===E)Z.push(V);else if(2===E)Z.push(V),Z.push(u);else{if(!(E>2))return;Z.push(V);for(var a=E-2;a>0;a--)Z.push(u+r*a);Z.push(u)}var U=0,I=0;$.forEach(function(Q){E-1>U&&(I+=b.getFlowElementSpace(Q)),U++}),I+=(O+w)/2,j=(q-d*I+I)/d,s.save();for(var a=0;d>a;a++){var P=e,x=0,G=N._overCount,k=0;b.s("flow.autoreverse")&&G&&G>d-(a+1)||(P-=a*(j+I),U=0,$.forEach(function(O){var G=P-x;if(G>=0&&q>G){var e=!0,m=L(G,W);k=0;for(var B=0;m>B;B++)k+=W[B];if(G-=k,e){var o=J(p[m],G),K=H;if(M){for(var d=p[m],T=0,V=0,i=0;i<d.length-1;i++){var Y=d[i],y=d[i+1],z=y.x-Y.x,u=y.y-Y.y,j=Math.sqrt(z*z+u*u);if(T+=j,T>G){V=i;break}}var n=d[V];K+=Math.atan2(o.y-n.y,o.x-n.x)}H&&(o=c(R,o.x-R.x,o.y-R.y,H)),N.$5e(s,o,O,Z[U],K)}}x+=b.getFlowElementSpace($[U]),U++}))}s.restore()}},$f=$._80o;$._80o=function(K){$f.call(this,K);var X=this,$=X._data,u=X.gv;$.s(C)&&u.$7e!=n&&$g.call(X,K)};var vi=T._80o;T._80o=function(T){vi.call(this,T);var V=this,c=V._data,D=V.gv;c.s(C)&&D.$7e!=n&&$g.call(V,T)};var go=$._79o,kq=T._79o,vm=function(){var t=this,s=t._data,p=s.s(S),M=!1,x=n;if(t._6I||(M=!0),x=s instanceof k.Edge?go.call(t):kq.call(t),s.s(C)&&M){var u=s.s(A),v=s.s(i);v&&u>p&&(p=u),p>0&&_.grow(x,Math.ceil(p/2)),r(t)}return!s.s(C)&&M&&(s[l]=s[m]=s[y]=t[K]=n),x};T._79o=vm,$._79o=vm,g.$5e=function(Q,f,v,T,D){var C=this,Z=C._data,U=C.gv,t=Z.s(b),o=Z.s(z),W=Z.s(I),L=Z.s(i),h=U.$8e,q=Z.s(u);if(h==n&&(h=U.$8e={}),Q.beginPath(),q!=n){var l=_.getImage(q),F=v/2;Q.translate(f.x,f.y),Q.rotate(D),Q.translate(-f.x,-f.y),_.drawImage(Q,l,f.x-F,f.y-F,v,v,Z),Q.translate(f.x,f.y),Q.rotate(-D),Q.translate(-f.x,-f.y)}else if(U.__flowBatch){var y=U.__flowBatchGroup;y||(y=U.__flowBatchGroup={});var d=[f.x,f.y,v/2];y[t]?y[t].push(d):y[t]=[d]}else Q.fillStyle=t,Q.arc(f.x,f.y,v/2,0,2*Math.PI,!0),Q.fill();if(L){var m=22,e=m+"_"+o+"_"+W,X=h[e];if(X==n){var w=document.createElement("canvas");j.setCanvas(w,m,m);var E=w.getContext("2d"),B=m/2,x=B,M=B;j.translateAndScale(E,0,0,1),E.beginPath();var c=E.createRadialGradient(x,M,0,x,x,B);c.addColorStop(0,o),c.addColorStop(1,W),E.fillStyle=c,E.arc(x,M,B,0,2*Math.PI,!0),E.fill(),X=h[e]=w}var F=T/2;_.drawImage(Q,X,f.x-F,f.y-F,T,T,Z)}},E.$9e=function(){var t=this,M=t.dm().$3e;t._24I,M.forEach(function(F){t._24I[F._id]=F}),t.iv()};var jq=F.prepareRemove;F.prepareRemove=function(z){jq.call(this,z);var U=z._dataModel,P=U.$3e;if(P)for(var N=P.length,K=0;N>K;K++)if(P[K]===z){P.splice(K,1);break}},E.setFlowInterval=function(e){var B=this,J=B.$11e;B.$11e=e,B.fp("flowInterval",J,e),B.$7e!=n&&(clearInterval(B.$7e),delete B.$7e,B.enableFlow(e))},E.getFlowInterval=function(){return this.$11e},E.enableFlow=function(d){var m=this,P=m.dm(),A=P.$3e;m.$7e==n&&(A.forEach(function(i){var g=m.getDataUI(i);r(g)}),m.$7e=setInterval(function(){P.$3e.forEach(function(S){Y(m.getDataUI(S))}),m.$9e()},d||m.$11e||50))},E.disableFlow=function(){var E=this;clearInterval(E.$7e),delete E.$7e;var T=E.dm().$3e;T&&E.$9e()};var ok=function(){this.__flowBatchGroup={}},aj=function(J){var r=this.__flowBatchGroup;if(r){J.save();for(var m in r){J.fillStyle=m,J.beginPath();var G=r[m];G.forEach(function(x){J.moveTo(x[0],x[1]),J.arc(x[0],x[1],x[2],0,2*Math.PI,!0)}),J.fill()}J.restore()}};E.setFlowBatch=function(F){var Q=this;!!Q.__flowBatch!=!!F&&(Q.__flowBatch=F,F?(Q.addBottomPainter(ok),Q.addTopPainter(aj)):(Q.removeBottomPainter(ok),Q.removeTopPainter(aj)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);