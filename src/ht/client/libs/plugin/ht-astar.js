!function(n,A,g){"use strict";var v=n.ht;v.Astar={},function(B){var Z=B();n.AStar=Z.astar,n.AStar.Graph=Z.Graph}(function(){function V(R){for(var F=R,M=[];F.parent;)M.unshift(F),F=F.parent;return M}function u(){return new K(function(P){return P.f})}function L(T,f){f=f||{},this.nodes=[],this.diagonal=!!f.diagonal,this.grid=[];for(var c=0;c<T.length;c++){this.grid[c]=[];for(var U=0,z=T[c];U<z.length;U++){var R=new m(c,U,z[U]);this.grid[c][U]=R,this.nodes.push(R)}}this.$13x()}function m(U,v,C){this.x=U,this.y=v,this.weight=C}function K(B){this.content=[],this.scoreFunction=B}var W={search:function(B,P,J,G){B.$6x(),G=G||{};var E=G.heuristic;E||(E=B.diagonal?W.$4x.diagonal:W.$4x.manhattan);var c=G.closest||!1,C=G.punish,$=u(),p=P;for(P.h=E(P,J),B.$7x(P),$.push(P);$.size()>0;){var y=$.pop();if(y===J)return V(y);y.closed=!0;for(var Y=B.neighbors(y),s=0,R=Y.length;R>s;++s){var Z=Y[s];if(!Z.closed&&!Z.$9x()){var j=y.g+Z.getCost(y,C),n=Z.visited;(!n||j<Z.g)&&(Z.visited=!0,Z.parent=y,Z.h=Z.h||E(Z,J),Z.g=j,Z.f=Z.g+Z.h,B.$7x(Z),c&&(Z.h<p.h||Z.h===p.h&&Z.g<p.g)&&(p=Z),n?$.$10x(Z):$.push(Z))}}}return c?V(p):[]},$4x:{manhattan:function(R,m){var e=Math.abs(m.x-R.x),c=Math.abs(m.y-R.y);return e+c},diagonal:function(B,U){var S=1,$=Math.sqrt(2),K=Math.abs(U.x-B.x),A=Math.abs(U.y-B.y);return S*(K+A)+($-2*S)*Math.min(K,A)}},$5x:function(h){h.f=0,h.g=0,h.h=0,h.visited=!1,h.closed=!1,h.parent=null}};return L.prototype.$13x=function(){this.dirtyNodes=[];for(var o=0;o<this.nodes.length;o++)W.$5x(this.nodes[o])},L.prototype.$6x=function(){for(var A=0;A<this.dirtyNodes.length;A++)W.$5x(this.dirtyNodes[A]);this.dirtyNodes=[]},L.prototype.$7x=function(O){this.dirtyNodes.push(O)},L.prototype.neighbors=function(p){var o=[],z=p.x,n=p.y,g=this.grid;return g[z-1]&&g[z-1][n]&&o.push(g[z-1][n]),g[z+1]&&g[z+1][n]&&o.push(g[z+1][n]),g[z]&&g[z][n-1]&&o.push(g[z][n-1]),g[z]&&g[z][n+1]&&o.push(g[z][n+1]),this.diagonal&&(g[z-1]&&g[z-1][n-1]&&o.push(g[z-1][n-1]),g[z+1]&&g[z+1][n-1]&&o.push(g[z+1][n-1]),g[z-1]&&g[z-1][n+1]&&o.push(g[z-1][n+1]),g[z+1]&&g[z+1][n+1]&&o.push(g[z+1][n+1])),o},L.prototype.toString=function(){for(var N=[],L=this.grid,P=0;P<L.length;P++){for(var Y=[],T=L[P],l=0;l<T.length;l++)Y.push(T[l].weight);N.push(Y.join(" "))}return N.join("\n")},m.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},m.prototype.getCost=function(P,b){var N;if(N=P&&P.x!=this.x&&P.y!=this.y?1.41421*this.weight:this.weight,b){var t=P;if(!t)return N;var g=t.parent;return g?Math.abs(g.x+this.x-2*t.x)>1e-5?N+b:Math.abs(g.y+this.y-2*t.y)>1e-5?N+b:N:N}},m.prototype.$9x=function(){return 0===this.weight},K.prototype={push:function(J){this.content.push(J),this.$11x(this.content.length-1)},pop:function(){var i=this.content[0],U=this.content.pop();return this.content.length>0&&(this.content[0]=U,this.$12x(0)),i},remove:function(u){var b=this.content.indexOf(u),W=this.content.pop();b!==this.content.length-1&&(this.content[b]=W,this.scoreFunction(W)<this.scoreFunction(u)?this.$11x(b):this.$12x(b))},size:function(){return this.content.length},$10x:function(U){this.$11x(this.content.indexOf(U))},$11x:function(y){for(var l=this.content[y];y>0;){var E=(y+1>>1)-1,K=this.content[E];if(!(this.scoreFunction(l)<this.scoreFunction(K)))break;this.content[E]=l,this.content[y]=K,y=E}},$12x:function(v){for(var I=this.content.length,s=this.content[v],N=this.scoreFunction(s);;){var e,t=v+1<<1,P=t-1,W=null;if(I>P){var x=this.content[P];e=this.scoreFunction(x),N>e&&(W=P)}if(I>t){var Y=this.content[t],h=this.scoreFunction(Y);(null===W?N:e)>h&&(W=t)}if(null===W)break;this.content[v]=this.content[W],this.content[W]=s,v=W}}},{astar:W,Graph:L}});var O=v.Astar.Finder=function(v,H){var q=this;q.gv=v,q.$13x(H),q.refreshMap()};O.prototype={},O.prototype.constructor=O,A.defineProperties(O.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(G){this.gv._astarDebugInfo=G}}}),O.prototype.$13x=function(v){var s=this,f=s.$14x={};v=v||{};var N=v.gridSize||10;f.gridSizeX=v.gridSizeX||N,f.gridSizeY=v.gridSizeY||N,f.rect=v.rect,f.filter=v.filter,f.extendBlocks=v.extendBlocks||3,f.fastOverlap=v.fastOverlap===g?!0:v.fastOverlap,f.nodeRectExtend=v.nodeRectExtend||0,f.diagonal=v.diagonal===g?!0:v.diagonal,f.turnPunish=v.turnPunish===g?.1:v.turnPunish,f.simplify=v.simplify===g?!0:v.simplify,f.toGridCenter=v.toGridCenter===g?!1:v.toGridCenter,f.closest=v.closest===g?!0:v.closest},O.prototype.refreshMap=function(){var s,S=this,r=S.$14x,z=r.gridSizeX,T=r.gridSizeY,E=r.extendBlocks;r.rect?s=r.rect:(s=S.$15x(),v.Default.grow(s,z*E,T*E)),v.Default.grow(s,z,T);var V=Math.floor(s.x/z)*z,D=Math.floor(s.y/T)*T,B=Math.ceil(s.width/z),e=Math.ceil(s.height/T),X=B*z,q=e*T;S.$16x={x:V,y:D,w:X,h:q,gridX:z,gridY:T,xLen:B,yLen:e},S.$17x(),S.$21x()},O.prototype.$15x=function(){var j=this.gv;if(j instanceof v.graph.GraphView)return j.getContentRect();var t,P=v.Default.unionRect;return j.dm().each(function(E){j.isVisible(E)&&E.getRect&&(t=P(t,E.getRect()))}),t},O.prototype.$17x=function(){var q,H,b,s,J=this,Z=J.$16x,Q=Z.xLen,M=Z.yLen;for(q=new Array(Q),b=0;Q>b;b++)for(q[b]=H=new Array(M),s=M;s--;)H[s]=1;var g=J.$14x.filter;for(J.gv.dm().each(function(t){g&&g(t)===!1||(!J._debugInfo||t!==J._debugInfo.grid&&t!=J._debugInfo.path)&&J.$1cw(q,t)}),b=0;Q>b;b++)q[b][0]=1,q[b][M-1]=1;for(s=0;M>s;s++)q[0][s]=1,q[Q-1][s]=1;J.grid=q;var n=new AStar.Graph(q,{diagonal:J.$14x.diagonal});J.graph=n},O.prototype.$18x=function(Q,d,J,R,a,X,V,z){var W=this.$19x,E=W(J-Q,a-V,R-d,X-z);if(1e-6>=E&&E>=-1e-6)return!1;var q=W(a-Q,a-V,X-d,X-z)/E;if(0>q||q>1)return!1;var T=W(J-Q,a-Q,R-d,X-d)/E;return 0>T||T>1?!1:!0},O.prototype.$19x=function(F,h,f,m){return F*m-h*f},O.prototype.$1aw=function(l,f,S,Y){for(var b=[-(f[1]-l[1]),f[0]-l[0]],u=b[0]*(S[0]-l[0])+b[1]*(S[1]-l[1])>=0,s=0,A=Y.length;A>s;s+=2)if(b[0]*(Y[s]-l[0])+b[1]*(Y[s+1]-l[1])>=0===u)return!1;return!0},O.prototype.$1bw=function(l,x){for(var e,O,y=this,s=0,q=l.length;q>s;s+=2)if(e=s===q-2?0:s+2,O=e===q-2?0:e+2,y.$1aw([l[s],l[s+1]],[l[e],l[e+1]],[l[O],l[O+1]],x))return!1;for(var s=0,q=x.length;q>s;s+=2)if(e=s===q-2?0:s+2,O=e===q-2?0:e+2,y.$1aw([x[s],x[s+1]],[x[e],x[e+1]],[x[O],x[O+1]],l))return!1;return!0},O.prototype.$1cw=function(o,c){if(c.getRect){var D=this,k=c.getRect();v.Default.grow(k,D.$14x.nodeRectExtend);var Y,W,p,M,q,N,A,t,j,u,S,G=D.$1dw({x:k.x,y:k.y}),X=D.$1dw({x:k.x+k.width,y:k.y+k.height}),r=D.$14x.fastOverlap;if(!r){var l=c.getCorners();A=[],l.forEach(function(w){A.push(w.x,w.y)}),u=D.$14x.gridSizeX/2,S=D.$14x.gridSizeY/2}for(W=Math.max(0,G.x),p=Math.min(X.x,o.length-1),q=Math.max(0,G.y),N=Math.min(X.y,o.length?o[0].length-1:-1),Y=W;p>=Y;Y++)for(M=q;N>=M;M++)if(r)o[Y][M]=0;else{j=D.$1ew({x:Y,y:M});var E=j.x-u,J=j.x+u,s=j.y-S,H=j.y+S;t=[E,s,E,H,J,H,J,s],D.$1bw(A,t)&&(o[Y][M]=0)}}},O.prototype.$1dw=function(k,M){var x=this,G=x.$16x,d=(k.x-G.x)/G.gridX,l=(k.y-G.y)/G.gridY;return M!==!1&&(d=Math.round(d),l=Math.round(l)),{x:d,y:l}},O.prototype.$1ew=function(L){var v=this,S=v.$16x;return{x:L.x*S.gridX+S.x,y:L.y*S.gridY+S.y}},O.prototype.$1fw=function(P){var w=this,c=w.$16x,s=c.xLen,H=c.yLen;if(P.x>=0&&P.x<s&&P.y>=0&&P.y<H)return P;var n={x:P.x,y:P.y};return n.x<0?n.x=0:n.x>=s&&(n.x=s-1),n.y<0?n.y=0:n.y>=H&&(n.y=H-1),n},O.prototype.findPath=function(v,w){var c,f,F,D,E=this,C=E.$1dw(v),A=E.$1dw(w);if(F=E.$1fw(C),D=E.$1fw(A),F!==C&&D!==A){var X=E.$16x,i=X.x-X.gridX/2,M=X.y-X.gridY/2,y=i+X.gridX*X.xLen,G=M+X.gridY*X.yLen;if(!(E.$18x(v.x,v.y,w.x,w.y,i,M,y,M)||E.$18x(v.x,v.y,w.x,w.y,y,M,y,G)||E.$18x(v.x,v.y,w.x,w.y,y,G,i,G)||E.$18x(v.x,v.y,w.x,w.y,i,G,i,M)))return[v,w]}F!==C&&(c=!0,C=F),D!==A&&(f=!0,A=D);var a=E.graph.grid[C.x][C.y],k=E.graph.grid[A.x][A.y],t=AStar.search(E.graph,a,k,{closest:E.$14x.closest,punish:E.$14x.turnPunish});if(!t||!t.length)return null;var d=[];d.push(v),c&&d.push(E.$1ew(t[0]));for(var o=1,Z=t.length;Z-1>o;o++)d.push(E.$1ew(t[o]));if(f)d.push(E.$1ew(t[Z-1])),d.push(w);else{var P=t[Z-1];A.x!==P.x||A.y!==P.y||E.$14x.toGridCenter?d.push(E.$1ew(P)):d.push(w)}return E.$14x.simplify&&(d=E.simplifyPath(d)),E.$20x=d,E.$21x(),d},O.prototype.debugOn=function(Z){this.debugFlag=!0,this.debugSettings=Z||{},this.$21x()},O.prototype.simplifyPath=function(a){var D=a.length;if(2>=D)return a;var C,E,u=[a[0],a[1]],A=u[0],S=u[1],L=1e-5;for(C=2;D>C;C++)E=a[C],Math.abs((S.x-A.x)*(E.y-A.y)-(S.y-A.y)*(E.x-A.x))<L?S=u[u.length-1]=E:(A=S,S=E,u.push(E));return u},O.prototype.$21x=function(){var J=this;if(J.$22x(),this.debugFlag){var W=J.grid;if(W){var b,u=J.gv;if(J.debugSettings.$16x!==!1){b=[];for(var j,D,s,X,m,Z=[],V=J.$14x.gridSizeX/2,q=J.$14x.gridSizeY/2,L=W.length,B=L?W[0].length:0,I=1;L-1>I;I++)for(var o=1;B-1>o;o++)W[I][o]||(j=J.$1ew({x:I,y:o}),D=j.x-V,s=j.x+V,X=j.y-q,m=j.y+q,b.push({x:D,y:X},{x:D,y:m},{x:s,y:m},{x:s,y:X}),Z.push(1,2,2,2,5));var y=new v.Shape;y.s("shape.border.color","rgba(50, 50, 50, 0.2)"),y.s("shape.border.width",1),y.s("shape.background","rgba(200, 50, 100, 0.2)"),y.s("2d.editable",!1),y.s("2d.selectable",!1),y.setPoints(b),y.setSegments(Z),J._debugInfo={grid:y},u.dm().add(y)}J.debugSettings.path!==!1&&(b=new v.Shape,J.$20x&&(b.setPoints(J.$20x),b.s("shape.border.color","red"),b.s("shape.border.width",1),b.s("2d.editable",!1),b.s("2d.selectable",!1),b.s("shape.background",null),J._debugInfo||(J._debugInfo={}),J._debugInfo.path=b,u.dm().add(b)))}}},O.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},O.prototype.$22x=function(){var t=this;if(t._debugInfo){var b=t._debugInfo.grid,g=t._debugInfo.path,P=t.gv;b&&P.dm().remove(b),g&&P.dm().remove(g),t._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);