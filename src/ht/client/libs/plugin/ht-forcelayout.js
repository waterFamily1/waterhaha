!function(G,d){"use strict";var r="ht",x=r+".layout.",q=G[r]||module.parent.exports.ht,J=q.List,O=q.DataModel,A=q.Node,u=q.Edge,l=q.Group,V=Math,C=V.sqrt,H=V.random,T=V.max,B=V.min,I=function(E){return E*E};q.Default.getInternal().addMSMap({ms_force:function(G){G._interval=50,G._stepCount=10,G._motionLimit=.01,G._edgeRepulsion=.65,G._nodeRepulsion=.65,G._damper=1,G._maxMotion=0,G._motionRatio=0,G.init=function(j){var $=this;j instanceof O?$.dm=j:$.gv=j,$._nodeMap={},$._nodes=new J,$._edges=new J},G.start=function(){var C=this,Q=C.gv;if(!C._timer){var s=C.cdm=Q?Q.dm():C.dm;s.mm(C.handleDataModelChange,C),s.md(C.handleDataPropertyChange,C),Q&&Q.mp(C.handleGV,C),s.each(function(K){if(C.isVisible(K)&&C.isLayoutable(K)&&K instanceof A)if(C instanceof g){var D=K.p3();K.p3([D[0]+H(),D[1]+H(),D[2]+H()])}else D=K.p(),K.p(D.x+H(),D.y+H())}),C._timer=setInterval(function(){C.relax()},C._interval),C._damper=1}},G.stop=function(){var B=this;B._timer&&(B.cdm.umm(B.handleDataModelChange,B),B.cdm.umd(B.handleDataPropertyChange,B),B.gv&&B.gv.ump(B.handleGV,B),clearInterval(B._timer),delete B._timer,delete B.cdm)},G.handleGV=function(y){var z=this;if("dataModel"===y.property){var b=y.oldValue,_=y.newValue;b&&(b.umm(z.handleDataModelChange,z),b.umd(z.handleDataPropertyChange,z)),this.cdm=_,_.mm(z.handleDataModelChange,z),_.md(z.handleDataPropertyChange,z)}},G.relax=function(){var a=this;if(!(a._damper<.1&&a._maxMotion<a._motionLimit)){this.cdm.each(function(j){a.isVisible(j)&&(j instanceof u?a.addEdge(j):j instanceof A&&a.addNode(j))});for(var K,i,Q=0,p=a._edges,T=a._nodes,g=T.size();Q<a._stepCount;Q++){for(p.each(a.relaxEdge,a),K=0;g>K;K++)for(i=0;g>i;i++)a.relaxNode(T.get(K),T.get(i));a.moveNode()}a._isAdjusting=1,T.each(function(n){n.fix||(n.p?n.v.p3(n.p):n.v.p(n.x,n.y))}),delete a._isAdjusting,a._nodeMap={},T.clear(),p.clear(),a.onRelaxed()}},G.onRelaxed=function(){},G.isRunning=function(){return!!this._timer},G.isVisible=function(D){return D.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(D):!0},G.isLayoutable=function(q){if(q.s("layoutable")===!1)return!1;if(q instanceof l)return!1;var v=this;return v.gv?v.gv.isMovable(q)&&!v.gv.isSelected(q):!(v.cdm||v.dm).sm().co(q)},G.getNodeRepulsion=function(){return this._nodeRepulsion},G.setNodeRepulsion=function(J){this._nodeRepulsion=J,this._damper=1},G.getEdgeRepulsion=function(){return this._edgeRepulsion},G.setEdgeRepulsion=function(M){this._edgeRepulsion=M,this._damper=1},G.getStepCount=function(){return this._stepCount},G.setStepCount=function(G){this._stepCount=G,this._damper=1},G.getInterval=function(){return this._interval},G.setInterval=function(I){var B=this;B._interval!==I&&(B._interval=I,B._timer&&(clearInterval(B._timer),B._timer=setInterval(function(){B.relax()},I)))},G.handleDataPropertyChange=function(s){!this._isAdjusting&&this.isVisible(s.data)&&(this._damper=1)},G.handleDataModelChange=function(){this._damper=1},G.damp=function(){var Z=this._maxMotion,X=this._damper;this._motionRatio<=.001&&((.2>Z||Z>1&&.9>X)&&X>.01?this._damper-=.01:.4>Z&&X>.003?this._damper-=.003:X>1e-4&&(this._damper-=1e-4)),Z<this._motionLimit&&(this._damper=0)}}}),q.layout.ForceLayout=function(b){this.init(b)},q.Default.def(x+"ForceLayout",d,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},getNodeSize:function(u){var L=this.gv;return L&&L.getDataUIBounds?L.getDataUIBounds(u):u.getRect()},addNode:function(b){var Z=this,g=Z._nodeMap[b._id];if(g)return g;var y=b.p();g={v:b,x:y.x,y:y.y,dx:0,dy:0,fix:!Z.isLayoutable(b),s:Z.getNodeSize(b)};var e=g.s,z=C(I(e.width)+I(e.height))*Z._nodeRepulsion;return g.r=1>z?100:z,Z._nodeMap[b._id]=g,Z._nodes.add(g),g},addEdge:function(O){if(O._40I&&O._41I){var Z=this,H=Z.addNode(O._40I),R=Z.addNode(O._41I),h={s:H,t:R};R=R.s,H=H.s;var d=R.width+H.width,M=R.height+H.height;h.length=C(d*d+M*M)*Z._edgeRepulsion,h.length<=0&&(h.length=100),Z._edges.add(h)}},relaxEdge:function(x){var d=x.t,y=x.s,L=d.x-y.x,J=d.y-y.y,G=C(L*L+J*J),n=100*x.length,N=.25*L/n*G,A=.25*J/n*G;d.dx=d.dx-N,d.dy=d.dy-A,y.dx=y.dx+N,y.dy=y.dy+A},relaxNode:function(O,q){if(O!==q){var Q=0,E=0,c=O.x-q.x,Y=O.y-q.y,v=c*c+Y*Y;0===v?(Q=H(),E=H()):36e4>v&&(Q=c/v,E=Y/v);var R=O.r*q.r/400;Q*=R,E*=R,O.dx+=Q,O.dy+=E,q.dx-=Q,q.dy-=E}},moveNode:function(){var m=this,h=m._limitBounds,v=m._maxMotion,Y=0,x=m._damper;m._nodes.each(function(e){if(!e.fix){var d=e.dx*x,X=e.dy*x;if(e.dx=d/2,e.dy=X/2,Y=T(C(d*d+X*X),Y),e.x+=T(-40,B(40,d)),e.y+=T(-40,B(40,X)),h){e.x<h.x&&(e.x=h.x,m.adjust(1,0)),e.y<h.y&&(e.y=h.y,m.adjust(0,1));var J=e.s;e.x+J.width>h.x+h.width&&(e.x=h.x+h.width-J.width,m.adjust(-1,0)),e.y+J.height>h.y+h.height&&(e.y=h.y+h.height-J.height,m.adjust(0,-1))}}}),m._maxMotion=Y,m._motionRatio=Y>0?v/Y-1:0,m.damp()},adjust:function(I,m){var s=this._limitBounds;this._nodes.each(function(f){I>0?(!s||f.x+f.s.width+I<s.x+s.width)&&(f.x+=I):(!s||f.x+I>s.x)&&(f.x+=I),m>0?(!s||f.y+f.s.height+m<s.y+s.height)&&(f.y+=m):(!s||f.y+m>s.y)&&(f.y+=m)})}});var g=q.layout.Force3dLayout=function(P){this.init(P)};q.Default.def(x+"Force3dLayout",d,{ms_force:1,getNodeSize3d:function(a){return a.s3()},addNode:function(w){var D=this,t=D._nodeMap[w._id];if(t)return t;t={v:w,p:w.p3(),d:[0,0,0],fix:!D.isLayoutable(w),s:D.getNodeSize3d(w)};var H=t.s,B=q.Default.getDistance(H)*D._nodeRepulsion;return t.r=1>B?100:B,D._nodeMap[w._id]=t,D._nodes.add(t),t},addEdge:function(z){if(z._40I&&z._41I){var c=this,$=c.addNode(z._40I),i=c.addNode(z._41I),l={s:$,t:i};i=i.s,$=$.s,l.length=C(I(i[0]+$[0])+I(i[1]+$[1])+I(i[2]+$[2]))*c._edgeRepulsion,l.length<=0&&(l.length=100),c._edges.add(l)}},relaxEdge:function(K){var v=K.t.p,r=K.s.p,O=K.t.d,L=K.s.d,D=v[0]-r[0],S=v[1]-r[1],W=v[2]-r[2],$=C(D*D+S*S+W*W),A=100*K.length,F=.25*D/A*$,u=.25*S/A*$,I=.25*W/A*$;O[0]-=F,O[1]-=u,O[2]-=I,L[0]+=F,L[1]+=u,L[2]+=I},relaxNode:function(d,P){if(d!==P){var K=d.p,L=P.p,N=0,G=0,i=0,l=K[0]-L[0],C=K[1]-L[1],f=K[2]-L[2],v=l*l+C*C+f*f;0===v?(N=H(),G=H(),i=H()):216e6>v&&(N=l/v,G=C/v,i=f/v);var x=d.r*P.r/400,z=d.d,t=P.d;N*=x,G*=x,i*=x,z[0]+=N,z[1]+=G,z[2]+=i,t[0]-=N,t[1]-=G,t[2]-=i}},moveNode:function(){var w=this,v=w._maxMotion,a=0,z=w._damper;w._nodes.each(function(M){if(!M.fix){var g=M.p,x=M.d,K=x[0]*z,p=x[1]*z,W=x[2]*z;x[0]=K/2,x[1]=p/2,x[2]=W/2,a=T(C(K*K+p*p+W*W),a),g[0]+=T(-40,B(40,K)),g[1]+=T(-40,B(40,p)),g[2]+=T(-40,B(40,W))}}),w._maxMotion=a,w._motionRatio=a>0?v/a-1:0,w.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);