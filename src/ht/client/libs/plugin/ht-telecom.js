!function(g,T){"use strict";var t=ht.AlarmSeverity=function(c,C,r,i,f){this.value=c,this.name=C,this.nickName=r,this.color=i,this.displayName=f};ht.Default.def("ht.AlarmSeverity",T,{toString:function(){return this.displayName||this.name}}),function(){t.severities=new ht.List,t._vm={},t._nm={},t._cp=function(S,Y){if(S&&Y){var E=S.value-Y.value;return E>0?1:0>E?-1:0}return S&&!Y?1:!S&&Y?-1:0},t.each=function(l,Y){t.severities.each(l,Y)},t.getSortFunction=function(){return t._cp},t.setSortFunction=function($){t._cp=$,t.severities.sort($)},t.add=function(R,Y,f,r,O){var d=new t(R,Y,f,r,O);return t._vm[R]=d,t._nm[Y]=d,t.severities.add(d),t.severities.sort(t._cp),d},t.remove=function(d){var _=t._nm[d];return _&&(delete t._nm[d],delete t._vm[_.value],t.severities.remove(_)),_},t.CRITICAL=t.add(500,"Critical","C","#FF0000"),t.MAJOR=t.add(400,"Major","M","#FFA000"),t.MINOR=t.add(300,"Minor","m","#FFFF00"),t.WARNING=t.add(200,"Warning","W","#00FFFF"),t.INDETERMINATE=t.add(100,"Indeterminate","N","#C800FF"),t.CLEARED=t.add(0,"Cleared","R","#00FF00"),t.isClearedAlarmSeverity=function(S){return S?0===S.value:!1},t.getByName=function(D){return t._nm[D]},t.getByValue=function(N){return t._vm[N]},t.clear=function(){t.severities.clear(),t._vm={},t._nm={}},t.compare=function(V,C){return t._cp(V,C)}}();var N=ht.AlarmState=function(A){this._d=A,this._nm={},this._am={},this._ps=null,this._haa=null,this._hna=null,this._hoa=null,this._hta=null,this._hls=!1,this._aac=0,this._nac=0};ht.Default.def("ht.AlarmState",T,{_ep:!0,_f:function(){this._c1(),this._c2(),this._c3(),this._c4(),this._c5(),this._c6(),this._c7(),this._d.fp("alarmState",null,this)},getHighestAcknowledgedAlarmSeverity:function(){return this._haa},getHighestNewAlarmSeverity:function(){return this._hna},getHighestOverallAlarmSeverity:function(){return this._hoa},getHighestNativeAlarmSeverity:function(){return this._hta},hasLessSevereNewAlarms:function(){return this._hls},_c1:function(){var I=null;for(var c in this._am)c=t.getByName(c),t.isClearedAlarmSeverity(c)||0!==this.getAcknowledgedAlarmCount(c)&&(I=I?t.compare(I,c)>0?I:c:c);this._haa=I},_c2:function(){var E=null;for(var n in this._nm)n=t.getByName(n),t.isClearedAlarmSeverity(n)||0!==this.getNewAlarmCount(n)&&(E=E?t.compare(E,n)>0?E:n:n);this._hna=E},_c3:function(){if(!this._hna)return this._hls=!1,void 0;for(var Y in this._nm)if(Y=t.getByName(Y),!t.isClearedAlarmSeverity(Y)&&0!==this.getNewAlarmCount(Y)&&t.compare(this._hna,Y)>0)return this._hls=!0,void 0;this._hls=!1},_c4:function(){var V=this._haa,T=this._hna,O=this._ps;this._hoa=V,t.compare(T,this._hoa)>0&&(this._hoa=T),t.compare(O,this._hoa)>0&&(this._hoa=O)},_c5:function(){var R=this._haa,U=this._hna;this._hta=R,t.compare(U,this._hta)>0&&(this._hta=U)},increaseAcknowledgedAlarm:function(w,l){if(0!==l){l=l||1;var n=this._am[w.name]||0;n+=l,this._am[w.name]=n,this._f()}},increaseNewAlarm:function(q,H){if(0!==H){H=H||1;var v=this._nm[q.name]||0;v+=H,this._nm[q.name]=v,this._f()}},decreaseAcknowledgedAlarm:function(M,Q){if(0!==Q){Q||(Q=1);var J=this._am[M.name]||0;if(J-=Q,0>J)throw"Alarm count can not be negative";this._am[M.name]=J,this._f()}},decreaseNewAlarm:function(s,n){if(0!==n){n||(n=1);var u=this._nm[s.name]||0;if(u-=n,0>u)throw"Alarm count can not be negative";this._nm[s.name]=u,this._f()}},acknowledgeAlarm:function(Q){this.decreaseNewAlarm(Q,1),this.increaseAcknowledgedAlarm(Q,1)},acknowledgeAllAlarms:function(o){if(o){var b=this.getNewAlarmCount(o);this.decreaseNewAlarm(o,b),this.increaseAcknowledgedAlarm(o,b)}else for(var x in this._nm)this.acknowledgeAllAlarms(t.getByName(x))},_c6:function(){this._aac=0;for(var P in this._am)P=t.getByName(P),this._aac+=this.getAcknowledgedAlarmCount(P)},getAcknowledgedAlarmCount:function(l){return l?this._am[l.name]||0:this._aac},getAlarmCount:function(x){return this.getAcknowledgedAlarmCount(x)+this.getNewAlarmCount(x)},_c7:function(){this._nac=0;for(var c in this._nm)this._nac+=this.getNewAlarmCount(t.getByName(c))},getNewAlarmCount:function(W){return W?this._nm[W.name]||0:this._nac},setNewAlarmCount:function($,O){this._nm[$.name]=O,this._f()},removeAllNewAlarms:function(t){t?delete this._nm[t]:this._nm={},this._f()},setAcknowledgedAlarmCount:function(h,y){this._am[h.name]=y,this._f()},removeAllAcknowledgedAlarms:function(n){n?delete this._am[n.name]:this._am={},this._f()},isEmpty:function(){return!this._hoa},clear:function(){this._am={},this._nm={},this._f()},getPropagateSeverity:function(){return this._ps},setPropagateSeverity:function(B){if(this._ep||(B=null),this._ps!==B){var X=this._ps;this._ps=B,this._f(),this._d.fp("propagateSeverity",X,B)}},isEnablePropagation:function(){return this._ep},setEnablePropagation:function(q){var N=this._ep;this._ep=q,this._d.fp("enablePropagation",N,q)&&(q||this.setPropagateSeverity(null))}});var d=ht.AlarmStatePropagator=function(P){this._dataModel=P,this._enable=!1,this._isPropagating=!1};ht.Default.def("ht.AlarmStatePropagator",T,{getDataModel:function(){return this._dataModel},isEnable:function(){return this._enable},setEnable:function(K){this._enable!==K&&(this._enable=K,this._enable?(this._dataModel.mm(this.handleDataModelChange,this),this._dataModel.md(this.handleDataPropertyChange,this),this._dataModel.each(function(s){this.propagate(s)},this)):(this._dataModel.umm(this.handleDataModelChange,this),this._dataModel.umd(this.handleDataPropertyChange,this)))},handleDataModelChange:function(p){p.data&&this.propagate(p.data)},handleDataPropertyChange:function(g){if("alarmState"===g.property||"enablePropagation"===g.property)this.propagate(g.data);else if("parent"===g.property){var I=g.oldValue;I&&this.propagate(I),this.propagate(g.data)}},propagate:function(S){S&&!this._isPropagating&&(this._isPropagating=!0,this.propagateToTop(S),this._isPropagating=!1)},propagateToTop:function(R){for(this.propagateToParent(null,R);R&&R.getParent();)this.propagateToParent(R,R.getParent()),R=R.getParent()},propagateToParent:function(H,U){var l=null;U.getChildren().each(function(J){var u=J.getAlarmState().getHighestOverallAlarmSeverity();t.compare(u,l)>0&&(l=u)}),U.getAlarmState().setPropagateSeverity(l)}}),ht.AlarmStateStatistics=function(P){this.sumNew=0,this.sumAcked=0,this.sumTotal=0,this.severtiyMap={},this.dataMap={},this.setDataModel(P)},ht.Default.def("ht.AlarmStateStatistics",T,{ms_fire:1,getDataModel:function(){return this._dataModel},setDataModel:function(E){var I=this._dataModel;I!==E&&(I&&(I.umd(this.handleDataPropertyChange,this),I.umm(this.handleDataModelChange,this),this.severtiyMap={},this.dataMap={}),this._dataModel=E,this.reset(),E.md(this.handleDataPropertyChange,this),E.mm(this.handleDataModelChange,this),this.fp("dataModel",I,E))},dispose:function(){this._dataModel.umd(this.handleDataPropertyChange,this),this._dataModel.umm(this.handleDataModelChange,this),delete this._dataModel},handleDataPropertyChange:function(d){"alarmState"===d.property&&(this.increase(d.data),this.fireAlarmStateChange())},handleDataModelChange:function(a){"add"===a.kind?(this.increase(a.data),this.fireAlarmStateChange()):"remove"===a.kind?(this.decrease(a.data),this.fireAlarmStateChange()):"clear"===a.kind&&(this.severtiyMap={},this.dataMap={},this.fireAlarmStateChange())},fireAlarmStateChange:function(){this.sumAcked=0,this.sumNew=0,this.sumTotal=0,t.each(function(I){var l=this.getSumInfo(I);this.sumAcked+=l.ackedCount,this.sumNew+=l.newCount,this.sumTotal+=l.totalCount},this),this.fp("alarmState",!1,!0)},getNewAlarmCount:function(s){if(!s)return this.sumNew;var c=this.getSumInfo(s);return c.newCount},getAcknowledgedAlarmCount:function(V){if(!V)return this.sumAcked;var t=this.getSumInfo(V);return t.ackedCount},getTotalAlarmCount:function(Z){if(!Z)return this.sumTotal;var n=this.getSumInfo(Z);return n.totalCount},getSumInfo:function(j){var I=this.severtiyMap[j.name];return I||(I={},I.newCount=0,I.ackedCount=0,I.totalCount=0,this.severtiyMap[j.name]=I),I},decrease:function(i){var w=this.dataMap[i.getId()];w&&(delete this.dataMap[i.getId()],t.each(function(l){var I=w[l.name],W=this.getSumInfo(l);W.newCount=W.newCount-I.newCount,W.ackedCount=W.ackedCount-I.ackedCount,W.totalCount=W.totalCount-I.totalCount},this))},increase:function(d){if(this.decrease(d),!this._filterFunc||this._filterFunc(d)){var M={},Z=d.getAlarmState();this.dataMap[d.getId()]=M,t.each(function(w){var H={};H.newCount=Z.getNewAlarmCount(w),H.ackedCount=Z.getAcknowledgedAlarmCount(w),H.totalCount=Z.getAlarmCount(w),M[w.name]=H;var l=this.getSumInfo(w);l.newCount=l.newCount+H.newCount,l.ackedCount=l.ackedCount+H.ackedCount,l.totalCount=l.totalCount+H.totalCount},this)}},reset:function(){this.severtiyMap={},this.dataMap={},this._dataModel.each(this.increase,this),this.fireAlarmStateChange()},setFilterFunc:function(e){var X=this._filterFunc;this._filterFunc=e,this.reset(),this.fp("filterFunc",X,e)},getFilterFunc:function(){return this._filterFunc}});var o=ht.Data.prototype;o.getAlarmState=function(){return this._alarmState||(this._alarmState=new N(this))},o=ht.DataModel.prototype,o.isEnableAlarmStatePropagator=function(){return!!this._alarmStatePropagator&&this._alarmStatePropagator.isEnable()},o.setEnableAlarmStatePropagator=function(K){K!=this.isEnableAlarmStatePropagator()&&(K?(this._alarmStatePropagator=new d(this)).setEnable(!0):this._alarmStatePropagator.setEnable(!1))},o=ht.graph.GraphView.prototype,o.getNote2=function(g){var T=g.getAlarmState().getHighestNewAlarmSeverity();if(T){var Y=g.getAlarmState().getNewAlarmCount(T)+T.nickName;return g.getAlarmState().hasLessSevereNewAlarms()&&(Y+="+"),Y}return g.s("note2")},o.getNote2Background=function(T){var c=T.getAlarmState().getHighestNewAlarmSeverity();return c?c.color:T.s("note2.background")},o.getBodyColor=function(N){var j=N.getAlarmState().getHighestNativeAlarmSeverity();return j?j.color:N.s("body.color")},o.getBorderColor=function(A){var b=A.getAlarmState().getPropagateSeverity();return b?b.color:A.s("border.color")},o=ht.widget.TreeView.prototype,o.getBorderColor=function(y){var R=y.getAlarmState().getPropagateSeverity();return R?R.color:y.s("border.color")},o.getIcon=function(u){return u.getIcon()?"__alarmIcon__":null},o=ht.widget.TreeTableView.prototype,o.getBorderColor=function(i){var L=i.getAlarmState().getPropagateSeverity();return L?L.color:i.s("border.color")},o.getIcon=function(g){return g.getIcon()?"__alarmIcon__":null},ht.Default.setImage("__alarmIcon__",{width:16,height:16,comps:[{type:"image",name:{func:function(I){return I.getIcon()}},color:{func:function(v){var B=v.getAlarmState().getHighestNativeAlarmSeverity();return B?B.color:v.s("body.color")}},rect:[0,0,16,16]}]});var w=ht.Style;w["note2.expanded"]=!0,w["note2.color"]="#000"}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);