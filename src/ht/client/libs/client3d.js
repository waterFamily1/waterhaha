/*
 * client3d.js - v0.3.2
 * Compiled Wed Nov 28 2018 16:24:38 GMT+0800 (GMT+08:00)
 * Copyright (c) 2018 www.hisense.com & www.hightopo.com
 */

!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.hteditor3d=e()}(this,function(){"use strict";function t(t){return/^scenes/.test(t)}function e(t){return/^models/.test(t)}function i(t){return/^symbols/.test(t)}function n(t){return/^assets/.test(t)}function o(t){return ht.Default.getImageMap()[t]?(delete ht.Default.getImageMap()[t],!0):ht.Default.getCompTypeMap()[t]?(delete ht.Default.getCompTypeMap()[t],!0):(void 0!==ht.Default.getShape3dModel(t)&&ht.Default.setShape3dModel(t,void 0),!1)}function r(t,e,i,n){var o=new ht.Tab;return o.setName(e),o.setView(i),t.getTabModel().add(o),n&&t.getTabModel().sm().ss(o),o}function s(t,e,i){var n=new FileReader;n.onloadend=function(t){e(t.target.result)},i?n.readAsDataURL(t):n.readAsText(t)}function a(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?decodeURIComponent(i[2]):null}var d={createTablePane:function(){var t=new ht.widget.TablePane;return t.getView().style.border=hteditor.config.color_line+" solid 1px",t},removeItem:function(t,e){if(t){var i=t.indexOf(e);i>=0&&t.splice(i,1)}},alert:function(t,e,i,n){var o=[{label:"\u786e\u8ba4",action:function(){r.hide(),i&&i()}}],r=new ht.widget.Dialog({title:t||" ",contentPadding:20,width:n||300,draggable:!0,content:"<p>"+e+"</p>",buttons:o});r.show()},config:window.hteditor_config||{}},h=function(){};ht.Default.setImage("editor.axis",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(138,138,138)",borderCap:"round",shadowColor:"#1ABC9C",points:[8,2.48536,8,9,1.08734,12.01256,8,9,14,13]}]}),ht.Default.setImage("hxeditor.cube",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"rect",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[2.48996,3.51341,9.97783,10.97318]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15,1,12.39369,3.59417,12.39369,14.44,15,11.41017,15,1,5.46231,1,2.50972,3.59417]}]}),ht.Default.setImage("hxeditor.cube.image",{width:100,height:100,comps:[{type:"rect",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.sphere",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.49999,1.5,13,13]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",arcFrom:3.22886,arcTo:5.96903,arcClose:!1,arcOval:!0,opacity:.4,rotation:2.4578,rect:[.10993,1.43114,12.94079,10.68594]}]}),ht.Default.setImage("hxeditor.sphere.image",{width:100,height:100,comps:[{type:"oval",background:"rgba(156,156,156,0.4)",rect:[0,0,100,100]}]}),ht.Default.setImage("hxeditor.cylinder",{background:"rgb(179,179,179)",width:16,height:16,blendMode:"override",comps:[{type:"oval",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5,1.5,13,9.5]},{type:"arc",borderWidth:1,borderColor:"rgb(255,255,255)",arcClose:!1,arcOval:!0,opacity:.4,rotation:3.14159,rect:[1.49362,6,13,9.5]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[1.49362,10.75,1.48724,6.35177]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[14.5,10.75,14.5,6.10177]}]}),ht.Default.setImage("hxeditor.floor",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"parallelogram",borderWidth:1,borderColor:"rgb(255,255,255)",rect:[1.5056,9.71598,12.98879,3.75]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",opacity:.2,points:[14.49439,9.71598,14.49439,1.61266,4.70858,1.61266,4.70858,9.71598]}]}),ht.Default.setImage("hxeditor.wall",{background:"rgb(0,0,0)",width:16,height:16,comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.2,points:[2,15,10,15,14,11]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[6,2,14,2,14,11,6,11,2,15,2,6,6,2,6,11]}]}),ht.Default.setImage("hxeditor.cancel",{background:"red",width:16,height:16,comps:[{type:"circle",borderWidth:1,borderColor:"rgb(255,255,255)",shadowColor:"#1ABC9C",rect:[1,1,14,14]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[10.94702,4.96729,4.99893,11.04194]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",borderCap:"round",points:[5,4.96729,11.29505,11.29505]}]}),ht.Default.setImage("hxeditor.pipeline",{background:"rgb(82,82,82)",width:16,height:16,blendMode:"override",comps:[{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",points:[14.11524,6.61831,14.11524,6.61831,9.30492,12.81031,8.07676,10.14929,6.8486,7.48826,9.56079,4.00846,6.33686,4.00846,3.11293,4.00846,.86129,8.92112,.86129,8.92112],segments:[1,4,4,4]},{type:"shape",borderWidth:1,borderColor:"rgb(255,255,255)",opacity:.4,points:[15.28357,7.93382,15.28357,7.93382,10.47326,14.12582,9.24509,11.46479,8.01693,8.80377,10.72913,5.32397,7.50519,5.32397,4.28126,5.32397,2.02963,10.23663,2.02963,10.23663],segments:[1,4,4,4]}]});var l=(function(){function t(t){this.value=t}function e(e){function i(t,e){return new Promise(function(i,o){var a={key:t,arg:e,resolve:i,reject:o,next:null};s?s=s.next=a:(r=s=a,n(t,e))})}function n(i,r){try{var s=e[i](r),a=s.value;a instanceof t?Promise.resolve(a.value).then(function(t){n("next",t)},function(t){n("throw",t)}):o(s.done?"return":"normal",s.value)}catch(t){o("throw",t)}}function o(t,e){switch(t){case"return":r.resolve({value:e,done:!0});break;case"throw":r.reject(e);break;default:r.resolve({value:e,done:!1})}r=r.next,r?n(r.key,r.arg):s=null}var r,s;this._invoke=i,"function"!=typeof e.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(t){return this._invoke("next",t)},e.prototype.throw=function(t){return this._invoke("throw",t)},e.prototype.return=function(t){return this._invoke("return",t)}}(),function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}),c=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),u=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},p=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},g=function(){function t(e){var i=this;l(this,t),this.handler=e,this.cookie=0,this.callbacks={},this.cmds={};var n=hteditor.config.host||window.location.hostname,o=hteditor.config.port||window.location.port,r="http://"+n+":"+o;this.socket=io.connect(r),this.socket.on("connect",function(){i.handler({type:"connected",message:r})}),this.socket.on("disconnect",function(){i.handler({type:"disconnected",message:r})}),this.socket.on("fileChanged",function(t){i.handler({type:"fileChanged",path:t.path,event:t.event})}),this.socket.on("operationDone",function(t,e){i.handleRespone(t,e)}),this.socket.on("download",function(t){i.handler({type:"download",path:t})})}return t.prototype.request=function(t,e,i){var n=++this.cookie;this.callbacks[n]=i,this.cmds[n]=t;var o=this.editor.sid;this.socket.emit(t,n,e,o?{sid:o}:null);var r=t;e&&(ht.Default.isString(e)?r=t+": "+e:e.path&&(r=t+": "+e.path)),this.handler({type:"request",message:r,cmd:t,data:e})},t.prototype.handleRespone=function(t,e){var i=this.callbacks[t],n=this.cmds[t];delete this.callbacks[t],delete this.cmds[t],i&&i(e),this.handler({type:"response",message:n,cmd:n,data:e})},t}(),f=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"scenes"))}return u(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list),this.addExportItem(e)},e}(hteditor.Explorer),m=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"models"))}return u(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),v=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"symbols"))}return u(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),b=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"assets"))}return u(e,t),e.prototype.initTreeMenu=function(t,e){this.addLocateTreeFileItem(e),this.addNewFolderItem(e,this.tree),this.addRenameItem(e,this.tree),this.addDeleteItem(e,this.tree)},e.prototype.initListMenu=function(t,e){this.addLocateListFileItem(e),this.addNewFolderItem(e,this.list),this.addCopyItem(e),this.addPasteItem(e),this.addRenameItem(e,this.list),this.addDeleteItem(e,this.list)},e}(hteditor.Explorer),w=function(t){function e(i){l(this,e);var n=p(this,t.call(this));n.editor=i,n.editor.menus.push(n);var o=[{label:"\u65b0\u5efa\u573a\u666f",action:function(){n.editor.newScene()}},{label:"\u65b0\u5efa\u6a21\u578b",items:[{label:"OBJ\u6a21\u578b",action:function(){n.editor.newOBJModel()}}]}];return n.setItems(o),n}return u(e,t),e}(ht.widget.ContextMenu),I=function(t){function e(i){l(this,e);var n=p(this,t.call(this,i.gv));return n.editor=i,n}return u(e,t),e.prototype.beginTransaction=function(){this._isBeginTransaction||(this._isBeginTransaction=!0,this.dm.beginTransaction())},e.prototype.endTransaction=function(){this._isBeginTransaction&&(this._isBeginTransaction=!1,this.dm.endTransaction())},e.prototype.getDataAt=function(t){return this.gv.getDataAt(t)},e.prototype.getNodeAt=function(t){var e=this.getDataAt(t);return e instanceof ht.Node?e:null},e.prototype.setUp=function(){t.prototype.setUp.call(this),this.sm.cs()},e.prototype.drawCanvas=function(t){},e.prototype.drawRect=function(t,e,i,n){e=this.toRect(e),n&&(t.fillStyle=n),i&&(t.strokeStyle=i),t.lineWidth=1,t.beginPath(),t.rect(e.x,e.y,e.width,e.height),t.stroke(),n&&t.fill(),i&&t.stroke()},e.prototype.drawPoint=function(t,e,i,n,o){e=this.toPoint(e),o&&(t.fillStyle=o),n&&(t.strokeStyle=n),t.lineWidth=1,t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI,!0),o&&t.fill(),n&&t.stroke()},e.prototype.drawPoints=function(t,e,i,n,o){for(var r=0;r<e.length;r++)this.drawPoint(t,e[r],i,n,o)},e.prototype.drawLine=function(t,e,i,n){e=this.toPoint(e),i=this.toPoint(i),t.lineWidth=1,t.strokeStyle=n,t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.stroke()},e.prototype.toRect=function(t){var e=this.zoom;return{x:t.x*e+this.tx,y:t.y*e+this.ty,width:t.width*e,height:t.height*e}},e.prototype.toPoint=function(t){return{x:t.x*this.zoom+this.tx,y:t.y*this.zoom+this.ty}},e.prototype.addData=function(t){this.editor.dm.add(t),this.editor.sm.ss(t),this.editor.gv.setFocus()},e.prototype.remove=function(t){this.dm.remove(t)},e.prototype.lp=function(t){return this.gv.lp(t)},c(e,[{key:"dm",get:function(){return this.gv.dm()}},{key:"sm",get:function(){return this.gv.dm().sm()}},{key:"zoom",get:function(){return this.gv.getZoom()}},{key:"tx",get:function(){return this.gv.tx()}},{key:"ty",get:function(){return this.gv.ty()}}]),e}(ht.graph.Interactor),D=function(t){function e(i,n,o){l(this,e);var r=p(this,t.call(this,i));return r.createFunc=n,r.points=[],r.segments=[],r.nextPoint=null,r.fill=o,r}return u(e,t),e.prototype.tearDown=function(){t.prototype.tearDown.call(this),this.points=[],this.segments=[],this.nextPoint=null},e.prototype.handleEsc=function(t){this.nextPoint?(this.nextPoint=null,this.editor.rulerView.validateCanvas()):this.createShape()},e.prototype.createShape=function(){if(this.points.length>1){var t=this.createFunc(this.points,this.segments);this.addData(t)}this.editor.setInteractionState("edit"),this.editor.pointsEditingMode=!0},e.prototype.handle_mousedown=function(t){this.handle_touchstart(t)},e.prototype.handle_touchstart=function(t){if(ht.Default.preventDefault(t),ht.Default.isLeftButton(t))if(this.gv.setFocus(t),ht.Default.isDoubleClick(t))this.createShape();else{var e=this.lp(t);if(this.points.length){var i=this.points[this.points.length-1];if(Math.abs(i.x-e.x)<.01&&Math.abs(i.y-e.y)<.01)return}this.points.push(e),this.segments.push(this.nextPoint?2:1),this.nextPoint=this.lp(t),this.editor.rulerView.validateCanvas()}},e.prototype.handle_mousemove=function(t){this.nextPoint&&(this.nextPoint=this.lp(t),this.editor.rulerView.validateCanvas())},e.prototype.drawCanvas=function(t){t.beginPath();for(var e=0,i=void 0,n=void 0,o=void 0,r=0;r<this.segments.length;r++){var s=this.segments[r];1===s?(i=this.toPoint(this.points[e++]),t.moveTo(i.x,i.y)):2===s?(i=this.toPoint(this.points[e++]),t.lineTo(i.x,i.y)):3===s?(i=this.toPoint(this.points[e++]),n=this.toPoint(this.points[e++]),t.quadraticCurveTo(i.x,i.y,n.x,n.y)):4===s?(i=this.toPoint(this.points[e++]),n=this.toPoint(this.points[e++]),o=this.toPoint(this.points[e++]),t.bezierCurveTo(i.x,po,y,n.x,n.y,o.x,o.y)):5===s&&t.closePath()}if(this.nextPoint){var a=this.toPoint(this.nextPoint);t.lineTo(a.x,a.y)}t.strokeStyle=hteditor.config.color_data_border,t.lineWidth=1,t.stroke(),this.fill&&(t.fillStyle=hteditor.config.color_transparent,t.fill()),this.drawPoints(t,this.points,4,hteditor.config.color_data_border,hteditor.config.color_data_background)},e}(I),T=function(t){function e(i,n){l(this,e);var o=p(this,t.call(this,i));return o.createFunc=n,o}return u(e,t),e.prototype.tearDown=function(){t.prototype.tearDown.call(this),this.node=this.p1=this.p2=null},e.prototype.handle_mousedown=function(t){this.handle_touchstart(t)},e.prototype.handle_touchstart=function(t){ht.Default.preventDefault(t),ht.Default.isLeftButton(t)&&(this.gv.setFocus(t),this.p1=this.lp(t),this.startDragging(t))},e.prototype.handleWindowMouseMove=function(t){this.handleWindowTouchMove(t)},e.prototype.handleWindowMouseUp=function(t){this.handleWindowTouchEnd(t)},e.prototype.handleWindowTouchMove=function(t){if(ht.Default.preventDefault(t),this.p1){this.p2=this.lp(t);var e=ht.Default.unionPoint(this.p1,this.p2);if(this.node)this.node.setRect(e);else{if(!e.width||!e.height)return;this.beginTransaction(),this.createNode(e,!1)}}},e.prototype.handleWindowTouchEnd=function(t){ht.Default.preventDefault(t),this.endTransaction(),!this.node&&this.p1&&this.createNode({x:this.p1.x-25,y:this.p1.y-25,width:50,height:50},!0),hteditor.config.continuousCreating?this.node=this.p1=this.p2=null:this.editor.setInteractionState("edit")},e.prototype.createNode=function(t,e){this.node=this.createFunc(t,e),this.node.s3(50,50,50),e?this.node.setPosition(t.x+t.width/2,t.y+t.height/2):this.node.setRect(t),this.addData(this.node)},e.prototype.drawCanvas=function(t){this.node&&this.drawRect(t,this.node.getRect(),hteditor.config.color_data_border)},e}(I),C=function(t){function e(i){l(this,e);var n=p(this,t.call(this));return n.editor=i,n.initMenu(),n.initItems(),n.enableToolTip(),n}return u(e,t),e.prototype.initMenu=function(){var t=this.editor.mainMenu=new w(this.editor),e=function(e){t.isShowing()&&!t.getView().contains(e.target)&&t.hide()};window.addEventListener("touchstart",e,!1),window.addEventListener("mousedown",e,!1)},e.prototype.initItems=function(){var t=[];t.push(this.createMenuItem()),t.push(this.createEditItem()),t.push(this.createCubeItem()),t.push(this.createCylinderItem()),t.push(this.createSphereItem()),t.push(this.createWallItem()),t.push(this.createFloorItem()),t.push(this.createPipelineItem()),this.setItems(t)},e.prototype.createMenuItem=function(){var t=this,e=hteditor.createItem("menu",hteditor.getString("editor.menu"),"editor.menu");return e.action=function(e,i,n){t.editor.mainMenu.isShowing()||(t.editor.mainMenu.showOnView(t,4,20),n.preventDefault(),n.stopPropagation())},e},e.prototype.createEditItem=function(){var t=this,e=function(){return"edit"===t.editor.getInteractionState()},i=hteditor.createItem("edit","\u7f16\u8f91","editor.edit",e);return i.action=function(){t.editor.setInteractionState("edit")},i},e.prototype.createWallItem=function(){var t=this,e=function(){return"wall"===t.editor.getInteractionState()},i=hteditor.createItem("wall","\u5899\u9762","hxeditor.wall",e);return i.action=function(){var e=new D(t.editor,function(t,e){var i=new ht.Shape;return i.setTall(280),i.setThickness(14),i.setElevation(i.getTall()/2),i.setPoints(t),i.setSegments(e),i.s({"all.color":"#DDDDDD","shape.background":null,"shape.border.width":i.getThickness(),"shape.border.color":"#DDDDDD"}),i});t.editor.setInteractionState("wall",e)},i},e.prototype.createFloorItem=function(){var t=this,e=function(){return"floor"===t.editor.getInteractionState()},i=hteditor.createItem("floor","\u5730\u677f","hxeditor.floor",e);return i.action=function(){var e=new D(t.editor,function(t,e){var i=new ht.Shape;return i.setTall(10),i.setThickness(-1),i.setElevation(-i.getTall()/2),i.setPoints(t),i.setSegments(e),i.s({"shape3d.color":"#EEEEEE","shape3d.top.color":"#EEEEEE","shape3d.bottom.color":"#EEEEEE","shape.background":"#EEEEEE"}),i.setAnchor3d(.5,0,.5),i},!0);t.editor.setInteractionState("floor",e)},i},e.prototype.createPipelineItem=function(){var t=this,e=function(){return"pipeline"===t.editor.getInteractionState()},i=hteditor.createItem("pipeline","\u7ba1\u9053","hxeditor.pipeline",e);return i.action=function(){var e=new D(t.editor,function(t,e){var i=new ht.Polyline;return i.setPoints(t),i.setSegments(e),i.setThickness(10),i.s({shape3d:"cylinder","shape3d.color":"#BFBFBF","shape3d.top.color":"#BFBFBF","shape3d.bottom.color":"#BFBFBF","shape.background":null,"shape.border.width":i.getThickness(),"shape.border.color":"#BFBFBF"}),i});t.editor.setInteractionState("pipeline",e)},i},e.prototype.createCubeItem=function(){var t=this,e=function(){return"cube"===t.editor.getInteractionState()},i=hteditor.createItem("cube","\u516d\u9762\u4f53","hxeditor.cube",e);return i.action=function(){var e=new T(t.editor,function(){var t=new ht.Node;return t.s({"all.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("cube",e)},i},e.prototype.createCylinderItem=function(){var t=this,e=function(){return"cylinder"===t.editor.getInteractionState()},i=hteditor.createItem("cylinder","\u5706\u67f1","hxeditor.cylinder",e);return i.action=function(){var e=new T(t.editor,function(){var t=new ht.Node;return t.s({shape3d:"cylinder","shape3d.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("cylinder",e)},i},e.prototype.createSphereItem=function(){var t=this,e=function(){return"sphere"===t.editor.getInteractionState()},i=hteditor.createItem("cube","\u7403\u4f53","hxeditor.sphere",e);return i.action=function(){var e=new T(t.editor,function(){var t=new ht.Node;return t.s({shape3d:"sphere","shape3d.color":"#DDDDDD"}),t.setAnchor3d(.5,0,.5),t},!0);t.editor.setInteractionState("sphere",e)},i},e}(ht.widget.Toolbar),x=function(t){function e(i){l(this,e);var n=p(this,t.call(this));return n.editor=i,n.initItems(),n.enableToolTip(),n.setStickToRight(!0),n.editor.gv.addPropertyChangeListener(n.handlePropertyChange,n),n.updateZoomLabel(),n}return u(e,t),e.prototype.handlePropertyChange=function(t){"zoom"===t.property&&this.updateZoomLabel()},e.prototype.updateZoomLabel=function(){this.label.innerHTML=parseInt(100*this.editor.gv.getZoom())+"%"},e.prototype.initItems=function(){var t=this,e=void 0,i=[];e=hteditor.createItem("save","\u4fdd\u5b58","editor.save"),e.action=function(){t.editor.save()},i.push(e),e=hteditor.createItem("cancel","\u53d6\u6d88","hxeditor.cancel"),e.action=function(){t.editor.cancel()},i.push(e),i.push({separator:!0}),e=hteditor.createItem("grid","\u663e\u793a\u7f16\u8f91\u8f74","editor.axis",function(){return!t.editor.scene.isEditHelperDisabled()}),e.action=function(){t.editor.scene.setEditHelperDisabled(!t.editor.scene.isEditHelperDisabled())},i.push(e),e=hteditor.createItem("grid","\u663e\u793a\u7f51\u683c","editor.grid",function(){return t.editor.gridVisible}),e.action=function(){t.editor.toggleGridEnabled()},i.push(e),e=hteditor.createItem("preview","\u9884\u89c8","editor.preview"),e.action=function(){t.editor.preview()},i.push(e),i.push({separator:!0}),i.push(this.createZoomItem()),e=hteditor.createItem("zoomToFit",hteditor.getString("editor.zoomtofit"),"editor.zoomtofit"),e.action=function(){t.editor.zoomToFit()},i.push(e),i.push({separator:!0}),e=hteditor.createItem("toggleLeft",hteditor.getString("editor.toggleleft"),"editor.toggleleft"),e.action=function(){t.editor.toggleLeft()},i.push(e),e=hteditor.createItem("toggleRight",hteditor.getString("editor.toggleright"),"editor.toggleright"),e.action=function(){t.editor.toggleRight()},i.push(e),this.setItems(i)},e.prototype.createZoomItem=function(){var t=this,e=this.label=ht.Default.createDiv(!0);e.style.font=this.getLabelFont(),e.style.color=this.getLabelColor(),e.style.cursor="ew-resize",e.style.width="40px",e.style.height=ht.Default.widgetRowHeight+"px",e.style.lineHeight=ht.Default.widgetRowHeight+"px",e.style.whiteSpace="nowrap",e.style.textAlign="center";var i=function(e){e.preventDefault();var i=t.editor.gv;ht.Default.isDoubleClick(e)&&i.zoomReset();var n=i.getZoom(),o=ht.Default.getClientPoint(e).x,r=function(t){t.preventDefault();var e=ht.Default.getClientPoint(t).x-o;i.setZoom(n*(1+.005*e))};window.addEventListener("mousemove",r,!1),window.addEventListener("touchmove",r,!1);var s=function(t){t.preventDefault(),window.removeEventListener("mousemove",r,!1),window.removeEventListener("touchmove",r,!1),window.removeEventListener("mouseup",s,!1),window.removeEventListener("touchend",s,!1)};window.addEventListener("mouseup",s,!1),window.addEventListener("touchend",s,!1)};return e.addEventListener("mousedown",i,!1),e.addEventListener("touchstart",i,!1),{id:"zoom",unfocusable:!0,element:e}},e}(ht.widget.Toolbar),P=function(t){function e(i){l(this,e);var n=p(this,t.call(this,i.dm));return n.editor=i,n.setEditable(!0),n.topDiv=ht.Default.createDiv(),n}return u(e,t),e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.getBrightness=function(){return null},e.prototype.isDroppable=function(t,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.positionDragImage=function(t){if(this.dragImage){var e=hteditor.config.dragImageSize,i=ht.Default.getPagePoint(t);this.dragImage.style.left=i.x-e/2+"px",this.dragImage.style.top=i.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(t,e,i){var n=this,o=i.view,r=o.draggingData;if("enter"===e){if(this._view.insertBefore(this.topDiv,this._scrollBarDiv),ht.Default.layout(this.topDiv,0,0,this.getWidth(),this.getHeight()),this.topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&r&&("model"===r.fileType||"symbol"===r.fileType||"image"===r.fileType)&&ht.Default.getImage(r.getImage())!==ht.Default.getImage("editor.unknown")){var s=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(r.getImage(),s,s,"centerUniform",r,i.view,null,ht.Default.devicePixelRatio),this.positionDragImage(t),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===e||"cancel"===e?(ht.Default.removeHTML(this.topDiv),this.removeDragImage()):"over"===e?this.positionDragImage(t):"drop"===e&&(ht.Default.removeHTML(this.topDiv),r&&(this.removeDragImage(),this.sm().cs(),o.handleDropToEditView?o.handleDropToEditView(this,r,this.getHitPosition(t),t):o.isSelected(r)?o.sm().toSelection().each(function(e){n.insert(e,t)}):this.insert(r,t)))},e.prototype.insert=function(t,e){var i=new ht.Node;"model"===t.fileType?i.s({shape3d:t.url}):"symbol"!==t.fileType&&"image"!==t.fileType||(i.s({shape3d:"billboard","shape3d.image":t.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),i.setImage(t.url)),i.setAnchor3d(.5,0,.5),i.p3(this.getHitPosition(e)),i.s("wf.visible","selected"),this.dm().add(i),this.sm().as(i)},e.prototype.toImage=function(t){var e=d.config.imageSize||400,i=this.getWidth(),n=this.getHeight(),o=Math.max(i,n),r=e/o;return i=Math.floor(i*r),n=Math.floor(n*r),this.toCanvas(t,i,n).toDataURL("image/png",1)},e}(ht.graph3d.Graph3dView),L={width:!0,height:!0,position:!0,rotation:!0,anchor:!0,scale:!0,expanded:!0},S=function(){function t(e){var i=this;l(this,t),this.graphView=e,this._rulerEnabled=!0,this._view=ht.Default.createView(!0,this),this.graphView.addViewListener(function(t){"validate"===t.kind&&i.validateCanvas()}),this._hRuler=ht.Default.createCanvas(),this._vRuler=ht.Default.createCanvas(),this._view.appendChild(this._hRuler),this._view.appendChild(this._vRuler),this._view.appendChild(this.graphView.getView()),this.graphView.addPropertyChangeListener(function(){i.iv()}),this.dm.sm().addSelectionChangeListener(function(t){i.iv()}),this.dm.addDataPropertyChangeListener(function(t){i.handleDataPropertyChanged(t)}),this.dm.addPropertyChangeListener(function(t){i.handleDataModelPropertyChanged(t)}),this.dm.layout=function(t){i._autoLayout||(i._autoLayout=new ht.layout.AutoLayout(i.graphView)),i._autoLayout.layout(t,function(){i.graphView.fitContent(!0)})},this.graphView.setEditable(!0),this.graphView.getInteractors().each(function(t){t.keep=!0})}return t.prototype.handleDataPropertyChanged=function(t){L[t.property]&&this.iv()},t.prototype.handleDataModelPropertyChanged=function(t){this.validateCanvas()},t.prototype.onPropertyChanged=function(t){this.iv()},t.prototype.addData=function(t){this.dm.add(t),this.dm.sm().ss(t),this.graphView.setFocus()},t.prototype.validateCanvas=function(){var t=this.graphView._topCanvas;if(t){var e=hteditor.initContext(t);e.clearRect(0,0,t.clientWidth,t.clientHeight),this.graphView.getInteractors().each(function(t){t.drawCanvas&&t.drawCanvas(e)}),e.restore()}},t.prototype.redraw=function(){hteditor.EditView.prototype.redraw.apply(this,arguments)},t.prototype.validateImpl=function(){hteditor.EditView.prototype.validateImpl.apply(this,arguments)},t.prototype.drawVerticalText=function(){hteditor.EditView.prototype.drawVerticalText.apply(this,arguments)},t.prototype.drawRuler=function(){hteditor.EditView.prototype.drawRuler.apply(this,arguments)},c(t,[{key:"dm",get:function(){return this.graphView.dm()}}]),t}();hteditor.msClass(S,{ms_v:1,ms_fire:1,ms_ac:["rulerBackground","rulerFont","rulerColor","rulerSize","guideColor"],_rulerFont:hteditor.config.smallFont,_rulerBackground:hteditor.config.color_pane,_rulerColor:hteditor.config.color_dark,_rulerSize:hteditor.config.rulerSize,_guideColor:hteditor.config.color_transparent,_interactionState:void 0});var R=function(t){function e(i){l(this,e);var n=p(this,t.call(this,i.dm));return n.editor=i,n._topCanvas=ht.Default.createCanvas(),n._topDiv=ht.Default.createDiv(),n._view.insertBefore(n._topCanvas,n._scrollBarDiv),n._view.insertBefore(n._topDiv,n._scrollBarDiv),n.mi(function(t){"prepareMove"!==t.kind&&"prepareEdit"!==t.kind||!t.event.altKey||(n.editor.copy(),n.editor.paste(!0),n.validate())}),n}return u(e,t),e.prototype.initMenu=function(){var t=this,e=[];this.menu=new ht.widget.ContextMenu(e),e.push({id:"bringToFront",label:hteditor.getString("editor.bringtofront"),action:function(){t.editor.bringToFront()},visible:function(){return!!t.editor.ld}}),e.push({id:"bringForward",label:hteditor.getString("editor.bringforward"),action:function(){t.editor.bringForward()},visible:function(){return!!t.editor.ld}}),e.push({id:"sendBackward",label:hteditor.getString("editor.sendbackward"),action:function(){t.editor.sendBackward()},visible:function(){return!!t.editor.ld}}),e.push({id:"sendToBack",label:hteditor.getString("editor.sendtoback"),action:function(){t.editor.sendToBack()},visible:function(){return!!t.editor.ld}}),e.push({separator:!0,visible:function(){return!!t.editor.ld}}),this.menu.addTo(this.getView()),this.editor.menus.push(this.menu)},e.prototype.getUnionNodeRect=function(t){var e=this,i=void 0;return t=t._as||t,t.forEach(function(t){t instanceof ht.Node&&(i=ht.Default.unionRect(i,e.getNodeRect(t)))}),i},e.prototype.getImage=function(t){var e=t.s("shape3d");if(e){var i=ht.Default.getShape3dModel(e);if(i&&i.json&&i.json.image)return i.json.image;if("sphere"===e||"cylinder"===e)return"hxeditor.sphere.image"}var n=t.getImage();return n&&"node_image"!==n?n:t.s("shape3d.image")?t.s("shape3d.image"):"hxeditor.cube.image"},e.prototype.getSelectWidth=function(t){return!this.isEditable(t)||t instanceof ht.Edge?t.s("select.width"):0},e.prototype.isDroppable=function(t,e){return e.view===this.editor.models.list||(e.view===this.editor.symbols.list||e.view===this.editor.assets.list)},e.prototype.positionDragImage=function(t){if(this.dragImage){var e=hteditor.config.dragImageSize,i=ht.Default.getPagePoint(t);this.dragImage.style.left=i.x-e/2+"px",this.dragImage.style.top=i.y-e/2+"px"}},e.prototype.removeDragImage=function(){this.dragImage&&(ht.Default.removeHTML(this.dragImage),this.dragImage=null)},e.prototype.handleCrossDrag=function(t,e,i){var n=this,o=i.view,r=o.draggingData;if("enter"===e){if(this._topDiv.style.border="solid "+hteditor.config.color_select_dark+" 2px",!this.dragImage&&r&&("model"===r.fileType||"symbol"===r.fileType||"image"===r.fileType)&&ht.Default.getImage(r.getImage())!==ht.Default.getImage("editor.unknown")){var s=hteditor.config.dragImageSize;this.dragImage=ht.Default.toCanvas(r.getImage(),s,s,"centerUniform",r,i.view,null,ht.Default.devicePixelRatio),this.positionDragImage(t),this.dragImage.style.opacity=hteditor.config.dragImageOpacity,ht.Default.appendToScreen(this.dragImage)}}else"exit"===e||"cancel"===e?(this._topDiv.style.border="",this.removeDragImage()):"over"===e?this.positionDragImage(t):"drop"===e&&(this._topDiv.style.border="",r&&(this.removeDragImage(),this.sm().cs(),o.handleDropToEditView?o.handleDropToEditView(this,r,this.lp(t),t):o.isSelected(r)?o.sm().toSelection().each(function(e){n.insert(e,t)}):this.insert(r,t)))},e.prototype.insert=function(t,e){var i=this.lp(e);if("model"===t.fileType){var n=new ht.Node;n.s({shape3d:t.url}),n.setAnchor3d(.5,0,.5),n.setPosition(i),this.dm().add(n),this.sm().as(n)}else if("symbol"===t.fileType||"image"===t.fileType){var o=new ht.Node;o.s({shape3d:"billboard","shape3d.image":t.url,"shape3d.image.cache":!1,"shape3d.autorotate":!0,"shape3d.alwaysOnTop":!1,"shape3d.fixSizeOnScreen":[-1,-1]}),o.setAnchor3d(.5,0,.5),o.p(i),o.setImage(t.url),this.dm().add(o),this.sm().as(o)}},e}(ht.graph.GraphView),E={width:20,height:16,comps:[{type:"image",stretch:"uniform",color:{func:function(t,e){if(t instanceof ht.Node){var i=t.s("shape3d");if(ht.Default.isString(i)&&hteditor.isJSON(i))return null}return hteditor.config.color_dark}},name:{func:function(t,e){if(t instanceof ht.Shape)return t.getThickness()>0?"hxeditor.wall":"hxeditor.floor";if(t instanceof ht.Node){var i=t.s("shape3d");if(i){if(ht.Default.isString(i)&&hteditor.isJSON(i))return i.substr(0,i.length-4)+"png"
;if("sphere"===i)return"hxeditor.sphere";if("cylinder"===i)return"hxeditor.cylinder"}return"hxeditor.cube"}return t.getIcon()}},rect:[0,0,20,16]}]},k={box:"\u7acb\u65b9\u4f53",sphere:"\u7403\u4f53",cone:"\u9525\u4f53",torus:"\u5706\u73af",cylinder:"\u5706\u67f1",star:"\u661f\u5f62\u4f53",rect:"\u77e9\u5f62\u4f53",roundRect:"\u5706\u77e9\u5f62\u4f53",triangle:"\u4e09\u89d2\u5f62\u4f53",rightTriangle:"\u76f4\u89d2\u4e09\u89d2\u5f62\u4f53",parallelogram:"\u5e73\u884c\u56db\u8fb9\u5f62\u4f53",trapezoid:"\u68af\u5f62\u4f53"},B=function(t){function e(i){return l(this,e),p(this,t.call(this,i,i.dm))}return u(e,t),e.prototype.handleDelete=function(){this.removeSelection()},e.prototype.onDataDoubleClicked=function(t,e){e.altKey?this.editor.gv.fitData(t,!0,hteditor.config.fitDataPadding):(this.editor.gv.makeCenter(t,!0),this.editor.scene.flyTo(t,{animation:!0}))},e.prototype.getLabel=function(e){var i=t.prototype.getLabel.call(this,e);if(!i){var n=e.s("shape3d");e instanceof ht.Shape?i="cylinder"===n?"\u7ba1\u9053":e.getThickness()>0?"\u5899\u9762":"\u5730\u677f":e instanceof ht.Node&&((i=k[n])||(i=hteditor.isJSON(n)?hteditor.fileNameToDisplayName(n):n)),i||(i="\u516d\u9762\u4f53")}return i||""},e.prototype.getIcon=function(t){return E},e.prototype._endDrag=function(t,e){var i=this,n=e.type,o=e.parent,r=e.refData;if(this.isSelected(this.draggingData)){var s=this.getTopRowOrderSelection();"down"===n&&s.reverse(),s.each(function(t){i._dropData(t,n,o,r)})}else this._dropData(this.draggingData,n,o,r),this.sm().ss(this.draggingData);o&&this.expand(o)},e.prototype._dropData=function(t,e,i,n){if(t.setParent(i),"down"===e||"up"===e){var o=i?i.getChildren():this.dm().getRoots(),r=o.indexOf(n);"down"===e&&r++,o.indexOf(t)<r&&r--,this.dm().moveTo(t,r)}else i||this.dm().moveToBottom(t)},e.prototype.isEditable=function(t){return!0},e.prototype.rename=function(t,e){t.setDisplayName(e)},e}(hteditor.DNDTree),V=function(t){function e(i){l(this,e);var n=p(this,t.call(this));return n.editor=i,n.initForm(),n.visible=!1,n.oopsImageJSON=ht.Default.getImage("editor.oops"),n.oopsImage=ht.Default.toCanvas(n.oopsImageJSON,n.oopsImageJSON.width,n.oopsImageJSON.height,"fill",null,null,null,ht.Default.devicePixelRatio).toDataURL(),n}return u(e,t),e.prototype.initForm=function(){var t=this;this.addRow([{id:"content",textArea:{}}],[.1],.1),this.addRow([{id:"url",textField:{editable:!1}},{id:"edit",button:{onClicked:function(){t.editing=!t.editing}}},{id:"commit",button:{label:"\u63d0\u4ea4",onClicked:function(){t.editor.reset(!0),t.editor.dm.disableHistoryManager(),t.editor.deserialize(t.content),t.editing=!1,t.editor.dm.enableHistoryManager(),t.editor.dm.clearHistoryManager()}}}],[.1,50,50]),this.getView().style.background=hteditor.config.color_pane,this.textArea=this.getViewById("content").getElement(),this.editing=!1},e.prototype.updateContentLater=function(){var t=this;this.visible&&!this.editing&&(this._updateContentLater||(this._updateContentLater=!0,setTimeout(function(){t.updateContent()},100)))},e.prototype.updateContent=function(){this.visible&&!this.editing&&(this._updateContentLater=!1,this.content=this.editor.serialize())},e.prototype.updateURL=function(){this.v("url",this.editor.url||"")},c(e,[{key:"editing",get:function(){return this._editing},set:function(t){this._editing!==t&&(this._editing=t,this.getViewById("edit").setLabel(t?"\u53d6\u6d88":"\u7f16\u8f91"),this.getViewById("commit").setDisabled(!t),this.getViewById("content").setEditable(t),t||this.updateContentLater())}},{key:"visible",get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,t?this.updateContent():this.editing||(this.content=""))}},{key:"content",get:function(){return this.v("content")},set:function(t){if(t&&t.length>hteditor.config.maxStringLength){t="Oops, tooooo long!",this.setDisabled(!0,this.oopsImage);var e=this.oopsImageJSON.width,i=this.oopsImageJSON.height;this.getDisabledDiv().style.backgroundSize=e+"px "+i+"px"}else this.setDisabled(!1);this.v("content",t)}}]),e}(ht.widget.FormPane),F=function(t){function e(i){l(this,e);var n=p(this,t.call(this));n.editor=i,n.buttons={};var o=[];o.push(n.createItem("cluster","\u6210\u4e32\u5747\u5206",[{type:"shape",points:[5,2,11,2,5,14,11,14],segments:[1,2,1,2],borderWidth:3,borderColor:hteditor.config.color_select},{type:"shape",points:[8,5,8,11,5,8,11,8],segments:[1,2,1,2],borderWidth:1,borderColor:hteditor.config.color_dark}])),o.push(n.createItem("distributeHorizontal","\u6c34\u5e73\u5747\u5206",[{type:"shape",points:[2,2,2,14,14,2,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[8,5,8,11],borderWidth:3}])),o.push(n.createItem("distributeVertical","\u5782\u76f4\u5747\u5206",[{type:"shape",points:[2,2,14,2,2,14,14,14],segments:[1,2,1,2],borderWidth:1},{type:"shape",points:[5,8,11,8],borderWidth:3}])),o.push(n.createItem("alignLeft","\u5de6\u5bf9\u9f50",[{type:"shape",points:[2,2,2,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,13,5,5,11,8,11],segments:[1,2,1,2],borderWidth:3}])),o.push(n.createItem("alignHorizontal","\u6c34\u5e73\u5bf9\u9f50",[{type:"shape",points:[8,2,8,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,13,5,6,11,10,11],segments:[1,2,1,2],borderWidth:3}])),o.push(n.createItem("alignRight","\u53f3\u5bf9\u9f50",[{type:"shape",points:[14,2,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[3,5,11,5,11,11,8,11],segments:[1,2,1,2],borderWidth:3}])),o.push(n.createItem("alignTop","\u9876\u5bf9\u9f50",[{type:"shape",points:[2,2,14,2],segments:[1,2],borderWidth:1},{type:"shape",points:[5,5,5,13,11,5,11,8],segments:[1,2,1,2],borderWidth:3}])),o.push(n.createItem("alignVertical","\u5782\u76f4\u5bf9\u9f50",[{type:"shape",points:[2,8,14,8],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,13,11,6,11,10],segments:[1,2,1,2],borderWidth:3}])),o.push(n.createItem("alignBottom","\u5e95\u5bf9\u9f50",[{type:"shape",points:[2,14,14,14],segments:[1,2],borderWidth:1},{type:"shape",points:[5,3,5,11,11,11,11,8],segments:[1,2,1,2],borderWidth:3}]));var r=.1,s=[r,r,r,r,r,r,r,r,r];return n.addRow(o,s),n.updateItems(),n.editor.sm.ms(function(){return n.updateItems()}),n}return u(e,t),e.prototype.createItem=function(t,e,i){var n=this;i.forEach(function(t){t.borderCap="round"}),i[0].borderColor=i[0].borderColor||hteditor.config.color_dark,i[1].borderColor=i[1].borderColor||hteditor.config.color_select;var o={width:16,height:16,fitSize:!0,comps:i};return this.buttons[t]=hteditor.createButton(null,e,o,function(){n[t]()})},e.prototype.updateItems=function(){var t=[];this.editor.sm.each(function(e){e instanceof ht.Node&&t.push(e)}),t.length>2?(this.buttons.cluster.setDisabled(!1),this.buttons.distributeHorizontal.setDisabled(!1),this.buttons.distributeVertical.setDisabled(!1),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):t.length>1?(this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!1),this.buttons.alignHorizontal.setDisabled(!1),this.buttons.alignRight.setDisabled(!1),this.buttons.alignTop.setDisabled(!1),this.buttons.alignVertical.setDisabled(!1),this.buttons.alignBottom.setDisabled(!1)):(this.buttons.cluster.setDisabled(!0),this.buttons.distributeHorizontal.setDisabled(!0),this.buttons.distributeVertical.setDisabled(!0),this.buttons.alignLeft.setDisabled(!0),this.buttons.alignHorizontal.setDisabled(!0),this.buttons.alignRight.setDisabled(!0),this.buttons.alignTop.setDisabled(!0),this.buttons.alignVertical.setDisabled(!0),this.buttons.alignBottom.setDisabled(!0))},e.prototype.getUnionRect=function(t){return this.editor.gv?this.editor.gv.getUnionNodeRect(t):null},e.prototype.isSelected=function(t){return this.editor.sm.contains(t)},e.prototype.hasSelectedGroupParent=function(t){return hteditor.InspectorTool.prototype.hasSelectedGroupParent.apply(this,arguments)},e.prototype.hasSelectedHost=function(t){return hteditor.InspectorTool.prototype.hasSelectedHost.apply(this,arguments)},e.prototype.cluster=function(){var t=this.selection;if(t.length){this.editor.beginTransaction(),this.alignHorizontal(),this.alignVertical();var e=void 0,i=void 0;t.forEach(function(t){void 0===e?e=i=t.getElevation():(e>t.getElevation()&&(e=t.getElevation()),i<t.getElevation()&&(i=t.getElevation()))}),t.sort(function(t,e){return t.getElevation()-e.getElevation()});for(var n=(i-e)/(t.length-1),o=1;o<t.length-1;o++)t[o].setElevation(e+o*n);this.editor.endTransaction()}},e.prototype.distributeHorizontal=function(){hteditor.InspectorTool.prototype.distributeHorizontal.apply(this,arguments)},e.prototype.distributeVertical=function(){hteditor.InspectorTool.prototype.distributeVertical.apply(this,arguments)},e.prototype.alignLeft=function(){hteditor.InspectorTool.prototype.alignLeft.apply(this,arguments)},e.prototype.alignHorizontal=function(){hteditor.InspectorTool.prototype.alignHorizontal.apply(this,arguments)},e.prototype.alignRight=function(){hteditor.InspectorTool.prototype.alignRight.apply(this,arguments)},e.prototype.alignTop=function(){hteditor.InspectorTool.prototype.alignTop.apply(this,arguments)},e.prototype.alignVertical=function(){hteditor.InspectorTool.prototype.alignVertical.apply(this,arguments)},e.prototype.alignBottom=function(){hteditor.InspectorTool.prototype.alignBottom.apply(this,arguments)},c(e,[{key:"selection",get:function(){var t=this,e=[];return this.editor.sm.each(function(i){i instanceof ht.Node&&(t.hasSelectedGroupParent(i.getParent())||t.hasSelectedHost(i)||e.push(i))}),e}}]),e}(ht.widget.FormPane),_=function(t){function e(i,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];l(this,e);var r=p(this,t.call(this,i,n,n,o));return r.setHPadding(8),r.setVPadding(4),r.addUpdateHandler(function(){r.initDataBindings()}),r}return u(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addCustomProperties()},e.prototype.addTitle=function(t,e){var i=this._oldTitle;this.editor.fireEvent("titleCreating",{oldTitle:i,title:t,inspector:this});var n=[],o=hteditor.getString("editor."+t.toLowerCase(),!0)||hteditor.getString(t);n.push({element:o,font:hteditor.config.boldFont}),e=e||{},e.title=t,e.background=hteditor.config.color_pane_dark;var r=this.addRow(n,[.1],null,e);return this._oldTitle=t,this.editor.fireEvent("titleCreated",{oldTitle:i,title:t,inspector:this}),r},e.prototype.addOneRow=function(t,e,i){for(var n=[this.indent,.1],o=2,r=t.length;o<r;o++)n.push(20);return this.addRow(t,n,e?this.getRowHeight()*e:null,i)},e.prototype.addDBRow=function(t,e,i,n,o){var r=this,s=void 0;if(d.config.dataBindings&&(!d.config.dataBindings.filter||d.config.dataBindings.filter(e,i))){var a=function(){d.config.dataBindings.onButtonClicked(r.data,e,i)},h=e+":"+i,l=this.addButton(t,null,h,null,a,!0);this.updateHandlers.push(function(){if(!t.hidden&&r.data){var n=d.config.isDataBound(r.data,e,i);l.setIcon(n?"editor.bind.state":"editor.unbind.state")}})}return s=this.addOneRow(t,o,n),s.keys={name:i,displayName:this.toDisplayName(t),accessType:e},s},e.prototype.initDataBindings=function(){var t=this,e=this._dataBindingRowInfos;e&&e.length>0&&(this.removeRows(e),this._dataBindingRowInfos=null);var i=this._dataBindingHandlers;i&&i.length>0&&(i.forEach(function(e){t.removeUpdateHandler(e)}),this._dataBindingHandlers=null);var n=this.data;if(n){var o=[n.s("all.image"),n.s("top.image"),n.s("bottom.image"),n.s("left.image"),n.s("right.image"),n.s("front.image"),n.s("back.image"),n.s("shape3d.image"),n.s("shape3d.top.image"),n.s("shape3d.bottom.image"),n.s("shape3d.from.image"),n.s("shape3d.to.image")],r=[];if(o.forEach(function(t){t&&r.push(ht.Default.getImage(t))}),0!==r.length){for(var s=[],a=!1,d=0,h=r.length;d<h;d++){var l=r[d];if(!l){a=!0;break}l.dataBindings&&s.push.apply(s,l.dataBindings)}if(a){var c=ht.Default.handleImageLoaded;return void(ht.Default.handleImageLoaded=function(){for(var e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];c.apply(ht.Default,i),t.initDataBindings(),ht.Default.handleImageLoaded=c})}if(0!==s.length){var u=this.updateHandlers.length;e=[this.addTitle(hteditor.getString("DataBindings"))];var p={};s.forEach(function(i){var n=i.attr;if(!p[n]){p[n]=1;var o=t.addDataBind(i);e.push(t.addDBRow(o,"a",n))}}),this._dataBindingRowInfos=e,this._dataBindingHandlers=this.updateHandlers.slice(u),this._dataBindingHandlers.forEach(function(t){t()})}}}},e.prototype.addDataBind=function(t){var e=[],i=t.attr,n=hteditor.config.valueTypes[t.valueType];if(!n)return this.editor.fireEvent("error",{message:"Wrong value type:"+t.valueType}),!1;var o=hteditor.getString(t.name)||i,r=function(t){return t.a(i)},s=function(t,e){return t.a(i,e)};return"int"===n.type||"number"===n.type?n.angle?this.addLabelRotation(e,o,r,s,n.min,n.max,n.step):this.addLabelRange(e,o,r,s,n.min,n.max,n.step,n.type):"color"===n.type?this.addLabelColor(e,o,r,s):"boolean"===n.type?this.addLabelCheckBox(e,o,r,s):"enum"===n.type?this.addLabelComboBox(e,o,r,s,n.values,n.labels,n.icons):"multiline"===n.type?this.addLabelMultiline(e,o,r,s):"font"===n.type?this.addLabelFont(e,o,r,s):"image"===n.type?this.addLabelImage(e,o,r,s):"url"===n.type?this.addLabelURL(e,o,r,s):"colorArray"===n.type?this.addLabelArray(e,o,r,s,"color"):"numberArray"===n.type?this.addLabelArray(e,o,r,s,"number"):"stringArray"===n.type?this.addLabelArray(e,o,r,s,"string"):"objectArray"===n.type?this.addLabelArray(e,o,r,s,"object"):"function"===n.type?this.addLabelFunction(e,o,r,s,i):"object"===n.type?this.addLabelObject(e,o,r,s,i):this.addLabelInput(e,o,r,s),e},e.prototype.addLabelData=function(t,e,i,n){var o=this,r=this.addLabelInput(t,e,function(t){var e=i(t);return e?e.toLabel()||e.getClassName():""}),s=r.getElement();r.isDroppable=function(t,e){return e.view.draggingData&&o.dataModel===e.view.draggingData.getDataModel()},r.handleCrossDrag=function(t,e,i){"enter"===e?s.style.border="solid "+d.config.color_select_dark+" 2px":"exit"===e||"cancel"===e?s.style.border="":"over"===e||"drop"===e&&(s.style.border="",o.setValue(n,i.view.draggingData),r.setFocus())},s.onkeydown=function(t){ht.Default.isDelete(t)&&o.setValue(n,null)};var a=new ht.widget.Image;a.drawImage=function(t,e,i,n,r,s){var d=a.data,h=o.editor.list;d&&h&&h.dm().contains(d)&&(e=h.getIcon(d))&&drawStretchImage(t,ht.Default.getImage(e),"centerUniform",i,n,r,s,d,h)},this.updateHandlers.push(function(){if(!t.hidden){var e=a.data;a.data=o.getValue(i),a.fp("data",e,a.data)}}),t.push(a)},c(e,[{key:"type",set:function(t){this._type=t},get:function(){return this._type}},{key:"dataModel",get:function(){return this.editor.dm}},{key:"indent",get:function(){return hteditor.config.indent}},{key:"indent2",get:function(){return hteditor.config.indent2}}]),e}(hteditor.Inspector),M=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"scene",!0))}return u(e,t),e.prototype.initForm=function(){var e=this;t.prototype.initForm.call(this);var i=void 0;this.addTitle("\u573a\u666f"),i=[],this.addLabelInput(i,"\u9884\u89c8\u5730\u5740",hteditor.getter("a","previewURL"),hteditor.setter("a","previewURL")),this.addRow(i,[this.indent,.1]),i=[],i.push("\u76f8\u673a"),this.addButton(i,null,"\u91cd\u7f6e","editor.resetsize.state",function(){e.editor.scene.setEye(ht.Default.graph3dViewEye)}),this.addLabelInput(i,"X",function(t){return parseFloat(e.editor.scene.getEye()[0])},function(t,i){var n=e.editor.scene.getEye();e.editor.scene.setEye(i,n[1],n[2])},"int",1),this.addLabelInput(i,"Y",function(t){return parseFloat(e.editor.scene.getEye()[1])},function(t,i){var n=e.editor.scene.getEye();e.editor.scene.setEye(n[0],i,n[2])},"int",1),this.addLabelInput(i,"Z",function(t){return parseFloat(e.editor.scene.getEye()[2])},function(t,i){var n=e.editor.scene.getEye();e.editor.scene.setEye(n[0],n[1],i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1]),i=[],i.push("\u76ee\u6807"),this.addButton(i,null,"\u91cd\u7f6e","editor.resetsize.state",function(){e.editor.scene.setCenter(ht.Default.graph3dViewCenter)}),this.addLabelInput(i,"X",function(t){return parseFloat(e.editor.scene.getCenter()[0])},function(t,i){var n=e.editor.scene.getCenter();e.editor.scene.setCenter(i,n[1],n[2])},"int",1),this.addLabelInput(i,"Y",function(t){return parseFloat(e.editor.scene.getCenter()[1])},function(t,i){var n=e.editor.scene.getCenter();e.editor.scene.setCenter(n[0],i,n[2])},"int",1),this.addLabelInput(i,"Z",function(t){return parseFloat(e.editor.scene.getCenter()[2])},function(t,i){var n=e.editor.scene.getCenter();e.editor.scene.setCenter(n[0],n[1],i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1]),i=[],this.addLabelRange(i,"\u8fd1\u7aef\u4f4d\u7f6e",function(){return e.editor.scene.getNear()},function(t,i){e.editor.scene.setNear(i)},1,void 0,1,"int"),this.addLabelRange(i,"\u8fdc\u7aef\u4f4d\u7f6e",function(){return e.editor.scene.getFar()},function(t,i){e.editor.scene.setFar(i)},0,void 0,100,"int"),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelColor(i,"\u80cc\u666f\u989c\u8272",hteditor.getter("p","background"),hteditor.setter("p","background")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelColor(i,"\u7f51\u683c\u989c\u8272",function(t){var i=e.editor.scene.getGridColor();return i instanceof Array?"rgba("+Math.floor(255*i[0])+","+Math.floor(255*i[1])+","+Math.floor(255*i[2])+","+i[3]+")":e.editor.scene.getGridColor()},function(t,i){e.editor.scene.setGridColor(i)}),this.addRow(i,[this.indent,.1]),i=[],this.addLabelRange(i,"\u7f51\u683c\u7ebf\u6570",function(t){return e.editor.scene.getGridSize()},function(t,i){e.editor.scene.setGridSize(i)},0,void 0,1,"int"),this.addLabelRange(i,"\u95f4\u8ddd",function(t){return e.editor.scene.getGridGap()},function(t,i){e.editor.scene.setGridGap(i)},1,void 0,1,"int"),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelImage(i,"\u73af\u5883\u5149\u8d34\u56fe",function(t){return t.getEnvmap()},function(t,e){return t.setEnvmap(e)}),this.addRow(i,[this.indent,.1,20]);var n=this.editor.scene,o=editor3d.scene.getHighlightHelper();i=[],this.addLabelComboBox(i,"\u9ad8\u4eae",function(){return o.mode},function(t,e){o.mode=e},[0,1,2],["\u65e0","\u9009\u4e2d","\u60ac\u6d6e"]),this.addRow(i,[this.indent,.1]);var r=[],s=n.getPostProcessingModule("Bloom"),a=function(){s.enable?r.forEach(function(t){e.addRow(t.items,t.widths,t.height,t)}):e.removeRows(r)};i=[],this.addLabelCheckBox(i,"\u8f89\u5149",function(){return s.enable},function(t,i){n.enablePostProcessing("Bloom",i),a(),n.iv(),e.updateProperties()}),this.addOneRow(i),i=[],this.addLabelRange(i,"\u5f3a\u5ea6",function(){return s.strength},function(t,i){s.strength=i,n.iv(),e.updateProperties()},0,void 0,.01,"number"),r.push(this.addOneRow(i)),i=[],this.addLabelRange(i,"\u8303\u56f4",function(){return s.radius},function(t,i){s.radius=i,n.iv(),e.updateProperties()},0,void 0,.01,"number"),r.push(this.addOneRow(i)),i=[],this.addLabelRange(i,"\u53d1\u5149\u9608\u503c",function(){return s.threshold},function(t,i){s.threshold=i,n.iv(),e.updateProperties()},0,1,.01,"number"),r.push(this.addOneRow(i)),a()},e}(_),N=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"data",!1))}return u(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addBasicProperties(),this.addWireframeProperties(),this.addTransformProperties()},e.prototype.addBasicProperties=function(){var t=this;this.addTitle("\u57fa\u7840");var e=[];this.addLabelInput(e,"\u540d\u79f0",hteditor.getter("p","displayName"),hteditor.setter("p","displayName")),this.addLabelInput(e,"\u6807\u7b7e",hteditor.getter("p","tag"),hteditor.setter("p","tag")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelURL(e,"\u5bfc\u822a",function(t){return t.a("navigate")||""},function(t,e){t.a("navigate",e)},function(t,e){var i=e.view.draggingData;return i&&("scene"===i.fileType||"display"===i.fileType)}),this.addLabelInput(e,"\u63d0\u793a",hteditor.getter("p","toolTip"),hteditor.setter("p","toolTip")),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelComboBox(e,"\u7c7b\u578b",function(t){return t.s("shape3d")},function(e,i){e.s("shape3d",i),t.editor.updateInspector()},["","billboard","plane","cone","cylinder","roundRect","sphere","torus","triangle"]),this.addOneRow(e),e=[],this.addLabelCheckBox(e,"\u53ef\u9009\u4e2d",function(t){return t.s("3d.selectable")},function(t,e){t.s("2d.selectable",e),t.s("3d.selectable",e)}),this.addLabelCheckBox(e,"\u53ef\u79fb\u52a8",function(t){return t.s("3d.movable")},function(t,e){t.s("2d.movable",e),t.s("3d.movable",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,"\u53ef\u7f16\u8f91",function(t){return t.s("3d.editable")},function(t,e){t.s("2d.editable",e),t.s("3d.editable",e)}),this.addLabelCheckBox(e,"\u53ef\u89c1",function(t){return t.s("3d.visible")},function(t,e){t.s("2d.visible",e),t.s("3d.visible",e)}),this.addRow(e,[this.indent,.1,this.indent2,.1]),e=[],this.addLabelCheckBox(e,"\u53ef\u4ea4\u4e92",function(t){return t.s("interactive")},function(t,e){return t.s("interactive",e)}),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,"\u73af\u5883\u5149",function(t){return t.s("envmap")||0},hteditor.setter("s","envmap"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,"\u9009\u4e2d\u4eae\u5ea6",function(t){return t.s("select.brightness")},hteditor.setter("s","select.brightness"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelObject(e,"\u591a\u8fb9\u5f62\u504f\u79fb",function(t){return t.s("polygonOffset")},hteditor.setter("s","polygonOffset"),"number"),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){this.addTitle("\u53d8\u6362");var t=[];t.push("\u4f4d\u7f6e"),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){t instanceof ht.Node&&t.p3(0,0,0)}),this.addLabelInput(t,"X",hteditor.getter("p","x"),hteditor.setter("p","x"),"int",1),this.addLabelInput(t,"Y",hteditor.getter("p","elevation"),hteditor.setter("p","elevation"),"int",1),this.addLabelInput(t,"Z",hteditor.getter("p","y"),hteditor.setter("p","y"),"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push("\u65cb\u8f6c"),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){t instanceof ht.Node&&t.r3(0,0,0)}),this.addLabelInput(t,"X",function(t){return Math.round(180/Math.PI*t.getRotationX())},function(t,e){t instanceof ht.Node&&t.setRotationX(e*Math.PI/180)},"int",1),this.addLabelInput(t,"Y",function(t){return Math.round(180/Math.PI*t.getRotationY())},function(t,e){t instanceof ht.Node&&t.setRotationY(e*Math.PI/180)},"int",1),this.addLabelInput(t,"Z",function(t){return Math.round(180/Math.PI*t.getRotationZ())},function(t,e){t instanceof ht.Node&&t.setRotationZ(e*Math.PI/180)},"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push("\u5927\u5c0f"),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){t instanceof ht.Node&&t.s3(-1,-1,-1)}),this.addLabelInput(t,"X",hteditor.getter("p","width"),hteditor.setter("p","width"),"int",1),this.addLabelInput(t,"Y",hteditor.getter("p","tall"),hteditor.setter("p","tall"),"int",1),this.addLabelInput(t,"Z",hteditor.getter("p","height"),hteditor.setter("p","height"),"int",1),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push("\u951a\u70b9"),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){t instanceof ht.Node&&t.setAnchor3d(.5,0,.5,!0)}),this.addLabelInput(t,"X",function(t){return parseFloat(t.getAnchorX().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(parseFloat(e),t.getAnchorElevation(),t.getAnchorY(),!0)},"number",.01),this.addLabelInput(t,"Y",function(t){return parseFloat(t.getAnchorElevation().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(t.getAnchorX(),parseFloat(e),t.getAnchorY(),!0)},"number",.01),this.addLabelInput(t,"Z",function(t){return parseFloat(t.getAnchorY().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setAnchor3d(t.getAnchorX(),t.getAnchorElevation(),parseFloat(e),!0)},"number",.01),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1]),t=[],t.push("\u7f29\u653e"),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){t instanceof ht.Node&&t.setScale3d(1,1,1)}),this.addLabelInput(t,"X",function(t){return parseFloat(t.getScaleX().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleX(parseFloat(e))},"number",.01),this.addLabelInput(t,"Y",function(t){return parseFloat(t.getScaleTall().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleTall(parseFloat(e))},"number",.01),this.addLabelInput(t,"Z",function(t){return parseFloat(t.getScaleY().toFixed(2))},function(t,e){t instanceof ht.Node&&t.setScaleY(parseFloat(e))},"number",.01),this.addRow(t,[this.indent-40-8,20,20,.1,20,.1,20,.1])},e.prototype.addWireframeProperties=function(){this.addTitle("\u7acb\u4f53\u7ebf\u6846");var t=[];this.addLabelComboBox(t,"\u663e\u793a",hteditor.getter("s","wf.visible"),function(t,e){t.s("wf.visible",e)},[!1,!0,"selected"]),this.addLabelCheckBox(t,"\u77ed\u7ebf\u6846",hteditor.getter("s","wf.short"),hteditor.setter("s","wf.short")),this.addRow(t,[this.indent,.1,this.indent2,.1]),t=[],this.addLabelColor(t,"\u989c\u8272",hteditor.getter("s","wf.color"),function(t,e){return t.s("wf.color",e)}),this.addRow(t,[this.indent,.1])},e.prototype.addAssociateObject=function(){var t=this,e=[];e.push("\u5173\u8054\u5bf9\u8c61");var i=new ht.widget.TextField;i.setEditable(!1),e.push(i),e.push(this.createSelectButton()),this.addRow(e,[this.indent,.1,40]),this.updateHandlers.push(function(){var e=t.editor.ld?t.editor.ld.a("hx.associateObject"):"";i.setText(e||"")})},e.prototype.createSelectButton=function(){var t=this,e=function(){for(var e=new ht.DataModel,i=new ht.widget.TreeView(e),n=0;n<3;n++){var o=new ht.Data;o.setName("\u5bf9\u8c61-"+n),e.add(o);for(var r=0;r<3;r++){var s=new ht.Data;s.setName("\u5bf9\u8c61-"+n+"-"+r),s.setParent(o),e.add(s)}}i.expandAll(),e.sm().setSelectionMode("single");var a=new ht.widget.FormPane;a.addRow([i],[.1],.1);var d=new ht.widget.Dialog,h=[];h.push({label:"\u786e\u8ba4",action:function(){if(t.editor.ld){var i=e.sm().ld(),n=i?i.getName():void 0;t.editor.ld.a("hx.associateObject",n)}d.hide()}},{label:"\u53d6\u6d88",action:function(){d.hide()}}),d.setConfig({title:"\u9009\u62e9\u5bf9\u8c61",draggable:!0,width:200,height:300,contentPadding:0,content:a,buttons:h,buttonsAlign:"right"}),d.show()};return hteditor.createButton("\u9009\u62e9",null,null,e)},e}(_),O=["all","front","back","left","right","top","bottom"],z=["\u516d\u9762","\u524d\u9762","\u540e\u9762","\u5de6\u9762","\u53f3\u9762","\u9876\u9762","\u5e95\u9762"],A=function(t,e,i){return function(n){var o=n.s(t+"."+e);return i&&void 0===o?n.s("all."+e):o}},H=function(t){return function(e){var i=e.s(t);return i||(i=e.s("all.uv.scale")),i?i[0]:1}},j=function(t){return function(e,i){var n=e.s(t);n||(n=e.s("all.uv.scale")),e.s(t,[i,n?n[1]:1])}},W=function(t){return function(e){var i=e.s(t);return i||(i=e.s("all.uv.scale")),i?i[1]:1}},q=function(t){return function(e,i){var n=e.s(t);n||(n=e.s("all.uv.scale")),e.s(t,[n?n[0]:1,i])}},U=function(t){return function(e){e.s(t,null)}},G=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Cube"))}return u(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addCubeProperties()},e.prototype.addCubeProperties=function(){var t=void 0,e=void 0,i=new ht.widget.TabView;e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var o=O[n]+".image";t=[],this.addLabelImage(t,z[n],A(O[n],"image"),hteditor.setter("s",o)),e.addRow(t,[this.indent,.1,20])}r(i,"\u56fe\u7247",e,!0),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var s=O[n]+".uv.scale";t=[],this.addLabel(t,z[n]),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",U(s)),this.addLabelInput(t,"U",H(s),j(s),"number",1),this.addLabelInput(t,"V",W(s),q(s),"number",1),e.addRow(t,[this.indent-20-8,20,20,.1,20,.1])}r(i,"\u91cd\u590d",e,!0),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var a=O[n]+".color";t=[],this.addLabelColor(t,z[n],A(O[n],"color"),hteditor.setter("s",a)),e.addRow(t,[this.indent,.1])}r(i,"\u989c\u8272",e),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var d=O[n]+".transparent";t=[],this.addLabelCheckBox(t,z[n],A(O[n],"transparent"),hteditor.setter("s",d)),e.addRow(t,[this.indent,.1])}r(i,"\u900f\u660e",e),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var h=O[n]+".visible";t=[],this.addLabelCheckBox(t,z[n],A(O[n],"visible",!0),hteditor.setter("s",h)),e.addRow(t,[this.indent,.1])}r(i,"\u53ef\u89c1",e),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var l=O[n]+".reverse.color";t=[],this.addLabelColor(t,z[n],A(O[n],"reverse.color"),hteditor.setter("s",l)),e.addRow(t,[this.indent,.1])}r(i,"\u80cc\u989c\u8272",e),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var c=O[n]+".reverse.flip";t=[],this.addLabelCheckBox(t,z[n],A(O[n],"reverse.flip",!0),hteditor.setter("s",c)),e.addRow(t,[this.indent,.1])}r(i,"\u80cc\u53cd\u8f6c",e),e=new ht.widget.FormPane;for(var n=0;n<O.length;n++){var u=O[n]+".reverse.cull";t=[],this.addLabelCheckBox(t,z[n],A(O[n],"reverse.cull",!0),hteditor.setter("s",u)),e.addRow(t,[this.indent,.1])}r(i,"\u80cc\u88c1\u526a",e),e.validateImpl();var p=i.getTabHeight()+e.getScrollHeight();t=[],t.push(i),this.addRow(t,[.1],p)},e}(N),J=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Cone"))}return u(e,t),e}(N),Z=["shape3d","shape3d.top","shape3d.bottom","shape3d.from","shape3d.to"],X=["\u4e3b\u9762","\u9876\u9762","\u5e95\u9762","\u8d77\u59cb\u9762","\u7ed3\u675f\u9762"],Y=["shape3d","shape3d.top","shape3d.bottom"],K=["\u4e3b\u9762","\u9876\u9762","\u5e95\u9762"],$=function(t){return function(e){var i=e.s(t);return i?i[0]:1}},Q=function(t){return function(e,i){var n=e.s(t);e.s(t,[i,n?n[1]:1])}},tt=function(t){return function(e){var i=e.s(t);return i?i[1]:1}},et=function(t){return function(e,i){var n=e.s(t);e.s(t,[n?n[0]:1,i])}},it=function(t){return function(e){e.s(t,null)}},nt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Shape3d"))}return u(e,t),e.prototype.initForm=function(){t.prototype.initForm.call(this),this.addEffectProperties(),this.addTopBodyBottomProperties()},e.prototype.getCurrentPoint=function(t){return this.editor.currentPoint?this.editor.currentPoint[t]:0},e.prototype.setCurrentPoint=function(t,e){console.log(t,e),this.editor.gv.getEditInteractor().getSubModule("Curve").setCurrentPoint(t,e)},e.prototype.addTopBodyBottomProperties=function(){var t=void 0,e=void 0,i=new ht.widget.TabView,n=this.faces,o=this.names;e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var a=n[s]+".image";t=[],this.addLabelImage(t,o[s],hteditor.getter("s",a),hteditor.setter("s",a)),e.addRow(t,[this.indent,.1,20])}r(i,"\u56fe\u7247",e,!0),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var d=n[s]+".uv.scale";t=[],this.addLabel(t,o[s]),this.addButton(t,null,"\u91cd\u7f6e","editor.resetsize.state",it(d)),this.addLabelInput(t,"U",$(d),Q(d),"number",1),this.addLabelInput(t,"V",tt(d),et(d),"number",1),e.addRow(t,[this.indent-20-8,20,20,.1,20,.1])}r(i,"\u91cd\u590d",e,!0),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var h=n[s]+".color";t=[],this.addLabelColor(t,o[s],hteditor.getter("s",h),hteditor.setter("s",h)),e.addRow(t,[this.indent,.1,20])}r(i,"\u989c\u8272",e),e=new ht.widget.FormPane;for(var s=0;s<n.length;s++){var l=n[s]+".visible";t=[],this.addLabelCheckBox(t,o[s],hteditor.getter("s",l),hteditor.setter("s",l)),e.addRow(t,[this.indent,.1,20])}r(i,"\u53ef\u89c1",e),e=new ht.widget.FormPane,t=[],this.addLabelColor(t,"\u989c\u8272",hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),e.addRow(t,[this.indent,.1]),t=[],
this.addLabelCheckBox(t,"\u53cd\u8f6c",hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),e.addRow(t,[this.indent,.1]),t=[],this.addLabelCheckBox(t,"\u88c1\u526a",hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),e.addRow(t,[this.indent,.1]),r(i,"\u80cc\u9762",e),e.validateImpl();var c=i.getTabHeight()+e.getScrollHeight();t=[],t.push(i),this.addRow(t,[.1],c)},e.prototype.addEffectProperties=function(){this.addTitle("\u6548\u679c");var t=[];this.addLabelCheckBox(t,"\u900f\u660e",hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(t,[this.indent,.1]),t=[],this.addLabelColor(t,"\u67d3\u8272",hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,"\u900f\u660e\u5ea6",hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,"\u8fb9\u6570",hteditor.getter("s","shape3d.side"),hteditor.setter("s","shape3d.side"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]),this.simple||(t=[],this.addLabelRange(t,"\u8d77\u59cb\u8fb9\u4f4d\u7f6e",hteditor.getter("s","shape3d.side.from"),hteditor.setter("s","shape3d.side.from"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]),t=[],this.addLabelRange(t,"\u7ed3\u675f\u8fb9\u4f4d\u7f6e",hteditor.getter("s","shape3d.side.to"),hteditor.setter("s","shape3d.side.to"),0,void 0,1,"int"),this.addRow(t,[this.indent,.1]))},e.prototype.addExtraProperties=function(t){},c(e,[{key:"simple",get:function(){return!1}},{key:"faces",get:function(){return this.simple?Y:Z}},{key:"names",get:function(){return this.simple?K:X}}]),e}(N),ot=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Cylinder"))}return u(e,t),e}(nt),rt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"RoundRect"))}return u(e,t),e}(N),st=["shape3d","shape3d.from","shape3d.to"],at=["\u4e3b\u9762","\u8d77\u59cb\u9762","\u7ed3\u675f\u9762"],dt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Sphere"))}return u(e,t),c(e,[{key:"faces",get:function(){return st}},{key:"names",get:function(){return at}}]),e}(nt),lt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Torus"))}return u(e,t),e}(N),ct=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Triangle"))}return u(e,t),e}(N),ut=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Model"))}return u(e,t),e.prototype.addBasicProperties=function(){t.prototype.addBasicProperties.call(this);var e=[],i=function(t,e){return!!e.view.draggingData&&"model"===e.view.draggingData.fileType};this.addLabelURL(e,"\u6a21\u578b",hteditor.getter("s","shape3d"),hteditor.setter("s","shape3d"),i),this.addRow(e,[this.indent,.1]),e=[],this.addLabelCheckBox(e,"\u900f\u660e",hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelColor(e,"\u989c\u8272",hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelColor(e,"\u67d3\u8272",hteditor.getter("s","shape3d.blend"),hteditor.setter("s","shape3d.blend")),this.addRow(e,[this.indent,.1]),e=[],this.addLabelRange(e,"\u900f\u660e\u5ea6",hteditor.getter("s","shape3d.opacity"),hteditor.setter("s","shape3d.opacity"),0,1,.01,"number"),this.addRow(e,[this.indent,.1]),e=[],this.addLabelCheckBox(e,"\u80cc\u88c1\u5207",hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addRow(e,[this.indent,.1])},e}(N),pt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Billboard"))}return u(e,t),e.prototype.addBasicProperties=function(){var e=this;t.prototype.addBasicProperties.call(this),this.addTitle("\u9762\u677f");var i=[];this.addLabelImage(i,"\u8d34\u56fe",function(t){return t.s("shape3d.image")},function(t,e){t.s("shape3d.image",e)}),this.addOneRow(i),i=[],this.addLabelInput(i,"\u8d34\u56fe\u7f29\u653e",function(t){return t.s("shape3d.texture.scale")||1},hteditor.setter("s","shape3d.texture.scale"),"number");var n=i[i.length-1];this.addOneRow(i),i=[],this.addLabelCheckBox(i,"\u7f6e\u9876",hteditor.getter("s","shape3d.alwaysOnTop"),hteditor.setter("s","shape3d.alwaysOnTop")),this.addLabelCheckBox(i,"\u900f\u660e",hteditor.getter("s","shape3d.transparent"),hteditor.setter("s","shape3d.transparent")),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelCheckBox(i,"\u81ea\u52a8\u65cb\u8f6c",hteditor.getter("s","shape3d.autorotate"),hteditor.setter("s","shape3d.autorotate"));var o=i[i.length-1];this.addLabelCheckBox(i,"\u7f13\u5b58",hteditor.getter("s","shape3d.image.cache"),function(t,i){t.s("shape3d.image.cache",i),i&&e.editor.scene.invalidateShape3dCachedImage(t),n.setDisabled(i)}),this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelCheckBox(i,"\u56fa\u5b9a\u5927\u5c0f",function(t){return!!t.s("shape3d.fixSizeOnScreen")},function(t,e){t.s("shape3d.fixSizeOnScreen",!!e&&[-1,-1]),e&&t.s("shape3d.autorotate",!0),o.setDisabled(e),r.setDisabled(e)}),this.addLabelCheckBox(i,"\u52a8\u6001\u5927\u5c0f",hteditor.getter("s","shape3d.vector.dynamic"),hteditor.setter("s","shape3d.vector.dynamic"));var r=i[i.length-1];this.addRow(i,[this.indent,.1,this.indent2,.1]),i=[],this.addLabelColor(i,"\u989c\u8272",hteditor.getter("s","shape3d.color"),hteditor.setter("s","shape3d.color")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelColor(i,"\u80cc\u989c\u8272",hteditor.getter("s","shape3d.reverse.color"),hteditor.setter("s","shape3d.reverse.color")),this.addRow(i,[this.indent,.1]),i=[],this.addLabelCheckBox(i,"\u80cc\u9762\u88c1\u5207",hteditor.getter("s","shape3d.reverse.cull"),hteditor.setter("s","shape3d.reverse.cull")),this.addLabelCheckBox(i,"\u80cc\u9762\u62f7\u8d1d",hteditor.getter("s","shape3d.reverse.flip"),hteditor.setter("s","shape3d.reverse.flip")),this.addRow(i,[this.indent,.1,this.indent2,.1])},e}(N),gt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Wall"))}return u(e,t),e.prototype.addBasicProperties=function(){t.prototype.addBasicProperties.call(this);var e=[];this.addLabelCheckBox(e,"\u662f\u5426\u95ed\u5408",hteditor.getter("p","closePath"),hteditor.setter("p","closePath")),this.addRow(e,[this.indent,.1])},e.prototype.addTransformProperties=function(){t.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,"\u91cd\u590d\u957f\u5ea6",hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,"\u539a\u5ea6",hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(e,"\u7cbe\u5ea6",hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e}(G),ft=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Floor"))}return u(e,t),e}(ot),mt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Pipeline"))}return u(e,t),e.prototype.addTransformProperties=function(){t.prototype.addTransformProperties.call(this);var e=[];this.addLabelRange(e,"\u91cd\u590d\u957f\u5ea6",hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(e,"\u539a\u5ea6",hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(e,"\u7cbe\u5ea6",hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(e,[this.indent,.1,30,.1,30,.1])},e.prototype.addExtraProperties=function(e){t.prototype.addExtraProperties.call(this);var i=[];this.addLabelInput(i,"\u8d77\u59cb\u89d2\u5ea6",function(t){return Math.round(180/Math.PI*t.s("shape3d.start.angle"))},function(t,e){t.s("shape3d.start.angle",e*Math.PI/180)},"int",1),e.addRow(i,[this.indent,.1]),i=[],this.addLabelInput(i,"\u8de8\u57df\u89d2\u5ea6",function(t){return Math.round(180/Math.PI*t.s("shape3d.sweep.angle"))},function(t,e){t.s("shape3d.sweep.angle",e*Math.PI/180)},"int",1),e.addRow(i,[this.indent,.1])},c(e,[{key:"simple",get:function(){return!0}}]),e}(nt),vt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Polyline"))}return u(e,t),e.prototype.addTransformProperties=function(){var e=this;t.prototype.addTransformProperties.call(this);var i=[];this.addLabelRange(i,"\u91cd\u590d\u957f\u5ea6",hteditor.getter("s","repeat.uv.length"),hteditor.setter("s","repeat.uv.length"),0,void 0,1,"int"),this.addLabelRange(i,"\u539a\u5ea6",hteditor.getter("p","thickness"),hteditor.setter("p","thickness"),0,Number.MAX_VALUE,1),this.addLabelRange(i,"\u7cbe\u5ea6",hteditor.getter("s","shape3d.resolution"),hteditor.setter("s","shape3d.resolution"),0,200,1,"int"),this.addRow(i,[this.indent,.1,30,.1,30,.1]),i=[],i.push("\u70b9"),this.addButton(i,null,"\u91cd\u7f6e","editor.resetsize.state",function(t){e.setCurrentPoint("e",0)}),this.addLabelInput(i,"X",function(t){return e.getCurrentPoint("x")},function(t,i){e.setCurrentPoint("x",i)},"int",1),this.addLabelInput(i,"Y",function(t){return e.getCurrentPoint("e")},function(t,i){e.setCurrentPoint("e",i)},"int",1),this.addLabelInput(i,"Z",function(t){return e.getCurrentPoint("y")},function(t,i){e.setCurrentPoint("y",i)},"int",1),this.addRow(i,[this.indent-40-8,20,20,.1,20,.1,20,.1])},c(e,[{key:"simple",get:function(){return!0}}]),e}(nt),yt=function(t){function e(i){return l(this,e),p(this,t.call(this,i,"Edge"))}return u(e,t),e}(N),bt=(function(t){function e(i,n){l(this,e);var o=p(this,t.call(this));o.modelDialog=i,o.data=n;var r=[];return r.push({label:"\u786e\u8ba4",action:function(){o.ok()}}),r.push({label:"\u53d6\u6d88",action:function(){o.hide()}}),o.setConfig({title:"\u544a\u8b66",closable:!0,draggable:!0,width:510,height:360,contentPadding:0,resizeMode:"wh",maximizable:!0,content:o.createFormPane(),buttons:r,buttonsAlign:"right"}),o.updateProperties(),o.updateColumns(),o.show(),o}u(e,t),e.prototype.ok=function(){if(!this.nameTextField.getValue())return void d.alert("\u63d0\u793a","\u544a\u8b66\u540d\u79f0\u4e0d\u80fd\u4e3a\u7a7a");if(!this.propertyTextField.getValue())return void d.alert("\u63d0\u793a","\u5173\u8054\u5c5e\u6027\u4e0d\u80fd\u4e3a\u7a7a");if(this.formPane.v("numberType")){var t=!0;if(this.alarmTable.dm().each(function(e){e.a("min")>=e.a("max")&&(t=!1)}),!t)return void d.alert("\u63d0\u793a","\u6700\u5c0f\u503c\u5927\u4e8e\u7b49\u4e8e\u6700\u5927\u503c\uff0c\u4e0d\u5408\u6cd5")}var e=this.modelDialog.json;e.alarms||(e.alarms=[]);var i=this.data;i||(i=new ht.Data,e.alarms.push(i.alarm={}),this.modelDialog.alarmTable.getDataModel().add(i));var n=i.alarm;n.name=this.nameTextField.getValue(),n.property=this.propertyTextField.getValue(),this.formPane.v("stringType")?n.type="string":n.type="number",n.items=[],this.alarmTable.dm().each(function(t){n.items.push({min:t.a("min"),max:t.a("max"),value:t.a("value"),severity:t.a("severity"),icon:t.a("icon"),action:t.a("action")})}),this.hide()},e.prototype.updateProperties=function(){var t=this;if(this.data){var e=this.data.alarm;this.nameTextField.setValue(e.name||""),this.propertyTextField.setValue(e.property||""),"string"===e.type?this.formPane.v("stringType",!0):this.formPane.v("numberType",!0),this.alarmTable.dm().clear(),e.items&&e.items.forEach(function(e){var i=new ht.Data;i.a({min:e.min,max:e.max,value:e.value,"hx.alarm.color":hteditor_config.haixin.alarmColors[e.severity],severity:e.severity,icon:e.icon,action:e.action}),t.alarmTable.dm().add(i)})}},e.prototype.updateColumns=function(){this.alarmTable&&(this.formPane.v("stringType")?(this.alarmTable.getColumnModel().getDataByTag("min").setVisible(!1),this.alarmTable.getColumnModel().getDataByTag("max").setVisible(!1),this.alarmTable.getColumnModel().getDataByTag("value").setVisible(!0)):(this.alarmTable.getColumnModel().getDataByTag("min").setVisible(!0),this.alarmTable.getColumnModel().getDataByTag("max").setVisible(!0),this.alarmTable.getColumnModel().getDataByTag("value").setVisible(!1)))},e.prototype.createFormPane=function(){var t=this;this.formPane=new ht.widget.FormPane,this.nameTextField=new ht.widget.TextField,this.propertyTextField=new ht.widget.TextField;var e={id:"numberType",radioButton:{label:"\u6570\u503c\u578b",groupId:"valueType",selected:!0,onValueChanged:function(){t.updateColumns()}}},i={id:"stringType",radioButton:{label:"\u5b57\u7b26\u4e32",groupId:"valueType",onValueChanged:function(){t.updateColumns()}}};this.formPane.addRow([null,"\u544a\u8b66\u540d\u79f0",this.nameTextField,null],[.1,70,"50+0.2",.1]),this.formPane.addRow([null,"\u5173\u8054\u5c5e\u6027",this.propertyTextField,null],[.1,70,"50+0.2",.1]),this.formPane.addRow([null,"\u6570\u503c\u7c7b\u578b",e,i,null],[.1,70,"25+0.1","25+0.1",.1]),this.formPane.addRow([null,{button:{label:"\u6dfb\u52a0",onClicked:function(){var e=new ht.Data;e.a({min:0,max:100,value:0,"hx.alarm.color":"red",severity:hteditor_config.haixin.alarmSeverityEnum.values[0],icon:hteditor_config.haixin.alarmIconEnum.values[0],action:hteditor_config.haixin.alarmActionEnum.values[0]}),t.alarmTable.dm().add(e),t.alarmTable.sm().ss(e)}}},{button:{label:"\u5220\u9664",onClicked:function(){if(!t.alarmTable.sm().ld())return void d.alert("\u63d0\u793a","\u672a\u9009\u4e2d\u544a\u8b66");t.alarmTable.removeSelection()}}}],[.1,40,40]);var n=d.createTablePane();return this.alarmTable=n.getTableView(),this.alarmTable.setEditable(!0),n.addColumns([{name:"min",tag:"min",displayName:"\u6700\u5c0f\u503c",align:"center",valueType:"number",accessType:"attr",editable:!0},{name:"max",tag:"max",displayName:"\u6700\u5927\u503c",align:"center",valueType:"number",accessType:"attr",editable:!0},{name:"value",tag:"value",displayName:"\u503c",align:"center",valueType:"string",accessType:"attr",editable:!0},{name:"severity",displayName:"\u8b66\u793a\u7ea7\u522b",align:"center",accessType:"attr",enum:hteditor_config.haixin.alarmSeverityEnum,setValue:function(t,e,i,n){t.a({severity:i,"hx.alarm.color":hteditor_config.haixin.alarmColors[i]})},editable:!0},{name:"icon",displayName:"\u8b66\u793a\u7b26\u53f7",align:"center",accessType:"attr",enum:hteditor_config.haixin.alarmIconEnum,onEditorCreated:function(t){t.editor.drawValue=function(t,e,i,n,o,r,s){var a=ht.Default.getImage(this.toIcon(e));a&&ht.Default.drawCenterImage(t,a,n+this.getWidth()/2,o+s/2)}},setValue:function(e,i,n,o){t.alarmTable.dm().each(function(t){t.a("icon",n)})},editable:!0},{name:"action",displayName:"\u8b66\u793a\u52a8\u4f5c",align:"center",accessType:"attr",enum:hteditor_config.haixin.alarmActionEnum,editable:!0}]),this.formPane.addRow([n],[.1],.1),this.formPane}}(ht.widget.Dialog),function(t){function e(i){l(this,e);var n=p(this,t.call(this));n.editor=i;var o=[];return o.push({label:"\u786e\u8ba4",action:function(){n.ok()}}),o.push({label:"\u53d6\u6d88",action:function(){n.hide()}}),n.dm=new ht.DataModel,n.node=new ht.Node,n.node.setAnchor3d(.5,0,.5),n.dm.add(n.node),n.g3d=new ht.graph3d.Graph3dView(n.dm),n.g3d.setGridVisible(!0),n.formPane=n.createFromPane(),n.splitView=new ht.widget.SplitView(n.g3d,n.formPane,"h",.55),n.setConfig({title:"OBJ\u6a21\u578b\u8bbe\u7f6e",closable:!0,draggable:!0,width:666,height:500,contentPadding:0,resizeMode:"wh",maximizable:!0,content:n.splitView,buttons:o,buttonsAlign:"right"}),n.setModal(!1),n}return u(e,t),e.prototype.ok=function(){var t=this,e=this.formPane.v("url");if(e){this.json||(this.json={modelType:"obj"}),this.json.obj=this.formPane.v("obj"),this.json.mtl=this.formPane.v("mtl"),this.json.image=this.formPane.v("imageURL"),this.json.prefix=this.formPane.v("prefix"),this.associateObjectTextField&&(this.json["hx.associateObject"]=this.associateObjectTextField.getValue()||void 0);var i={path:e,content:ht.Default.stringify(this.json)};this.editor.request("upload",i,function(n){t.node.s("shape3d",e),setTimeout(function(){i={path:e.substr(0,e.length-5)+".png",content:t.g3d.toDataURL(t.dm.getBackground())},t.editor.request("upload",i,function(e){t.hide()})},500)})}},e.prototype.open=function(t,e){this.url=t,this.json=e,this.node.s("shape3d",t),this.node.p3(0,0,0),this.g3d.reset(),this.update(),this.isShowing()||this.show()},e.prototype.update=function(){var t=this.json;this.url?(this.formPane.getViewById("url").setEditable(!1),this.formPane.v("url",this.url)):(this.formPane.getViewById("url").setEditable(!0),this.formPane.v("url",this.editor.models.currentDir+"/***.json"));var e=ht.Default.getShape3dModel(this.url);if(e&&e.rawS3){var i=e.rawS3[0],n=e.rawS3[1],o=e.rawS3[2],r=Math.max(n,i/(this.g3d.getAspect()||1)),s=r/2/Math.tan(this.g3d.getFovy()/2);s=2*Math.max(o/2,s),this.g3d.setEye(0,n/2,s),this.g3d.setCenter(0,n/2,0),this.g3d.setNear(Math.min(10,s/4)),this.g3d.setFar(Math.max(1e4,4*s)),t=this.json=ht.Default.parse(ht.Default.stringify(e.json))}t||(t={obj:"assets/objs/***.obj",mtl:"assets/objs/***.mtl",imageURL:"",prefix:"",image:null}),this.formPane.v("obj",t.obj||""),this.formPane.v("mtl",t.mtl||""),this.formPane.v("imageURL",t.image||""),this.formPane.v("prefix",t.prefix||""),this.formPane.getItemById("image").element.setIcon(t.image)},e.prototype.createFromPane=function(){var t=this,e=new ht.widget.FormPane;e.addRow([{element:"\u8def\u5f84"},{id:"url",textField:{}}],[60,.1]),e.addRow([{element:"obj"},{id:"obj",textField:{}}],[60,.1]),e.addRow([{element:"mtl"},{id:"mtl",textField:{}}],[60,.1]),e.addRow([{element:"\u8d34\u56fe\u524d\u7f00"},{id:"prefix",textField:{}}],[60,.1]),e.addRow([{element:"\u56fe\u7247"},{id:"imageURL",textField:{}}],[60,.1]),e.addRow([{id:"image",image:{}}],[.1],70);var i=e.getViewById("imageURL").getElement();return i.onblur=function(e){t.formPane.getItemById("image").element.setIcon(i.value)},i.onkeydown=function(e){ht.Default.isEnter(e)&&t.formPane.getItemById("image").element.setIcon(i.value)},e},e.prototype.createSelectButton=function(){var t=this,e=function(){for(var e=new ht.DataModel,i=new ht.widget.TreeView(e),n=0;n<3;n++){var o=new ht.Data;o.setName("\u5bf9\u8c61-"+n),e.add(o);for(var r=0;r<3;r++){var s=new ht.Data;s.setName("\u5bf9\u8c61-"+n+"-"+r),s.setParent(o),e.add(s)}}i.expandAll(),e.sm().setSelectionMode("single");var a=new ht.widget.FormPane;a.addRow([i],[.1],.1);var d=new ht.widget.Dialog,h=[];h.push({label:"\u786e\u8ba4",action:function(){var i=e.sm().ld(),n=i?i.getName():void 0;t.associateObjectTextField&&t.associateObjectTextField.setText(n),d.hide()}},{label:"\u53d6\u6d88",action:function(){d.hide()}}),d.setConfig({title:"\u9009\u62e9\u5bf9\u8c61",draggable:!0,width:200,height:300,contentPadding:0,content:a,buttons:h,buttonsAlign:"right"}),d.show()};return hteditor.createButton("\u9009\u62e9",null,null,e)},e}(ht.widget.Dialog)),wt=function(){function u(t){var e=this;l(this,u),this.params=t,this._eventNotifier=new ht.Notifier,this._clones=[],this.modelDialogs={},this.parentDOM=t.parentDOM||window;var i=ht.Default.getClass(hteditor.config.serviceClass||g);this.service=new i(this.handleServiceEvent.bind(this),this),ht.Default.handleModelLoaded=function(t,i){for(var n in e.modelDialogs){var o=e.modelDialogs[n];t===o.url&&o.isShowing()&&o.update&&o.update()}e.inspector&&e.inspector.updateProperties()},this.serializer=new ht.JSONSerializer,this.serializer.isSerializable=function(t){return e.scene.sm().contains(t)}}return u.prototype.addEventListener=function(){hteditor.Editor.prototype.addEventListener.apply(this,arguments)},u.prototype.removeEventListener=function(t,e){hteditor.Editor.prototype.removeEventListener.apply(this,arguments)},u.prototype.fireEvent=function(t,e){hteditor.Editor.prototype.fireEvent.apply(this,arguments)},u.prototype.handleServiceEvent=function(r){if("connected"===r.type)this.init&&(this.init(),this.init=null);else if("fileChanged"===r.type){var s=r.path;o(s)&&(this.scene.invalidateAll(),this.gv.invalidateAll()),t(s)?this.requestScenes():e(s)?(this.requestModels(),this.scene.invalidateAll(),this.gv.invalidateAll()):i(s)?this.requestSymbols():n(s)&&this.requestAssets()}else"download"===r.type&&this.downloadFile(r.path)},u.prototype.downloadFile=function(t){try{var e=document.createElement("iframe");e.src=htconfig.Default.protocol+"//"+htconfig.Default.host+":"+htconfig.Default.port+t,e.style.display="none",document.body.appendChild(e)}catch(t){}},u.prototype.beginTransaction=function(){this.dm.beginTransaction()},u.prototype.endTransaction=function(){this.dm.endTransaction()},u.prototype.toggleGridEnabled=function(){this.gridVisible=!this.gridVisible},u.prototype.init=function(){var t=this;this.menus=[],this.dm=new ht.DataModel,this.gv=new R(this),this.rulerView=new S(this.gv),this.scene=new P(this),this.functionView=new hteditor.FunctionView(this),this.fontView=new hteditor.FontView(this),this.objectView=new hteditor.ObjectView(this),this.sceneInspector=new M(this),this.dataInspector=new N(this),this.cubeInspector=new G(this),this.coneInspector=new J(this),this.cylinderInspector=new ot(this),this.roundRectInspector=new rt(this),this.sphereInspector=new dt(this),this.torusInspector=new lt(this),this.triangleInspector=new ct(this),this.modelInspector=new ut(this),this.billboardInspector=new pt(this),this.wallInspector=new gt(this),this.floorInspector=new ft(this),this.pipelineInspector=new mt(this),this.polylineInspector=new vt(this),this.edgeInspector=new yt(this),this.mainToolbar=new C(this),this.rightToolbar=new x(this),this.fireEvent("rightToolbarCreated"),this.topBorderPane=new ht.widget.BorderPane,this.topBorderPane.setCenterView(this.mainToolbar),this.topBorderPane.setRightView(this.rightToolbar),this.topBorderPane.setHeight(28),this.rightToolbar.onSumWidthChanged=function(){t.topBorderPane.setRightWidth(t.rightToolbar.getSumWidth())},this.setInteractionState("edit"),this.mainTabView=new ht.widget.TabView,this.scenes=new f(this),this.models=new m(this),this.symbols=new v(this),this.assets=new b(this),this.leftTopTabView=new ht.widget.TabView,r(this.leftTopTabView,"\u573a\u666f",this.scenes,!0),r(this.leftTopTabView,"\u6a21\u578b",this.models),r(this.leftTopTabView,"\u56fe\u6807",this.symbols),r(this.leftTopTabView,"\u8d44\u6e90",this.assets),this.treeView=new B(this),this.jsonView=new V(this),this.rightBottomTabView=new ht.widget.TabView,r(this.rightBottomTabView,"\u5217\u8868",this.treeView,!0),r(this.rightBottomTabView,"\u6570\u636e",this.jsonView);var e=this.rightBottomTabView.getTabModel().sm();e.ms(function(){var i=e.ld();t.jsonView.visible=(i?i.getView():null)===t.jsonView}),this.alignPane=new F(this),this.rightTopBorderPane=new ht.widget.BorderPane,this.rightTopBorderPane.setTopView(this.alignPane),this.rightTopBorderPane.setCenterView(this.inspectorPane),this.rightTopBorderPane.setTopHeight(ht.Default.widgetHeaderHeight+6),this.centerSplitView=new ht.widget.SplitView(this.rulerView,this.scene,"v"),this.leftSplitView=new ht.widget.SplitView(this.leftTopTabView,this.centerSplitView,"h",260),this.rightSplitView=new ht.widget.SplitView(this.rightTopBorderPane,this.rightBottomTabView,"v",-300),this.mainSplitView=new ht.widget.SplitView(this.leftSplitView,this.rightSplitView,"h",-360),this.mainPane=new ht.widget.BorderPane,this.mainPane.setTopView(this.topBorderPane),this.mainPane.setCenterView(this.mainSplitView),hteditor.layoutMainView(this.mainPane,this.parentDOM),this.parentDOM.addEventListener("keydown",this.handleKeydown.bind(this),!1),this.dnd=new hteditor.DND(this),this.dndFromOutside=new hteditor.DNDFromOutside(this,this.parentDOM),this.requestScenes(),this.requestModels(),this.requestSymbols(),this.requestAssets(),this.reset(),this.dm.addDataModelChangeListener(this.handleDataModelChange,this),this.dm.addPropertyChangeListener(this.handleDataModelPropertyChange,this),this.dm.addDataPropertyChangeListener(this.handleDataPropertyChange,this),this.sm.ms(this.handleSelectionChange,this),this.scene.addPropertyChangeListener(this.handleScenelPropertyChange,this),this.gv.addInteractorListener(this.handleInteractor,this),this.updateInspector(),this.fireEvent("editor3dCreated"),this.dm.enableHistoryManager(hteditor.config.maxUndoRedoSteps),this.initSID();var i=this.params.open||a("hteditor")||hteditor.config.open;i&&(hteditor.isJSON(i)?this._pendingOpenJSON=i:"newscene"===i&&this.newScene())},u.prototype.initSID=function(){var t=window.location.href.match("sid=([0-9a-z-]*)");t&&(this.sid=t[1])},u.prototype.handleDataModelPropertyChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},u.prototype.handleScenelPropertyChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},u.prototype.handleDataModelChange=function(t){this.inspector&&this.inspector.global&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},u.prototype.handleDataPropertyChange=function(t){var e=t.data;if("parent"===t.property&&e instanceof ht.Node&&!ht.Default.isIsolating()){var i=e.getParent();(!i||i instanceof ht.Node&&!(i instanceof ht.Block))&&e.setHost(i)}this.inspector&&!this.inspector.global&&this.inspector.data===e&&this.inspector.updateProperties(),this.jsonView.updateContentLater()},u.prototype.handleSelectionChange=function(){this.updateInspector()},u.prototype.handleInteractor=function(t){"selectPoint"===t.kind&&(this.currentPoint=void 0===t.x?null:{x:t.x,y:t.y,e:t.e},this.updateInspector())},u.prototype.updateInspector=function(){this.inspector=null;var t=this.ld;if(t){var e=t.s("shape3d");t instanceof ht.Polyline?this.inspector=this.polylineInspector:t instanceof ht.Shape?"cylinder"===e?this.inspector=this.pipelineInspector:t.getThickness()>0?this.inspector=this.wallInspector:this.inspector=this.floorInspector:t instanceof ht.Node?e?hteditor.isJSON(e)?this.inspector=this.modelInspector:"billboard"===e||"plane"===e?this.inspector=this.billboardInspector:"cube"===e?this.inspector=this.cubeInspector:"cone"===e?this.inspector=this.coneInspector:"cylinder"===e?this.inspector=this.cylinderInspector:"roundRect"===e?this.inspector=this.roundRectInspector:"sphere"===e?this.inspector=this.sphereInspector:"torus"===e?this.inspector=this.torusInspector:"triangle"===e&&(this.inspector=this.triangleInspector):this.inspector=this.cubeInspector:t instanceof ht.Edge&&(this.inspector=this.edgeInspector),this.inspector||(this.inspector=this.dataInspector)}else this.inspector=this.sceneInspector;this.inspector&&(this.inspector.data=t,this.inspector.updateProperties()),this.rightTopBorderPane.setCenterView(this.inspector)},u.prototype.reset=function(t){t||(this.url=null),this.dm.disableHistoryManager(),this.scene.setCenter([0,0,0]),this.scene.setEye([0,300,1e3]),this.scene.enablePostProcessing("Bloom",!1),this.gridVisible=!0,this.dm.setName(void 0),this.dm.setBackground(void 0),this.dm.setHierarchicalRendering(!0),this.dm.setLayers(void 0),this.dm.setAttrObject(void 0),this.dm.setEnvmap(void 0),this.dm.clear(),this.editInteractor.setStyle("gridBlockSize",50),this.editInteractor.setStyle("gridThickLinesEvery",hteditor.config.displayGridThickLinesEvery),this.editInteractor.setStyle("gridThickColor",hteditor.config.displayGridThickColor),this.editInteractor.setStyle("gridLightColor",hteditor.config.displayGridLightColor),this.editInteractor.setStyle("gridAngle",hteditor.config.displayGridAngle),this.editInteractor.setStyle("gridRotation",hteditor.config.displayGridRotation),this.editInteractor.setStyle("gridZoomThreshold",.02),this.dm.enableHistoryManager(),this.dm.clearHistoryManager()},u.prototype.getModelDialog=function(t){var e=this.modelDialogs[t];if(!e){var i=hteditor.config.modelDialogClasses?hteditor.config.modelDialogClasses[t]:null;i||(i=bt),e=this.modelDialogs[t]=new i(this)}return e},u.prototype.open=function(t,e){var i=this;if(ht.Default.isString(t)&&(t=this.getFileNode(t)),t&&!t._changedId){var n=t.url;"scene"===t.fileType?this.newScene(n):"model"===t.fileType&&ht.Default.xhrLoad(n,function(t){t=ht.Default.parse(t),i.getModelDialog(t.modelType).open(n,t)})}},u.prototype.newOBJModel=function(){this.getModelDialog("obj").open()},u.prototype.newScene=function(t){var e=this;t?ht.Default.xhrLoad(t,function(i){e.reset(),e.dm.disableHistoryManager(),e.url=t,e.deserialize(i),e.gv.fitContent(!0),e.dm.enableHistoryManager(),e.dm.clearHistoryManager()}):this.reset()},u.prototype.cancel=function(){var t=this,e=this.url;e&&ht.Default.xhrLoad(e,function(i){t.reset(),t.dm.disableHistoryManager(),t.url=e,t.deserialize(i),t.gv.fitContent(!0),t.dm.enableHistoryManager(),t.dm.clearHistoryManager()})},u.prototype.save=function(){var t=this;if(this.url)this.saveImpl(this.url);else{var e=this.scenes.currentDir,i=function(i,n){if("ok"===n){var o=hteditor.isJSON(i)?hteditor.trimExtension(i):i,r=e+"/"+o+".json",s=!1;if(t.scenes.dataModel.each(function(t){t.url===r&&(s=!0)}),s){var a=[{label:"\u786e\u5b9a",action:function(){d.hide()}}],d=new ht.widget.Dialog({title:hteditor.strings["editor.filenameconflict"],contentPadding:20,width:300,draggable:!0,content:"<p>"+hteditor.strings["editor.filenameExisted"]+"</p>",buttons:a});d.show()}else t.saveImpl(r)}},n={name:void 0,scene:this.scene};this.fireEvent("sceneNewNameInputing",n),n.name?i(n.name,"ok"):hteditor.getInput("\u65b0\u573a\u666f\u540d","",{nullable:!1,trim:!0,maxLength:hteditor.config.maxFileNameLength},i)}},u.prototype.saveImpl=function(t){var e=this;if(t){this.url=t;var i={url:t,scene:this.scene};if(this.fireEvent("sceneSaving",i),i.preventDefault)return!1;i={path:i.url,content:this.serialize()},this.request("upload",i,function(n){!0===n&&(i={path:t.substr(0,t.length-5)+".png",content:e.scene.toImage(e.dm.getBackground())},e.request("upload",i))})}},u.prototype.preview=function(){var t=this.dm.a("previewURL")||"scene.html";this.url&&-1===t.indexOf("?")&&(t+=-1===t.indexOf("?")?"?":"&",t+="tag="+encodeURI(this.url)),window.open(t,t);var e={path:"previews/scene.json",content:this.serialize()};this.request("upload",e,function(t){})},u.prototype.deserialize=function(t){t=ht.Default.parse(t);var e=t.scene;e&&(e.eye&&this.scene.setEye(e.eye),e.center&&this.scene.setCenter(e.center),e.near&&this.scene.setNear(e.near),e.far&&this.scene.setFar(e.far),e.background&&this.dm.setBackground(e.background),e.gridSize&&this.scene.setGridSize(e.gridSize),e.gridGap&&this.scene.setGridGap(e.gridGap),e.gridColor&&this.scene.setGridColor(e.gridColor)),this.dm.deserialize(t)},u.prototype.serialize=function(){return ht.Default.stringify(this.toJSON())},u.prototype.toJSON=function(){var t=this.dm.toJSON();return t.scene={eye:this.scene.getEye(),center:this.scene.getCenter(),near:this.scene.getNear(),far:this.scene.getFar(),background:this.dm.getBackground(),gridSize:this.scene.getGridSize(),gridGap:this.scene.getGridGap(),gridColor:this.scene.getGridColor()},t},u.prototype.getInteractionState=function(){return this._interactionState},u.prototype.setInteractionState=function(t,e){var i=this;if(this._interactionState!==t){this._interactionState=t,this.pointsEditingMode=!1;var n=[];this.gv.getInteractors().each(function(e){e.keep?e.interactiveDisabled="edit"!==t:n.push(e)}),n.forEach(function(t){t.tearDown(),i.gv.getInteractors().remove(t)}),"edit"!==t&&(e.setUp(),this.gv.getInteractors().add(e)),this.gv.invalidateSelection(),this.rulerView.validateCanvas(),this.mainToolbar.iv()}},u.prototype.request=function(t,e,i,n){var o=this;i=i||h,n?setTimeout(function(){o.service.request(t,e,i)},n):this.service.request(t,e,i)},u.prototype.requestScenes=function(){var e=this;this._requestingScenes||(this.request("explore","/scenes",function(i){e._requestingScenes=!1,e.scenes.parse(i),e._pendingOpenJSON&&t(e._pendingOpenJSON)&&(e.scenes.dataModel.getDataById(e._pendingOpenJSON)?(e.open(e._pendingOpenJSON),e.selectFileNode(e._pendingOpenJSON)):d.config.newIfFailToOpen&&(e.newScene(),e.url=e._pendingOpenJSON,e.save()),delete e._pendingOpenJSON)},hteditor.config.requestDelay),this._requestingScenes=!0)},u.prototype.requestSymbols=function(){var t=this;this._requestingSymbols||(this.request("explore","/symbols",function(e){t._requestingSymbols=!1,t.symbols.parse(e)},hteditor.config.requestDelay),
this._requestingSymbols=!0)},u.prototype.requestModels=function(){var t=this;this._requestingModels||(this.request("explore","/models",function(e){t._requestingModels=!1,t.models.parse(e)},hteditor.config.requestDelay),this._requestingModels=!0)},u.prototype.requestAssets=function(){var t=this;this._requestingAssets||(this.request("explore","/assets",function(e){t._requestingAssets=!1,t.assets.parse(e)},hteditor.config.requestDelay),this._requestingAssets=!0)},u.prototype.requestBase64=function(t,e){this.request("source",{url:t,encoding:"base64",prefix:"data:;base64,"},e)},u.prototype.copy=function(){this.ld&&(this.serializer.dm=this.scene.dm(),this._cloneJSON=this.serializer.serialize())},u.prototype.paste=function(){if(this._cloneJSON){var t=this.serializer.deserialize(this._cloneJSON);this.scene.sm().ss(t)}},u.prototype.undo=function(){hteditor.Editor.prototype.undo.apply(this,arguments)},u.prototype.redo=function(){hteditor.Editor.prototype.redo.apply(this,arguments)},u.prototype.renameFile=function(){hteditor.Editor.prototype.renameFile.apply(this,arguments)},u.prototype.getFileNode=function(){return hteditor.Editor.prototype.getFileNode.apply(this,arguments)},u.prototype.moveFile=function(){hteditor.Editor.prototype.moveFile.apply(this,arguments)},u.prototype.removeFiles=function(){hteditor.Editor.prototype.removeFiles.apply(this,arguments)},u.prototype.locate=function(){hteditor.Editor.prototype.locate.apply(this,arguments)},u.prototype.newFolder=function(){hteditor.Editor.prototype.newFolder.apply(this,arguments)},u.prototype.toggleLeft=function(){"normal"===this.leftSplitView.getStatus()?this.leftSplitView.setStatus("cl"):this.leftSplitView.setStatus("normal")},u.prototype.toggleRight=function(){"normal"===this.mainSplitView.getStatus()?this.mainSplitView.setStatus("cr"):this.mainSplitView.setStatus("normal")},u.prototype.handleKeydown=function(t){var e=t.keyCode,i=ht.Default.isCtrlDown(t);if(i&&83===e&&t.preventDefault(),i&&83===e)return void this.save();if(!ht.Default.isInput(t.target)){if(t.preventDefault(),ht.Default.isEsc(t))for(var n=0;n<this.menus.length;n++)if(this.menus[n].isShowing())return void this.menus[n].hide();var o=ht.Default.isShiftDown(t);if(80===e)this.preview();else if(90===e)if(i)o?this.redo():this.undo();else{var r=this.dm.sm().getSelection();0===r.length&&(r=null),this.zoomToFit(r)}else if(71===e){if(i){if(o){var s=this.dm.sm().ld();if(!s||!s.s("__group__"))return;this.beginTransaction();var a=s.getChildren().toArray();return a.forEach(function(t){t.setParent(null),t.setHost(null)}),this.dm.remove(s),this.dm.sm().ss(a),void this.endTransaction()}if(0===this.dm.sm().size())return;var d=this.scene.getBoundingBox(),h=d.min,l=d.max,c=l[0]-h[0],u=l[2]-h[2],p=l[1]-h[1];this.beginTransaction();var g=new ht.Node;g.s3(c,p,u),g.p3(h[0]+.5*c,h[1]+.5*p,h[2]+.5*u),g.s({shape3d:"box","shape3d.transparent":!0,"shape3d.color":"rgba(0, 0, 0, 0)","shape3d.reverse.cull":!0,__group__:!0}),this.dm.add(g);var r=this.dm.sm().getSelection();r.forEach(function(t){t.setParent(g),t.setHost(g)}),this.dm.sm().ss(g),this.endTransaction()}}else i&&67===e?this.copy():i&&86===e&&this.paste()}},u.prototype.selectFileNode=function(t){for(var e=this,i=this.leftTopTabView.getTabModel().getDatas(),n=0;n<i.size();n++){var o=i.get(n);if(o.getView()instanceof hteditor.Explorer){var r=function(){var i=o.getView(),n=i.dataModel.getDataById(t);if(n)return e.leftTopTabView.getTabModel().sm().ss(o),"dir"===n.fileType?(i.tree.sm().ss(n),setTimeout(function(){i.tree.makeVisible(n)},500)):(i.tree.sm().ss(n.getParent()),i.list.sm().ss(n),setTimeout(function(){i.tree.makeVisible(n.getParent()),i.list.makeVisible(n)},500)),{v:void 0}}();if("object"==typeof r)return r.v}}},u.prototype.dropLocalFileOnDir=function(t,e){for(var i=t.dataTransfer.files,n=0;n<i.length;n++)this.uploadLocalFile(i[n],e.url)},u.prototype.uploadLocalFile=function(t,e){var i=this,n=t.name;s(t,function(t){var o={path:e+"/"+n,content:t};i.request("upload",o)},!0)},u.prototype.zoomToFit=function(t){this.scene.flyTo(t,{animation:!0});var e=this.gv;if(!t)return void e.fitContent(!0);var i;t.each(function(t){i=ht.Default.unionRect(i,e.getDataUIBounds(t))}),ht.Default.grow(i,20,20),e.fitRect(i,!0)},c(u,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this.jsonView.updateURL()}},{key:"ld",get:function(){return this.sm.ld()}},{key:"sm",get:function(){return this.dm.sm()}},{key:"editInteractor",get:function(){return this.gv.getEditInteractor()}},{key:"pointsEditingMode",get:function(){return this.editInteractor.pointsEditingMode},set:function(t){this.editInteractor.pointsEditingMode=t}},{key:"anchorVisible",get:function(){return this.editInteractor.getStyle("anchorVisible")},set:function(t){this.editInteractor.setStyle("anchorVisible",t)}},{key:"gridVisible",get:function(){return this.scene.isGridVisible()},set:function(t){this.scene.setGridVisible(t),this.scene.setOriginAxisVisible(t),this.editInteractor.gridEnabled=t}},{key:"explorer",get:function(){return this.leftTopTabView.getCurrentTab().getView()}}]),u}();return d.version="0.3.2",d.createEditor3d=function(t){if(window.location.host.indexOf("hightopo")>=0){var e="https:"==document.location.protocol?"https://":"http://";document.write(unescape("%3Cdiv style='display:none'%3E%3Cspan id='cnzz_stat_icon_1000279011'%3E%3C/span%3E%3Cscript src='"+e+"s23.cnzz.com/z_stat.php%3Fid%3D1000279011%26show%3Dpic' type='text/javascript'%3E%3C/script%3E%3C/div%3E")),document.body.style.margin="0px",document.body.style.padding="0px"}t&&(ht.Default.isString(t)?t={container:t}:t.tagName&&t.appendChild&&(t={container:t})),t=t||{};var i=void 0,n=void 0===t.container?d.config.container:t.container;return null===n?i=null:n?ht.Default.isString(n)?i=document.getElementById(n):n.length?(i=ht.Default.createDiv(),i.style.left=n[0]+"px",i.style.top=n[1]+"px",i.style.width=n[2]+"px",i.style.height=n[3]+"px",document.body.appendChild(i)):i=n:i=document.body,t.parentDOM=i,new wt(t)},d});